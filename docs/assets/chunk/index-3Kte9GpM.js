import{j as Ft}from"../../main-XQ0DTgpi.js";const wn="1.0.0-rc.26",nt=typeof window<"u",ir=typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:Function("return this")(),An=()=>!1,ae=Array.isArray,Z=Object.assign,H=Object.defineProperty,k=Object.defineProperties,bn=Object.prototype.toString,ge=Object.prototype.hasOwnProperty,K=t=>bn.call(t);function me(t){return t===void 0}function Ne(t){return t===null}function B(t){return typeof t=="string"}function sr(t){return typeof t=="boolean"}function mt(t){return typeof t=="number"}function R(t){return typeof t=="function"}function U(t){return K(t)==="[object Object]"}function Pn(t){return!Ne(t)&&typeof t=="object"}function _t(t){return K(t)==="[object Promise]"}function Rn(t){var e;return R(t)&&((e=t.name)===null||e===void 0?void 0:e.indexOf("bound "))===0&&!t.hasOwnProperty("prototype")}function ot(t){var e;if(R(t)){const r=t.toString();return((e=t.prototype)===null||e===void 0?void 0:e.constructor)===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\s+[A-Z]/.test(r)||/^class\s+/.test(r)}return!1}function Sn(t){return typeof ShadowRoot<"u"&&t instanceof ShadowRoot}function it(t){var e;return t instanceof URL||!!(!((e=t)===null||e===void 0)&&e.href)}function le(t){var e;return t instanceof Element||B((e=t)===null||e===void 0?void 0:e.tagName)}function Me(t){var e;return t instanceof Node||mt((e=t)===null||e===void 0?void 0:e.nodeType)}function yn(t){return K(t)==="[object HTMLAnchorElement]"}function Mn(t){return K(t)==="[object HTMLAudioElement]"}function On(t){return K(t)==="[object HTMLVideoElement]"}function Dn(t){return K(t)==="[object HTMLLinkElement]"}function Cn(t){return K(t)==="[object HTMLBodyElement]"}function ar(t){return K(t)==="[object HTMLStyleElement]"}function Pe(t){return K(t)==="[object HTMLScriptElement]"}function In(t){return K(t)==="[object HTMLDivElement]"}function Ln(t){return K(t)==="[object HTMLImageElement]"}function xn(t){return K(t)==="[object HTMLBaseElement]"}function Ye(t){return K(t)==="[object DocumentFragment]"}function Tn(t){return K(t)==="[object ShadowRoot]"}function Je(t){return le(t)&&t.tagName.toUpperCase()==="MICRO-APP-BODY"}function Nn(t){return le(t)&&t.tagName.toUpperCase()==="MICRO-APP-HEAD"}function Bn(t){let e=K(t)==="[object HTMLElement]";if(e){const r=t.tagName.toUpperCase();e=e&&!r.startsWith("MICRO-APP")}return e}function Un(t){return K(t)==="[object ProxyDocument]"}function cr(t,e){try{return W(t).pathname.split(".").pop()===e}catch{return!1}}function re(t,e,r){if(t==null)throw new TypeError("includes target is null or undefined");const n=Object(t),o=parseInt(n.length,10)||0;if(o===0)return!1;r=parseInt(r,10)||0;let i=Math.max(r>=0?r:o+r,0);for(;i<o;){if(e===n[i]||e!==e&&n[i]!==n[i])return!0;i++}return!1}function I(t,e=null,...r){const n=e&&B(e)?` app ${e}:`:"";B(t)?console.error(`[micro-app]${n} ${t}`,...r):console.error(`[micro-app]${n}`,t,...r)}function _e(t,e=null,...r){const n=e&&B(e)?` app ${e}:`:"";B(t)?console.warn(`[micro-app]${n} ${t}`,...r):console.warn(`[micro-app]${n}`,t,...r)}function ee(t,...e){Promise.resolve().then(t.bind(null,...e))}function Wn(t,e=0,...r){setTimeout(t.bind(null,...r),e)}const W=function(){class t extends URL{}return(e,r)=>r?new t(""+e,r):new t(""+e)}();function Rt(t){return t.startsWith("//")?`${ir.location.protocol}${t}`:t}function vt(t,e=null){if(!B(t)||!t)return"";try{const{origin:r,pathname:n,search:o}=W(Rt(t),(window.rawWindow||window).location.href),i=`${r}${n}${o}`;return/^https?:\/\//.test(i)?i:""}catch(r){return I(r,e),""}}function $(t){return!B(t)||!t?"":t.replace(/(^\d+)|([^\w\d-_])/gi,"")}function st(t){const{origin:e,pathname:r}=W(t);if(/\.(\w+)$/.test(r)){const n=`${e}${r}`.split("/");return n.pop(),n.join("/")+"/"}return`${e}${r}/`.replace(/\/\/$/,"/")}function X(t,e){return!t||/^((((ht|f)tps?)|file):)?\/\//.test(t)||/^(data|blob):/.test(t)?t:W(t,st(Rt(e))).toString()}function Fn(t){const e=t.split("/");return e.pop(),Rt(e.join("/")+"/")}function at(t,e,r,n){let o=0;function i(){++o===t.length&&n&&n()}t.forEach((s,a)=>{_t(s)?s.then(c=>{e({data:c,index:a}),i()}).catch(c=>{r({error:c,index:a}),i()}):(e({data:s,index:a}),i())})}function Hn(){return"noModule"in document.createElement("script")}function jn(){return"inline-"+Math.random().toString(36).substr(2,15)}function $n(t){return t.filter(function(e){return e in this?!1:this[e]=!0},Object.create(null))}const ct=ir.requestIdleCallback||function(t){const e=Date.now();return setTimeout(function(){t({didTimeout:!1,timeRemaining(){return Math.max(0,50-(Date.now()-e))}})},1)};function lr(t){return new Promise(e=>{ct(()=>{t(e)})})}let St=null;function gt(t){St=t}function Q(){return St}function Be(t){St!==t&&!Ot()&&(gt(t),ee(()=>{gt(null)}))}let yt=null;function Et(t){yt=t}function Xe(){return yt}function Mt(t){yt!==t&&!Ot()&&(Et(t),ee(()=>{Et(null)}))}let Ie=!1;function Ot(){return Ie}function G(t){t!==!1?(gt(null),Et(null),t&&!Ie&&(Ie=!0,ee(()=>{Ie=!1}))):Ie=!1}function z(t,e){const r=(window.rawDocument||document).createElement(t,e);return r.__MICRO_APP_NAME__&&delete r.__MICRO_APP_NAME__,r.__PURE_ELEMENT__=!0,r}function de(t){return!t||/(^\d)|([^\w\d-_\u4e00-\u9fa5])/gi.test(t)}function Re(t){return/^body$/i.test(t)||/^head$/i.test(t)||/^html$/i.test(t)||/^title$/i.test(t)||/^:root$/i.test(t)}function ue(t){return Sn(t)?t.host:t}function pt(t){return t?t.replace(/^\s+|\s+$/g,""):""}function Ht(){return navigator.userAgent.indexOf("Firefox")>-1}function jt(t){const e={},r=t.split("&");for(const n of r){const o=n.indexOf("="),i=o<0?n:n.slice(0,o),s=o<0?null:n.slice(o+1);if(i in e){let a=e[i];ae(a)||(a=e[i]=[a]),a.push(s)}else e[i]=s}return e}function Ze(t){let e="";for(const r in t){const n=t[r];Ne(n)?e+=(e.length?"&":"")+r:(ae(n)?n:[n]).forEach(i=>{me(i)||(e+=(e.length?"&":"")+r,Ne(i)||(e+="="+i))})}return e}function $t(){const t=new Set;function e(r){return t.add(r),()=>t.has(r)?t.delete(r):!1}return{add:e,list:()=>t}}function Gn(){const t=new Map;function e(r,n){return t.set(r,n),()=>t.has(r)?t.delete(r):!1}return{add:e,get:r=>t.get(r),delete:r=>t.has(r)?t.delete(r):!1}}function wt(t){const e=t.attributes,r=new Map;for(let n=0;n<e.length;n++)r.set(e[n].name,e[n].value);return r}function Ue(t,e){t?t.push(()=>lr(r=>{e(),r()})):e()}function We(t){return t?.reduce((e,r)=>e.then(r),Promise.resolve())||null}function Fe(t){return t.startsWith("inline-")}function Gt(t,e,r,...n){try{R(t)&&t(...n)}catch(o){I(`An error occurred in app ${e} window.${r} 
`,null,o)}}function qn(t){for(;t?.firstChild;)t.removeChild(t.firstChild)}function qt(t,e){if(t==null)return!1;if(R(e)){if(typeof t=="number"||typeof t=="string"||typeof t=="boolean")return!1}else throw new TypeError("Right-hand side of 'instanceof' is not callable");let r=Object.getPrototypeOf(t);for(;r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}const Kn=["mounted","unmount"];function At(t,e){return Kn.includes(t)?`${t}-${e}`:t}function Qn(t){return U(t)?!Object.keys(t).length:!0}function Vn(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},target:{get(){return e}}})}function he(t,e,r,n){var o;if(!t)return _e(`element does not exist in lifecycle ${r}`,e);t=ue(t),G();const i=Z({name:e,container:t},n&&{error:n}),s=new CustomEvent(r,{detail:i});Vn(s,t),R((o=_.options.lifeCycles)===null||o===void 0?void 0:o[r])&&_.options.lifeCycles[r](s,e),t.dispatchEvent(s)}function ie(t,e,r={}){var n;const o=new CustomEvent(At(e,t.name),{detail:r});(n=t.sandBox)===null||n===void 0||n.microAppWindow.dispatchEvent(o)}function Ee(t,e=null,r={}){return G(),R(_.options.fetch)?_.options.fetch(t,r,e):window.fetch(t,r).then(n=>n.text())}class Dt{static getInstance(){return this.instance||(this.instance=new Dt),this.instance}run(e,r){const n=e.name,o=e.ssrUrl||e.url;(cr(o,"js")?Promise.resolve(`<micro-app-head><script src='${o}'><\/script></micro-app-head><micro-app-body></micro-app-body>`):Ee(o,n,{cache:"no-cache"})).then(a=>{if(!a){const c="html is empty, please check in detail";return e.onerror(new Error(c)),I(c,n)}a=this.formatHTML(o,a,n),r(a,e)}).catch(a=>{I(`Failed to fetch data from ${e.url}, micro-app stop rendering`,n,a),e.onLoadError(a)})}formatHTML(e,r,n){return this.processHtml(e,r,n,_.options.plugins).replace(/<head[^>]*>[\s\S]*?<\/head>/i,o=>o.replace(/<head/i,"<micro-app-head").replace(/<\/head>/i,"</micro-app-head>")).replace(/<body[^>]*>[\s\S]*?<\/body>/i,o=>o.replace(/<body/i,"<micro-app-body").replace(/<\/body>/i,"</micro-app-body>"))}processHtml(e,r,n,o){var i;if(!o)return r;const s=[];return o.global&&s.push(...o.global),!((i=o.modules)===null||i===void 0)&&i[n]&&s.push(...o.modules[n]),s.length>0?s.reduce((a,c)=>U(c)&&R(c.processHtml)?c.processHtml(a,e):a,r):r}}const Xn=/(^|\s+)(html|:root)(?=[\s>~[.#:]+|$)/,Kt=/(^|\s+)((html[\s>~]+body)|body)(?=[\s>~[.#:]+|$)/;function zn(t,e){t=e?`${e} ${t}`:t;const r=new Error(t);throw r.reason=t,e&&(r.filename=e),r}class Yn{constructor(){this.cssText="",this.prefix="",this.baseURI="",this.linkPath="",this.result="",this.scopecssDisable=!1,this.scopecssDisableSelectors=[],this.scopecssDisableNextLine=!1,this.mediaRule=this.createMatcherForRuleWithChildRule(/^@media *([^{]+)/,"@media"),this.supportsRule=this.createMatcherForRuleWithChildRule(/^@supports *([^{]+)/,"@supports"),this.documentRule=this.createMatcherForRuleWithChildRule(/^@([-\w]+)?document *([^{]+)/,"@document"),this.hostRule=this.createMatcherForRuleWithChildRule(/^@host\s*/,"@host"),this.importRule=this.createMatcherForNoneBraceAtRule("import"),this.charsetRule=this.createMatcherForNoneBraceAtRule("charset"),this.namespaceRule=this.createMatcherForNoneBraceAtRule("namespace"),this.containerRule=this.createMatcherForRuleWithChildRule(/^@container *([^{]+)/,"@container")}exec(e,r,n,o){return this.cssText=e,this.prefix=r,this.baseURI=n,this.linkPath=o||"",this.matchRules(),Ht()?decodeURIComponent(this.result):this.result}reset(){this.cssText=this.prefix=this.baseURI=this.linkPath=this.result="",this.scopecssDisable=this.scopecssDisableNextLine=!1,this.scopecssDisableSelectors=[]}matchRules(){for(this.matchLeadingSpaces(),this.matchComments();this.cssText.length&&this.cssText.charAt(0)!=="}"&&(this.matchAtRule()||this.matchStyleRule());)this.matchComments()}matchStyleRule(){const e=this.formatSelector(!0);return this.scopecssDisableNextLine=!1,e?(this.recordResult(e),this.matchComments(),this.styleDeclarations(),this.matchLeadingSpaces(),!0):this.printError("selector missing",this.linkPath)}formatSelector(e){const r=this.commonMatch(/^[^{]+/,e);if(!r)return!1;const n={};return r[0].replace(/\[([^\]=]+)(?:=([^\]]+))?\]/g,(i,s,a,c)=>{const u=`__mock_${s}_${c}Value__`;return n[u]=a,i.replace(a,u)}).replace(/(^|,[\n\s]*)([^,]+)/g,(i,s,a)=>(a=pt(a),a=a.replace(/\[[^\]=]+(?:=([^\]]+))?\]/g,(c,u)=>n[u]?c.replace(u,n[u]):c),a&&!(this.scopecssDisableNextLine||this.scopecssDisable&&(!this.scopecssDisableSelectors.length||this.scopecssDisableSelectors.includes(a))||Xn.test(a))&&(Kt.test(a)?a=a.replace(Kt,this.prefix+" micro-app-body"):a=this.prefix+" "+a),s+a))}styleDeclarations(){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?!0:this.printError("Declaration missing '}'",this.linkPath)):this.printError("Declaration missing '{'",this.linkPath)}matchAllDeclarations(e=0){let r=this.commonMatch(/^(?:url\(["']?(?:[^)"'}]+)["']?\)|[^{}/])*/,!0)[0];if(r&&(!this.scopecssDisableNextLine&&(!this.scopecssDisable||this.scopecssDisableSelectors.length)&&(r=r.replace(/url\((["']?)(.*?)\1\)/gm,(n,o,i)=>/^((data|blob):|#|%23)/.test(i)||/^(https?:)?\/\//.test(i)?n:(/^((\.\.?\/)|[^/])/.test(i)&&this.linkPath&&(this.baseURI=Fn(this.linkPath)),`url("${X(i,this.baseURI)}")`))),this.recordResult(r)),this.scopecssDisableNextLine=!1,!!this.cssText.length){if(this.cssText.charAt(0)==="/")this.cssText.charAt(1)==="*"?this.matchComments():this.commonMatch(/\/+/);else if(this.cssText.charAt(0)==="{")this.matchOpenBrace(),e++;else if(this.cssText.charAt(0)==="}"){if(e<1)return;this.matchCloseBrace(),e--}return this.matchAllDeclarations(e)}}matchAtRule(){return this.cssText[0]!=="@"?!1:(this.scopecssDisableNextLine=!1,this.keyframesRule()||this.mediaRule()||this.customMediaRule()||this.supportsRule()||this.importRule()||this.charsetRule()||this.namespaceRule()||this.containerRule()||this.documentRule()||this.pageRule()||this.hostRule()||this.fontFaceRule()||this.layerRule())}keyframesRule(){if(!this.commonMatch(/^@([-\w]+)?keyframes\s*/))return!1;if(!this.commonMatch(/^[^{]+/))return this.printError("@keyframes missing name",this.linkPath);if(this.matchComments(),!this.matchOpenBrace())return this.printError("@keyframes missing '{'",this.linkPath);for(this.matchComments();this.keyframeRule();)this.matchComments();return this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError("@keyframes missing '}'",this.linkPath)}keyframeRule(){let e;const r=[];for(;e=this.commonMatch(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)r.push(e[1]),this.commonMatch(/^,\s*/);return r.length?(this.styleDeclarations(),this.matchLeadingSpaces(),!0):!1}customMediaRule(){return this.commonMatch(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/)?(this.matchLeadingSpaces(),!0):!1}pageRule(){return this.commonMatch(/^@page */)?(this.formatSelector(!1),this.scopecssDisableNextLine=!1,this.commonHandlerForAtRuleWithSelfRule("page")):!1}fontFaceRule(){return this.commonMatch(/^@font-face\s*/)?this.commonHandlerForAtRuleWithSelfRule("font-face"):!1}layerRule(){return this.commonMatch(/^@layer\s*([^{;]+)/)?this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError("@layer missing '}'",this.linkPath)):!!this.commonMatch(/^[;]+/):!1}createMatcherForRuleWithChildRule(e,r){return()=>this.commonMatch(e)?this.matchOpenBrace()?(this.matchComments(),this.matchRules(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError(`${r} missing '}'`,this.linkPath)):this.printError(`${r} missing '{'`,this.linkPath):!1}createMatcherForNoneBraceAtRule(e){const r=new RegExp("^@"+e+"\\s*([^;]+);");return()=>this.commonMatch(r)?(this.matchLeadingSpaces(),!0):!1}commonHandlerForAtRuleWithSelfRule(e){return this.matchOpenBrace()?(this.matchAllDeclarations(),this.matchCloseBrace()?(this.matchLeadingSpaces(),!0):this.printError(`@${e} missing '}'`,this.linkPath)):this.printError(`@${e} missing '{'`,this.linkPath)}matchComments(){for(;this.matchComment(););}matchComment(){if(this.cssText.charAt(0)!=="/"||this.cssText.charAt(1)!=="*")return!1;this.scopecssDisableNextLine=!1;let e=2;for(;this.cssText.charAt(e)!==""&&(this.cssText.charAt(e)!=="*"||this.cssText.charAt(e+1)!=="/");)++e;if(e+=2,this.cssText.charAt(e-1)==="")return this.printError("End of comment missing",this.linkPath);let r=this.cssText.slice(2,e-2);return this.recordResult(`/*${r}*/`),r=pt(r.replace(/^\s*!/,"")),r==="scopecss-disable-next-line"?this.scopecssDisableNextLine=!0:/^scopecss-disable/.test(r)?r==="scopecss-disable"?this.scopecssDisable=!0:(this.scopecssDisable=!0,r.replace("scopecss-disable","").split(",").forEach(o=>{this.scopecssDisableSelectors.push(pt(o))})):r==="scopecss-enable"&&(this.scopecssDisable=!1,this.scopecssDisableSelectors=[]),this.cssText=this.cssText.slice(e),this.matchLeadingSpaces(),!0}commonMatch(e,r=!1){const n=e.exec(this.cssText);if(!n)return;const o=n[0];return this.cssText=this.cssText.slice(o.length),r||this.recordResult(o),n}matchOpenBrace(){return this.commonMatch(/^{\s*/)}matchCloseBrace(){return this.commonMatch(/^}\s*/)}matchLeadingSpaces(){this.commonMatch(/^\s*/)}recordResult(e){Ht()?this.result+=encodeURIComponent(e):this.result+=e}printError(e,r){this.cssText.length&&zn(e,r)}}function Qt(t,e,r,n,o){if(!t.__MICRO_APP_HAS_SCOPED__){t.__MICRO_APP_HAS_SCOPED__=!0;let i=null;try{i=Le.exec(t.textContent,r,n,o),Le.reset()}catch(s){Le.reset(),I(`An error occurred while parsing CSS:
`,e,s)}i&&(t.textContent=i)}}let Le;function lt(t,e,r){if(e.scopecss){const n=Ct(e.name);Le||(Le=new Yn);const o=i=>i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(t.textContent){Qt(t,e.name,n,e.url,r);const i=new MutationObserver(()=>{const s=o(n),a=t.textContent&&new RegExp(s).test(t.textContent);i.disconnect(),a||(t.__MICRO_APP_HAS_SCOPED__=!1,lt(t,e,r))});i.observe(t,{childList:!0,characterData:!0})}else{const i=new MutationObserver(function(){i.disconnect(),t.textContent&&!t.hasAttribute("data-styled")&&Qt(t,e.name,n,e.url,r)});i.observe(t,{childList:!0})}}return t}function Ct(t,e=!1){const r=e?"\\":"";return`${_.tagName}${r}[name=${t}${r}]`}function ur(t,e){Object.defineProperties(t,{currentTarget:{get(){return e}},srcElement:{get(){return e}},target:{get(){return e}}})}function hr(t){const e=new CustomEvent("load");ur(e,t),R(t.onload)?t.onload(e):t.dispatchEvent(e)}function dr(t){const e=new CustomEvent("error");ur(e,t),R(t.onerror)?t.onerror(e):t.dispatchEvent(e)}function Jn(){const t=new Map,e=new Map;function r(n){return{setInfo(o,i){n.set(o,i)},getInfo(o){var i;return(i=n.get(o))!==null&&i!==void 0?i:null},hasInfo(o){return n.has(o)},deleteInfo(o){return n.delete(o)}}}return{link:r(t),script:Object.assign(Object.assign({},r(e)),{deleteInlineInfo(n){n.forEach(o=>{Fe(o)&&e.delete(o)})}})}}var Y=Jn();function Zn(t,e,r){const n=r.appSpace;for(const o in n)if(o!==t){const i=n[o];if(i.parsedCode)return i.parsedCode.replace(new RegExp(Ct(o,!0),"g"),e)}}function kn(t,e){e.forEach((r,n)=>{n!=="rel"&&(n==="href"&&(n="data-origin-href"),l.rawSetAttribute.call(t,n,r))})}function fr(t,e,r,n=!1){const o=t.getAttribute("rel");let i=t.getAttribute("href"),s=null;if(o==="stylesheet"&&i){i=X(i,r.url);let a=Y.link.getInfo(i);const c={attrs:wt(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",appSpace:{[r.name]:c}},Y.link.setInfo(i,a),!n)r.source.links.add(i),s=document.createComment(`link element with href=${i} move to micro-app-head as style element`),a.appSpace[r.name].placeholder=s;else return{address:i,linkInfo:a}}else o&&["prefetch","preload","prerender","modulepreload","icon"].includes(o)?n?s=document.createComment(`link element with rel=${o}${i?" & href="+i:""} removed by micro-app`):e?.removeChild(t):i&&l.rawSetAttribute.call(t,"href",X(i,r.url));if(n)return{replaceComment:s};if(s)return e?.replaceChild(s,t)}function eo(t,e,r,n){const o=Array.from(e.source.links),i=o.map(a=>{const c=Y.link.getInfo(a);return c.code?c.code:Ee(a,e.name)}),s=n?[]:null;at(i,a=>{Ue(s,()=>to(o[a.index],a.data,r,e))},a=>{I(a,e.name)},()=>{n?n.then(()=>{s.push(()=>Promise.resolve(e.onLoad({html:t}))),We(s)}):e.onLoad({html:t})})}function to(t,e,r,n){const o=Y.link.getInfo(t);o.code=e;const i=o.appSpace[n.name],s=i.placeholder;if(s){const a=z("style");pr(n,t,a,o,i.attrs),s.parentNode?s.parentNode.replaceChild(a,s):r.appendChild(a),i.placeholder=null}}function pr(t,e,r,n,o){if(t.scopecss){const i=n.appSpace[t.name];if(i.prefix=i.prefix||Ct(t.name),i.parsedCode)r.textContent=i.parsedCode;else{const s=Zn(t.name,i.prefix,n);s?r.textContent=s:(r.textContent=n.code,lt(r,t,e)),i.parsedCode=r.textContent}}else r.textContent=n.code;kn(r,o)}function ro(t,e,r,n){const o=z("style"),i=()=>{pr(e,t,o,r,r.appSpace[e.name].attrs),hr(n)};return r.code?ee(i):Ee(t,e.name).then(s=>{r.code=s,i()}).catch(s=>{I(s,e.name),dr(n)}),o}var xe;(function(t){t.NAME="name",t.URL="url"})(xe||(xe={}));var j;(function(t){t.CREATED="created",t.LOADING="loading",t.LOAD_FAILED="load_failed",t.BEFORE_MOUNT="before_mount",t.MOUNTING="mounting",t.MOUNTED="mounted",t.UNMOUNT="unmount"})(j||(j={}));var N;(function(t){t.CREATED="created",t.BEFOREMOUNT="beforemount",t.MOUNTED="mounted",t.UNMOUNT="unmount",t.ERROR="error",t.BEFORESHOW="beforeshow",t.AFTERSHOW="aftershow",t.AFTERHIDDEN="afterhidden"})(N||(N={}));var Ae;(function(t){t.ONMOUNT="onmount",t.ONUNMOUNT="onunmount"})(Ae||(Ae={}));var Te;(function(t){t.KEEP_ALIVE_SHOW="keep_alive_show",t.KEEP_ALIVE_HIDDEN="keep_alive_hidden"})(Te||(Te={}));var Vt;(function(t){t.DESTROY="destroy",t.DESTORY="destory",t.INLINE="inline",t.DISABLESCOPECSS="disableScopecss",t.DISABLESANDBOX="disableSandbox",t.DISABLE_SCOPECSS="disable-scopecss",t.DISABLE_SANDBOX="disable-sandbox",t.DISABLE_MEMORY_ROUTER="disable-memory-router",t.DISABLE_PATCH_REQUEST="disable-patch-request",t.KEEP_ROUTER_STATE="keep-router-state",t.KEEP_ALIVE="keep-alive",t.CLEAR_DATA="clear-data",t.SSR="ssr",t.FIBER="fiber"})(Vt||(Vt={}));const Xt="window,self,globalThis,document,Document,Array,Object,String,Boolean,Math,Number,Symbol,Date,Function,Proxy,WeakMap,WeakSet,Set,Map,Reflect,Element,Node,RegExp,Error,TypeError,JSON,isNaN,parseFloat,parseInt,performance,console,decodeURI,encodeURI,decodeURIComponent,encodeURIComponent,navigator,undefined,location,history",zt=[1,2,3],mr="state",He="search",ke="native",_r="native-scope",vr="pure",no=[He,mr,ke,_r,vr],gr=["popstate","hashchange","load","unload","unmount","appstate-change","statechange","mounted","error"],oo=gr,io=gr.concat(["unhandledrejection","message"]),Er=["onpopstate","onhashchange","onload","onunload","onerror"],so=Er,ao=Er.concat(["onunhandledrejection"]),co=["DOMContentLoaded","readystatechange"],lo=["onreadystatechange"],wr=["window","self","globalThis"],uo=["rawWindow","rawDocument"],ho=["host","hostname","port","protocol","origin"],fo=["text/javascript","text/ecmascript","application/javascript","application/ecmascript","module","systemjs-module","systemjs-importmap"];function fe(t,e){return e.appSpace[t.name].module&&(!t.useSandbox||t.iframe)}function po(t,e){return e.appSpace[t.name].attrs.has("id")}function ut(t,e){return t.inline||e.appSpace[t.name].inline||fe(t,e)||po(t,e)}function Ar(t){return t.iframe?t.sandBox.microAppWindow:l.rawWindow}function mo(t,e){const r=Ar(t);return new r.Function(e)}function _o(t,e,r){const n=e.appSpace;for(const o in n)if(o!==t.name){const i=n[o];if(i.parsedCode===r&&i.parsedFunction)return i.parsedFunction}}function br(t,e,r){return _o(t,e,r)||mo(t,r)}function Pr(){const t=jn();return Y.script.hasInfo(t)?Pr():t}function vo(t,e){e.forEach((r,n)=>{n==="type"&&r==="module"||n==="defer"||n==="async"||(n==="src"&&(n="data-origin-src"),l.rawSetAttribute.call(t,n,r))})}function Rr(t,e){return t.useSandbox&&!fe(t,e)}function Sr(t,e){return Rr(t,e)?t.iframe?"iframe":"with":"disable"}function yr(t,e,r,n=!1){var o;let i=null,s=t.getAttribute("src");if(s&&(s=X(s,r.url)),t.hasAttribute("exclude")||It(s,r.name))i=document.createComment("script element with exclude attribute removed by micro-app");else{if(t.type&&!fo.includes(t.type)||t.hasAttribute("ignore")||Lt(s,r.name))return!((o=l.rawDocument)===null||o===void 0)&&o.currentScript&&delete l.rawDocument.currentScript,null;if(l.supportModuleScript&&t.noModule||!l.supportModuleScript&&t.type==="module")i=document.createComment(`${t.noModule?"noModule":"module"} script ignored by micro-app`);else if(s){let a=Y.script.getInfo(s);const c={async:t.hasAttribute("async"),defer:t.defer||t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:wt(t)};if(a?a.appSpace[r.name]=a.appSpace[r.name]||c:a={code:"",isExternal:!0,appSpace:{[r.name]:c}},Y.script.setInfo(s,a),!n)r.source.scripts.add(s),i=document.createComment(`script with src='${s}' extract by micro-app`);else return{address:s,scriptInfo:a}}else if(t.textContent){const a=Pr(),c={code:t.textContent,isExternal:!1,appSpace:{[r.name]:{async:!1,defer:t.type==="module",module:t.type==="module",inline:t.hasAttribute("inline"),pure:t.hasAttribute("pure"),attrs:wt(t)}}};if(!n)r.source.scripts.add(a),Y.script.setInfo(a,c),i=document.createComment("inline script extract by micro-app");else return{address:a,scriptInfo:c}}else n||(i=document.createComment("script element removed by micro-app"))}return n?{replaceComment:i}:e?.replaceChild(i,t)}function Mr(t){var e,r,n;const o=((e=_.options.plugins)===null||e===void 0?void 0:e.global)||[],i=((n=(r=_.options.plugins)===null||r===void 0?void 0:r.modules)===null||n===void 0?void 0:n[t])||[];return[...o,...i]}function It(t,e){return t?(Mr(e)||[]).some(n=>n.excludeChecker?n.excludeChecker(t):!1):!1}function Lt(t,e){return t?(Mr(e)||[]).some(n=>n.ignoreChecker?n.ignoreChecker(t):!1):!1}function go(t,e){const r=Array.from(e.source.scripts),n=[],o=[];for(const s of r){const a=Y.script.getInfo(s),c=a.appSpace[e.name];(!c.defer&&!c.async||e.isPrefetch&&!e.isPrerender)&&(n.push(a.code?a.code:Ee(s,e.name)),o.push([s,a]))}const i=e.isPrefetch||e.fiber?[]:null;n.length?at(n,s=>{Ue(i,()=>Eo(o[s.index][0],o[s.index][1],s.data,e))},s=>{I(s,e.name)},()=>{i?(i.push(()=>Promise.resolve(e.onLoad({html:t}))),We(i)):e.onLoad({html:t})}):e.onLoad({html:t})}function Eo(t,e,r,n){if(e.code=r,n.isPrefetch&&n.prefetchLevel===2){const o=e.appSpace[n.name];if(!o.parsedCode&&(o.parsedCode=Or(t,n,r,e),o.sandboxType=Sr(n,e),!ut(n,e)))try{o.parsedFunction=br(n,e,o.parsedCode)}catch(i){I("Something went wrong while handling preloaded resources",n.name,`
`,i)}}}function wo(t,e){const r=t.fiber?[]:null,n=Array.from(t.source.scripts),o=[],i=[];for(const s of n){const a=Y.script.getInfo(s),c=a.appSpace[t.name];c.defer||c.async?(a.isExternal&&!a.code&&!fe(t,a)?o.push(Ee(s,t.name)):o.push(a.code),i.push([s,a]),fe(t,a)&&(e.moduleCount=e.moduleCount?++e.moduleCount:1)):Ue(r,()=>{et(s,t,a),e(!1)})}o.length?at(o,s=>{const a=i[s.index][1];a.code=a.code||s.data},s=>{e.errorCount=e.errorCount?++e.errorCount:1,I(s,t.name)},()=>{i.forEach(([s,a])=>{B(a.code)&&Ue(r,()=>{et(s,t,a,e),!fe(t,a)&&e(!1)})}),r?(r.push(()=>Promise.resolve(e(me(e.moduleCount)||e.errorCount===o.length))),We(r)):e(me(e.moduleCount)||e.errorCount===o.length)}):r?(r.push(()=>Promise.resolve(e(!0))),We(r)):e(!0)}function et(t,e,r,n,o){var i,s;try{So(e);const a=r.appSpace[e.name],c=Sr(e,r);if((!a.parsedCode||a.sandboxType!==c)&&(a.parsedCode=Or(t,e,r.code,r),a.sandboxType=c,a.parsedFunction=null),ut(e,r)){const u=o||z("script");if(Po(t,a.parsedCode,fe(e,r),u,a.attrs,n),!o){const d=e.iframe?(i=e.sandBox)===null||i===void 0?void 0:i.microBody:e.querySelector("micro-app-body");d?.appendChild(u)}}else Ro(e,r)}catch(a){console.warn(`[micro-app from ${o?"runDynamicScript":"runScript"}] app ${e.name}: `,a,t);const c=a;let u=!0;if(typeof((s=_?.options)===null||s===void 0?void 0:s.excludeRunScriptFilter)=="function"&&(u=_.options.excludeRunScriptFilter(t,c,e.name,e.url)!==!0),u)throw a}}function Ao(t,e,r,n){const o=ut(e,r)?z("script"):document.createComment(`dynamic script with src='${t}' extract by micro-app`),i=()=>hr(n),s=()=>{const a=Object.getOwnPropertyDescriptor(l.rawDocument,"currentScript");(!a||a.configurable)&&Object.defineProperty(l.rawDocument,"currentScript",{value:n,configurable:!0}),et(t,e,r,i,o),!fe(e,r)&&i()};return r.code||fe(e,r)?ee(s):Ee(t,e.name).then(a=>{r.code=a,s()}).catch(a=>{I(a,e.name),dr(n)}),o}function bo(t,e,r){const n=ut(e,r)?z("script"):document.createComment("dynamic inline script extract by micro-app");return et(t,e,r,void 0,n),n}function Po(t,e,r,n,o,i){if(r){if(l.rawSetAttribute.call(n,"type","module"),Fe(t)?n.textContent=e:n.src=t,i){const s=()=>{i.moduleCount&&i.moduleCount--,i(i.moduleCount===0)};Fe(t)?ee(s):n.onload=s}}else n.textContent=e;vo(n,o)}function Ro(t,e){const r=e.appSpace[t.name];r.parsedFunction||(r.parsedFunction=br(t,e,r.parsedCode)),r.parsedFunction.call(Ar(t))}function Or(t,e,r,n){return U(_.options.plugins)&&(r=Mo(t,r,e.name,_.options.plugins)),Rr(e,n)?e.iframe?`(function(window,self,global,location){;${r}
${Fe(t)?"":`//# sourceURL=${t}
`}}).call(window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyWindow,window.__MICRO_APP_SANDBOX__.proxyLocation);`:`;(function(proxyWindow){with(proxyWindow.__MICRO_APP_WINDOW__){(function(${Xt}){;${r}
${Fe(t)?"":`//# sourceURL=${t}
`}}).call(proxyWindow,${Xt})}})(window.__MICRO_APP_PROXY_WINDOW__);`:r}function So(t){yo(t)}function yo(t){t.sandBox&&(l.rawWindow.__MICRO_APP_PROXY_WINDOW__=t.sandBox.proxyWindow)}function Mo(t,e,r,n){var o;const i=Yt(n.global,e,t);return Yt((o=n.modules)===null||o===void 0?void 0:o[r],i,t)}function Yt(t,e,r){return ae(t)?t.reduce((n,o)=>U(o)&&R(o.loader)?o.loader(n,r):n,e):e}function Oo(t,e,r){if(!t||!Cn(t))return;Array.from(t.getElementsByTagName("link")).map(a=>(a.hasAttribute("exclude")||It(a.getAttribute("href"),e.name)?a.parentElement.replaceChild(document.createComment("link element with exclude attribute ignored by micro-app"),a):a.hasAttribute("ignore")||Lt(a.getAttribute("href"),e.name)?a.hasAttribute("href")&&l.rawSetAttribute.call(a,"href",X(a.getAttribute("href"),e.url)):fr(a,a.parentElement,e),a)),Array.from(t.getElementsByTagName("style")).map(a=>(a.hasAttribute("exclude")?a.parentElement.replaceChild(document.createComment("style element with exclude attribute ignored by micro-app"),a):e.scopecss&&!a.hasAttribute("ignore")&&Ue(r,()=>lt(a,e)),a)),Array.from(t.getElementsByTagName("script")).map(a=>(yr(a,a.parentElement,e),a)),Array.from(t.getElementsByTagName("img")).map(a=>(a.hasAttribute("src")&&l.rawSetAttribute.call(a,"src",X(a.getAttribute("src"),e.url)),a))}function Do(t,e){const r=e.parseHtmlString(t),n=l.rawElementQuerySelector.call(r,"micro-app-head"),o=l.rawElementQuerySelector.call(r,"micro-app-body");if(!n||!o){const a=`element ${n?"body":"head"} is missing`;return e.onerror(new Error(a)),I(a,e.name)}const i=e.isPrefetch||e.fiber?[]:null;Oo(r,e,i);const s=We(i);e.source.links.size?eo(r,e,n,s):s?s.then(()=>e.onLoad({html:r})):e.onLoad({html:r}),e.source.scripts.size?go(r,e):e.onLoad({html:r})}class Co{constructor(){this.eventList=new Map,this.queue=[],this.recordStep={},this.process=()=>{var e,r;let n;const o=this.recordStep,i=this.queue;for(this.recordStep={},this.queue=[];n=i.shift();){const s=this.eventList.get(n),a=s.tempData,c=s.force;s.tempData=null,s.force=!1;let u;if(c||!this.isEqual(s.data,a)){s.data=a||s.data;for(const d of s.callbacks){const w=d(s.data);w&&(u??(u=[])).push(w)}(r=(e=o[n]).dispatchDataEvent)===null||r===void 0||r.call(e),o[n].nextStepList.forEach(d=>d(u))}}}}isLegalName(e){return e?!0:(I("event-center: Invalid name"),!1)}enqueue(e,r,n){this.recordStep[e]?(this.recordStep[e].nextStepList.push(r),n&&(this.recordStep[e].dispatchDataEvent=n)):this.recordStep[e]={nextStepList:[r],dispatchDataEvent:n},!this.queue.includes(e)&&this.queue.push(e)===1&&ee(this.process)}isEqual(e,r){if(!r||Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==r[n])return!1;return!0}on(e,r,n=!1){if(this.isLegalName(e)){if(!R(r))return I("event-center: Invalid callback function");let o=this.eventList.get(e);o?n&&Object.keys(o.data).length&&(!this.queue.includes(e)||this.isEqual(o.data,o.tempData))&&r(o.data):(o={data:{},callbacks:new Set},this.eventList.set(e,o)),o.callbacks.add(r)}}off(e,r){if(this.isLegalName(e)){const n=this.eventList.get(e);n&&(R(r)?n.callbacks.delete(r):n.callbacks.clear())}}clearData(e){if(this.isLegalName(e)){const r=this.eventList.get(e);r&&(r.data={})}}dispatch(e,r,n,o,i){if(this.isLegalName(e)){if(!U(r))return I("event-center: data must be object");let s=this.eventList.get(e);s?(s.tempData=Z({},s.tempData||s.data,r),!s.force&&(s.force=!!o)):(s={data:r,callbacks:new Set},this.eventList.set(e,s),s.force=!0),this.enqueue(e,n,i)}}getData(e){var r;const n=this.eventList.get(e);return(r=n?.data)!==null&&r!==void 0?r:null}}const T=new Co;function q(t,e){return!B(t)||!t?"":e?`__${t}_from_base_app__`:`__${t}_from_micro_app__`}class Dr{addGlobalDataListener(e,r){const n=this.appName;n&&(e.__APP_NAME__=n,e.__AUTO_TRIGGER__=r),T.on("global",e,r)}removeGlobalDataListener(e){R(e)&&T.off("global",e)}setGlobalData(e,r,n){G(),T.dispatch("global",e,o=>R(r)&&r(o),n)}forceSetGlobalData(e,r){this.setGlobalData(e,r,!0)}getGlobalData(){return T.getData("global")}clearGlobalData(){T.clearData("global")}clearGlobalDataListener(){const e=this.appName,r=T.eventList.get("global");if(r)for(const n of r.callbacks)(e&&e===n.__APP_NAME__||!(e||n.__APP_NAME__))&&r.callbacks.delete(n)}}class Io extends Dr{addDataListener(e,r,n){T.on(q($(e),!1),r,n)}removeDataListener(e,r){R(r)&&T.off(q($(e),!1),r)}getData(e,r=!1){return T.getData(q($(e),r))}setData(e,r,n,o){T.dispatch(q($(e),!0),r,i=>R(n)&&n(i),o)}forceSetData(e,r,n){this.setData(e,r,n,!0)}clearData(e,r=!0){T.clearData(q($(e),r))}clearDataListener(e){T.off(q($(e),!1))}changeEventAppName(e,r){const n=q($(e),!0),o=q($(r),!0);T.eventList.has(o)&&(T.eventList.set(n,T.eventList.get(o)),T.eventList.delete(o))}}class Cr extends Dr{constructor(e){super(),this.appName=$(e),!this.appName&&I(`Invalid appName ${e}`)}addDataListener(e,r){e.__AUTO_TRIGGER__=r,T.on(q(this.appName,!0),e,r)}removeDataListener(e){R(e)&&T.off(q(this.appName,!0),e)}getData(e=!0){return T.getData(q(this.appName,e))}dispatch(e,r,n){G(),T.dispatch(q(this.appName,!1),e,o=>R(r)&&r(o),n,()=>{const o=y.get(this.appName);if(o?.container&&U(e)){const i=new CustomEvent("datachange",{detail:{data:T.getData(q(this.appName,!1))}});ue(o.container).dispatchEvent(i)}})}forceDispatch(e,r){this.dispatch(e,r,!0)}clearData(e=!1){T.clearData(q(this.appName,e))}clearDataListener(){T.off(q(this.appName,!0))}}function Ir(t){var e,r;if(t){t.umdDataListeners={global:new Set((e=t.umdDataListeners)===null||e===void 0?void 0:e.global),normal:new Set((r=t.umdDataListeners)===null||r===void 0?void 0:r.normal)};const n=T.eventList.get("global");if(n)for(const i of n.callbacks)t.appName===i.__APP_NAME__&&t.umdDataListeners.global.add(i);const o=T.eventList.get(q(t.appName,!0));if(o)for(const i of o.callbacks)t.umdDataListeners.normal.add(i)}}function Lr(t){if(t?.umdDataListeners){for(const e of t.umdDataListeners.global)t.addGlobalDataListener(e,e.__AUTO_TRIGGER__);for(const e of t.umdDataListeners.normal)t.addDataListener(e,e.__AUTO_TRIGGER__);xt(t)}}function xt(t){t==null||delete t.umdDataListeners}class je{constructor(){this.appInstanceMap=y}static getInstance(){return this.instance||(this.instance=new je),this.instance}get(e){return this.appInstanceMap.get(e)}set(e,r){this.appInstanceMap.set(e,r)}getAll(){return Array.from(this.appInstanceMap.values())}clear(){this.appInstanceMap.clear()}}function xr(){Tr(),je.getInstance().getAll().forEach(t=>{t.container&&ue(t.container).disconnectedCallback()}),!window.__MICRO_APP_UMD_MODE__&&je.getInstance().clear()}function Tr(){window.__MICRO_APP_ENVIRONMENT__&&window.removeEventListener("unmount",xr,!1)}function Lo(){window.__MICRO_APP_ENVIRONMENT__&&(Tr(),window.addEventListener("unmount",xr,!1))}function xo(t){return sr(t.__MICRO_APP_IS_BOUND_FUNCTION__)?t.__MICRO_APP_IS_BOUND_FUNCTION__:t.__MICRO_APP_IS_BOUND_FUNCTION__=Rn(t)}function To(t){return sr(t.__MICRO_APP_IS_CONSTRUCTOR__)?t.__MICRO_APP_IS_CONSTRUCTOR__:t.__MICRO_APP_IS_CONSTRUCTOR__=ot(t)}function J(t,e,r="WINDOW"){if(R(t)&&!To(t)&&!xo(t)&&t.bind){const n=`__MICRO_APP_BOUND_${r}_FUNCTION__`;if(t[n])return t[n];const o=t.bind(e);for(const i in t)o[i]=t[i];return t.hasOwnProperty("prototype")&&H(o,"prototype",{value:t.prototype,configurable:!0,enumerable:!1,writable:!0}),t[n]=o}return t}class No{constructor(e,r){this.rawWindowScopeKeyList=["location"],this.staticEscapeProperties=["System","__cjsWrapper"],this.staticScopeProperties=["webpackJsonp","webpackHotUpdate","Vue","onpopstate","onhashchange","event"],this.scopeProperties=Array.from(this.staticScopeProperties),this.escapeProperties=[],this.injectedKeys=new Set,this.escapeKeys=new Set,this.appName=e,this.url=r,this.injectReactHMRProperty()}injectReactHMRProperty(){}}class Bo{}function Uo(){l.rawWindow._babelPolyfill&&(l.rawWindow._babelPolyfill=!1)}function Tt(t,e){const r=Array.from(t.childNodes);r.length&&r.forEach(n=>{Tt(n,e)}),F(t,e)}function F(t,e){var r,n;if(e&&Me(t)&&t.__MICRO_APP_NAME__!==e&&!t.__PURE_ELEMENT__&&!Ot()){const o={__MICRO_APP_NAME__:{configurable:!0,enumerable:!0,writable:!0,value:e}};if(yn(t)&&je.getInstance().get(e)&&(o.href={get(){return this.getAttribute("href")},set(s){s!==void 0&&this.setAttribute("href",s)}}),k(t,o),we(e)){const i=(n=(r=y.get(e))===null||r===void 0?void 0:r.sandBox)===null||n===void 0?void 0:n.proxyWindow;i&&k(t,{baseURI:{configurable:!0,enumerable:!0,get:()=>i.location.href},ownerDocument:{configurable:!0,enumerable:!0,get:()=>t!==i.document?i.document:null},parentNode:Nr(e,l.rawParentNodeDesc),getRootNode:{configurable:!0,enumerable:!0,writable:!0,value:function(){return i.document}}})}}return t}function Nr(t,e){return{configurable:!0,enumerable:!0,get(){var r,n,o,i,s,a,c;Mt(t);const u=(r=e.get)===null||r===void 0?void 0:r.call(this);if(Je(u)&&(!((n=y.get(t))===null||n===void 0)&&n.container)){const d=(i=(o=_.options).getRootElementParentNode)===null||i===void 0?void 0:i.call(o,this,t);return d||((s=_?.options)===null||s===void 0?void 0:s.inheritBaseBody)!==!0&&((c=(a=y.get(t))===null||a===void 0?void 0:a.container)===null||c===void 0?void 0:c.querySelector("micro-app-body"))||l.rawDocument.body}return u}}}function Wo(t,e,r){const{proxyDocument:n,documentEffect:o}=Fo(t,r),i=Ho(t,n);return k(e,{document:{configurable:!1,enumerable:!0,get(){return n}},Document:{configurable:!1,enumerable:!1,get(){return i}}}),o}function Fo(t,e){const r=new Map,n=new Map;let o=null,i=null;const{rawDocument:s,rawCreateElement:a,rawCreateElementNS:c,rawAddEventListener:u,rawRemoveEventListener:d}=l;function w(p,m){const P=a.call(s,p,m);return F(P,t)}function A(p,m,P){const x=c.call(s,p,m,P);return F(x,t)}function O(p,m,P){const x=r.get(p);x?x.add(m):r.set(p,new Set([m])),m&&(m.__MICRO_APP_MARK_OPTIONS__=P),u.call(s,p,m,P)}function D(p,m,P){const x=r.get(p);x?.size&&x.has(m)&&x.delete(m),d.call(s,p,m,P)}const E=()=>{n.clear(),i=null},M=()=>{i=o||i,r.forEach((p,m)=>{if(p.size){const P=n.get(m)||[];n.set(m,new Set([...P,...p]))}})},b=()=>{i&&!o&&(g.onclick=i),n.forEach((p,m)=>{for(const P of p)g.addEventListener(m,P,P?.__MICRO_APP_MARK_OPTIONS__)}),E()},v=()=>{R(o)&&d.call(s,"click",o),o=null,r.size&&(r.forEach((p,m)=>{for(const P of p)d.call(s,m,P)}),r.clear())},f=(()=>{var p;const m=new Map([["onclick",L=>{R(o)&&d.call(s,"click",o,!1),R(L)&&u.call(s,"click",L,!1),o=L}]]),P=((p=_.options)===null||p===void 0?void 0:p.customProxyDocumentProps)||new Map;return new Map([...m,...P])})(),g=new Proxy(s,{get:(p,m)=>{var P;return Be(t),m==="createElement"?w:m==="createElementNS"?A:m===Symbol.toStringTag?"ProxyDocument":m==="defaultView"?e.proxyWindow:m==="onclick"?o:m==="addEventListener"?O:m==="removeEventListener"?D:m==="microAppElement"?(P=y.get(t))===null||P===void 0?void 0:P.container:m==="__MICRO_APP_NAME__"?t:J(Reflect.get(p,m),s,"DOCUMENT")},set:(p,m,P)=>(f.has(m)?f.get(m)(P):m!=="microAppElement"&&Reflect.set(p,m,P),!0)});return{proxyDocument:g,documentEffect:{reset:E,record:M,rebuild:b,release:v}}}function Ho(t,e){const{rawDocument:r,rawRootDocument:n}=l;class o{static[Symbol.hasInstance](s){let a=s;for(;a;)if(a=Object.getPrototypeOf(a),a===o.prototype)return!0;return s===e||s instanceof n}}return Object.setPrototypeOf(o,n),Object.setPrototypeOf(o.prototype,new Proxy(n.prototype,{get(i,s){return Be(t),J(Reflect.get(i,s),r,"DOCUMENT")},set(i,s,a){return Reflect.set(i,s,a),!0}})),o}function jo(t,e,r){return $o(e),Go(t,e,r),qo(e,t)}function $o(t){const e=l.rawWindow;Object.getOwnPropertyNames(e).filter(r=>/^on/.test(r)&&!so.includes(r)).forEach(r=>{const{enumerable:n,writable:o,set:i}=Object.getOwnPropertyDescriptor(e,r)||{enumerable:!0,writable:!0};H(t,r,{enumerable:n,configurable:!0,get:()=>e[r],set:o??!!i?s=>{e[r]=s}:void 0})})}function Go(t,e,r){const n=l.rawWindow,o=new Map,i=new Proxy(e,{get:(s,a)=>(Be(t),Reflect.has(s,a)||B(a)&&/^__MICRO_APP_/.test(a)||re(r.scopeProperties,a)?(re(uo,a)&&G(),Reflect.get(s,a)):J(Reflect.get(n,a),n)),set:(s,a,c)=>{if(re(r.rawWindowScopeKeyList,a))Reflect.set(n,a,c);else if(!ge.call(s,a)&&ge.call(n,a)&&!re(r.scopeProperties,a)){const u=Object.getOwnPropertyDescriptor(n,a),{configurable:d,enumerable:w,writable:A,set:O}=u;H(s,a,{value:c,configurable:d,enumerable:w,writable:A??!!O}),r.injectedKeys.add(a)}else(!Reflect.has(s,a)||re(r.scopeProperties,a))&&r.injectedKeys.add(a),Reflect.set(s,a,c);return(re(r.escapeProperties,a)||re(r.staticEscapeProperties,a)&&!Reflect.has(n,a))&&!re(r.scopeProperties,a)&&(!Reflect.has(n,a)&&r.escapeKeys.add(a),Reflect.set(n,a,c)),!0},has:(s,a)=>re(r.scopeProperties,a)?r.injectedKeys.has(a)?Reflect.has(s,a):!!s[a]:Reflect.has(s,a)||Reflect.has(n,a),getOwnPropertyDescriptor:(s,a)=>{if(ge.call(s,a))return o.set(a,"target"),Object.getOwnPropertyDescriptor(s,a);if(ge.call(n,a)){o.set(a,"rawWindow");const c=Object.getOwnPropertyDescriptor(n,a);return c&&!c.configurable&&(c.configurable=!0),c}},defineProperty:(s,a,c)=>o.get(a)==="rawWindow"?Reflect.defineProperty(n,a,c):Reflect.defineProperty(s,a,c),ownKeys:s=>$n(Reflect.ownKeys(n).concat(Reflect.ownKeys(s))),deleteProperty:(s,a)=>ge.call(s,a)?(r.injectedKeys.has(a)&&r.injectedKeys.delete(a),r.escapeKeys.has(a)&&Reflect.deleteProperty(n,a),Reflect.deleteProperty(s,a)):!0});r.proxyWindow=i}function qo(t,e){const r=new Map,n=new Map,o=new Map,i=new Map,{rawWindow:s,rawAddEventListener:a,rawRemoveEventListener:c,rawDispatchEvent:u,rawSetInterval:d,rawSetTimeout:w,rawClearInterval:A,rawClearTimeout:O}=l;function D(h){var f;return oo.includes(h)&&(!((f=y.get(e))===null||f===void 0)&&f.container)?ue(y.get(e).container):s}t.addEventListener=function(h,f,g){h=At(h,e);const p=r.get(h);p?p.add(f):r.set(h,new Set([f])),f&&(f.__MICRO_APP_MARK_OPTIONS__=g),a.call(D(h),h,f,g)},t.removeEventListener=function(h,f,g){h=At(h,e);const p=r.get(h);p?.size&&p.has(f)&&p.delete(f),c.call(D(h),h,f,g)},t.dispatchEvent=function(h){return u.call(D(h?.type),h)},t.setInterval=function(h,f,...g){const p=d.call(s,h,f,...g);return o.set(p,{handler:h,timeout:f,args:g}),p},t.setTimeout=function(h,f,...g){const m=typeof h=="string"?h:function(...x){i.delete(P),typeof h=="function"&&h(...x)},P=w.call(s,m,f,...g);return i.set(P,{handler:m,timeout:f,args:g}),P},t.clearInterval=function(h){o.delete(h),A.call(s,h)},t.clearTimeout=function(h){i.delete(h),O.call(s,h)};const E=()=>{n.clear()};return{reset:E,record:()=>{r.forEach((h,f)=>{if(h.size){const g=n.get(f)||[];n.set(f,new Set([...g,...h]))}})},rebuild:()=>{n.forEach((h,f)=>{for(const g of h)t.addEventListener(f,g,g?.__MICRO_APP_MARK_OPTIONS__)}),E()},release:h=>{r.size&&(r.forEach((f,g)=>{for(const p of f)c.call(D(g),g,p)}),r.clear()),h&&(o.forEach((f,g)=>{A.call(s,g)}),i.forEach((f,g)=>{O.call(s,g)}),o.clear(),i.clear())}}}function se(t,e,r){const n=l.rawWindow.history.state,o={__MICRO_APP_STATE__:Z({},n?.__MICRO_APP_STATE__,{[t]:{fullPath:r?r.pathname+r.search+r.hash:null,state:e??null,mode:Oe(t)}})};return Z({},n,o)}function Ko(t,e){return U(e?.__MICRO_APP_STATE__)&&(me(e.__MICRO_APP_STATE__[t])||delete e.__MICRO_APP_STATE__[t],Object.keys(e.__MICRO_APP_STATE__).length||delete e.__MICRO_APP_STATE__),Qn(e)?null:Z({},e)}function Ke(t){var e,r;const n=l.rawWindow.history.state;return((r=(e=n?.__MICRO_APP_STATE__)===null||e===void 0?void 0:e[t])===null||r===void 0?void 0:r.state)||null}function Br(t){var e;const r=l.rawWindow.history.state;return((e=r?.__MICRO_APP_STATE__)===null||e===void 0?void 0:e[t])||null}const Qo=/&/g,Vo=/=/g,Ur=/%M1/g,Wr=/%M2/g;function Fr(t){return encodeURIComponent(Nt(t).replace(Qo,"%M1").replace(Vo,"%M2"))}function Hr(t){return Nt(t).replace(Ur,"&").replace(Wr,"=")}function Nt(t){try{const e=decodeURIComponent(t);return t===e||Ur.test(e)||Wr.test(e)?e:Nt(e)}catch{return t}}function Qe(t){var e,r,n,o;const i=l.rawWindow.location,s=l.rawWindow.history.state;if(V(t)){const a=Bt(i.search,i.hash),c=((e=a.hashQuery)===null||e===void 0?void 0:e[t])||((r=a.searchQuery)===null||r===void 0?void 0:r[t]);return B(c)?Hr(c):null}return((o=(n=s?.__MICRO_APP_STATE__)===null||n===void 0?void 0:n[t])===null||o===void 0?void 0:o.fullPath)||(oe(t)?i.pathname+i.search+i.hash:null)}function pe(t,e){const r=l.rawWindow.location;let n=e.pathname+e.search+e.hash,o=!1;if(V(t)){let{pathname:i,search:s,hash:a}=r;const c=Bt(s,a),u=Fr(n);return a&&!s?(o=!0,c.hashQuery?c.hashQuery[t]=u:c.hashQuery={[t]:u},a=(a.includes("?")?a.slice(0,a.indexOf("?")+1):a+"?")+Ze(c.hashQuery)):(c.searchQuery?c.searchQuery[t]=u:c.searchQuery={[t]:u},s="?"+Ze(c.searchQuery)),{fullPath:i+s+a,isAttach2Hash:o}}return(Ut(t)||ne(t))&&(n=r.pathname+r.search+r.hash),{fullPath:n,isAttach2Hash:o}}function Xo(t){var e,r,n,o;let{pathname:i,search:s,hash:a}=l.rawWindow.location,c=!1;if(V(t)){const u=Bt(s,a);if(!((e=u.hashQuery)===null||e===void 0)&&e[t]){c=!0,(r=u.hashQuery)===null||r===void 0||delete r[t];const d=Ze(u.hashQuery);a=a.slice(0,a.indexOf("?")+ +!!d)+d}else if(!((n=u.searchQuery)===null||n===void 0)&&n[t]){(o=u.searchQuery)===null||o===void 0||delete o[t];const d=Ze(u.searchQuery);s=d?"?"+d:""}}return{fullPath:i+s+a,isAttach2Hash:c}}function Bt(t,e){const r={};return t!==""&&t!=="?"&&(r.searchQuery=jt(t.slice(1))),e.includes("?")&&(r.hashQuery=jt(e.slice(e.indexOf("?")+1))),r}function zo(t,e){const r=Qe(t);if(!r)return"";const n=W(r,e);return n.origin+n.pathname+n.search}function $e(t){const e=y.get(t);return!!(e&&!e.isPrefetch)}function Oe(t){var e;return(e=y.get(t))===null||e===void 0?void 0:e.routerMode}function V(t){return Oe(t)===He}function Ut(t){return Oe(t)===mr}function bt(t){return Oe(t)===ke}function Yo(t){return Oe(t)===_r}function ne(t){return Oe(t)===vr}function oe(t){return bt(t)||Yo(t)}function jr(t,e){const r=e&&ke||t||_.options["disable-memory-router"]&&ke||_.options["router-mode"]||He;return no.includes(r)?r:He}function $r(t){const e=l.rawWindow,r=n=>{var o,i,s;if(ye({excludeHiddenApp:!0,excludePreRender:!0}).includes(t)&&!n.onlyForBrowser&&(!oe(t)||!l.rawWindow.history.state||Br(t))){const a=(o=y.get(t))===null||o===void 0?void 0:o.container;Wn(()=>tt(t,Qe(t)),(s=(i=a&&ue(a))===null||i===void 0?void 0:i.getRouterEventDelay())!==null&&s!==void 0?s:0)}};return e.addEventListener("popstate",r),()=>{e.removeEventListener("popstate",r)}}function tt(t,e){const r=y.get(t);if(r?.sandBox){const n=r.sandBox.proxyWindow,o=r.sandBox.microAppWindow;let i=!1;const s=n.location.href;if(e){const a=n.location.hash;De(t,e,o.location),i=n.location.hash!==a}Jo(t,n,o),i&&Zo(t,n,o,s),G()}}function Jo(t,e,r){const n=new PopStateEvent("popstate",{state:Ke(t)});r.dispatchEvent(n),we(t)||R(e.onpopstate)&&e.onpopstate(n)}function Zo(t,e,r,n){const o=new HashChangeEvent("hashchange",{newURL:e.location.href,oldURL:n});r.dispatchEvent(o),we(t)||R(e.onhashchange)&&e.onhashchange(o)}function ko(t){const e=new PopStateEvent("popstate",{state:null});t&&(e.onlyForBrowser=!0),l.rawWindow.dispatchEvent(e)}function ei(t){const e=new HashChangeEvent("hashchange",{newURL:l.rawWindow.location.href,oldURL:t});l.rawWindow.dispatchEvent(e)}function Pt(t,e,r){G(),$e(t)&&(ko(e),r&&ei(r))}function Gr(t,e){const r=l.rawWindow.history;function n(i){return function(...s){var a,c,u;s[2]=me(s[2])||Ne(s[2])||""+s[2]==""?e.href:""+s[2];const d=W(s[2],e.href),w=d.pathname+d.search+d.hash;ne(t)||ht(t,i,pe(t,d),!0,se(t,s[0],d),s[1]),w!==e.fullPath&&De(t,w,e),(u=(a=y.get(t))===null||a===void 0?void 0:(c=a.sandBox).updateIframeBase)===null||u===void 0||u.call(c)}}const o={pushState:n("pushState"),replaceState:n("replaceState")};return we(t)?Z({go(i){return r.go(i)}},o):new Proxy(r,{get(i,s){return s==="pushState"||s==="replaceState"?o[s]:s==="state"?Ke(t):J(Reflect.get(i,s),i,"HISTORY")},set(i,s,a){return s==="pushState"||s==="replaceState"?o[s]=a:Reflect.set(i,s,a),!0}})}function Se(t,e,r,n=null,o=""){$e(t)&&(e==="pushState"?l.rawPushState:l.rawReplaceState).call(l.rawWindow.history,n,o,r)}function ht(t,e,r,n,o,i){if($e(t)){const s=l.rawWindow.location,a=s.pathname+s.search+s.hash,c=r.isAttach2Hash&&a!==r.fullPath?s.href:null;Se(t,e,r.fullPath,o,i),a!==r.fullPath&&V(t)&&Pt(t,n,c)}}function dt(t,e,r){ht(t,"replaceState",e,!0,r)}function Jt(t){const e=l.rawWindow;return function(...r){var n;if(!((n=e.history.state)===null||n===void 0)&&n.__MICRO_APP_STATE__&&(!U(r[0])||!r[0].__MICRO_APP_STATE__)&&(B(r[2])||it(r[2]))){const o=e.location.href;W(r[2],o).href===o&&(r[0]=Z({},r[0],{__MICRO_APP_STATE__:e.history.state.__MICRO_APP_STATE__}))}t.apply(e.history,r),ye({excludeHiddenApp:!0,excludePreRender:!0}).forEach(o=>{if((V(o)||Ut(o))&&!Qe(o)){const i=y.get(o);dt(o,pe(o,i.sandBox.proxyWindow.location),se(o,Ke(o),i.sandBox.proxyWindow.location))}oe(o)&&!Br(o)&&Se(o,"replaceState",e.location.href,se(o))}),G()}}function qr(){const t=l.rawWindow;t.history.pushState=Jt(l.rawPushState),t.history.replaceState=Jt(l.rawReplaceState)}function Kr(){const t=l.rawWindow;t.history.pushState=l.rawPushState,t.history.replaceState=l.rawReplaceState}function ti(){function t(E,M,b,v){ht(E,M,pe(E,b),!1,se(E,v??null,b)),G()}function e(E,M,b,v){const h=M.sandBox.proxyWindow.location,f=W(b.path,h.href),g=h.pathname+h.search+h.hash,p=f.pathname+f.search+f.hash;if(g!==p||Qe(E)!==p){if(!ne(E)){const m=v&&b.replace!==!1||b.replace===!0?"replaceState":"pushState";t(E,m,f,b.state)}V(E)||tt(E,p)}}function r(E){return function(M){return new Promise((b,v)=>{const h=$(M.name);if(h&&B(M.path))if(ye({excludeHiddenApp:!0,excludePreRender:!0}).includes(h)){const f=y.get(h);b(f.sandBox.sandboxReady.then(()=>e(h,f,M,E)))}else v(I("导航失败，请确保子应用渲染后再调用此方法"));else v(I(`navigation failed, name & path are required when use router.${E?"replace":"push"}`))})}}function n(E){return function(...M){return l.rawWindow.history[E](...M)}}const o=$t(),i=$t();function s(E,M,b,v){G();for(const h of v)R(h)?h(M,b,E):U(h)&&R(h[E])&&h[E](M,b)}function a(E,M,b){D.current.set(E,M),s(E,M,b,o.list()),ct(()=>{s(E,M,b,i.list())})}function c(E){D.current.delete(E)}function u(E){if(V(E)||Ut(E)){const M=y.get(E);dt(E,pe(E,M.sandBox.proxyWindow.location),se(E,Ke(E),M.sandBox.proxyWindow.location))}}function d(E){E=$(E),E&&ye().includes(E)&&u(E)}function w({includeHiddenApp:E=!1,includePreRender:M=!1}){ye({excludeHiddenApp:!E,excludePreRender:!M}).forEach(b=>u(b))}function A(){const E=Gn();function M(v){const h=$(v.name);return!h||!v.path?An:E.add(h,v.path)}function b(v){return v=$(v),v?E.delete(v):!1}return{setDefaultPage:M,removeDefaultPage:b,getDefaultPage:E.get}}function O(){let E=null;function M(b){Pn(b)&&(E=new Proxy(b,{get(v,h){return G(),J(Reflect.get(v,h),v,"BASEROUTER")},set(v,h,f){return Reflect.set(v,h,f),!0}}))}return{setBaseAppRouter:M,getBaseAppRouter:()=>E}}const D=Object.assign(Object.assign({current:new Map,encode:Fr,decode:Hr,push:r(!1),replace:r(!0),go:n("go"),back:n("back"),forward:n("forward"),beforeEach:o.add,afterEach:i.add,attachToURL:d,attachAllToURL:w},A()),O());return{router:D,executeNavigationGuard:a,clearRouterWhenUnmount:c}}const{router:Ve,executeNavigationGuard:Qr,clearRouterWhenUnmount:ri}=ti(),ni=["href","pathname","search","hash","host","hostname","port","protocol","search"],oi=[...ni,"origin","fullPath"];function Vr(t,e,r,n,o,i){const a=l.rawWindow.location,c=!!r,u=W(e);function d(){return c?r.location:u}function w(v,h){const f=W(v,b.href);if(f.origin===b.origin){const g=pe(t,f);if(!oe(t)){if(h=ne(t)?"replaceState":h,f.pathname===b.pathname&&f.search===b.search){let p=null;(f.hash!==b.hash||ne(t))&&(g.isAttach2Hash&&(p=a.href),(!ne(t)||!f.hash)&&Se(t,h,g.fullPath,V(t)?null:se(t,null,f))),f.hash?V(t)?Pt(t,!1,p):tt(t,f.pathname+f.search+f.hash):M();return}Se(t,h,g.fullPath,V(t)?null:se(t,null,f)),M();return}return g.fullPath}return v}function A(v,h){const f=W(v,e);f[h]===b[h]&&b.hash?Pt(t,!1):(Se(t,f[h]===b[h]||ne(t)?"replaceState":"pushState",pe(t,f).fullPath,V(t)?null:se(t,null,f)),M())}const O=v=>function(h){if($e(t)){const f=w(h,v==="assign"?"pushState":"replaceState");f&&a[v](W(f,a.origin).href)}},D=O("assign"),E=O("replace"),M=v=>a.reload(v);H(d(),"fullPath",{enumerable:!0,configurable:!0,get:()=>b.pathname+b.search+b.hash});const b=new Proxy({},{get:(v,h)=>{const f=d();if(h==="assign")return D;if(h==="replace")return E;if(h==="reload")return M;if(h==="self")return f;if(h==="fullPath")return f.fullPath;if(ho.includes(h)){if(bt(t))return a[h];if(c)return n[h]}if(h==="href"){if(bt(t))return f[h].replace(f.origin,a.origin);if(c)return f[h].replace(o,i)}return J(Reflect.get(f,h),f,"LOCATION")},set:(v,h,f)=>{if($e(t)){const g=d();if(h==="href"){const p=w(f,"pushState");p&&(a.href=W(p,a.origin).href)}else if(h==="pathname")if(oe(t))a.pathname=f;else{const p=("/"+f).replace(/^\/+/,"/")+b.search+b.hash;A(p,"pathname")}else if(h==="search")if(oe(t))a.search=f;else{const p=b.pathname+("?"+f).replace(/^\?+/,"?")+b.hash;A(p,"search")}else if(h==="hash")if(oe(t))a.hash=f;else{const p=b.pathname+b.search+("#"+f).replace(/^#+/,"#"),m=W(p,e);m.hash!==b.hash&&(ne(t)||ht(t,"pushState",pe(t,m),!1,se(t,null,m)),V(t)||tt(t,m.pathname+m.search+m.hash))}else Reflect.set(g,h,f)}return!0}});return b}function rt(t,e){const r=Z({name:t},e);for(const n of oi)r[n]=e[n];return r}function ii(t,e){Qr(t,rt(t,e),rt(t,e))}function De(t,e,r,n){var o;const i=rt(t,r),s=W(e,r.href);if(we(t)){const u=y.get(t).sandBox.microAppWindow;(o=u.rawReplaceState)===null||o===void 0||o.call(u.history,Ke(t),"",s.href)}else{let u=s.href;r.self.origin!==s.origin&&(u=u.replace(s.origin,r.self.origin)),r.self.href=u}const a=l.rawWindow.location;oe(t)&&e!==a.pathname+a.search+a.hash&&n!=="prevent"&&Se(t,"replaceState",e,l.rawWindow.history.state);const c=rt(t,r);(n==="auto"||i.fullPath!==c.fullPath&&n!=="prevent")&&Qr(t,c,i)}function si(t,e){const r=Vr(t,e);return{microLocation:r,microHistory:Gr(t,r)}}function Xr(t,e,r){const n=Qe(t);n?(De(t,n,e,"auto"),ne(t)&&ft(t)):Wt(t,e,r)}function Wt(t,e,r){r&&De(t,r,e,"prevent"),ne(t)||dt(t,pe(t,e),se(t,null,e)),ii(t,e)}function zr(t,e,r,n){if(!n&&!oe(t)){const{pathname:o,search:i,hash:s}=W(e);De(t,o+i+s,r,"prevent")}ne(t)||ft(t),ri(t)}function ft(t){dt(t,Xo(t),Ko(t,l.rawWindow.history.state))}function Zt(t,e){const r=me(e)?l.rawWindow.fetch:e;return R(r)?function(o,i,...s){return(B(o)||it(o))&&(o=W(o,t).toString()),G(),r.call(l.rawWindow,o,i,...s)}:r}function kt(t,e){const r=me(e)?l.rawWindow.XMLHttpRequest:e;return ot(r)?class extends r{open(o,i,...s){(B(i)&&!/^f(ile|tp):\/\//.test(i)||it(i))&&(i=W(i,t).toString()),G(),super.open(o,i,...s)}}:r}function ai(){let t;function e(n,o,i){const s=me(i)?l.rawWindow.EventSource:i;return ot(s)?class extends s{constructor(c,u,...d){if((B(c)||it(c))&&(c=W(c,o).toString()),G(),super(c,u,...d),t){const w=t.get(n);w?w.add(this):t.set(n,new Set([this]))}else t=new Map([[n,new Set([this])]])}close(){var c;super.close(),(c=t.get(n))===null||c===void 0||c.delete(this)}}:s}function r(n){const o=t?.get(n);o?.size&&(o.forEach(i=>{i.close()}),o.clear())}return{createMicroEventSource:e,clearMicroEventSource:r}}const{createMicroEventSource:er,clearMicroEventSource:ci}=ai();class Ge extends No{constructor(e,r){super(e,r),this.active=!1,this.microAppWindow=new Bo,this.patchWith(n=>{this.getSpecialProperties(e),this.patchRouter(e,r,this.microAppWindow),this.windowEffect=jo(e,this.microAppWindow,this),this.documentEffect=Wo(e,this.microAppWindow,this),this.setMappingPropertiesWithRawDescriptor(this.microAppWindow),this.initStaticGlobalKeys(e,r,this.microAppWindow),n()})}start({umdMode:e,baseroute:r,defaultPage:n,disablePatchRequest:o}){this.active||(this.active=!0,this.initRouteState(n),this.removeHistoryListener=$r(this.microAppWindow.__MICRO_APP_NAME__),oe(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=r),e||this.initGlobalKeysWhenStart(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow,o),++l.activeSandbox===1&&(tn(),qr()),++Ge.activeCount===1&&Lo(),Uo())}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:o}){var i;this.active&&(this.recordAndReleaseEffect({umdMode:e,clearData:o,destroy:n},!e||n),this.clearRouteState(r),(i=this.removeHistoryListener)===null||i===void 0||i.call(this),(!e||n)&&(ci(this.microAppWindow.__MICRO_APP_NAME__),this.injectedKeys.forEach(s=>{Reflect.deleteProperty(this.microAppWindow,s)}),this.injectedKeys.clear(),this.escapeKeys.forEach(s=>{Reflect.deleteProperty(l.rawWindow,s)}),this.escapeKeys.clear(),this.clearHijackUmdHooks()),--l.activeSandbox===0&&(rn(),Kr()),--Ge.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=st(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="with",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=Z(new Cr(e),{removeDomScope:G,pureCreateElement:z,location:n.location,router:Ve})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){this.windowEffect.reset(),this.documentEffect.reset(),xt(this.microAppWindow.microApp)}recordEffectSnapshot(){this.windowEffect.record(),this.documentEffect.record(),Ir(this.microAppWindow.microApp)}rebuildEffectSnapshot(){this.windowEffect.rebuild(),this.documentEffect.rebuild(),Lr(this.microAppWindow.microApp)}releaseGlobalEffect({umdMode:e=!1,clearData:r=!1,isPrerender:n=!1,keepAlive:o=!1,destroy:i=!1}){var s,a,c;this.windowEffect.release(!e&&!o&&!n||i),this.documentEffect.release(),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearDataListener(),(a=this.microAppWindow.microApp)===null||a===void 0||a.clearGlobalDataListener(),r&&(_.clearData(this.microAppWindow.__MICRO_APP_NAME__),(c=this.microAppWindow.microApp)===null||c===void 0||c.clearData())}getSpecialProperties(e){var r;U(_.options.plugins)&&(this.commonActionForSpecialProperties(_.options.plugins.global),this.commonActionForSpecialProperties((r=_.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(ae(e))for(const r of e)U(r)&&(ae(r.scopeProperties)&&(this.scopeProperties=this.scopeProperties.concat(r.scopeProperties)),ae(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties)))}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchWith(e){this.sandboxReady=new Promise(r=>e(r))}setMappingPropertiesWithRawDescriptor(e){let r,n;const o=l.rawWindow;o===o.parent?r=n=this.proxyWindow:(r=o.top,n=o.parent),k(e,{top:this.createDescriptorForMicroAppWindow("top",r),parent:this.createDescriptorForMicroAppWindow("parent",n)}),wr.forEach(i=>{H(e,i,this.createDescriptorForMicroAppWindow(i,this.proxyWindow))})}createDescriptorForMicroAppWindow(e,r){const{configurable:n=!0,enumerable:o=!0,writable:i,set:s}=Object.getOwnPropertyDescriptor(l.rawWindow,e)||{writable:!0};return{value:r,configurable:n,enumerable:o,writable:i??!!s}}initGlobalKeysWhenStart(e,r,n,o){n.hasOwnProperty=i=>ge.call(n,i)||ge.call(l.rawWindow,i),this.setHijackProperty(e,n),o||this.patchRequestApi(e,r,n),this.setScopeProperties(n)}setHijackProperty(e,r){let n,o;k(r,{eval:{configurable:!0,enumerable:!1,get(){return Be(e),n||l.rawWindow.eval},set:i=>{n=i}},Image:{configurable:!0,enumerable:!1,get(){return Be(e),o||l.ImageProxy},set:i=>{o=i}}})}patchRequestApi(e,r,n){let o=Zt(r),i=kt(r),s=er(e,r);k(n,{fetch:{configurable:!0,enumerable:!0,get(){return o},set(a){o=Zt(r,a)}},XMLHttpRequest:{configurable:!0,enumerable:!0,get(){return i},set(a){i=kt(r,a)}},EventSource:{configurable:!0,enumerable:!0,get(){return s},set(a){s=er(e,r,a)}}})}setScopeProperties(e){this.scopeProperties.forEach(r=>{Reflect.set(e,r,e[r])})}patchRouter(e,r,n){const{microLocation:o,microHistory:i}=si(e,r);k(n,{location:{configurable:!1,enumerable:!0,get(){return o},set:s=>{l.rawWindow.location=s}},history:{configurable:!0,enumerable:!0,get(){return i}}})}initRouteState(e){Xr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){zr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){Wt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){ft(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){Tt(e,this.microAppWindow.__MICRO_APP_NAME__)}actionsBeforeExecScripts(e,r){this.patchStaticElement(e),this.clearHijackUmdHooks=this.hijackUmdHooks(this.appName,this.microAppWindow,r)}hijackUmdHooks(e,r,n){let o,i,s;return k(r,{mount:{configurable:!0,get:()=>o,set:a=>{this.active&&R(a)&&!o&&n(o=a,i)}},unmount:{configurable:!0,get:()=>i,set:a=>{this.active&&R(a)&&!i&&n(o,i=a)}},[`micro-app-${e}`]:{configurable:!0,get:()=>s,set:a=>{this.active&&U(a)&&!s&&(s=a,n(s.mount,s.unmount))}}}),()=>{o=i=s=null}}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}Ge.activeCount=0;function li(t,e,r,n){const o=l.rawWindow.history,i=W(e),s=i.protocol+"//"+i.host,a=i.pathname+i.search+i.hash,c=r.history;return r.rawReplaceState=c.replaceState,Z(c,Gr(t,r.location)),k(c,{scrollRestoration:{configurable:!0,enumerable:!0,get(){return o.scrollRestoration},set(u){o.scrollRestoration=u}}}),De(t,a,r.location,"prevent"),Vr(t,e,r,i,n,s)}const ui=["Array"],hi=["getComputedStyle","DOMParser","visualViewport","matchMedia","ResizeObserver","IntersectionObserver"],di=[/animationFrame$/i,/mutationObserver$/i,/height$|width$/i,/offset$/i,/selection$/i,/^range/i,/^screen/i,/^scroll/i,/X$|Y$/],fi=["body","head","html","title"],pi=["childElementCount","children","firstElementChild","firstChild","lastElementChild","activeElement","fullscreenElement","pictureInPictureElement","pointerLockElement","styleSheets"],mi=["append","contains","replaceChildren","createRange","getSelection","elementFromPoint","elementsFromPoint","getAnimations"],_i=["characterSet","compatMode","contentType","designMode","dir","doctype","embeds","fullscreenEnabled","hidden","implementation","lastModified","pictureInPictureEnabled","plugins","readyState","referrer","visibilityState","fonts"],vi=["execCommand","createRange","exitFullscreen","exitPictureInPicture","getElementsByTagNameNS","hasFocus","prepend"],gi=["blob:"],Ei=window.Worker;function wi(t){try{const e=t instanceof URL?t:new URL(t);return gi.includes(e.protocol)?!0:e.protocol===window.location.protocol&&e.hostname===window.location.hostname&&e.port===window.location.port}catch{return!1}}function Ai(t){let e;try{e=new Blob([t],{type:"application/javascript"})}catch{const o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new o;i.append(t),e=i.getBlob("application/javascript")}return(window.URL||window.webkitURL).createObjectURL(e)}const tr=new Proxy(Ei,{construct(t,e){let[r,n]=e;n=n||{};const o=Q();let i=r;if(o){const s=y.get(o);i=X(r,s.url)}if(i&&!wi(i)){const s=`import "${r}";`,a=Ai(s);return n.type="module",new t(a,n)}else return new t(r,n)}});function bi(t,e,r){return Pi(t,e,r),Ri(e,r),Si(e)}function Pi(t,e,r){const n=l.rawWindow;hi.forEach(o=>{e[o]=J(n[o],n)}),Object.getOwnPropertyNames(e).filter(o=>(di.some(i=>{if(i.test(o)&&o in e.parent){if(R(n[o]))e[o]=J(n[o],n);else{const{configurable:s,enumerable:a}=Object.getOwnPropertyDescriptor(e,o)||{configurable:!0,enumerable:!0};s&&H(e,o,{configurable:s,enumerable:a,get:()=>n[o],set:c=>{n[o]=c}})}return!0}return!1}),ot(e[o])&&o in n&&!ui.includes(o)&&H(e[o],Symbol.hasInstance,{configurable:!0,enumerable:!1,value(i){return qt(i,n[o])||qt(i,e[o])}}),/^on/.test(o)&&!ao.includes(o))).forEach(o=>{const{enumerable:i,writable:s,set:a}=Object.getOwnPropertyDescriptor(e,o)||{enumerable:!0,writable:!0};try{H(e,o,{enumerable:i,configurable:!0,get:()=>n[o],set:s??!!a?c=>{n[o]=R(c)?c.bind(e):c}:void 0})}catch(c){_e(c,t)}}),r.escapeProperties.forEach(o=>{let i=e[o];H(e,o,{enumerable:!0,configurable:!0,get(){return i??J(n[o],n)},set(s){i=s}})})}function Ri(t,e){const r=l.rawWindow,n=new Set;Object.defineProperty(t,"Worker",{value:tr,configurable:!0,writable:!0});const o=new Proxy(t,{get:(i,s)=>s==="Worker"?tr:s==="location"?e.proxyLocation:re(wr,s)?o:n.has(s)?Reflect.get(i,s):re(e.escapeProperties,s)&&!Reflect.get(i,s)?J(Reflect.get(r,s),r):J(Reflect.get(i,s),i),set:(i,s,a)=>s==="location"?Reflect.set(r,s,a):(Reflect.has(i,s)||n.add(s),Reflect.set(i,s,a),!0),has:(i,s)=>s in i,deleteProperty:(i,s)=>Reflect.has(i,s)?Reflect.deleteProperty(i,s):!0});e.proxyWindow=o}function Si(t){const{rawWindow:e,rawAddEventListener:r,rawRemoveEventListener:n,rawDispatchEvent:o}=l,i=new Map,s=new Map;function a(A){var O;let D=[];return Array.isArray((O=_?.options)===null||O===void 0?void 0:O.escapeIframeWindowEvents)&&(D=_.options.escapeIframeWindowEvents),io.filter(M=>!D.includes(M)).includes(A)?t:e}t.addEventListener=function(A,O,D){const E=i.get(A);E?E.add(O):i.set(A,new Set([O])),O&&(O.__MICRO_APP_MARK_OPTIONS__=D),r.call(a(A),A,O,D)},t.removeEventListener=function(A,O,D){const E=i.get(A);E?.size&&E.has(O)&&E.delete(O),n.call(a(A),A,O,D)},t.dispatchEvent=function(A){return o.call(a(A?.type),A)};const c=()=>{s.clear()};return{reset:c,record:()=>{i.forEach((A,O)=>{if(A.size){const D=s.get(O)||[];s.set(O,new Set([...D,...A]))}})},rebuild:()=>{s.forEach((A,O)=>{for(const D of A)t.addEventListener(O,D,D?.__MICRO_APP_MARK_OPTIONS__)}),c()},release:()=>{i.size&&(i.forEach((A,O)=>{for(const D of A)n.call(a(O),O,D)}),i.clear())}}}function yi(t,e,r){return Mi(t,e),Oi(t,e,r),Di(t,e)}function te(t,e){var r;return!((r=_?.options)===null||r===void 0)&&r.disableIframeRootDocument?e:t}function Mi(t,e){const r=l.rawDocument,n=e.Document,o=e.document,i=n.prototype.createElement,s=n.prototype.createElementNS,a=n.prototype.createTextNode,c=n.prototype.createDocumentFragment,u=n.prototype.createComment,d=n.prototype.querySelector,w=n.prototype.querySelectorAll,A=n.prototype.getElementById,O=n.prototype.getElementsByClassName,D=n.prototype.getElementsByTagName,E=n.prototype.getElementsByName,M=n.prototype.elementFromPoint,b=n.prototype.caretRangeFromPoint;n.prototype.caretRangeFromPoint=function(p,m){const P=M.call(r,p,m),x=b.call(r,p,m);return F(P,t),x},n.prototype.createElement=function(p,m){let P=i.call(te(this,r),p,m);return Bn(P)&&(P=i.call(r,p,m)),F(P,t)},n.prototype.createElementNS=function(p,m,P){const x=s.call(te(this,r),p,m,P);return F(x,t)},n.prototype.createTextNode=function(p){const m=a.call(te(this,r),p);return F(m,t)},n.prototype.createDocumentFragment=function(){const p=c.call(te(this,r));return F(p,t)},n.prototype.createComment=function(p){const m=u.call(te(this,r),p);return F(m,t)};function v(g){return Mt(t),o===g?r:g}function h(g){var p,m;const P=v(this);if(g==="body"&&((p=_?.options)===null||p===void 0?void 0:p.inheritBaseBody)!==!0)return this.body;if(!g||Re(g)||r!==P)return d.call(P,g);const x=(m=y.get(t))===null||m===void 0?void 0:m.querySelector(g);return x||g==="base"?x:d.call(o,g)}function f(g){var p,m;const P=v(this);if(!g||Re(g)||r!==P)return w.call(P,g);const x=(m=(p=y.get(t))===null||p===void 0?void 0:p.querySelectorAll(g))!==null&&m!==void 0?m:[];return x.length||g==="base"?x:w.call(o,g)}n.prototype.querySelector=h,n.prototype.querySelectorAll=f,n.prototype.getElementById=function(p){const m=v(this);if(de(p))return A.call(m,p);try{return h.call(te(this,r),`#${p}`)}catch{return A.call(m,p)}},n.prototype.getElementsByClassName=function(p){const m=v(this);if(de(p))return O.call(m,p);try{return f.call(te(this,r),`.${p}`)}catch{return O.call(m,p)}},n.prototype.getElementsByTagName=function(p){const m=v(te(this,r));if(Re(p)||de(p))return D.call(m,p);if(/^script$/i.test(p))return D.call(o,p);try{return f.call(te(this,r),p)}catch{return D.call(m,p)}},n.prototype.getElementsByName=function(p){const m=v(te(this,r));if(de(p))return E.call(m,p);try{return f.call(te(this,r),`[name=${p}]`)}catch{return E.call(m,p)}}}function Oi(t,e,r){const n=l.rawDocument,o=e.Document,i=e.document,s=(c,u)=>{const{enumerable:d}=Object.getOwnPropertyDescriptor(o.prototype,c)||{enumerable:!0};return{configurable:!0,enumerable:d,get:u}},a=()=>{const c={};return[["documentURI",()=>r.proxyLocation.href],["URL",()=>r.proxyLocation.href],["documentElement",()=>n.documentElement],["scrollingElement",()=>n.scrollingElement],["forms",()=>o.prototype.querySelectorAll.call(i,"form")],["images",()=>o.prototype.querySelectorAll.call(i,"img")],["links",()=>o.prototype.querySelectorAll.call(i,"a")],["microAppElement",()=>{var d;return(d=y.get(t))===null||d===void 0?void 0:d.container}],["__MICRO_APP_NAME__",()=>t]].forEach(d=>{c[d[0]]=s(d[0],d[1])}),pi.forEach(d=>{c[d]=s(d,()=>n[d])}),mi.forEach(d=>{c[d]=s(d,()=>J(n[d],n,"DOCUMENT"))}),_i.forEach(d=>{c[d]=s(d,()=>n[d])}),vi.forEach(d=>{c[d]=s(d,()=>J(n[d],n,"DOCUMENT"))}),c};k(o.prototype,a()),fi.forEach(c=>{H(i,c,{enumerable:!0,configurable:!0,get:()=>{var u,d;return Mt(t),c==="body"&&((u=_?.options)===null||u===void 0?void 0:u.inheritBaseBody)!==!0&&((d=r.options.container)===null||d===void 0?void 0:d.querySelector("micro-app-body"))||n[c]},set:u=>{n[c]=u}})})}function Di(t,e){const{rawDocument:r,rawAddEventListener:n,rawRemoveEventListener:o,rawDispatchEvent:i}=l,s=new Map,a=new Map;let c=null,u=null;const d=e.Document,w=e.document;function A(v,h){return co.includes(v)?h:r}d.prototype.addEventListener=function(v,h,f){const g=R(h)?h.__MICRO_APP_BOUND_FUNCTION__=h.__MICRO_APP_BOUND_FUNCTION__||h.bind(this):h,p=s.get(v);p?p.add(h):s.set(v,new Set([h])),h&&(h.__MICRO_APP_MARK_OPTIONS__=f),n.call(A(v,this),v,g,f)},d.prototype.removeEventListener=function(v,h,f){const g=s.get(v);g?.size&&g.has(h)&&g.delete(h);const p=h?.__MICRO_APP_BOUND_FUNCTION__||h;o.call(A(v,this),v,p,f)},d.prototype.dispatchEvent=function(v){return i.call(A(v?.type,this),v)};function O(v){return v==="onclick"?h=>{R(c)&&o.call(r,"click",c,!1),R(h)?(c=h.bind(w),n.call(r,"click",c,!1)):c=h}:h=>{r[v]=R(h)?h.bind(w):h}}Object.getOwnPropertyNames(d.prototype).filter(v=>/^on/.test(v)&&!lo.includes(v)).forEach(v=>{const{enumerable:h,writable:f,set:g}=Object.getOwnPropertyDescriptor(d.prototype,v)||{enumerable:!0,writable:!0};try{H(d.prototype,v,{enumerable:h,configurable:!0,get:()=>v==="onclick"?c:r[v],set:f??!!g?O(v):void 0})}catch(p){_e(p,t)}});const D=()=>{a.clear(),u=null};return{reset:D,record:()=>{u=c||u,s.forEach((v,h)=>{if(v.size){const f=a.get(h)||[];a.set(h,new Set([...f,...v]))}})},rebuild:()=>{u&&!c&&(w.onclick=u),a.forEach((v,h)=>{for(const f of v)w.addEventListener(h,f,f?.__MICRO_APP_MARK_OPTIONS__)}),D()},release:()=>{R(c)&&o.call(r,"click",c),c=null,s.size&&(s.forEach((v,h)=>{for(const f of v)o.call(A(h,w),h,f?.__MICRO_APP_BOUND_FUNCTION__||f)}),s.clear())}}}function Ci(t,e,r,n){Ii(t,r,n),Li(e,r,t)}function Ii(t,e,r){const n=l.rawRootElement,o=l.rawRootNode,i=l.rawDocument,s=e.document,a=e.Node,c=e.Element,u=e.DocumentFragment,d=a.prototype.appendChild,w=a.prototype.insertBefore,A=a.prototype.replaceChild,O=a.prototype.removeChild,D=c.prototype.append,E=c.prototype.prepend,M=u.prototype.append,b=u.prototype.prepend,v=c.prototype.insertAdjacentElement,h=a.prototype.cloneNode,f=Object.getOwnPropertyDescriptor(c.prototype,"innerHTML"),g=Object.getOwnPropertyDescriptor(a.prototype,"parentNode"),p=Object.getOwnPropertyDescriptor(a.prototype,"ownerDocument"),m=L=>(Pe(L)||xn(L))&&L.__PURE_ELEMENT__,P=L=>L===r.microHead?i.head:L===r.microBody?i.body:L;a.prototype.appendChild=function(S){return F(S,t),m(S)?d.call(this,S):o.prototype.appendChild.call(P(this),S)},a.prototype.insertBefore=function(S,C){return F(S,t),m(S)?w.call(this,S,C):o.prototype.insertBefore.call(P(this),S,C)},a.prototype.replaceChild=function(S,C){return F(S,t),m(S)?A.call(this,S,C):o.prototype.replaceChild.call(P(this),S,C)},a.prototype.removeChild=function(S){return m(S)||this.contains(S)?O.call(this,S):o.prototype.removeChild.call(P(this),S)},u.prototype.append=c.prototype.append=function(...S){let C=0,ve=!1;for(;C<S.length;)S[C]=Me(S[C])?S[C]:s.createTextNode(S[C]),m(S[C])&&(ve=!0),C++;return ve?(Ye(this)?M:D).call(this,...S):n.prototype.append.call(P(this),...S)},u.prototype.prepend=c.prototype.prepend=function(...S){let C=0,ve=!1;for(;C<S.length;)S[C]=Me(S[C])?S[C]:s.createTextNode(S[C]),m(S[C])&&(ve=!0),C++;return ve?(Ye(this)?b:E).call(this,...S):n.prototype.prepend.call(P(this),...S)},c.prototype.insertAdjacentElement=function(S,C){return F(C,t),m(C)?v.call(this,S,C):n.prototype.insertAdjacentElement.call(P(this),S,C)},H(a.prototype,"baseURI",{configurable:!0,enumerable:!0,get(){return r.proxyWindow.location.href}}),H(a.prototype,"ownerDocument",{configurable:!0,enumerable:!0,get(){var L;return this.__PURE_ELEMENT__||this===s?(L=p.get)===null||L===void 0?void 0:L.call(this):s}}),H(a.prototype,"parentNode",Nr(t,g)),a.prototype.getRootNode=function(){return s},a.prototype.cloneNode=function(S){const C=h.call(this,S);return F(C,t)},H(c.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){var L;return(L=f.get)===null||L===void 0?void 0:L.call(this)},set(L){var S;(S=f.set)===null||S===void 0||S.call(this,L),Array.from(this.children).forEach(C=>{le(C)&&F(C,t)})}});const x=new Proxy(e.Image,{construct(L,S){const C=new L(...S);return F(C,t),C}});H(e,"Image",{configurable:!0,writable:!0,value:x})}function Li(t,e,r){const n=e.Element,o=n.prototype.setAttribute;n.prototype.setAttribute=function(a,c){var u;if(/^micro-app(-\S+)?/i.test(this.tagName)&&a==="data"&&this.setAttribute!==n.prototype.setAttribute)this.setAttribute(a,c);else{const d=(u=_?.options)===null||u===void 0?void 0:u.aHrefResolver;if(a==="href"&&/^a$/i.test(this.tagName)&&typeof d=="function")c=d(c,r,t);else if((a==="src"||a==="srcset")&&/^(img|script|video|audio|source|embed)$/i.test(this.tagName)||a==="href"&&/^(link|image)$/i.test(this.tagName)||a==="href"&&/^(a)$/i.test(this.tagName)&&!/^#/.test(c)){let w=t;nt&&a==="href"&&/^a$/i.test(this.tagName)&&R(_.options.excludeAssetFilter)&&_.options.excludeAssetFilter(c)&&(w=document.baseURI),c=X(c,w)}o.call(this,a,c)}},[[e.HTMLImageElement.prototype,"src"],[e.HTMLScriptElement.prototype,"src"],[e.HTMLLinkElement.prototype,"href"],[e.SVGImageElement.prototype,"href"]].forEach(([s,a])=>{const{enumerable:c,configurable:u,get:d,set:w}=Object.getOwnPropertyDescriptor(s,a)||{enumerable:!0,configurable:!0};H(s,a,{enumerable:c,configurable:u,get:function(){return d?.call(this)},set:function(A){w?.call(this,X(A,t))}})})}class qe{constructor(e,r,n){this.active=!1,this.escapeProperties=[],this.updateIframeBase=()=>{var s;(s=this.baseElement)===null||s===void 0||s.setAttribute("href",W(this.url).origin+this.proxyLocation.pathname)},this.appName=e,this.url=r,this.options=n;const o=l.rawWindow.location,i=o.protocol+"//"+o.host;this.deleteIframeElement=this.createIframeElement(e,i+o.pathname,n),this.microAppWindow=this.iframe.contentWindow,this.patchIframe(this.microAppWindow,s=>{this.microAppWindow=this.iframe.contentWindow,this.createIframeTemplate(this.microAppWindow),this.getSpecialProperties(e),this.proxyLocation=li(e,r,this.microAppWindow,i),this.windowEffect=bi(e,this.microAppWindow,this),this.documentEffect=yi(e,this.microAppWindow,this),Ci(e,r,this.microAppWindow,this),this.initStaticGlobalKeys(e,r,this.microAppWindow),s()})}createIframeElement(e,r,n){this.iframe=z("iframe");const o=Object.assign(Object.assign({},n?.attrs),{id:e,src:_.options.iframeSrc||r,style:"display: none","powered-by":"micro-app"});return Object.keys(o).forEach(i=>this.iframe.setAttribute(i,o[i])),l.rawDocument.body.appendChild(this.iframe),()=>ee(()=>{var i,s;(s=(i=this.iframe)===null||i===void 0?void 0:i.parentNode)===null||s===void 0||s.removeChild(this.iframe),this.iframe=null})}start({baseroute:e,defaultPage:r,disablePatchRequest:n}){this.active||(this.active=!0,this.initRouteState(r),this.removeHistoryListener=$r(this.microAppWindow.__MICRO_APP_NAME__),oe(this.microAppWindow.__MICRO_APP_NAME__)&&(this.microAppWindow.__MICRO_APP_BASE_ROUTE__=this.microAppWindow.__MICRO_APP_BASE_URL__=e),n||this.createIframeBase(),++l.activeSandbox===1&&(tn(),qr()),++qe.activeCount)}stop({umdMode:e,keepRouteState:r,destroy:n,clearData:o}){var i;this.active&&(this.recordAndReleaseEffect({clearData:o},!e||n),this.clearRouteState(r),(i=this.removeHistoryListener)===null||i===void 0||i.call(this),(!e||n)&&(this.deleteIframeElement(),this.clearHijackUmdHooks()),--l.activeSandbox===0&&(rn(),Kr()),--qe.activeCount,this.active=!1)}initStaticGlobalKeys(e,r,n){n.__MICRO_APP_ENVIRONMENT__=!0,n.__MICRO_APP_NAME__=e,n.__MICRO_APP_URL__=r,n.__MICRO_APP_PUBLIC_PATH__=st(r),n.__MICRO_APP_BASE_ROUTE__="",n.__MICRO_APP_WINDOW__=n,n.__MICRO_APP_PRE_RENDER__=!1,n.__MICRO_APP_UMD_MODE__=!1,n.__MICRO_APP_PROXY_WINDOW__=this.proxyWindow,n.__MICRO_APP_SANDBOX__=this,n.__MICRO_APP_SANDBOX_TYPE__="iframe",n.rawWindow=l.rawWindow,n.rawDocument=l.rawDocument,n.microApp=Z(new Cr(e),{removeDomScope:G,pureCreateElement:z,location:this.proxyLocation,router:Ve})}recordAndReleaseEffect(e,r=!1){r?this.resetEffectSnapshot():this.recordEffectSnapshot(),this.releaseGlobalEffect(e)}resetEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.reset(),(r=this.documentEffect)===null||r===void 0||r.reset(),xt(this.microAppWindow.microApp)}recordEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.record(),(r=this.documentEffect)===null||r===void 0||r.record(),Ir(this.microAppWindow.microApp)}rebuildEffectSnapshot(){var e,r;(e=this.windowEffect)===null||e===void 0||e.rebuild(),(r=this.documentEffect)===null||r===void 0||r.rebuild(),Lr(this.microAppWindow.microApp)}releaseGlobalEffect({clearData:e=!1}){var r,n,o,i,s;(r=this.windowEffect)===null||r===void 0||r.release(),(n=this.documentEffect)===null||n===void 0||n.release(),(o=this.microAppWindow.microApp)===null||o===void 0||o.clearDataListener(),(i=this.microAppWindow.microApp)===null||i===void 0||i.clearGlobalDataListener(),e&&(_.clearData(this.microAppWindow.__MICRO_APP_NAME__),(s=this.microAppWindow.microApp)===null||s===void 0||s.clearData())}setPreRenderState(e){this.microAppWindow.__MICRO_APP_PRE_RENDER__=e}markUmdMode(e){this.microAppWindow.__MICRO_APP_UMD_MODE__=e}patchIframe(e,r){const n=e.document;this.sandboxReady=new Promise(o=>{(function i(){setTimeout(()=>{try{e.document===n?i():(e.stop(),r(o))}catch{i()}},0)})()})}createIframeTemplate(e){const r=e.document;qn(r);const n=r.createElement("html");n.innerHTML="<head></head><body></body>",r.appendChild(n),this.microBody=r.body,this.microHead=r.head}createIframeBase(){this.baseElement=z("base"),this.updateIframeBase(),this.microHead.appendChild(this.baseElement)}getSpecialProperties(e){var r;U(_.options.plugins)&&(this.commonActionForSpecialProperties(_.options.plugins.global),this.commonActionForSpecialProperties((r=_.options.plugins.modules)===null||r===void 0?void 0:r[e]))}commonActionForSpecialProperties(e){if(ae(e))for(const r of e)U(r)&&ae(r.escapeProperties)&&(this.escapeProperties=this.escapeProperties.concat(r.escapeProperties))}initRouteState(e){Xr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location,e)}clearRouteState(e){zr(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.__MICRO_APP_URL__,this.microAppWindow.location,e)}setRouteInfoForKeepAliveApp(){Wt(this.microAppWindow.__MICRO_APP_NAME__,this.microAppWindow.location)}removeRouteInfoForKeepAliveApp(){ft(this.microAppWindow.__MICRO_APP_NAME__)}patchStaticElement(e){Tt(e,this.microAppWindow.__MICRO_APP_NAME__)}actionsBeforeExecScripts(e,r){this.patchStaticElement(e),this.clearHijackUmdHooks=this.hijackUmdHooks(this.appName,this.microAppWindow,r)}hijackUmdHooks(e,r,n){let o,i,s;return k(r,{mount:{configurable:!0,get:()=>o,set:a=>{this.active&&R(a)&&!o&&n(o=a,i)}},unmount:{configurable:!0,get:()=>i,set:a=>{this.active&&R(a)&&!i&&n(o,i=a)}},[`micro-app-${e}`]:{configurable:!0,get:()=>s,set:a=>{this.active&&U(a)&&!s&&(s=a,n(s.mount,s.unmount))}}}),()=>{o=i=s=null}}setStaticAppState(e){this.microAppWindow.__MICRO_APP_STATE__=e}}qe.activeCount=0;const y=new Map;class Yr{constructor({name:e,url:r,container:n,scopecss:o,useSandbox:i,inline:s,iframe:a,ssrUrl:c,isPrefetch:u,prefetchLevel:d,routerMode:w,attrs:A}){this.state=j.CREATED,this.keepAliveState=null,this.loadSourceLevel=0,this.umdHookMount=null,this.umdHookUnmount=null,this.umdMode=!1,this.sandBox=null,this.fiber=!1,this.isReloading=!1,y.set(e,this),this.name=e,this.url=r,this.useSandbox=i,this.scopecss=this.useSandbox&&o,this.attrs=A,this.iframe=a??!1,this.inline=this.getInlineModeState(s),this.isReloading=!1,this.routerMode=w||He,this.container=n??null,this.ssrUrl=c??"",this.isPrefetch=u??!1,this.isPrerender=d===3,this.prefetchLevel=d,this.source={html:null,links:new Set,scripts:new Set},this.loadSourceCode(),this.createSandbox()}loadSourceCode(){this.setAppState(j.LOADING),Dt.getInstance().run(this,Do)}onLoad({html:e,defaultPage:r,routerMode:n,baseroute:o,disablePatchRequest:i}){var s;if(++this.loadSourceLevel===2){if(this.source.html=e,this.isUnmounted())return;if(!this.isPrefetch)ue(this.container).mount(this);else if(this.isPrerender){const a=z("div");a.setAttribute("prerender","true"),(s=this.sandBox)===null||s===void 0||s.setPreRenderState(!0),this.mount({container:a,inline:this.inline,fiber:!0,defaultPage:r||"",disablePatchRequest:i??!1,routerMode:n,baseroute:o||""})}}}onLoadError(e){this.loadSourceLevel=-1,this.isUnmounted()||(this.onerror(e),this.setAppState(j.LOAD_FAILED))}mount({container:e,inline:r,routerMode:n,defaultPage:o,baseroute:i,disablePatchRequest:s,fiber:a}){if(this.loadSourceLevel!==2)return this.container=e,this.isPrerender=!1,ie(this,"statechange",{appState:j.LOADING}),this.setAppState(j.LOADING);this.createSandbox();const c=()=>{var u,d,w,A,O,D,E;if(this.setAppState(j.BEFORE_MOUNT),this.isPrerender&&In(this.container)&&this.container.hasAttribute("prerender"))this.container=this.cloneContainer(e,this.container,!1),(u=this.sandBox)===null||u===void 0||u.rebuildEffectSnapshot(),(d=this.preRenderEvents)===null||d===void 0||d.forEach(M=>M()),this.isPrerender=!1,this.preRenderEvents=null,Ve.attachToURL(this.name),(w=this.sandBox)===null||w===void 0||w.setPreRenderState(!1);else{this.container=e,this.inline=this.getInlineModeState(r),this.fiber=a,this.routerMode=n;const M=()=>{he(this.container,this.name,N.BEFOREMOUNT)};if(this.isPrerender?((A=this.preRenderEvents)!==null&&A!==void 0?A:this.preRenderEvents=[]).push(M):M(),this.setAppState(j.MOUNTING),ie(this,"statechange",{appState:j.MOUNTING}),this.cloneContainer(this.container,this.source.html,!this.umdMode),(O=this.sandBox)===null||O===void 0||O.start({umdMode:this.umdMode,baseroute:i,defaultPage:o,disablePatchRequest:s}),!this.umdMode)(D=this.sandBox)===null||D===void 0||D.actionsBeforeExecScripts(this.container,(b,v)=>{var h;if(!this.umdMode&&!this.isUnmounted()&&(this.umdHookMount=R(b)?b:null,this.umdHookUnmount=R(v)?v:null,R(this.umdHookMount)&&R(this.umdHookUnmount))){(h=this.sandBox)===null||h===void 0||h.markUmdMode(this.umdMode=!0);try{this.getAppState()===j.MOUNTED?this.umdHookMount(_.getData(this.name,!0)):this.handleMounted(this.umdHookMount(_.getData(this.name,!0)))}catch(f){I(`An error occurred when mount 
`,this.name,f)}}}),wo(this,b=>{!this.umdMode&&b===!0&&this.handleMounted()});else{(E=this.sandBox)===null||E===void 0||E.rebuildEffectSnapshot();try{this.handleMounted(this.umdHookMount(_.getData(this.name,!0)))}catch(b){I(`An error occurred when mount 
`,this.name,b)}}}};this.sandBox?this.sandBox.sandboxReady.then(()=>!this.isUnmounted()&&c()):c()}handleMounted(e){var r,n;const o=()=>{const i=()=>this.actionsAfterMounted();_t(e)?e.then(i).catch(s=>{I(`An error occurred in window.mount 
`,this.name,s),i()}):i()};this.isPrerender?((r=this.preRenderEvents)===null||r===void 0||r.push(o),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({isPrerender:!0})):o()}actionsAfterMounted(){var e;this.isUnmounted()||(this.setAppState(j.MOUNTED),Gt(this.getMicroAppGlobalHook(Ae.ONMOUNT),this.name,Ae.ONMOUNT,_.getData(this.name,!0)),ie(this,"statechange",{appState:j.MOUNTED}),ie(this,"mounted"),he(this.container,this.name,N.MOUNTED),this.isHidden()&&((e=this.sandBox)===null||e===void 0||e.recordAndReleaseEffect({keepAlive:!0})))}unmount({destroy:e,clearData:r,keepRouteState:n,unmountcb:o}){var i;e=e||this.state===j.LOAD_FAILED,this.setAppState(j.UNMOUNT);try{this.handleUnmounted(e,r,n,o,(i=this.umdHookUnmount)===null||i===void 0?void 0:i.call(this,_.getData(this.name,!0)))}catch(s){I(`An error occurred when unmount 
`,this.name,s)}}handleUnmounted(e,r,n,o,i){ie(this,"statechange",{appState:j.UNMOUNT}),ie(this,"unmount"),Gt(this.getMicroAppGlobalHook(Ae.ONUNMOUNT),this.name,Ae.ONUNMOUNT);const s=()=>this.actionsAfterUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:o});_t(i)?(G(),i.then(s).catch(a=>{I(`An error occurred in window.unmount 
`,this.name,a),s()})):s()}actionsAfterUnmounted({destroy:e,clearData:r,keepRouteState:n,unmountcb:o}){var i;this.umdMode&&this.container&&!e&&this.cloneContainer(this.source.html,this.container,!1);const s=this.isReloading?!1:r||e;(i=this.sandBox)===null||i===void 0||i.stop({umdMode:this.umdMode,keepRouteState:n&&!e,destroy:e,clearData:s}),he(this.container,this.name,N.UNMOUNT),this.clearOptions(e),o?.()}clearOptions(e){var r,n;this.isPrerender=!1,this.preRenderEvents=null,this.setKeepAliveState(null),this.container?(this.container.innerHTML="",this.container=null):this.umdMode||(n=(r=this.sandBox)===null||r===void 0?void 0:r.deleteIframeElement)===null||n===void 0||n.call(r),this.iframe&&!this.umdMode&&(this.sandBox=null),e&&this.actionsForCompletelyDestroy(),G()}actionsForCompletelyDestroy(){var e,r;(r=(e=this.sandBox)===null||e===void 0?void 0:e.deleteIframeElement)===null||r===void 0||r.call(e),Y.script.deleteInlineInfo(this.source.scripts),y.delete(this.name)}hiddenKeepAliveApp(e){var r,n;this.setKeepAliveState(Te.KEEP_ALIVE_HIDDEN),ie(this,"appstate-change",{appState:"afterhidden"}),he(this.container,this.name,N.AFTERHIDDEN),V(this.name)&&((r=this.sandBox)===null||r===void 0||r.removeRouteInfoForKeepAliveApp()),this.loadSourceLevel!==2?ue(this.container).unmount():(this.container=this.cloneContainer(z("div"),this.container,!1),(n=this.sandBox)===null||n===void 0||n.recordAndReleaseEffect({keepAlive:!0})),e?.()}showKeepAliveApp(e){var r,n;const o=this.container;this.container=e,(r=this.sandBox)===null||r===void 0||r.rebuildEffectSnapshot(),ie(this,"appstate-change",{appState:"beforeshow"}),he(e,this.name,N.BEFORESHOW),this.setKeepAliveState(Te.KEEP_ALIVE_SHOW),this.cloneContainer(this.container,o,!1),V(this.name)&&((n=this.sandBox)===null||n===void 0||n.setRouteInfoForKeepAliveApp()),ie(this,"appstate-change",{appState:"aftershow"}),he(this.container,this.name,N.AFTERSHOW)}onerror(e){ie(this,"statechange",{appState:j.LOAD_FAILED}),he(this.container,this.name,N.ERROR,e)}parseHtmlString(e){var r;const n=!((r=this.sandBox)===null||r===void 0)&&r.proxyWindow?this.sandBox.proxyWindow.DOMParser:l.rawWindow.DOMParser;return new n().parseFromString(e,"text/html").body}cloneContainer(e,r,n){return r&&e&&(e.innerHTML="",Array.from(n?this.parseHtmlString(r.innerHTML).childNodes:r.childNodes).forEach(o=>{e.appendChild(o)})),e}createSandbox(){if(this.useSandbox&&!this.sandBox){const e={attrs:this.attrs,container:this.container};this.sandBox=this.iframe?new qe(this.name,this.url,e):new Ge(this.name,this.url)}}setAppState(e){var r;this.state=e,(r=this.sandBox)===null||r===void 0||r.setStaticAppState(e)}getAppState(){return this.state}setKeepAliveState(e){this.keepAliveState=e}getKeepAliveState(){return this.keepAliveState}isUnmounted(){return j.UNMOUNT===this.state}isHidden(){return Te.KEEP_ALIVE_HIDDEN===this.keepAliveState}getMicroAppGlobalHook(e){var r,n;const o=(n=(r=this.sandBox)===null||r===void 0?void 0:r.proxyWindow)===null||n===void 0?void 0:n[e];return R(o)?o:null}querySelector(e){return this.container?l.rawElementQuerySelector.call(this.container,e):null}querySelectorAll(e){return this.container?l.rawElementQuerySelectorAll.call(this.container,e):[]}getInlineModeState(e){var r;return(r=this.iframe||e)!==null&&r!==void 0?r:!1}}function we(t){var e,r;return(r=(e=y.get(t))===null||e===void 0?void 0:e.iframe)!==null&&r!==void 0?r:!1}const ce=new WeakMap;function Jr(t){var e;return(e=ce.get(t))!==null&&e!==void 0?e:t}function Zr(t,e){if(ce.has(t))return ce.get(t);if(ar(t)){if(t.hasAttribute("exclude")){const r=document.createComment("style element with exclude attribute ignored by micro-app");return ce.set(t,r),r}else if(e.scopecss&&!t.hasAttribute("ignore"))return lt(t,e);return t}else if(Dn(t)){if(t.hasAttribute("exclude")||It(t.getAttribute("href"),e.name)){const i=document.createComment("link element with exclude attribute ignored by micro-app");return ce.set(t,i),i}else if(t.hasAttribute("ignore")||Lt(t.getAttribute("href"),e.name)||t.href&&R(_.options.excludeAssetFilter)&&_.options.excludeAssetFilter(t.href))return t;const{address:r,linkInfo:n,replaceComment:o}=fr(t,null,e,!0);if(r&&n){const i=ro(r,e,n,t);return ce.set(t,i),i}else if(o)return ce.set(t,o),o;return t}else if(Pe(t)){if(t.src&&R(_.options.excludeAssetFilter)&&_.options.excludeAssetFilter(t.src))return t;const{replaceComment:r,address:n,scriptInfo:o}=yr(t,null,e,!0)||{};if(n&&o){const i=o.isExternal?Ao(n,e,o,t):bo(n,e,o);return ce.set(t,i),i}else if(r)return ce.set(t,r),r;return t}return t}function kr(t,e,r,n,o){const i=en(r,n,t);if(i){if(!we(t.name)&&Je(i)&&e!==l.rawRemoveChild){const s=Object.getOwnPropertyDescriptor(n,"parentNode");(!s||s.configurable)&&!n.__MICRO_APP_HAS_DPN__&&k(n,{parentNode:{configurable:!0,get(){var a,c;const u=l.rawParentNodeDesc.get.call(this);return Je(u)&&t.container?((c=(a=_.options).getRootElementParentNode)===null||c===void 0?void 0:c.call(a,this,t.name))||document.body:u}},__MICRO_APP_HAS_DPN__:{configurable:!0,get:()=>!0}})}if(o&&!i.contains(o)){if(e===l.rawInsertBefore&&r.contains(o)){const s=Array.from(r.childNodes).indexOf(o);if(i.childNodes[s])return ze(e,i,n,i.childNodes[s],t)}return l.rawAppendChild.call(i,n)}else if(e===l.rawRemoveChild&&!i.contains(n))return r.contains(n)?e.call(n.parentElement,n):n;return ze(e,i,n,o,t)}return ze(e,r,n,o,t)}function en(t,e,r){if(r){if(t===document.head)return r.iframe&&Pe(e)?r.sandBox.microHead:r.querySelector("micro-app-head");if(t===document.body||t===document.body.parentNode)return r.iframe&&Pe(e)?r.sandBox.microBody:r.querySelector("micro-app-body");if(r.iframe&&Pe(e))return r.sandBox.microBody}return null}function ze(t,e,r,n,o){return xi(t)?(o?.iframe&&Pe(r)&&(t===l.rawFragmentAppend?t=l.rawAppend:t===l.rawFragmentPrepend&&(t=l.rawPrepend)),t.call(e,r)):t.call(e,r,n)}function xi(t){return t===l.rawAppend||t===l.rawPrepend||t===l.rawFragmentAppend||t===l.rawFragmentPrepend}function Ti(t,e){var r;if(le(e)){if(/^(img|script)$/i.test(e.tagName))e.hasAttribute("src")&&l.rawSetAttribute.call(e,"src",X(e.getAttribute("src"),t.url)),e.hasAttribute("srcset")&&l.rawSetAttribute.call(e,"srcset",X(e.getAttribute("srcset"),t.url));else if(/^(link|image)$/i.test(e.tagName)&&e.hasAttribute("href")||/^(a)$/i.test(e.tagName)&&e.hasAttribute("href")&&!/^#/.test(e.getAttribute("href")||"")){const n=(r=_?.options)===null||r===void 0?void 0:r.aHrefResolver,o=e.getAttribute("href");let i;/^(a)$/i.test(e.tagName)&&typeof n=="function"?i=n(o,t.name,t.url):i=X(o,t.url),l.rawSetAttribute.call(e,"href",i)}}}function Ce(t,e,r,n){const o=Q();if(Me(e)&&!e.__PURE_ELEMENT__&&(e.__MICRO_APP_NAME__||o)){F(e,e.__MICRO_APP_NAME__||o);const i=y.get(e.__MICRO_APP_NAME__);if(i?.container)return ar(e)&&t.getRootNode()instanceof ShadowRoot&&e.setAttribute("ignore","true"),Ti(i,e),kr(i,n,t,Zr(e,i),r&&Jr(r))}return ze(n,t,e,r)}function tn(){Ni();const t=l.rawRootElement,e=l.rawRootNode,r=l.rawDocumentFragment;e.prototype.appendChild=function(s){return Ce(this,s,null,l.rawAppendChild)},e.prototype.insertBefore=function(s,a){return Ce(this,s,a,l.rawInsertBefore)},e.prototype.replaceChild=function(s,a){return Ce(this,s,a,l.rawReplaceChild)},e.prototype.removeChild=function(s){if(s?.__MICRO_APP_NAME__){const a=y.get(s.__MICRO_APP_NAME__);if(a?.container)return kr(a,l.rawRemoveChild,this,Jr(s));try{return l.rawRemoveChild.call(this,s)}catch{return s?.parentNode&&l.rawRemoveChild.call(s.parentNode,s)}}return l.rawRemoveChild.call(this,s)},r.prototype.append=t.prototype.append=function(...s){let a=0;for(;a<s.length;){let c=s[a];c=Me(c)?c:l.rawCreateTextNode.call(l.rawDocument,c),Ce(this,be(c),null,Ye(this)?l.rawFragmentAppend:l.rawAppend),a++}},r.prototype.prepend=t.prototype.prepend=function(...s){let a=s.length,c=l.rawPrepend;for((Ye(this)||Tn(this))&&(c=l.rawFragmentPrepend);a>0;){let u=s[a-1];u=Me(u)?u:l.rawCreateTextNode.call(l.rawDocument,u),Ce(this,be(u),null,c),a--}},t.prototype.insertAdjacentElement=function(i,s){var a;if(s?.__MICRO_APP_NAME__&&le(s)){const c=y.get(s.__MICRO_APP_NAME__);if(c?.container){const u=Zr(s,c);if(!le(u))return s;const d=(a=en(this,u,c))!==null&&a!==void 0?a:this;return l.rawInsertAdjacentElement.call(d,i,u)}}return l.rawInsertAdjacentElement.call(this,i,s)};function n(i){const s=Xe()||Q();if((i===document.body||i===document.head)&&s){const a=y.get(s);if(a?.container){if(i===document.body)return a.querySelector("micro-app-body");if(i===document.head)return a.querySelector("micro-app-head")}}return i}function o(i,s,a,c,u){if(i){const d=Xe()||Q();if(d&&we(d)){const w=y.get(d);if(Nn(s))return w.sandBox.microHead[u](c);if(Je(s))return w.sandBox.microBody[u](c)}}return a}t.prototype.querySelector=function(s){var a;const c=(a=n(this))!==null&&a!==void 0?a:this,u=l.rawElementQuerySelector.call(c,s);return o(Ne(u)&&c!==this,c,u,s,"querySelector")},t.prototype.querySelectorAll=function(s){var a;const c=(a=n(this))!==null&&a!==void 0?a:this,u=l.rawElementQuerySelectorAll.call(c,s);return o(!u.length&&c!==this,c,u,s,"querySelectorAll")},t.prototype.setAttribute=function(s,a){var c,u;if(/^micro-app(-\S+)?/i.test(this.tagName)&&s==="data"&&this.setAttribute!==t.prototype.setAttribute)this.setAttribute(s,a);else{const d=this.__MICRO_APP_NAME__||Q();if(d&&y.has(d)&&((s==="src"||s==="srcset")&&/^(img|script|video|audio|source|embed)$/i.test(this.tagName)||s==="href"&&/^(link|image)$/i.test(this.tagName)||s==="href"&&/^(a)$/i.test(this.tagName)&&!/^#/.test(a))){const w=y.get(d),A=(c=_?.options)===null||c===void 0?void 0:c.aHrefResolver;s==="href"&&/^a$/i.test(this.tagName)&&typeof A=="function"?a=A(a,d,w.url):a=X(a,w.url)}if(l.rawSetAttribute.call(this,s,a),Ln(this)||On(this)||Mn(this)){let w=!1;!((u=_?.options)===null||u===void 0)&&u.includeCrossOrigin&&R(_.options.includeCrossOrigin)&&(w=_.options.includeCrossOrigin(a)),w&&(node.crossOrigin="anonymous")}}},H(e.prototype,"parentNode",{configurable:!0,enumerable:!0,get(){var i,s,a;const c=Xe()||Q();if(c&&this===l.rawDocument.firstElementChild){const d=(a=(s=(i=y.get(c))===null||i===void 0?void 0:i.sandBox)===null||s===void 0?void 0:s.proxyWindow)===null||a===void 0?void 0:a.document;if(d)return d}return l.rawParentNodeDesc.get.call(this)}}),H(t.prototype,"innerHTML",{configurable:!0,enumerable:!0,get(){return l.rawInnerHTMLDesc.get.call(this)},set(i){l.rawInnerHTMLDesc.set.call(this,i);const s=this.__MICRO_APP_NAME__||Xe()||Q();Array.from(this.children).forEach(a=>{le(a)&&s&&F(a,s)})}}),e.prototype.cloneNode=function(s){const a=l.rawCloneNode.call(this,s);return F(a,this.__MICRO_APP_NAME__)}}function be(t){return F(t,Q())}function Ni(){const t=l.rawDocument,e=l.rawRootDocument;function r(i){return Un(i)?t:i}e.prototype.createElement=function(s,a){const c=l.rawCreateElement.call(r(this),s,a);return be(c)},e.prototype.createElementNS=function(s,a,c){const u=l.rawCreateElementNS.call(r(this),s,a,c);return be(u)},e.prototype.createDocumentFragment=function(){const s=l.rawCreateDocumentFragment.call(r(this));return be(s)},e.prototype.createComment=function(s){const a=l.rawCreateComment.call(r(this),s);return be(a)};function n(i){var s,a;const c=r(this),u=Q();return!u||!i||Re(i)||t!==c?l.rawQuerySelector.call(c,i):(a=(s=y.get(u))===null||s===void 0?void 0:s.querySelector(i))!==null&&a!==void 0?a:null}function o(i){var s,a;const c=r(this),u=Q();return!u||!i||Re(i)||t!==c?l.rawQuerySelectorAll.call(c,i):(a=(s=y.get(u))===null||s===void 0?void 0:s.querySelectorAll(i))!==null&&a!==void 0?a:[]}e.prototype.querySelector=n,e.prototype.querySelectorAll=o,e.prototype.getElementById=function(s){const a=r(this);if(!Q()||de(s))return l.rawGetElementById.call(a,s);try{return n.call(a,`#${s}`)}catch{return l.rawGetElementById.call(a,s)}},e.prototype.getElementsByClassName=function(s){const a=r(this);if(!Q()||de(s))return l.rawGetElementsByClassName.call(a,s);try{return o.call(a,`.${s}`)}catch{return l.rawGetElementsByClassName.call(a,s)}},e.prototype.getElementsByTagName=function(s){var a;const c=r(this),u=Q();if(!u||Re(s)||de(s)||!(!((a=y.get(u))===null||a===void 0)&&a.inline)&&/^script$/i.test(s))return l.rawGetElementsByTagName.call(c,s);try{return o.call(c,s)}catch{return l.rawGetElementsByTagName.call(c,s)}},e.prototype.getElementsByName=function(s){const a=r(this);if(!Q()||de(s))return l.rawGetElementsByName.call(a,s);try{return o.call(a,`[name=${s}]`)}catch{return l.rawGetElementsByName.call(a,s)}}}function Bi(){const t=l.rawRootDocument;t.prototype.createElement=l.rawCreateElement,t.prototype.createElementNS=l.rawCreateElementNS,t.prototype.createDocumentFragment=l.rawCreateDocumentFragment,t.prototype.querySelector=l.rawQuerySelector,t.prototype.querySelectorAll=l.rawQuerySelectorAll,t.prototype.getElementById=l.rawGetElementById,t.prototype.getElementsByClassName=l.rawGetElementsByClassName,t.prototype.getElementsByTagName=l.rawGetElementsByTagName,t.prototype.getElementsByName=l.rawGetElementsByName}function rn(){G(),Bi();const t=l.rawRootElement,e=l.rawRootNode;e.prototype.appendChild=l.rawAppendChild,e.prototype.insertBefore=l.rawInsertBefore,e.prototype.replaceChild=l.rawReplaceChild,e.prototype.removeChild=l.rawRemoveChild,e.prototype.cloneNode=l.rawCloneNode,t.prototype.append=l.rawAppend,t.prototype.prepend=l.rawPrepend,t.prototype.querySelector=l.rawElementQuerySelector,t.prototype.querySelectorAll=l.rawElementQuerySelectorAll,t.prototype.setAttribute=l.rawSetAttribute,H(e.prototype,"parentNode",l.rawParentNodeDesc),H(t.prototype,"innerHTML",l.rawInnerHTMLDesc)}let rr=!1;function Ui(){if(!rr){rr=!0;const t=z("style");l.rawSetAttribute.call(t,"type","text/css"),t.textContent=`
${_.tagName}, micro-app-body { display: block; } 
micro-app-head { display: none; }`,l.rawDocument.head.appendChild(t)}}const l={activeSandbox:0};function Wi(){if(nt){const t=window.rawWindow||Function("return window")(),e=window.rawDocument||Function("return document")(),r=t.Document||Function("return Document")(),n=t.Element,o=t.Node,i=t.EventTarget,s=t.DocumentFragment,a=o.prototype.appendChild,c=o.prototype.insertBefore,u=o.prototype.replaceChild,d=o.prototype.removeChild,w=n.prototype.setAttribute,A=n.prototype.append,O=n.prototype.prepend,D=s.prototype.append,E=s.prototype.prepend,M=o.prototype.cloneNode,b=n.prototype.querySelector,v=n.prototype.querySelectorAll,h=n.prototype.insertAdjacentElement,f=Object.getOwnPropertyDescriptor(n.prototype,"innerHTML"),g=Object.getOwnPropertyDescriptor(o.prototype,"parentNode"),p=r.prototype.createElement,m=r.prototype.createElementNS,P=r.prototype.createTextNode,x=r.prototype.createDocumentFragment,L=r.prototype.createComment,S=r.prototype.querySelector,C=r.prototype.querySelectorAll,ve=r.prototype.getElementById,on=r.prototype.getElementsByClassName,sn=r.prototype.getElementsByTagName,an=r.prototype.getElementsByName,cn=new Proxy(t.Image,{construct(gn,En){return F(new gn(...En),Q())}}),ln=t.setInterval,un=t.setTimeout,hn=t.clearInterval,dn=t.clearTimeout,fn=t.history.pushState,pn=t.history.replaceState,mn=i.prototype.addEventListener,_n=i.prototype.removeEventListener,vn=i.prototype.dispatchEvent;window.__MICRO_APP_BASE_APPLICATION__=!0,Z(l,{supportModuleScript:Hn(),rawWindow:t,rawDocument:e,rawRootDocument:r,rawRootElement:n,rawRootNode:o,rawDocumentFragment:s,rawSetAttribute:w,rawAppendChild:a,rawInsertBefore:c,rawReplaceChild:u,rawRemoveChild:d,rawAppend:A,rawPrepend:O,rawFragmentAppend:D,rawFragmentPrepend:E,rawCloneNode:M,rawElementQuerySelector:b,rawElementQuerySelectorAll:v,rawInsertAdjacentElement:h,rawInnerHTMLDesc:f,rawParentNodeDesc:g,rawCreateElement:p,rawCreateElementNS:m,rawCreateDocumentFragment:x,rawCreateTextNode:P,rawCreateComment:L,rawQuerySelector:S,rawQuerySelectorAll:C,rawGetElementById:ve,rawGetElementsByClassName:on,rawGetElementsByTagName:sn,rawGetElementsByName:an,ImageProxy:cn,rawSetInterval:ln,rawSetTimeout:un,rawClearInterval:hn,rawClearTimeout:dn,rawPushState:fn,rawReplaceState:pn,rawAddEventListener:mn,rawRemoveEventListener:_n,rawDispatchEvent:vn}),Ui()}}function Fi(t){class e extends HTMLElement{constructor(){super(...arguments),this.isWaiting=!1,this.cacheData=null,this.connectedCount=0,this.connectStateMap=new Map,this._appName="",this.appUrl="",this.ssrUrl="",this.version=wn,this.handleAttributeUpdate=()=>{this.isWaiting=!1;const n=$(this.getAttribute("name")),o=vt(this.getAttribute("url"),this.appName);if(this.legalAttribute("name",n)&&this.legalAttribute("url",o)){const i=y.get(n);if(n!==this.appName&&i&&!i.isUnmounted()&&!i.isHidden()&&!i.isPrefetch)return this.setAttribute("name",this.appName),I(`app name conflict, an app named ${n} is running`);(n!==this.appName||o!==this.appUrl)&&(n===this.appName?this.unmount(!0,()=>{this.actionsForAttributeChange(n,o,i)}):this.getKeepAliveModeResult()?(this.handleHiddenKeepAliveApp(),this.actionsForAttributeChange(n,o,i)):this.unmount(!1,()=>{this.actionsForAttributeChange(n,o,i)}))}else n!==this.appName&&this.setAttribute("name",this.appName)}}static get observedAttributes(){return["name","url"]}connectedCallback(){Object.getPrototypeOf(this)!==e.prototype&&Object.setPrototypeOf(this,e.prototype);const n=++this.connectedCount;this.connectStateMap.set(n,!0);const o=this.appName&&this.appUrl;ee(()=>{this.connectStateMap.get(n)&&(he(this,this.appName,N.CREATED),o&&this.handleConnected())})}disconnectedCallback(){this.connectStateMap.set(this.connectedCount,!1),this.handleDisconnected()}reload(n){return new Promise(o=>{const i=()=>{this.removeEventListener(N.MOUNTED,i),this.removeEventListener(N.AFTERSHOW,i),o(!0)};this.addEventListener(N.MOUNTED,i),this.addEventListener(N.AFTERSHOW,i),this.handleDisconnected(n,()=>{this.handleConnected()})})}handleDisconnected(n=!1,o){const i=y.get(this.appName);i&&!i.isUnmounted()&&!i.isHidden()&&(this.getKeepAliveModeResult()&&!n?this.handleHiddenKeepAliveApp(o):this.unmount(n,o))}attributeChangedCallback(n,o,i){if(this.legalAttribute(n,i)&&this[n===xe.NAME?"appName":"appUrl"]!==i)if(n===xe.URL&&(!this.appUrl||!this.connectStateMap.get(this.connectedCount))){if(i=vt(i,this.appName),!i)return I(`Invalid attribute url ${i}`,this.appName);this.appUrl=i,this.handleInitialNameAndUrl()}else if(n===xe.NAME&&(!this.appName||!this.connectStateMap.get(this.connectedCount))){const s=$(i);if(!s)return I(`Invalid attribute name ${i}`,this.appName);this.cacheData&&(_.setData(s,this.cacheData),this.cacheData=null),this.appName=s,s!==i&&this.setAttribute("name",this.appName),this.handleInitialNameAndUrl()}else this.isWaiting||(this.isWaiting=!0,ee(this.handleAttributeUpdate))}handleInitialNameAndUrl(){this.connectStateMap.get(this.connectedCount)&&this.handleConnected()}handleConnected(){if(!(!this.appName||!this.appUrl))if(this.getDisposeResult("shadowDOM")&&!this.shadowRoot&&R(this.attachShadow)&&this.attachShadow({mode:"open"}),this.updateSsrUrl(this.appUrl),y.has(this.appName)){const n=y.get(this.appName),o=n.ssrUrl||n.url,i=this.ssrUrl||this.appUrl;n.isHidden()&&n.url===this.appUrl?this.handleShowKeepAliveApp(n):o===i&&(n.isUnmounted()||n.isPrefetch&&this.sameCoreOptions(n))?this.handleMount(n):n.isPrefetch||n.isUnmounted()?this.handleCreateApp():I(`app name conflict, an app named ${this.appName} with url ${o} is running`)}else this.handleCreateApp()}actionsForAttributeChange(n,o,i){var s;this.updateSsrUrl(o),this.appName=n,this.appUrl=o,((s=this.shadowRoot)!==null&&s!==void 0?s:this).innerHTML="",n!==this.getAttribute("name")&&this.setAttribute("name",this.appName),i?i.isHidden()?i.url===this.appUrl?this.handleShowKeepAliveApp(i):I(`app name conflict, an app named ${this.appName} is running`):i.url===this.appUrl&&i.ssrUrl===this.ssrUrl?this.handleMount(i):this.handleCreateApp():this.handleCreateApp()}legalAttribute(n,o){return!B(o)||!o?(I(`unexpected attribute ${n}, please check again`,this.appName),!1):!0}handleCreateApp(){const n={};Array.prototype.slice.call(this.attributes).forEach(({name:s,value:a})=>{s.startsWith("data-")&&(n[s]=a)});const o=()=>{var s;return new Yr({name:this.appName,url:this.appUrl,container:(s=this.shadowRoot)!==null&&s!==void 0?s:this,scopecss:this.useScopecss(),useSandbox:this.useSandbox(),inline:this.getDisposeResult("inline"),iframe:this.getDisposeResult("iframe"),ssrUrl:this.ssrUrl,routerMode:this.getMemoryRouterMode(),attrs:n})},i=y.get(this.appName);i?i.isPrerender?this.unmount(!0,o):(i.actionsForCompletelyDestroy(),o()):o()}handleMount(n){n.isPrefetch=!1,n.setAppState(j.BEFORE_MOUNT),ee(()=>this.mount(n))}mount(n){var o;n.mount({container:(o=this.shadowRoot)!==null&&o!==void 0?o:this,inline:this.getDisposeResult("inline"),routerMode:this.getMemoryRouterMode(),baseroute:this.getBaseRouteCompatible(),defaultPage:this.getDefaultPage(),disablePatchRequest:this.getDisposeResult("disable-patch-request"),fiber:this.getDisposeResult("fiber")})}unmount(n,o){const i=y.get(this.appName);i&&!i.isUnmounted()&&i.unmount({destroy:n||this.getDestroyCompatibleResult(),clearData:this.getDisposeResult("clear-data"),keepRouteState:this.getDisposeResult("keep-router-state"),unmountcb:o}),delete this.__MICRO_APP_NAME__}handleHiddenKeepAliveApp(n){const o=y.get(this.appName);o&&!o.isUnmounted()&&!o.isHidden()&&o.hiddenKeepAliveApp(n)}handleShowKeepAliveApp(n){ee(()=>{var o;return n.showKeepAliveApp((o=this.shadowRoot)!==null&&o!==void 0?o:this)})}getDisposeResult(n){return(this.compatibleProperties(n)||!!_.options[n])&&this.compatibleDisableProperties(n)}compatibleProperties(n){return n==="disable-scopecss"?this.hasAttribute("disable-scopecss")||this.hasAttribute("disableScopecss"):n==="disable-sandbox"?this.hasAttribute("disable-sandbox")||this.hasAttribute("disableSandbox"):this.hasAttribute(n)}compatibleDisableProperties(n){return n==="disable-scopecss"?this.getAttribute("disable-scopecss")!=="false"&&this.getAttribute("disableScopecss")!=="false":n==="disable-sandbox"?this.getAttribute("disable-sandbox")!=="false"&&this.getAttribute("disableSandbox")!=="false":this.getAttribute(n)!=="false"}useScopecss(){return!(this.getDisposeResult("disable-scopecss")||this.getDisposeResult("shadowDOM"))}useSandbox(){return!this.getDisposeResult("disable-sandbox")}sameCoreOptions(n){return n.scopecss===this.useScopecss()&&n.useSandbox===this.useSandbox()&&n.iframe===this.getDisposeResult("iframe")}getBaseRouteCompatible(){var n,o;return(o=(n=this.getAttribute("baseroute"))!==null&&n!==void 0?n:this.getAttribute("baseurl"))!==null&&o!==void 0?o:""}getDestroyCompatibleResult(){return this.getDisposeResult("destroy")||this.getDisposeResult("destory")}getKeepAliveModeResult(){return this.getDisposeResult("keep-alive")&&!this.getDestroyCompatibleResult()}updateSsrUrl(n){if(this.getDisposeResult("ssr"))if(this.getDisposeResult("disable-memory-router")||this.getDisposeResult("disableSandbox")){const o=l.rawWindow.location;this.ssrUrl=X(o.pathname+o.search,n)}else{let o=zo(this.appName,n);const i=this.getDefaultPage();if(!o&&i){const s=W(i,n);o=s.origin+s.pathname+s.search}this.ssrUrl=o}else this.ssrUrl&&(this.ssrUrl="")}getDefaultPage(){return Ve.getDefaultPage(this.appName)||this.getAttribute("default-page")||this.getAttribute("defaultPage")||""}getMemoryRouterMode(){return jr(this.getAttribute("router-mode"),this.compatibleProperties("disable-memory-router")&&this.compatibleDisableProperties("disable-memory-router"))}setAttribute(n,o){if(n==="data")if(U(o)){const i={};Object.getOwnPropertyNames(o).forEach(s=>{B(s)&&s.indexOf("__")===0||(i[s]=o[s])}),this.data=i}else o!=="[object Object]"&&_e("property data must be an object",this.appName);else l.rawSetAttribute.call(this,n,o)}getRouterEventDelay(){let n=parseInt(this.getAttribute("router-event-delay"));return isNaN(n)&&(n=parseInt(R(_.options["router-event-delay"])?_.options["router-event-delay"](this.appName):_.options["router-event-delay"])),isNaN(n)?0:n}set data(n){this.appName?_.setData(this.appName,n):this.cacheData=n}get data(){return this.appName?_.getData(this.appName,!0):this.cacheData?this.cacheData:null}set appName(n){n!==this._appName&&(_.changeEventAppName(n,this._appName),this._appName=n)}get appName(){return this._appName}get publicPath(){return st(this.appUrl)}get baseRoute(){return this.getBaseRouteCompatible()}}window.customElements.define(t,e)}function nr(t,e){if(!nt)return I("preFetch is only supported in browser environment");ct(()=>{const r=mt(e)?e:_.options.prefetchDelay;setTimeout(()=>{Hi(t)},mt(r)?r:3e3)})}function Hi(t){R(t)&&(t=t()),ae(t)&&t.reduce((e,r)=>e.then(()=>ji(r)),Promise.resolve())}function ji(t){return lr(e=>{var r,n,o,i,s,a;if(U(t)&&navigator.onLine)if(t.name=$(t.name),t.url=vt(t.url,t.name),t.name&&t.url&&!y.has(t.name)){const c=new Yr({name:t.name,url:t.url,isPrefetch:!0,scopecss:!((n=(r=t["disable-scopecss"])!==null&&r!==void 0?r:t.disableScopecss)!==null&&n!==void 0?n:_.options["disable-scopecss"]),useSandbox:!((i=(o=t["disable-sandbox"])!==null&&o!==void 0?o:t.disableSandbox)!==null&&i!==void 0?i:_.options["disable-sandbox"]),inline:(s=t.inline)!==null&&s!==void 0?s:_.options.inline,iframe:(a=t.iframe)!==null&&a!==void 0?a:_.options.iframe,prefetchLevel:t.level&&zt.includes(t.level)?t.level:_.options.prefetchLevel&&zt.includes(_.options.prefetchLevel)?_.options.prefetchLevel:2}),u=c.onLoad,d=c.onLoadError;c.onLoad=w=>{c.isPrerender&&Z(w,{defaultPage:t["default-page"],routerMode:jr(t["router-mode"]),baseroute:t.baseroute,disablePatchRequest:t["disable-patch-request"]}),e(),u.call(c,w)},c.onLoadError=(...w)=>{e(),d.call(c,...w)}}else e();else e()})}function $i(t){U(t)&&ct(()=>{or(t.js,"js",Y.script),or(t.css,"css",Y.link)})}function or(t,e,r){if(ae(t)){const n=t.filter(i=>B(i)&&cr(i,e)&&!r.hasInfo(i)),o=n.map(i=>Ee(i));at(o,i=>{const s=n[i.index];e==="js"?r.hasInfo(s)||r.setInfo(s,{code:i.data,isExternal:!1,appSpace:{}}):r.hasInfo(s)||r.setInfo(s,{code:i.data,appSpace:{}})},i=>{I(i)})}}function ye({excludeHiddenApp:t=!1,excludePreRender:e=!1}={}){const r=[];return y.forEach((n,o)=>{!n.isUnmounted()&&(!n.isPrefetch||n.isPrerender&&!e)&&(!t||!n.isHidden())&&r.push(o)}),r}function Gi(){return Array.from(y.keys())}function nn(t,e){const r=y.get($(t));return new Promise(n=>{if(r)if(r.isUnmounted()||r.isPrefetch)r.isPrerender?r.unmount({destroy:!!e?.destroy,clearData:!!e?.clearData,keepRouteState:!1,unmountcb:n.bind(null,!0)}):(e?.destroy&&r.actionsForCompletelyDestroy(),n(!0));else if(r.isHidden())e?.destroy?r.unmount({destroy:!0,clearData:!0,keepRouteState:!0,unmountcb:n.bind(null,!0)}):e?.clearAliveState?r.unmount({destroy:!1,clearData:!!e.clearData,keepRouteState:!0,unmountcb:n.bind(null,!0)}):n(!0);else{const o=ue(r.container),i=()=>{o.removeEventListener(N.UNMOUNT,i),o.removeEventListener(N.AFTERHIDDEN,s),n(!0)},s=()=>{o.removeEventListener(N.UNMOUNT,i),o.removeEventListener(N.AFTERHIDDEN,s),n(!0)};if(o.addEventListener(N.UNMOUNT,i),o.addEventListener(N.AFTERHIDDEN,s),e?.destroy){let a,c;o.hasAttribute("destroy")&&(a=o.getAttribute("destroy")),o.hasAttribute("destory")&&(c=o.getAttribute("destory")),o.setAttribute("destroy","true"),o.parentNode.removeChild(o),o.removeAttribute("destroy"),B(a)&&o.setAttribute("destroy",a),B(c)&&o.setAttribute("destory",c)}else if(e?.clearAliveState&&o.hasAttribute("keep-alive")){const a=o.getAttribute("keep-alive");o.removeAttribute("keep-alive");let c=null;e.clearData&&(c=o.getAttribute("clear-data"),o.setAttribute("clear-data","true")),o.parentNode.removeChild(o),o.setAttribute("keep-alive",a),B(c)&&o.setAttribute("clear-data",c)}else{let a=null;e?.clearData&&(a=o.getAttribute("clear-data"),o.setAttribute("clear-data","true")),o.parentNode.removeChild(o),B(a)&&o.setAttribute("clear-data",a)}}else _e(`app ${t} does not exist when unmountApp`),n(!1)})}function qi(t){return Array.from(y.keys()).reduce((e,r)=>e.then(()=>nn(r,t)),Promise.resolve(!0))}function Ki(t,e){return new Promise(r=>{const n=y.get($(t));if(n){const o=n.container&&ue(n.container);if(o){const i=_.getData(t);n.isReloading=!0,o.reload(e).then(()=>{i&&_.setData(t,i),n.isReloading=!1,r(!0)})}else _e(`app ${t} is not rendered, cannot use reload`),r(!1)}else _e(`app ${t} does not exist when reload app`),r(!1)})}function Qi(t){return new Promise(e=>{if(!U(t))return I("renderApp options must be an object");const r=le(t.container)?t.container:B(t.container)?document.querySelector(t.container):null;if(!le(r))return I("Target container is not a DOM element.");const n=z(_.tagName);for(const a in t)if(a==="onDataChange")R(t[a])&&n.addEventListener("datachange",t[a]);else if(a==="lifeCycles"){const c=t[a];if(U(c))for(const u in c)u.toUpperCase()in N&&R(c[u])&&n.addEventListener(u.toLowerCase(),c[u])}else a!=="container"&&n.setAttribute(a,t[a]);const o=()=>{s(),e(!0)},i=()=>{s(),e(!1)},s=()=>{n.removeEventListener(N.MOUNTED,o),n.removeEventListener(N.ERROR,i)};n.addEventListener(N.MOUNTED,o),n.addEventListener(N.ERROR,i),r.appendChild(n)})}class Vi extends Io{constructor(){super(...arguments),this.tagName="micro-app",this.hasInit=!1,this.options={},this.router=Ve,this.preFetch=nr,this.unmountApp=nn,this.unmountAllApps=qi,this.getActiveApps=ye,this.getAllApps=Gi,this.reload=Ki,this.renderApp=Qi}start(e){var r,n;if(!nt||!window.customElements)return I("micro-app is not supported in this environment");if(this.hasInit)return I("microApp.start executed repeatedly");if(this.hasInit=!0,e?.tagName)if(/^micro-app(-\S+)?/.test(e.tagName))this.tagName=e.tagName;else return I(`${e.tagName} is invalid tagName`);if(Wi(),window.customElements.get(this.tagName))return _e(`element ${this.tagName} is already defined`);if(U(e)&&(this.options=e,e["disable-scopecss"]=(r=e["disable-scopecss"])!==null&&r!==void 0?r:e.disableScopecss,e["disable-sandbox"]=(n=e["disable-sandbox"])!==null&&n!==void 0?n:e.disableSandbox,e.preFetchApps&&nr(e.preFetchApps),e.globalAssets&&$i(e.globalAssets),U(e.plugins))){const o=e.plugins.modules;if(U(o))for(const i in o){const s=$(i);s&&i!==s&&(o[s]=o[i],delete o[i])}}Fi(this.tagName)}}const _=new Vi;_.start();function Ji(){return Ft.jsx("div",{children:Ft.jsx("micro-app",{name:"my-app",url:"http://localhost:5175/",iframe:!0})})}export{Ji as default};
