import{r as c,j as e,T as V,B as z}from"../../main-DzykU_cl.js";import{l as B}from"./lodash-CN7y4eQT.js";import{F as h}from"./index-CkCatyj_.js";import{A as O}from"./index-CF7E4fOl.js";import{S as C}from"./index-048wQVRF.js";import{C as u}from"./index-DyYjffXN.js";import{U as G}from"./index-ZVhFORXa.js";import{R as H}from"./UploadOutlined-CL3kQUqk.js";import{S as w}from"./index-BFI9kj1I.js";import{S as k}from"./index-CdRMCcvW.js";import{S as M}from"./index-DhwBZsB2.js";import{R as J}from"./DownloadOutlined-Caee277d.js";import"./row-COOdU8yd.js";import"./index-AglA6CMl.js";import"./useBreakpoint-w2IjVQaS.js";import"./useForceUpdate-CosIKAaA.js";import"./ExclamationCircleFilled-C864b64l.js";import"./InfoCircleFilled-BJKSyOCY.js";import"./fade-DoU_FCEA.js";import"./EyeOutlined-DxJGTue0.js";import"./SearchOutlined-BAcjJbDy.js";const K="_canvasWrapper_82b5x_1",Q="_canvas_82b5x_1",X="_canvasLoading_82b5x_20",R={canvasWrapper:K,canvas:Q,canvasLoading:X},{Title:Y,Paragraph:L,Text:P}=V,{Option:S}=M,be=()=>{const m=c.useRef(null),[I,F]=c.useState(null),[g]=h.useForm(),[j,_]=c.useState(null),[A,y]=c.useState(!1),U=c.useMemo(()=>({pixelSize:10,keepAspectRatio:!0,pixelShape:"square",colorReduction:!1,colorLevels:8}),[]),p=c.useCallback(s=>{const a=m.current,t=a?.getContext("2d");!a||!t||(y(!0),requestAnimationFrame(()=>{const d=g.getFieldsValue();a.width=s.width,a.height=s.height,t.clearRect(0,0,a.width,a.height),t.drawImage(s,0,0);const n=d.pixelSize,x=t.getImageData(0,0,a.width,a.height);x.data,t.clearRect(0,0,a.width,a.height);for(let i=0;i<a.height;i+=n)for(let o=0;o<a.width;o+=n){const l=N(x,o,i,n,a.width,a.height);if(d.colorReduction){const r=d.colorLevels;l.r=Math.round(l.r/255*(r-1))*(255/(r-1)),l.g=Math.round(l.g/255*(r-1))*(255/(r-1)),l.b=Math.round(l.b/255*(r-1))*(255/(r-1))}switch(t.fillStyle=`rgb(${l.r}, ${l.g}, ${l.b})`,d.pixelShape){case"circle":t.beginPath(),t.arc(o+n/2,i+n/2,n/2,0,Math.PI*2),t.fill();break;case"rounded":t.beginPath(),t.roundRect(o,i,n,n,n/4),t.fill();break;case"square":default:t.fillRect(o,i,n,n);break}}y(!1)}))},[]),N=(s,a,t,d,n,x)=>{let i=0,o=0,l=0,r=0;const E=Math.min(a+d,n),T=Math.min(t+d,x);for(let f=t;f<T;f++)for(let v=a;v<E;v++){const b=(f*n+v)*4;i+=s.data[b],o+=s.data[b+1],l+=s.data[b+2],r++}return{r:Math.round(i/r),g:Math.round(o/r),b:Math.round(l/r)}},$=c.useMemo(()=>B.debounce(s=>p(s),100),[p]),W=c.useCallback(s=>{const a=new Image;return m.current&&(a.onload=()=>{_(a),p(a)},a.src=URL.createObjectURL(s)),!1},[p]),q=()=>{j&&$(j)},D=()=>{const s=m.current;if(!s)return;const a=document.createElement("a");a.download="像素化图片.png",a.href=s.toDataURL("image/png"),a.click()};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[e.jsx(Y,{level:2,children:"Canvas 像素化效果演示"}),e.jsx(O,{type:"info",message:"什么是图像像素化？",description:"图像像素化是一种将图像分解成大的色块的处理技术，可以创造复古的8位游戏风格或艺术效果。通过调整像素大小和形状，可以得到不同的视觉效果。",showIcon:!0,style:{marginBottom:"20px"}}),e.jsxs(C,{direction:"vertical",style:{width:"100%"},children:[e.jsx(u,{title:"上传图片",children:e.jsx(C,{direction:"vertical",style:{width:"100%"},children:e.jsxs(G.Dragger,{accept:"image/*",beforeUpload:W,maxCount:1,fileList:I?[I]:[],onChange:({fileList:s})=>F(s[0]),children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(H,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽图片到此区域上传"})]})})}),e.jsx(u,{title:"像素化配置",children:e.jsxs(h,{form:g,initialValues:U,onValuesChange:q,layout:"vertical",children:[e.jsx(h.Item,{label:"像素大小",name:"pixelSize",tooltip:"像素块的尺寸，值越大像素化效果越明显",children:e.jsx(w,{min:1,max:50})}),e.jsx(h.Item,{label:"保持宽高比",name:"keepAspectRatio",valuePropName:"checked",tooltip:"启用后将保持原图的宽高比",children:e.jsx(k,{})}),e.jsx(h.Item,{label:"像素形状",name:"pixelShape",tooltip:"选择不同的像素块形状",children:e.jsxs(M,{children:[e.jsx(S,{value:"square",children:"方形"}),e.jsx(S,{value:"circle",children:"圆形"}),e.jsx(S,{value:"rounded",children:"圆角"})]})}),e.jsx(h.Item,{label:"启用颜色减少",name:"colorReduction",valuePropName:"checked",tooltip:"减少颜色数量，增强复古效果",children:e.jsx(k,{})}),e.jsx(h.Item,{label:"颜色等级",name:"colorLevels",tooltip:"颜色数量，值越小颜色越少",children:e.jsx(w,{min:2,max:32,disabled:!g.getFieldValue("colorReduction")})})]})}),e.jsx(u,{title:"预览效果",extra:e.jsx(z,{type:"primary",icon:e.jsx(J,{}),onClick:D,disabled:!j,children:"下载图片"}),children:e.jsx("div",{className:`${R.canvasWrapper} ${A?R.canvasLoading:""}`,children:e.jsx("canvas",{ref:m,className:R.canvas})})}),e.jsxs(u,{title:"功能说明",children:[e.jsx(L,{children:e.jsx(P,{strong:!0,children:"像素化特点："})}),e.jsxs("ul",{children:[e.jsx("li",{children:"可调整像素大小，控制像素化程度"}),e.jsx("li",{children:"支持不同的像素形状（方形、圆形、圆角）"}),e.jsx("li",{children:"可启用颜色减少功能，创造复古效果"}),e.jsx("li",{children:"支持保持原图宽高比"}),e.jsx("li",{children:"支持下载处理后的图片"})]}),e.jsx(L,{children:e.jsx(P,{strong:!0,children:"实现原理："})}),e.jsxs("ul",{children:[e.jsx("li",{children:"使用 Canvas API 处理图片"}),e.jsx("li",{children:"按指定步长分割图像区域"}),e.jsx("li",{children:"计算每个区域的平均颜色"}),e.jsx("li",{children:"使用不同形状绘制像素块"}),e.jsx("li",{children:"可选的颜色量化处理，减少颜色数量"})]})]})]})]})};export{be as default};
