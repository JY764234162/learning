import{r as c,j as e,T as V,B as z}from"../../main-OXPBM_qZ.js";import{l as B}from"./lodash-B7k7C2SF.js";import{F as h}from"./index-DXnuiRA5.js";import{A as O}from"./index-Dc_ZFgXU.js";import{S as C}from"./index-CFwjkXIH.js";import{C as u}from"./index-ozCc7co4.js";import{U as G}from"./index-CbExy1dJ.js";import{R as H}from"./UploadOutlined-CW5N2kTB.js";import{S as w}from"./index-jOllm9k2.js";import{S as k}from"./index-DYepb2Hy.js";import{S as M}from"./index-BJKGtT01.js";import{R as J}from"./DownloadOutlined-5rxQ1gt8.js";import"./row-CpERS4l2.js";import"./index-CYoKMSM0.js";import"./useBreakpoint-Cr3g4EDJ.js";import"./useForceUpdate--dps8mAK.js";import"./ExclamationCircleFilled-nN6694U8.js";import"./InfoCircleFilled-DwrpwwI6.js";import"./fade-W4Mt3bIn.js";import"./EyeOutlined-C9MC2XXc.js";import"./PurePanel-BgWvpYE5.js";import"./SearchOutlined-DfU5rCjC.js";const K="_canvasWrapper_82b5x_1",Q="_canvas_82b5x_1",X="_canvasLoading_82b5x_20",R={canvasWrapper:K,canvas:Q,canvasLoading:X},{Title:Y,Paragraph:L,Text:P}=V,{Option:S}=M,Re=()=>{const m=c.useRef(null),[I,F]=c.useState(null),[g]=h.useForm(),[j,_]=c.useState(null),[A,y]=c.useState(!1),U=c.useMemo(()=>({pixelSize:10,keepAspectRatio:!0,pixelShape:"square",colorReduction:!1,colorLevels:8}),[]),p=c.useCallback(s=>{const t=m.current,a=t?.getContext("2d");!t||!a||(y(!0),requestAnimationFrame(()=>{const d=g.getFieldsValue();t.width=s.width,t.height=s.height,a.clearRect(0,0,t.width,t.height),a.drawImage(s,0,0);const n=d.pixelSize,x=a.getImageData(0,0,t.width,t.height);x.data,a.clearRect(0,0,t.width,t.height);for(let l=0;l<t.height;l+=n)for(let o=0;o<t.width;o+=n){const r=N(x,o,l,n,t.width,t.height);if(d.colorReduction){const i=d.colorLevels;r.r=Math.round(r.r/255*(i-1))*(255/(i-1)),r.g=Math.round(r.g/255*(i-1))*(255/(i-1)),r.b=Math.round(r.b/255*(i-1))*(255/(i-1))}switch(a.fillStyle=`rgb(${r.r}, ${r.g}, ${r.b})`,d.pixelShape){case"circle":a.beginPath(),a.arc(o+n/2,l+n/2,n/2,0,Math.PI*2),a.fill();break;case"rounded":a.beginPath(),a.roundRect(o,l,n,n,n/4),a.fill();break;case"square":default:a.fillRect(o,l,n,n);break}}y(!1)}))},[]),N=(s,t,a,d,n,x)=>{let l=0,o=0,r=0,i=0;const E=Math.min(t+d,n),T=Math.min(a+d,x);for(let f=a;f<T;f++)for(let v=t;v<E;v++){const b=(f*n+v)*4;l+=s.data[b],o+=s.data[b+1],r+=s.data[b+2],i++}return{r:Math.round(l/i),g:Math.round(o/i),b:Math.round(r/i)}},$=c.useMemo(()=>B.debounce(s=>p(s),100),[p]),W=c.useCallback(s=>{const t=new Image;return m.current&&(t.onload=()=>{_(t),p(t)},t.src=URL.createObjectURL(s)),!1},[p]),q=()=>{j&&$(j)},D=()=>{const s=m.current;if(!s)return;const t=document.createElement("a");t.download="像素化图片.png",t.href=s.toDataURL("image/png"),t.click()};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[e.jsx(Y,{level:2,children:"Canvas 像素化效果演示"}),e.jsx(O,{type:"info",message:"什么是图像像素化？",description:"图像像素化是一种将图像分解成大的色块的处理技术，可以创造复古的8位游戏风格或艺术效果。通过调整像素大小和形状，可以得到不同的视觉效果。",showIcon:!0,style:{marginBottom:"20px"}}),e.jsxs(C,{direction:"vertical",style:{width:"100%"},children:[e.jsx(u,{title:"上传图片",children:e.jsx(C,{direction:"vertical",style:{width:"100%"},children:e.jsxs(G.Dragger,{accept:"image/*",beforeUpload:W,maxCount:1,fileList:I?[I]:[],onChange:({fileList:s})=>F(s[0]),children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(H,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽图片到此区域上传"})]})})}),e.jsx(u,{title:"像素化配置",children:e.jsxs(h,{form:g,initialValues:U,onValuesChange:q,layout:"vertical",children:[e.jsx(h.Item,{label:"像素大小",name:"pixelSize",tooltip:"像素块的尺寸，值越大像素化效果越明显",children:e.jsx(w,{min:1,max:50})}),e.jsx(h.Item,{label:"保持宽高比",name:"keepAspectRatio",valuePropName:"checked",tooltip:"启用后将保持原图的宽高比",children:e.jsx(k,{})}),e.jsx(h.Item,{label:"像素形状",name:"pixelShape",tooltip:"选择不同的像素块形状",children:e.jsxs(M,{children:[e.jsx(S,{value:"square",children:"方形"}),e.jsx(S,{value:"circle",children:"圆形"}),e.jsx(S,{value:"rounded",children:"圆角"})]})}),e.jsx(h.Item,{label:"启用颜色减少",name:"colorReduction",valuePropName:"checked",tooltip:"减少颜色数量，增强复古效果",children:e.jsx(k,{})}),e.jsx(h.Item,{label:"颜色等级",name:"colorLevels",tooltip:"颜色数量，值越小颜色越少",children:e.jsx(w,{min:2,max:32,disabled:!g.getFieldValue("colorReduction")})})]})}),e.jsx(u,{title:"预览效果",extra:e.jsx(z,{type:"primary",icon:e.jsx(J,{}),onClick:D,disabled:!j,children:"下载图片"}),children:e.jsx("div",{className:`${R.canvasWrapper} ${A?R.canvasLoading:""}`,children:e.jsx("canvas",{ref:m,className:R.canvas})})}),e.jsxs(u,{title:"功能说明",children:[e.jsx(L,{children:e.jsx(P,{strong:!0,children:"像素化特点："})}),e.jsxs("ul",{children:[e.jsx("li",{children:"可调整像素大小，控制像素化程度"}),e.jsx("li",{children:"支持不同的像素形状（方形、圆形、圆角）"}),e.jsx("li",{children:"可启用颜色减少功能，创造复古效果"}),e.jsx("li",{children:"支持保持原图宽高比"}),e.jsx("li",{children:"支持下载处理后的图片"})]}),e.jsx(L,{children:e.jsx(P,{strong:!0,children:"实现原理："})}),e.jsxs("ul",{children:[e.jsx("li",{children:"使用 Canvas API 处理图片"}),e.jsx("li",{children:"按指定步长分割图像区域"}),e.jsx("li",{children:"计算每个区域的平均颜色"}),e.jsx("li",{children:"使用不同形状绘制像素块"}),e.jsx("li",{children:"可选的颜色量化处理，减少颜色数量"})]})]})]})]})};export{Re as default};
