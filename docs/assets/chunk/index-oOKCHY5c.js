import{r as n,j as e,T as U}from"../../main-BdssBdaK.js";import{l as _}from"./lodash-CgxPygPy.js";import{F as o}from"./index-CLaslxvW.js";import{A as L}from"./index-DP0mdh1e.js";import{S as y}from"./index-RcpCfIRg.js";import{C as x}from"./index-CqsQUBG0.js";import{U as z}from"./index-xXHI4sV5.js";import{R as E}from"./UploadOutlined-JfLUlZpb.js";import{S as R}from"./index-DkhiTol7.js";import{I as V}from"./index-C2NPSFB8.js";import{S as g}from"./index-BdsT6mCp.js";import{C as q}from"./ColorPicker-CIRP4EkS.js";import"./row-C_tOcRBJ.js";import"./index-BIZZa86p.js";import"./useBreakpoint-DFLkBD6y.js";import"./useForceUpdate-hANogpxD.js";import"./ExclamationCircleFilled-CzleENMA.js";import"./InfoCircleFilled-krVInnJ3.js";import"./fade-hJV4ytfh.js";import"./DownloadOutlined-DLklpAHD.js";import"./EyeOutlined-D8UNOCuo.js";import"./Input-CAIDGnEc.js";import"./SearchOutlined-Bwn__wnW.js";import"./index-DSVLGwor.js";import"./index-vIVRchuk.js";import"./index-Bi2r6JyH.js";import"./index-C9rsMHbh.js";const H="_canvasWrapper_82b5x_1",B="_canvas_82b5x_1",S={canvasWrapper:H,canvas:B},{Title:O,Paragraph:k,Text:T}=U,be=()=>{const j=n.useRef(null),[I,W]=n.useState(null),[C]=o.useForm(),[d,F]=n.useState(null),u=n.useRef(""),A=n.useMemo(()=>({text:"水印文本",fontSize:30,opacity:.3,angle:-30,spacing:50,useCustomColor:!1,customColor:"#000000",useCurrentTime:!0}),[]),$=n.useCallback(t=>{if(u.current)return u.current;const a=document.createElement("canvas"),s=a.getContext("2d");if(!s)return"0,0,0";const r=Math.min(1,100/Math.max(t.width,t.height));a.width=t.width*r,a.height=t.height*r,s.drawImage(t,0,0,a.width,a.height);const l=s.getImageData(0,0,a.width,a.height).data,m={};let i="";const v=4;for(let h=0;h<l.length;h+=4*v){const c=`${l[h]},${l[h+1]},${l[h+2]}`;m[c]=(m[c]||0)+1,(!i||m[c]>m[i])&&(i=c)}return u.current=i,i},[]),f=n.useCallback(t=>{const a=j.current,s=a?.getContext("2d");!a||!s||requestAnimationFrame(()=>{s.clearRect(0,0,a.width,a.height),s.drawImage(t,0,0);const r=C.getFieldsValue(),p=$(t),l=r.useCustomColor?typeof r.customColor=="string"?r.customColor:`rgba(${r.customColor.toRgb().r}, ${r.customColor.toRgb().g}, ${r.customColor.toRgb().b}, ${r.customColor.toRgb().a})`:M(p);N(s,a,l,r)})},[]),b=n.useMemo(()=>_.debounce(t=>f(t),100),[f]),D=n.useCallback(t=>{const a=new Image,s=j.current,r=s?.getContext("2d");return!s||!r||(a.onload=()=>{s.width=a.width,s.height=a.height,u.current="",F(a),f(a)},a.src=URL.createObjectURL(t)),!1},[]),M=t=>{const a=t.split(",").map(Number);return a[0]*.299+a[1]*.587+a[2]*.114>186?"rgba(0, 0, 0, 0.3)":"rgba(255, 255, 255, 0.3)"},N=(t,a,s,r)=>{const p=r.useCurrentTime?new Date().toLocaleString():r.text;t.font=`${r.fontSize}px Arial`,t.fillStyle=s,t.globalAlpha=r.opacity;const l=r.angle*Math.PI/180,m=t.measureText(p).width,i=r.fontSize,v=Math.ceil(a.width/(m+r.spacing)),h=Math.ceil(a.height/(i+r.spacing));t.save();for(let c=0;c<v;c++)for(let w=0;w<h;w++)t.save(),t.translate(c*(m+r.spacing),w*(i+r.spacing)),t.rotate(l),t.fillText(p,0,0),t.restore();t.restore(),t.globalAlpha=1},P=t=>{d&&("useCurrentTime"in t,b(d))};return e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[e.jsx(O,{level:2,children:"Canvas 水印演示"}),e.jsx(L,{type:"info",message:"什么是智能水印？",description:"智能水印是一种根据图片主色调自动调整水印颜色的技术。它通过分析图片的主要颜色，选择合适的对比度颜色作为水印，使水印既清晰可见又不会过分干扰原图的观感。",showIcon:!0,style:{marginBottom:"20px"}}),e.jsxs(y,{direction:"vertical",style:{width:"100%"},children:[e.jsx(x,{title:"上传图片",children:e.jsx(y,{direction:"vertical",style:{width:"100%"},children:e.jsxs(z.Dragger,{accept:"image/*",beforeUpload:D,maxCount:1,fileList:I?[I]:[],onChange:({fileList:t})=>W(t[0]),children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(E,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽图片到此区域上传"})]})})}),e.jsx(x,{title:"水印配置",children:e.jsxs(o,{form:C,initialValues:A,onValuesChange:P,layout:"vertical",children:[e.jsx(o.Item,{label:"使用当前时间",name:"useCurrentTime",valuePropName:"checked",children:e.jsx(R,{})}),e.jsx(o.Item,{label:"水印文本",name:"text",rules:[{required:!0,message:"请输入水印文本"}],children:e.jsx(V,{placeholder:"请输入水印文本"})}),e.jsx(o.Item,{label:"字体大小",name:"fontSize",children:e.jsx(g,{min:12,max:300})}),e.jsx(o.Item,{label:"不透明度",name:"opacity",children:e.jsx(g,{min:.1,max:1,step:.1})}),e.jsx(o.Item,{label:"旋转角度",name:"angle",children:e.jsx(g,{min:-180,max:180})}),e.jsx(o.Item,{label:"间距",name:"spacing",children:e.jsx(g,{min:10,max:300})}),e.jsx(o.Item,{label:"使用自定义颜色",name:"useCustomColor",valuePropName:"checked",children:e.jsx(R,{})}),e.jsx(o.Item,{label:"自定义颜色",name:"customColor",children:e.jsx(q,{format:"rgb",allowClear:!1,onChange:t=>{C.setFieldValue("customColor",t),d&&b(d)}})})]})}),e.jsx(x,{title:"预览效果",children:e.jsx("div",{className:S.canvasWrapper,children:e.jsx("canvas",{ref:j,className:S.canvas})})}),e.jsxs(x,{title:"功能说明",children:[e.jsx(k,{children:e.jsx(T,{strong:!0,children:"水印特点："})}),e.jsxs("ul",{children:[e.jsx("li",{children:"自适应水印颜色（根据图片主色调）"}),e.jsx("li",{children:"可自定义水印文本或使用时间戳"}),e.jsx("li",{children:"可调整字体大小、透明度、角度"}),e.jsx("li",{children:"可配置水印间距"}),e.jsx("li",{children:"支持自定义水印颜色"})]}),e.jsx(k,{children:e.jsx(T,{strong:!0,children:"实现原理："})}),e.jsxs("ul",{children:[e.jsx("li",{children:"使用 Canvas API 处理图片"}),e.jsx("li",{children:"分析图片像素获取主色调"}),e.jsx("li",{children:"计算对比度选择水印颜色"}),e.jsx("li",{children:"使用变换矩阵实现旋转效果"}),e.jsx("li",{children:"计算间距实现均匀分布"})]})]})]})]})};export{be as default};
