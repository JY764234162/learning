"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.version=exports.stopEvent=exports.shadow=exports.setLayerDimensions=exports.normalizeUnicode=exports.noContextMenu=exports.isValidExplicitDest=exports.isPdfFile=exports.isDataScheme=exports.getXfaPageViewport=exports.getUuid=exports.getPdfFilenameFromUrl=exports.getFilenameFromUrl=exports.getDocument=exports.fetchData=exports.createValidAbsoluteUrl=exports.build=exports.XfaLayer=exports.VerbosityLevel=exports.Util=exports.TouchManager=exports.TextLayer=exports.SupportedImageMimeTypes=exports.SignatureExtractor=exports.ResponseException=exports.RenderingCancelledException=exports.PixelsPerInch=exports.PermissionFlag=exports.PasswordResponses=exports.PDFWorker=exports.PDFDateString=exports.PDFDataRangeTransport=exports.OutputScale=exports.OPS=exports.MathClamp=exports.InvalidPDFException=exports.ImageKind=exports.GlobalWorkerOptions=exports.FeatureTest=exports.DrawLayer=exports.DOMSVGFactory=exports.ColorPicker=exports.AnnotationType=exports.AnnotationMode=exports.AnnotationLayer=exports.AnnotationEditorUIManager=exports.AnnotationEditorType=exports.AnnotationEditorParamsType=exports.AnnotationEditorLayer=exports.AbortException=void 0;var _Util2,_PixelsPerInch2,_ImageManager,_TouchManager2,_AnnotationEditor,_TextLayer2,_PDFDocumentLoadingTa,_PDFDocumentLoadingTa2,_PDFWorker2,_FreeTextEditor,_ColorPicker2,_HighlightEditor,_DrawingEditor,_SignatureExtractor2,_DrawLayer2;function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _toSetter(t,e,n){e||(e=[]);var r=e.length++;return Object.defineProperty({},"_",{set:function set(o){e[r]=o,t.apply(n,e);}});}function _superPropGet(t,o,e,r){var p=_get2(_getPrototypeOf(1&r?t.prototype:t),o,e);return 2&r&&"function"==typeof p?function(t){return p.apply(e,t);}:p;}function _get2(){return _get2="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var p=_superPropBase(e,t);if(p){var n=Object.getOwnPropertyDescriptor(p,t);return n.get?n.get.call(arguments.length<3?e:r):n.value;}},_get2.apply(null,arguments);}function _superPropBase(t,o){for(;!{}.hasOwnProperty.call(t,o)&&null!==(t=_getPrototypeOf(t)););return t;}function _regeneratorKeys(e){var n=Object(e),r=[];for(var t in n)r.unshift(t);return function e(){for(;r.length;)if((t=r.pop())in n)return e.value=t,e.done=!1,e;return e.done=!0,e;};}function _interopRequireWildcard(e,t){if("function"==typeof WeakMap)var r=new WeakMap(),n=new WeakMap();return(_interopRequireWildcard=function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;var o,i,f={__proto__:null,"default":e};if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return f;if(o=t?n:r){if(o.has(e))return o.get(e);o.set(e,f);}for(var _t32 in e)"default"!==_t32&&{}.hasOwnProperty.call(e,_t32)&&((i=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,_t32))&&(i.get||i.set)?o(f,_t32,i):f[_t32]=e[_t32]);return f;})(e,t);}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r);}function _readOnlyError(r){throw new TypeError('"'+r+'" is read-only');}function _regenerator(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a;}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0));}if(o||r>1)return a;throw y=!0,n;}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0);}else 1===c&&(t=i["return"])&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e;}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break;}catch(t){i=e,c=1,u=t;}finally{f=1;}}return{value:t,done:y};};}(r,o,i),!0),u;}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this;}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e;}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,"Generator"),_regeneratorDefine2(u,n,function(){return this;}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]";}),(_regenerator=function _regenerator(){return{w:i,m:f};})();}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},"",{});}catch(e){i=0;}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){if(r)i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n;else{var o=function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e);});};o("next",0),o("throw",1),o("return",2);}},_regeneratorDefine2(e,r,n,t);}function _classPrivateMethodInitSpec(e,a){_checkPrivateRedeclaration(e,a),a.add(e);}function _classPrivateFieldInitSpec(e,t,a){_checkPrivateRedeclaration(e,t),t.set(e,a);}function _checkPrivateRedeclaration(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object");}function _classPrivateGetter(s,r,a){return a(_assertClassBrand(s,r));}function _classPrivateFieldGet(s,a){return s.get(_assertClassBrand(s,a));}function _classPrivateFieldSet(s,a,r){return s.set(_assertClassBrand(s,a),r),r;}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value;}catch(n){return void e(n);}i.done?t(u):Promise.resolve(u).then(r,o);}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n);}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n);}_next(void 0);});};}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e;}function _toArray(r){return _arrayWithHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableRest();}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r);}function _assertClassBrand(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object");}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1;}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r;}finally{try{if(!f&&null!=t["return"]&&(u=t["return"](),Object(u)!==u))return;}finally{if(o)throw n;}}return a;}}function _arrayWithHoles(r){if(Array.isArray(r))return r;}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n2=0,F=function F(){};return{s:F,n:function n(){return _n2>=r.length?{done:!0}:{done:!1,value:r[_n2++]};},e:function e(r){throw r;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var o,a=!0,u=!1;return{s:function s(){t=t.call(r);},n:function n(){var r=t.next();return a=r.done,r;},e:function e(r){u=!0,o=r;},f:function f(){try{a||null==t["return"]||t["return"]();}finally{if(u)throw o;}}};}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0;}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n;}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o);}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+"";}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===r?String:Number)(t);}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function");}function _callSuper(t,o,e){return o=_getPrototypeOf(o),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e));}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t);}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e;}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t;})();}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t);},_getPrototypeOf(t);}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e);}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t;},_setPrototypeOf(t,e);}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}function _asyncIterator(r){var n,t,o,e=2;for("undefined"!=typeof Symbol&&(t=Symbol.asyncIterator,o=Symbol.iterator);e--;){if(t&&null!=(n=r[t]))return n.call(r);if(o&&null!=(n=r[o]))return new AsyncFromSyncIterator(n.call(r));t="@@asyncIterator",o="@@iterator";}throw new TypeError("Object is not async iterable");}function AsyncFromSyncIterator(r){function AsyncFromSyncIteratorContinuation(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var n=r.done;return Promise.resolve(r.value).then(function(r){return{value:r,done:n};});}return AsyncFromSyncIterator=function AsyncFromSyncIterator(r){this.s=r,this.n=r.next;},AsyncFromSyncIterator.prototype={s:null,n:null,next:function next(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments));},"return":function _return(r){var n=this.s["return"];return void 0===n?Promise.resolve({value:r,done:!0}):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments));},"throw":function _throw(r){var n=this.s["return"];return void 0===n?Promise.reject(r):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments));}},new AsyncFromSyncIterator(r);}/**
 * @licstart The following is the entire license notice for the
 * JavaScript code in this page
 *
 * Copyright 2024 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @licend The above is the entire license notice for the
 * JavaScript code in this page
 *//******/// The require scope
/******/var __webpack_require__={};/******//************************************************************************//******//* webpack/runtime/define property getters *//******/(function(){/******/// define getter functions for harmony exports
/******/__webpack_require__.d=function(exports,definition){/******/for(var key in definition){/******/if(__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)){/******/Object.defineProperty(exports,key,{enumerable:true,get:definition[key]});/******/}/******/}/******/};/******/})();/******//******//* webpack/runtime/hasOwnProperty shorthand *//******/(function(){/******/__webpack_require__.o=function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop);};/******/})();/******//************************************************************************/var __webpack_exports__=globalThis.pdfjsLib={};// EXPORTS
__webpack_require__.d(__webpack_exports__,{AbortException:function AbortException(){return/* reexport */_AbortException;},AnnotationEditorLayer:function AnnotationEditorLayer(){return/* reexport */_AnnotationEditorLayer;},AnnotationEditorParamsType:function AnnotationEditorParamsType(){return/* reexport */_AnnotationEditorParamsType;},AnnotationEditorType:function AnnotationEditorType(){return/* reexport */_AnnotationEditorType;},AnnotationEditorUIManager:function AnnotationEditorUIManager(){return/* reexport */_AnnotationEditorUIManager;},AnnotationLayer:function AnnotationLayer(){return/* reexport */_AnnotationLayer;},AnnotationMode:function AnnotationMode(){return/* reexport */_AnnotationMode;},AnnotationType:function AnnotationType(){return/* reexport */_AnnotationType;},ColorPicker:function ColorPicker(){return/* reexport */_ColorPicker;},DOMSVGFactory:function DOMSVGFactory(){return/* reexport */_DOMSVGFactory;},DrawLayer:function DrawLayer(){return/* reexport */_DrawLayer;},FeatureTest:function FeatureTest(){return/* reexport */util_FeatureTest;},GlobalWorkerOptions:function GlobalWorkerOptions(){return/* reexport */_GlobalWorkerOptions;},ImageKind:function ImageKind(){return/* reexport */util_ImageKind;},InvalidPDFException:function InvalidPDFException(){return/* reexport */_InvalidPDFException;},MathClamp:function MathClamp(){return/* reexport */_MathClamp;},OPS:function OPS(){return/* reexport */_OPS;},OutputScale:function OutputScale(){return/* reexport */_OutputScale;},PDFDataRangeTransport:function PDFDataRangeTransport(){return/* reexport */_PDFDataRangeTransport;},PDFDateString:function PDFDateString(){return/* reexport */_PDFDateString;},PDFWorker:function PDFWorker(){return/* reexport */_PDFWorker;},PasswordResponses:function PasswordResponses(){return/* reexport */_PasswordResponses;},PermissionFlag:function PermissionFlag(){return/* reexport */_PermissionFlag;},PixelsPerInch:function PixelsPerInch(){return/* reexport */_PixelsPerInch;},RenderingCancelledException:function RenderingCancelledException(){return/* reexport */_RenderingCancelledException;},ResponseException:function ResponseException(){return/* reexport */_ResponseException;},SignatureExtractor:function SignatureExtractor(){return/* reexport */_SignatureExtractor;},SupportedImageMimeTypes:function SupportedImageMimeTypes(){return/* reexport */_SupportedImageMimeTypes;},TextLayer:function TextLayer(){return/* reexport */_TextLayer;},TouchManager:function TouchManager(){return/* reexport */_TouchManager;},Util:function Util(){return/* reexport */_Util;},VerbosityLevel:function VerbosityLevel(){return/* reexport */_VerbosityLevel;},XfaLayer:function XfaLayer(){return/* reexport */_XfaLayer;},build:function build(){return/* reexport */_build;},createValidAbsoluteUrl:function createValidAbsoluteUrl(){return/* reexport */_createValidAbsoluteUrl;},fetchData:function fetchData(){return/* reexport */_fetchData;},getDocument:function getDocument(){return/* reexport */_getDocument;},getFilenameFromUrl:function getFilenameFromUrl(){return/* reexport */_getFilenameFromUrl;},getPdfFilenameFromUrl:function getPdfFilenameFromUrl(){return/* reexport */_getPdfFilenameFromUrl;},getUuid:function getUuid(){return/* reexport */_getUuid;},getXfaPageViewport:function getXfaPageViewport(){return/* reexport */_getXfaPageViewport;},isDataScheme:function isDataScheme(){return/* reexport */_isDataScheme;},isPdfFile:function isPdfFile(){return/* reexport */_isPdfFile;},isValidExplicitDest:function isValidExplicitDest(){return/* reexport */_isValidExplicitDest2;},noContextMenu:function noContextMenu(){return/* reexport */_noContextMenu;},normalizeUnicode:function normalizeUnicode(){return/* reexport */_normalizeUnicode;},setLayerDimensions:function setLayerDimensions(){return/* reexport */_setLayerDimensions;},shadow:function shadow(){return/* reexport */_shadow;},stopEvent:function stopEvent(){return/* reexport */_stopEvent;},version:function version(){return/* reexport */_version;}});;// ./src/shared/util.js
var isNodeJS=(typeof process==="undefined"?"undefined":_typeof(process))==="object"&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");var IDENTITY_MATRIX=[1,0,0,1,0,0];var FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0];var LINE_FACTOR=1.35;var LINE_DESCENT_FACTOR=0.35;var BASELINE_FACTOR=LINE_DESCENT_FACTOR/LINE_FACTOR;var RenderingIntentFlag={ANY:0x01,DISPLAY:0x02,PRINT:0x04,SAVE:0x08,ANNOTATIONS_FORMS:0x10,ANNOTATIONS_STORAGE:0x20,ANNOTATIONS_DISABLE:0x40,IS_EDITING:0x80,OPLIST:0x100};var _AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};var AnnotationEditorPrefix="pdfjs_internal_editor_";var _AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101};var _AnnotationEditorParamsType={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41};var _PermissionFlag={PRINT:0x04,MODIFY_CONTENTS:0x08,COPY:0x10,MODIFY_ANNOTATIONS:0x20,FILL_INTERACTIVE_FORMS:0x100,COPY_FOR_ACCESSIBILITY:0x200,ASSEMBLE:0x400,PRINT_HIGH_QUALITY:0x800};var TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};var util_ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};var _AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var AnnotationReplyType={GROUP:"Group",REPLY:"R"};var AnnotationFlag={INVISIBLE:0x01,HIDDEN:0x02,PRINT:0x04,NOZOOM:0x08,NOROTATE:0x10,NOVIEW:0x20,READONLY:0x40,LOCKED:0x80,TOGGLENOVIEW:0x100,LOCKEDCONTENTS:0x200};var AnnotationFieldFlag={READONLY:0x0000001,REQUIRED:0x0000002,NOEXPORT:0x0000004,MULTILINE:0x0001000,PASSWORD:0x0002000,NOTOGGLETOOFF:0x0004000,RADIO:0x0008000,PUSHBUTTON:0x0010000,COMBO:0x0020000,EDIT:0x0040000,SORT:0x0080000,FILESELECT:0x0100000,MULTISELECT:0x0200000,DONOTSPELLCHECK:0x0400000,DONOTSCROLL:0x0800000,COMB:0x1000000,RICHTEXT:0x2000000,RADIOSINUNISON:0x2000000,COMMITONSELCHANGE:0x4000000};var AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};var DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};var PageActionEventType={O:"PageOpen",C:"PageClose"};var _VerbosityLevel={ERRORS:0,WARNINGS:1,INFOS:5};var _OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93};var DrawOPS={moveTo:0,lineTo:1,curveTo:2,closePath:3};var _PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};var verbosity=_VerbosityLevel.WARNINGS;function setVerbosityLevel(level){if(Number.isInteger(level)){verbosity=level;}}function getVerbosityLevel(){return verbosity;}function info(msg){if(verbosity>=_VerbosityLevel.INFOS){console.log("Info: ".concat(msg));}}function warn(msg){if(verbosity>=_VerbosityLevel.WARNINGS){console.log("Warning: ".concat(msg));}}function unreachable(msg){throw new Error(msg);}function assert(cond,msg){if(!cond){unreachable(msg);}}function _isValidProtocol(url){switch(url===null||url===void 0?void 0:url.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return true;default:return false;}}function _createValidAbsoluteUrl(url){var baseUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!url){return null;}if(options&&typeof url==="string"){if(options.addDefaultProtocol&&url.startsWith("www.")){var dots=url.match(/\./g);if((dots===null||dots===void 0?void 0:dots.length)>=2){url="http://".concat(url);}}if(options.tryConvertEncoding){try{url=stringToUTF8String(url);}catch(_unused){}}}var absoluteUrl=baseUrl?URL.parse(url,baseUrl):URL.parse(url);return _isValidProtocol(absoluteUrl)?absoluteUrl:null;}function _shadow(obj,prop,value){var nonSerializable=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;Object.defineProperty(obj,prop,{value:value,enumerable:!nonSerializable,configurable:true,writable:false});return value;}var BaseException=function BaseExceptionClosure(){function BaseException(message,name){this.message=message;this.name=name;}BaseException.prototype=new Error();BaseException.constructor=BaseException;return BaseException;}();var PasswordException=/*#__PURE__*/function(_BaseException){function PasswordException(msg,code){var _this;_classCallCheck(this,PasswordException);_this=_callSuper(this,PasswordException,[msg,"PasswordException"]);_this.code=code;return _this;}_inherits(PasswordException,_BaseException);return _createClass(PasswordException);}(BaseException);var UnknownErrorException=/*#__PURE__*/function(_BaseException2){function UnknownErrorException(msg,details){var _this2;_classCallCheck(this,UnknownErrorException);_this2=_callSuper(this,UnknownErrorException,[msg,"UnknownErrorException"]);_this2.details=details;return _this2;}_inherits(UnknownErrorException,_BaseException2);return _createClass(UnknownErrorException);}(BaseException);var _InvalidPDFException=/*#__PURE__*/function(_BaseException3){function _InvalidPDFException(msg){_classCallCheck(this,_InvalidPDFException);return _callSuper(this,_InvalidPDFException,[msg,"InvalidPDFException"]);}_inherits(_InvalidPDFException,_BaseException3);return _createClass(_InvalidPDFException);}(BaseException);var _ResponseException=/*#__PURE__*/function(_BaseException4){function _ResponseException(msg,status,missing){var _this3;_classCallCheck(this,_ResponseException);_this3=_callSuper(this,_ResponseException,[msg,"ResponseException"]);_this3.status=status;_this3.missing=missing;return _this3;}_inherits(_ResponseException,_BaseException4);return _createClass(_ResponseException);}(BaseException);var FormatError=/*#__PURE__*/function(_BaseException5){function FormatError(msg){_classCallCheck(this,FormatError);return _callSuper(this,FormatError,[msg,"FormatError"]);}_inherits(FormatError,_BaseException5);return _createClass(FormatError);}(BaseException);var _AbortException=/*#__PURE__*/function(_BaseException6){function _AbortException(msg){_classCallCheck(this,_AbortException);return _callSuper(this,_AbortException,[msg,"AbortException"]);}_inherits(_AbortException,_BaseException6);return _createClass(_AbortException);}(BaseException);function bytesToString(bytes){if(_typeof(bytes)!=="object"||(bytes===null||bytes===void 0?void 0:bytes.length)===undefined){unreachable("Invalid argument for bytesToString");}var length=bytes.length;var MAX_ARGUMENT_COUNT=8192;if(length<MAX_ARGUMENT_COUNT){return String.fromCharCode.apply(null,bytes);}var strBuf=[];for(var i=0;i<length;i+=MAX_ARGUMENT_COUNT){var chunkEnd=Math.min(i+MAX_ARGUMENT_COUNT,length);var chunk=bytes.subarray(i,chunkEnd);strBuf.push(String.fromCharCode.apply(null,chunk));}return strBuf.join("");}function stringToBytes(str){if(typeof str!=="string"){unreachable("Invalid argument for stringToBytes");}var length=str.length;var bytes=new Uint8Array(length);for(var i=0;i<length;++i){bytes[i]=str.charCodeAt(i)&0xff;}return bytes;}function string32(value){return String.fromCharCode(value>>24&0xff,value>>16&0xff,value>>8&0xff,value&0xff);}function objectSize(obj){return Object.keys(obj).length;}function objectFromMap(map){var obj=Object.create(null);var _iterator2=_createForOfIteratorHelper(map),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _step2$value=_slicedToArray(_step2.value,2),key=_step2$value[0],value=_step2$value[1];obj[key]=value;}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return obj;}function isLittleEndian(){var buffer8=new Uint8Array(4);buffer8[0]=1;var view32=new Uint32Array(buffer8.buffer,0,1);return view32[0]===1;}function isEvalSupported(){try{new Function("");return true;}catch(_unused2){return false;}}var util_FeatureTest=/*#__PURE__*/function(){function util_FeatureTest(){_classCallCheck(this,util_FeatureTest);}return _createClass(util_FeatureTest,null,[{key:"isLittleEndian",get:function get(){return _shadow(this,"isLittleEndian",isLittleEndian());}},{key:"isEvalSupported",get:function get(){return _shadow(this,"isEvalSupported",isEvalSupported());}},{key:"isOffscreenCanvasSupported",get:function get(){return _shadow(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!=="undefined");}},{key:"isImageDecoderSupported",get:function get(){return _shadow(this,"isImageDecoderSupported",typeof ImageDecoder!=="undefined");}},{key:"platform",get:function get(){var _navigator,_navigator2;if(typeof navigator!=="undefined"&&typeof((_navigator=navigator)===null||_navigator===void 0?void 0:_navigator.platform)==="string"&&typeof((_navigator2=navigator)===null||_navigator2===void 0?void 0:_navigator2.userAgent)==="string"){var _navigator3=navigator,platform=_navigator3.platform,userAgent=_navigator3.userAgent;return _shadow(this,"platform",{isAndroid:userAgent.includes("Android"),isLinux:platform.includes("Linux"),isMac:platform.includes("Mac"),isWindows:platform.includes("Win"),isFirefox:userAgent.includes("Firefox")});}return _shadow(this,"platform",{isAndroid:false,isLinux:false,isMac:false,isWindows:false,isFirefox:false});}},{key:"isCSSRoundSupported",get:function get(){var _globalThis$CSS,_globalThis$CSS$suppo;return _shadow(this,"isCSSRoundSupported",(_globalThis$CSS=globalThis.CSS)===null||_globalThis$CSS===void 0||(_globalThis$CSS$suppo=_globalThis$CSS.supports)===null||_globalThis$CSS$suppo===void 0?void 0:_globalThis$CSS$suppo.call(_globalThis$CSS,"width: round(1.5px, 1px)"));}}]);}();var hexNumbers=Array.from(Array(256).keys(),function(n){return n.toString(16).padStart(2,"0");});var _Util=/*#__PURE__*/function(){function _Util(){_classCallCheck(this,_Util);}return _createClass(_Util,null,[{key:"makeHexColor",value:function makeHexColor(r,g,b){return"#".concat(hexNumbers[r]).concat(hexNumbers[g]).concat(hexNumbers[b]);}},{key:"transform",value:function transform(m1,m2){return[m1[0]*m2[0]+m1[2]*m2[1],m1[1]*m2[0]+m1[3]*m2[1],m1[0]*m2[2]+m1[2]*m2[3],m1[1]*m2[2]+m1[3]*m2[3],m1[0]*m2[4]+m1[2]*m2[5]+m1[4],m1[1]*m2[4]+m1[3]*m2[5]+m1[5]];}},{key:"applyTransform",value:function applyTransform(p,m){var xt=p[0]*m[0]+p[1]*m[2]+m[4];var yt=p[0]*m[1]+p[1]*m[3]+m[5];return[xt,yt];}},{key:"applyInverseTransform",value:function applyInverseTransform(p,m){var d=m[0]*m[3]-m[1]*m[2];var xt=(p[0]*m[3]-p[1]*m[2]+m[2]*m[5]-m[4]*m[3])/d;var yt=(-p[0]*m[1]+p[1]*m[0]+m[4]*m[1]-m[5]*m[0])/d;return[xt,yt];}},{key:"getAxialAlignedBoundingBox",value:function getAxialAlignedBoundingBox(r,m){var p1=this.applyTransform(r,m);var p2=this.applyTransform(r.slice(2,4),m);var p3=this.applyTransform([r[0],r[3]],m);var p4=this.applyTransform([r[2],r[1]],m);return[Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1])];}},{key:"inverseTransform",value:function inverseTransform(m){var d=m[0]*m[3]-m[1]*m[2];return[m[3]/d,-m[1]/d,-m[2]/d,m[0]/d,(m[2]*m[5]-m[4]*m[3])/d,(m[4]*m[1]-m[5]*m[0])/d];}},{key:"singularValueDecompose2dScale",value:function singularValueDecompose2dScale(m){var transpose=[m[0],m[2],m[1],m[3]];var a=m[0]*transpose[0]+m[1]*transpose[2];var b=m[0]*transpose[1]+m[1]*transpose[3];var c=m[2]*transpose[0]+m[3]*transpose[2];var d=m[2]*transpose[1]+m[3]*transpose[3];var first=(a+d)/2;var second=Math.sqrt(Math.pow(a+d,2)-4*(a*d-c*b))/2;var sx=first+second||1;var sy=first-second||1;return[Math.sqrt(sx),Math.sqrt(sy)];}},{key:"normalizeRect",value:function normalizeRect(rect){var r=rect.slice(0);if(rect[0]>rect[2]){r[0]=rect[2];r[2]=rect[0];}if(rect[1]>rect[3]){r[1]=rect[3];r[3]=rect[1];}return r;}},{key:"intersect",value:function intersect(rect1,rect2){var xLow=Math.max(Math.min(rect1[0],rect1[2]),Math.min(rect2[0],rect2[2]));var xHigh=Math.min(Math.max(rect1[0],rect1[2]),Math.max(rect2[0],rect2[2]));if(xLow>xHigh){return null;}var yLow=Math.max(Math.min(rect1[1],rect1[3]),Math.min(rect2[1],rect2[3]));var yHigh=Math.min(Math.max(rect1[1],rect1[3]),Math.max(rect2[1],rect2[3]));if(yLow>yHigh){return null;}return[xLow,yLow,xHigh,yHigh];}},{key:"pointBoundingBox",value:function pointBoundingBox(x,y,minMax){minMax[0]=Math.min(minMax[0],x);minMax[1]=Math.min(minMax[1],y);minMax[2]=Math.max(minMax[2],x);minMax[3]=Math.max(minMax[3],y);}},{key:"rectBoundingBox",value:function rectBoundingBox(x0,y0,x1,y1,minMax){minMax[0]=Math.min(minMax[0],x0,x1);minMax[1]=Math.min(minMax[1],y0,y1);minMax[2]=Math.max(minMax[2],x0,x1);minMax[3]=Math.max(minMax[3],y0,y1);}},{key:"bezierBoundingBox",value:function bezierBoundingBox(x0,y0,x1,y1,x2,y2,x3,y3,minMax){minMax[0]=Math.min(minMax[0],x0,x3);minMax[1]=Math.min(minMax[1],y0,y3);minMax[2]=Math.max(minMax[2],x0,x3);minMax[3]=Math.max(minMax[3],y0,y3);_assertClassBrand(_Util,this,_getExtremum).call(this,x0,x1,x2,x3,y0,y1,y2,y3,3*(-x0+3*(x1-x2)+x3),6*(x0-2*x1+x2),3*(x1-x0),minMax);_assertClassBrand(_Util,this,_getExtremum).call(this,x0,x1,x2,x3,y0,y1,y2,y3,3*(-y0+3*(y1-y2)+y3),6*(y0-2*y1+y2),3*(y1-y0),minMax);}}]);}();_Util2=_Util;function _getExtremumOnCurve(x0,x1,x2,x3,y0,y1,y2,y3,t,minMax){if(t<=0||t>=1){return;}var mt=1-t;var tt=t*t;var ttt=tt*t;var x=mt*(mt*(mt*x0+3*t*x1)+3*tt*x2)+ttt*x3;var y=mt*(mt*(mt*y0+3*t*y1)+3*tt*y2)+ttt*y3;minMax[0]=Math.min(minMax[0],x);minMax[1]=Math.min(minMax[1],y);minMax[2]=Math.max(minMax[2],x);minMax[3]=Math.max(minMax[3],y);}function _getExtremum(x0,x1,x2,x3,y0,y1,y2,y3,a,b,c,minMax){if(Math.abs(a)<1e-12){if(Math.abs(b)>=1e-12){_assertClassBrand(_Util2,this,_getExtremumOnCurve).call(this,x0,x1,x2,x3,y0,y1,y2,y3,-c/b,minMax);}return;}var delta=Math.pow(b,2)-4*c*a;if(delta<0){return;}var sqrtDelta=Math.sqrt(delta);var a2=2*a;_assertClassBrand(_Util2,this,_getExtremumOnCurve).call(this,x0,x1,x2,x3,y0,y1,y2,y3,(-b+sqrtDelta)/a2,minMax);_assertClassBrand(_Util2,this,_getExtremumOnCurve).call(this,x0,x1,x2,x3,y0,y1,y2,y3,(-b-sqrtDelta)/a2,minMax);}var PDFStringTranslateTable=/* unused pure expression or super */null&&[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x2d8,0x2c7,0x2c6,0x2d9,0x2dd,0x2db,0x2da,0x2dc,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0x2022,0x2020,0x2021,0x2026,0x2014,0x2013,0x192,0x2044,0x2039,0x203a,0x2212,0x2030,0x201e,0x201c,0x201d,0x2018,0x2019,0x201a,0x2122,0xfb01,0xfb02,0x141,0x152,0x160,0x178,0x17d,0x131,0x142,0x153,0x161,0x17e,0,0x20ac];function stringToPDFString(str){if(str[0]>="\xEF"){var encoding;if(str[0]==="\xFE"&&str[1]==="\xFF"){encoding="utf-16be";if(str.length%2===1){str=str.slice(0,-1);}}else if(str[0]==="\xFF"&&str[1]==="\xFE"){encoding="utf-16le";if(str.length%2===1){str=str.slice(0,-1);}}else if(str[0]==="\xEF"&&str[1]==="\xBB"&&str[2]==="\xBF"){encoding="utf-8";}if(encoding){try{var decoder=new TextDecoder(encoding,{fatal:true});var buffer=stringToBytes(str);var decoded=decoder.decode(buffer);if(!decoded.includes("\x1b")){return decoded;}return decoded.replaceAll(/\x1b[^\x1b]*(?:\x1b|$)/g,"");}catch(ex){warn("stringToPDFString: \"".concat(ex,"\"."));}}}var strBuf=[];for(var i=0,ii=str.length;i<ii;i++){var charCode=str.charCodeAt(i);if(charCode===0x1b){while(++i<ii&&str.charCodeAt(i)!==0x1b){}continue;}var code=PDFStringTranslateTable[charCode];strBuf.push(code?String.fromCharCode(code):str.charAt(i));}return strBuf.join("");}function stringToUTF8String(str){return decodeURIComponent(escape(str));}function utf8StringToString(str){return unescape(encodeURIComponent(str));}function isArrayEqual(arr1,arr2){if(arr1.length!==arr2.length){return false;}for(var i=0,ii=arr1.length;i<ii;i++){if(arr1[i]!==arr2[i]){return false;}}return true;}function getModificationDate(){var date=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Date();var buffer=[date.getUTCFullYear().toString(),(date.getUTCMonth()+1).toString().padStart(2,"0"),date.getUTCDate().toString().padStart(2,"0"),date.getUTCHours().toString().padStart(2,"0"),date.getUTCMinutes().toString().padStart(2,"0"),date.getUTCSeconds().toString().padStart(2,"0")];return buffer.join("");}var NormalizeRegex=null;var NormalizationMap=null;function _normalizeUnicode(str){if(!NormalizeRegex){NormalizeRegex=/([\xA0\xB5\u037E\u0EB3\u2000-\u200A\u202F\u2126\uFB00-\uFB04\uFB06\uFB20-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBA1\uFBA4-\uFBA9\uFBAE-\uFBB1\uFBD3-\uFBDC\uFBDE-\uFBE7\uFBEA-\uFBF8\uFBFC\uFBFD\uFC00-\uFC5D\uFC64-\uFCF1\uFCF5-\uFD3D\uFD88\uFDF4\uFDFA\uFDFB\uFE71\uFE77\uFE79\uFE7B\uFE7D]+)|(\uFB05+)/g;NormalizationMap=new Map([["ﬅ","ſt"]]);}return str.replaceAll(NormalizeRegex,function(_,p1,p2){return p1?p1.normalize("NFKC"):NormalizationMap.get(p2);});}function _getUuid(){if(typeof crypto.randomUUID==="function"){return crypto.randomUUID();}var buf=new Uint8Array(32);crypto.getRandomValues(buf);return bytesToString(buf);}var AnnotationPrefix="pdfjs_internal_id_";function _isValidExplicitDest(validRef,validName,dest){if(!Array.isArray(dest)||dest.length<2){return false;}var _dest=_toArray(dest),page=_dest[0],zoom=_dest[1],args=_dest.slice(2);if(!validRef(page)&&!Number.isInteger(page)){return false;}if(!validName(zoom)){return false;}var argsLen=args.length;var allowNull=true;switch(zoom.name){case"XYZ":if(argsLen<2||argsLen>3){return false;}break;case"Fit":case"FitB":return argsLen===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(argsLen>1){return false;}break;case"FitR":if(argsLen!==4){return false;}allowNull=false;break;default:return false;}var _iterator3=_createForOfIteratorHelper(args),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var arg=_step3.value;if(typeof arg==="number"||allowNull&&arg===null){continue;}return false;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}return true;}function _MathClamp(v,min,max){return Math.min(Math.max(v,min),max);}function toHexUtil(arr){if(Uint8Array.prototype.toHex){return arr.toHex();}return Array.from(arr,function(num){return hexNumbers[num];}).join("");}function toBase64Util(arr){if(Uint8Array.prototype.toBase64){return arr.toBase64();}return btoa(bytesToString(arr));}function fromBase64Util(str){if(Uint8Array.fromBase64){return Uint8Array.fromBase64(str);}return stringToBytes(atob(str));}if(typeof Promise["try"]!=="function"){Promise["try"]=function(fn){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return new Promise(function(resolve){resolve(fn.apply(void 0,args));});};}if(typeof Math.sumPrecise!=="function"){Math.sumPrecise=function(numbers){return numbers.reduce(function(a,b){return a+b;},0);};};// ./src/display/display_utils.js
var SVG_NS="http://www.w3.org/2000/svg";var _PixelsPerInch=/*#__PURE__*/_createClass(function _PixelsPerInch(){_classCallCheck(this,_PixelsPerInch);});_PixelsPerInch2=_PixelsPerInch;_defineProperty(_PixelsPerInch,"CSS",96.0);_defineProperty(_PixelsPerInch,"PDF",72.0);_defineProperty(_PixelsPerInch,"PDF_TO_CSS_UNITS",_PixelsPerInch2.CSS/_PixelsPerInch2.PDF);function _fetchData(_x2){return _fetchData2.apply(this,arguments);}function _fetchData2(){_fetchData2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee60(url){var type,response,_args61=arguments,_t29;return _regenerator().w(function(_context61){while(1)switch(_context61.n){case 0:type=_args61.length>1&&_args61[1]!==undefined?_args61[1]:"text";if(!isValidFetchUrl(url,document.baseURI)){_context61.n=7;break;}_context61.n=1;return fetch(url);case 1:response=_context61.v;if(response.ok){_context61.n=2;break;}throw new Error(response.statusText);case 2:_t29=type;_context61.n=_t29==="arraybuffer"?3:_t29==="blob"?4:_t29==="json"?5:6;break;case 3:return _context61.a(2,response.arrayBuffer());case 4:return _context61.a(2,response.blob());case 5:return _context61.a(2,response.json());case 6:return _context61.a(2,response.text());case 7:return _context61.a(2,new Promise(function(resolve,reject){var request=new XMLHttpRequest();request.open("GET",url,true);request.responseType=type;request.onreadystatechange=function(){if(request.readyState!==XMLHttpRequest.DONE){return;}if(request.status===200||request.status===0){switch(type){case"arraybuffer":case"blob":case"json":resolve(request.response);return;}resolve(request.responseText);return;}reject(new Error(request.statusText));};request.send(null);}));}},_callee60);}));return _fetchData2.apply(this,arguments);}var PageViewport=/*#__PURE__*/function(){function PageViewport(_ref){var viewBox=_ref.viewBox,userUnit=_ref.userUnit,scale=_ref.scale,rotation=_ref.rotation,_ref$offsetX=_ref.offsetX,offsetX=_ref$offsetX===void 0?0:_ref$offsetX,_ref$offsetY=_ref.offsetY,offsetY=_ref$offsetY===void 0?0:_ref$offsetY,_ref$dontFlip=_ref.dontFlip,dontFlip=_ref$dontFlip===void 0?false:_ref$dontFlip;_classCallCheck(this,PageViewport);this.viewBox=viewBox;this.userUnit=userUnit;this.scale=scale;this.rotation=rotation;this.offsetX=offsetX;this.offsetY=offsetY;scale*=userUnit;var centerX=(viewBox[2]+viewBox[0])/2;var centerY=(viewBox[3]+viewBox[1])/2;var rotateA,rotateB,rotateC,rotateD;rotation%=360;if(rotation<0){rotation+=360;}switch(rotation){case 180:rotateA=-1;rotateB=0;rotateC=0;rotateD=1;break;case 90:rotateA=0;rotateB=1;rotateC=1;rotateD=0;break;case 270:rotateA=0;rotateB=-1;rotateC=-1;rotateD=0;break;case 0:rotateA=1;rotateB=0;rotateC=0;rotateD=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.");}if(dontFlip){rotateC=-rotateC;rotateD=-rotateD;}var offsetCanvasX,offsetCanvasY;var width,height;if(rotateA===0){offsetCanvasX=Math.abs(centerY-viewBox[1])*scale+offsetX;offsetCanvasY=Math.abs(centerX-viewBox[0])*scale+offsetY;width=(viewBox[3]-viewBox[1])*scale;height=(viewBox[2]-viewBox[0])*scale;}else{offsetCanvasX=Math.abs(centerX-viewBox[0])*scale+offsetX;offsetCanvasY=Math.abs(centerY-viewBox[1])*scale+offsetY;width=(viewBox[2]-viewBox[0])*scale;height=(viewBox[3]-viewBox[1])*scale;}this.transform=[rotateA*scale,rotateB*scale,rotateC*scale,rotateD*scale,offsetCanvasX-rotateA*scale*centerX-rotateC*scale*centerY,offsetCanvasY-rotateB*scale*centerX-rotateD*scale*centerY];this.width=width;this.height=height;}return _createClass(PageViewport,[{key:"rawDims",get:function get(){var dims=this.viewBox;return _shadow(this,"rawDims",{pageWidth:dims[2]-dims[0],pageHeight:dims[3]-dims[1],pageX:dims[0],pageY:dims[1]});}},{key:"clone",value:function clone(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$scale=_ref2.scale,scale=_ref2$scale===void 0?this.scale:_ref2$scale,_ref2$rotation=_ref2.rotation,rotation=_ref2$rotation===void 0?this.rotation:_ref2$rotation,_ref2$offsetX=_ref2.offsetX,offsetX=_ref2$offsetX===void 0?this.offsetX:_ref2$offsetX,_ref2$offsetY=_ref2.offsetY,offsetY=_ref2$offsetY===void 0?this.offsetY:_ref2$offsetY,_ref2$dontFlip=_ref2.dontFlip,dontFlip=_ref2$dontFlip===void 0?false:_ref2$dontFlip;return new PageViewport({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:scale,rotation:rotation,offsetX:offsetX,offsetY:offsetY,dontFlip:dontFlip});}},{key:"convertToViewportPoint",value:function convertToViewportPoint(x,y){return _Util.applyTransform([x,y],this.transform);}},{key:"convertToViewportRectangle",value:function convertToViewportRectangle(rect){var topLeft=_Util.applyTransform([rect[0],rect[1]],this.transform);var bottomRight=_Util.applyTransform([rect[2],rect[3]],this.transform);return[topLeft[0],topLeft[1],bottomRight[0],bottomRight[1]];}},{key:"convertToPdfPoint",value:function convertToPdfPoint(x,y){return _Util.applyInverseTransform([x,y],this.transform);}}]);}();var _RenderingCancelledException=/*#__PURE__*/function(_BaseException7){function _RenderingCancelledException(msg){var _this4;var extraDelay=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,_RenderingCancelledException);_this4=_callSuper(this,_RenderingCancelledException,[msg,"RenderingCancelledException"]);_this4.extraDelay=extraDelay;return _this4;}_inherits(_RenderingCancelledException,_BaseException7);return _createClass(_RenderingCancelledException);}(BaseException);function _isDataScheme(url){var ii=url.length;var i=0;while(i<ii&&url[i].trim()===""){i++;}return url.substring(i,i+5).toLowerCase()==="data:";}function _isPdfFile(filename){return typeof filename==="string"&&/\.pdf$/i.test(filename);}function _getFilenameFromUrl(url){var _url$split=url.split(/[#?]/,1);var _url$split2=_slicedToArray(_url$split,1);url=_url$split2[0];return url.substring(url.lastIndexOf("/")+1);}function _getPdfFilenameFromUrl(url){var defaultFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"document.pdf";if(typeof url!=="string"){return defaultFilename;}if(_isDataScheme(url)){warn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.');return defaultFilename;}var reURI=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/;var reFilename=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i;var splitURI=reURI.exec(url);var suggestedFilename=reFilename.exec(splitURI[1])||reFilename.exec(splitURI[2])||reFilename.exec(splitURI[3]);if(suggestedFilename){suggestedFilename=suggestedFilename[0];if(suggestedFilename.includes("%")){try{suggestedFilename=reFilename.exec(decodeURIComponent(suggestedFilename))[0];}catch(_unused3){}}}return suggestedFilename||defaultFilename;}var StatTimer=/*#__PURE__*/function(){function StatTimer(){_classCallCheck(this,StatTimer);_defineProperty(this,"started",Object.create(null));_defineProperty(this,"times",[]);}return _createClass(StatTimer,[{key:"time",value:function time(name){if(name in this.started){warn("Timer is already running for ".concat(name));}this.started[name]=Date.now();}},{key:"timeEnd",value:function timeEnd(name){if(!(name in this.started)){warn("Timer has not been started for ".concat(name));}this.times.push({name:name,start:this.started[name],end:Date.now()});delete this.started[name];}},{key:"toString",value:function toString(){var outBuf=[];var longest=0;var _iterator4=_createForOfIteratorHelper(this.times),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var name=_step4.value.name;longest=Math.max(name.length,longest);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}var _iterator5=_createForOfIteratorHelper(this.times),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _step5$value=_step5.value,_name=_step5$value.name,start=_step5$value.start,end=_step5$value.end;outBuf.push("".concat(_name.padEnd(longest)," ").concat(end-start,"ms\n"));}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}return outBuf.join("");}}]);}();function isValidFetchUrl(url,baseUrl){var res=baseUrl?URL.parse(url,baseUrl):URL.parse(url);return(res===null||res===void 0?void 0:res.protocol)==="http:"||(res===null||res===void 0?void 0:res.protocol)==="https:";}function _noContextMenu(e){e.preventDefault();}function _stopEvent(e){e.preventDefault();e.stopPropagation();}function deprecated(details){console.log("Deprecated API usage: "+details);}var _PDFDateString=/*#__PURE__*/function(){function _PDFDateString(){_classCallCheck(this,_PDFDateString);}return _createClass(_PDFDateString,null,[{key:"toDateObject",value:function toDateObject(input){if(!input||typeof input!=="string"){return null;}_assertClassBrand(_PDFDateString,this,_regex)._||(_regex._=_assertClassBrand(_PDFDateString,this,new RegExp("^D:"+"(\\d{4})"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"([Z|+|-])?"+"(\\d{2})?"+"'?"+"(\\d{2})?"+"'?")));var matches=_assertClassBrand(_PDFDateString,this,_regex)._.exec(input);if(!matches){return null;}var year=parseInt(matches[1],10);var month=parseInt(matches[2],10);month=month>=1&&month<=12?month-1:0;var day=parseInt(matches[3],10);day=day>=1&&day<=31?day:1;var hour=parseInt(matches[4],10);hour=hour>=0&&hour<=23?hour:0;var minute=parseInt(matches[5],10);minute=minute>=0&&minute<=59?minute:0;var second=parseInt(matches[6],10);second=second>=0&&second<=59?second:0;var universalTimeRelation=matches[7]||"Z";var offsetHour=parseInt(matches[8],10);offsetHour=offsetHour>=0&&offsetHour<=23?offsetHour:0;var offsetMinute=parseInt(matches[9],10)||0;offsetMinute=offsetMinute>=0&&offsetMinute<=59?offsetMinute:0;if(universalTimeRelation==="-"){hour+=offsetHour;minute+=offsetMinute;}else if(universalTimeRelation==="+"){hour-=offsetHour;minute-=offsetMinute;}return new Date(Date.UTC(year,month,day,hour,minute,second));}}]);}();var _regex={_:void 0};function _getXfaPageViewport(xfaPage,_ref3){var _ref3$scale=_ref3.scale,scale=_ref3$scale===void 0?1:_ref3$scale,_ref3$rotation=_ref3.rotation,rotation=_ref3$rotation===void 0?0:_ref3$rotation;var _xfaPage$attributes$s=xfaPage.attributes.style,width=_xfaPage$attributes$s.width,height=_xfaPage$attributes$s.height;var viewBox=[0,0,parseInt(width),parseInt(height)];return new PageViewport({viewBox:viewBox,userUnit:1,scale:scale,rotation:rotation});}function getRGB(color){if(color.startsWith("#")){var colorRGB=parseInt(color.slice(1),16);return[(colorRGB&0xff0000)>>16,(colorRGB&0x00ff00)>>8,colorRGB&0x0000ff];}if(color.startsWith("rgb(")){return color.slice(4,-1).split(",").map(function(x){return parseInt(x);});}if(color.startsWith("rgba(")){return color.slice(5,-1).split(",").map(function(x){return parseInt(x);}).slice(0,3);}warn("Not a valid color format: \"".concat(color,"\""));return[0,0,0];}function getColorValues(colors){var span=document.createElement("span");span.style.visibility="hidden";document.body.append(span);var _iterator6=_createForOfIteratorHelper(colors.keys()),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var name=_step6.value;span.style.color=name;var computedColor=window.getComputedStyle(span).color;colors.set(name,getRGB(computedColor));}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}span.remove();}function getCurrentTransform(ctx){var _ctx$getTransform=ctx.getTransform(),a=_ctx$getTransform.a,b=_ctx$getTransform.b,c=_ctx$getTransform.c,d=_ctx$getTransform.d,e=_ctx$getTransform.e,f=_ctx$getTransform.f;return[a,b,c,d,e,f];}function getCurrentTransformInverse(ctx){var _ctx$getTransform$inv=ctx.getTransform().invertSelf(),a=_ctx$getTransform$inv.a,b=_ctx$getTransform$inv.b,c=_ctx$getTransform$inv.c,d=_ctx$getTransform$inv.d,e=_ctx$getTransform$inv.e,f=_ctx$getTransform$inv.f;return[a,b,c,d,e,f];}function _setLayerDimensions(div,viewport){var mustFlip=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var mustRotate=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(viewport instanceof PageViewport){var _viewport$rawDims=viewport.rawDims,pageWidth=_viewport$rawDims.pageWidth,pageHeight=_viewport$rawDims.pageHeight;var style=div.style;var useRound=util_FeatureTest.isCSSRoundSupported;var w="var(--total-scale-factor) * ".concat(pageWidth,"px"),h="var(--total-scale-factor) * ".concat(pageHeight,"px");var widthStr=useRound?"round(down, ".concat(w,", var(--scale-round-x))"):"calc(".concat(w,")"),heightStr=useRound?"round(down, ".concat(h,", var(--scale-round-y))"):"calc(".concat(h,")");if(!mustFlip||viewport.rotation%180===0){style.width=widthStr;style.height=heightStr;}else{style.width=heightStr;style.height=widthStr;}}if(mustRotate){div.setAttribute("data-main-rotation",viewport.rotation);}}var _OutputScale=/*#__PURE__*/function(){function _OutputScale(){_classCallCheck(this,_OutputScale);var pixelRatio=_OutputScale.pixelRatio;this.sx=pixelRatio;this.sy=pixelRatio;}return _createClass(_OutputScale,[{key:"scaled",get:function get(){return this.sx!==1||this.sy!==1;}},{key:"symmetric",get:function get(){return this.sx===this.sy;}},{key:"limitCanvas",value:function limitCanvas(width,height,maxPixels,maxDim){var maxAreaScale=Infinity,maxWidthScale=Infinity,maxHeightScale=Infinity;if(maxPixels>0){maxAreaScale=Math.sqrt(maxPixels/(width*height));}if(maxDim!==-1){maxWidthScale=maxDim/width;maxHeightScale=maxDim/height;}var maxScale=Math.min(maxAreaScale,maxWidthScale,maxHeightScale);if(this.sx>maxScale||this.sy>maxScale){this.sx=maxScale;this.sy=maxScale;return true;}return false;}}],[{key:"pixelRatio",get:function get(){return globalThis.devicePixelRatio||1;}}]);}();var _SupportedImageMimeTypes=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];;// ./src/display/editor/toolbar.js
var _toolbar=/*#__PURE__*/new WeakMap();var _colorPicker=/*#__PURE__*/new WeakMap();var _editor=/*#__PURE__*/new WeakMap();var _buttons=/*#__PURE__*/new WeakMap();var _altText=/*#__PURE__*/new WeakMap();var _signatureDescriptionButton=/*#__PURE__*/new WeakMap();var _EditorToolbar_brand=/*#__PURE__*/new WeakSet();var EditorToolbar=/*#__PURE__*/function(){function EditorToolbar(editor){_classCallCheck(this,EditorToolbar);_classPrivateMethodInitSpec(this,_EditorToolbar_brand);_classPrivateFieldInitSpec(this,_toolbar,null);_classPrivateFieldInitSpec(this,_colorPicker,null);_classPrivateFieldInitSpec(this,_editor,void 0);_classPrivateFieldInitSpec(this,_buttons,null);_classPrivateFieldInitSpec(this,_altText,null);_classPrivateFieldInitSpec(this,_signatureDescriptionButton,null);_classPrivateFieldSet(_editor,this,editor);_l10nRemove._||(_l10nRemove._=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}));}return _createClass(EditorToolbar,[{key:"render",value:function render(){var editToolbar=_classPrivateFieldSet(_toolbar,this,document.createElement("div"));editToolbar.classList.add("editToolbar","hidden");editToolbar.setAttribute("role","toolbar");var signal=_classPrivateFieldGet(_editor,this)._uiManager._signal;editToolbar.addEventListener("contextmenu",_noContextMenu,{signal:signal});editToolbar.addEventListener("pointerdown",_pointerDown,{signal:signal});var buttons=_classPrivateFieldSet(_buttons,this,document.createElement("div"));buttons.className="buttons";editToolbar.append(buttons);var position=_classPrivateFieldGet(_editor,this).toolbarPosition;if(position){var style=editToolbar.style;var x=_classPrivateFieldGet(_editor,this)._uiManager.direction==="ltr"?1-position[0]:position[0];style.insetInlineEnd="".concat(100*x,"%");style.top="calc(".concat(100*position[1],"% + var(--editor-toolbar-vert-offset))");}_assertClassBrand(_EditorToolbar_brand,this,_addDeleteButton).call(this);return editToolbar;}},{key:"div",get:function get(){return _classPrivateFieldGet(_toolbar,this);}},{key:"hide",value:function hide(){var _classPrivateFieldGet2;_classPrivateFieldGet(_toolbar,this).classList.add("hidden");(_classPrivateFieldGet2=_classPrivateFieldGet(_colorPicker,this))===null||_classPrivateFieldGet2===void 0||_classPrivateFieldGet2.hideDropdown();}},{key:"show",value:function show(){var _classPrivateFieldGet3;_classPrivateFieldGet(_toolbar,this).classList.remove("hidden");(_classPrivateFieldGet3=_classPrivateFieldGet(_altText,this))===null||_classPrivateFieldGet3===void 0||_classPrivateFieldGet3.shown();}},{key:"addAltText",value:function(){var _addAltText=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(altText){var button;return _regenerator().w(function(_context){while(1)switch(_context.n){case 0:_context.n=1;return altText.render();case 1:button=_context.v;_assertClassBrand(_EditorToolbar_brand,this,_addListenersToElement).call(this,button);_classPrivateFieldGet(_buttons,this).prepend(button,_classPrivateGetter(_EditorToolbar_brand,this,_get_divider));_classPrivateFieldSet(_altText,this,altText);case 2:return _context.a(2);}},_callee,this);}));function addAltText(_x3){return _addAltText.apply(this,arguments);}return addAltText;}()},{key:"addColorPicker",value:function addColorPicker(colorPicker){_classPrivateFieldSet(_colorPicker,this,colorPicker);var button=colorPicker.renderButton();_assertClassBrand(_EditorToolbar_brand,this,_addListenersToElement).call(this,button);_classPrivateFieldGet(_buttons,this).prepend(button,_classPrivateGetter(_EditorToolbar_brand,this,_get_divider));}},{key:"addEditSignatureButton",value:function(){var _addEditSignatureButton=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(signatureManager){var button,_t,_t2,_t3,_t4;return _regenerator().w(function(_context2){while(1)switch(_context2.n){case 0:_t=_classPrivateFieldSet;_t2=_signatureDescriptionButton;_t3=this;_context2.n=1;return signatureManager.renderEditButton(_classPrivateFieldGet(_editor,this));case 1:_t4=_context2.v;button=_t(_t2,_t3,_t4);_assertClassBrand(_EditorToolbar_brand,this,_addListenersToElement).call(this,button);_classPrivateFieldGet(_buttons,this).prepend(button,_classPrivateGetter(_EditorToolbar_brand,this,_get_divider));case 2:return _context2.a(2);}},_callee2,this);}));function addEditSignatureButton(_x4){return _addEditSignatureButton.apply(this,arguments);}return addEditSignatureButton;}()},{key:"updateEditSignatureButton",value:function updateEditSignatureButton(description){if(_classPrivateFieldGet(_signatureDescriptionButton,this)){_classPrivateFieldGet(_signatureDescriptionButton,this).title=description;}}},{key:"remove",value:function remove(){var _classPrivateFieldGet4;_classPrivateFieldGet(_toolbar,this).remove();(_classPrivateFieldGet4=_classPrivateFieldGet(_colorPicker,this))===null||_classPrivateFieldGet4===void 0||_classPrivateFieldGet4.destroy();_classPrivateFieldSet(_colorPicker,this,null);}}]);}();function _pointerDown(e){e.stopPropagation();}function _focusIn(e){_classPrivateFieldGet(_editor,this)._focusEventsAllowed=false;_stopEvent(e);}function _focusOut(e){_classPrivateFieldGet(_editor,this)._focusEventsAllowed=true;_stopEvent(e);}function _addListenersToElement(element){var signal=_classPrivateFieldGet(_editor,this)._uiManager._signal;element.addEventListener("focusin",_assertClassBrand(_EditorToolbar_brand,this,_focusIn).bind(this),{capture:true,signal:signal});element.addEventListener("focusout",_assertClassBrand(_EditorToolbar_brand,this,_focusOut).bind(this),{capture:true,signal:signal});element.addEventListener("contextmenu",_noContextMenu,{signal:signal});}function _addDeleteButton(){var _classPrivateFieldGet129=_classPrivateFieldGet(_editor,this),editorType=_classPrivateFieldGet129.editorType,_uiManager=_classPrivateFieldGet129._uiManager;var button=document.createElement("button");button.className="delete";button.tabIndex=0;button.setAttribute("data-l10n-id",_l10nRemove._[editorType]);_assertClassBrand(_EditorToolbar_brand,this,_addListenersToElement).call(this,button);button.addEventListener("click",function(e){_uiManager["delete"]();},{signal:_uiManager._signal});_classPrivateFieldGet(_buttons,this).append(button);}function _get_divider(_this5){var divider=document.createElement("div");divider.className="divider";return divider;}var _l10nRemove={_:null};var _buttons2=/*#__PURE__*/new WeakMap();var _toolbar2=/*#__PURE__*/new WeakMap();var _uiManager2=/*#__PURE__*/new WeakMap();var _HighlightToolbar_brand=/*#__PURE__*/new WeakSet();var HighlightToolbar=/*#__PURE__*/function(){function HighlightToolbar(uiManager){_classCallCheck(this,HighlightToolbar);_classPrivateMethodInitSpec(this,_HighlightToolbar_brand);_classPrivateFieldInitSpec(this,_buttons2,null);_classPrivateFieldInitSpec(this,_toolbar2,null);_classPrivateFieldInitSpec(this,_uiManager2,void 0);_classPrivateFieldSet(_uiManager2,this,uiManager);}return _createClass(HighlightToolbar,[{key:"show",value:function show(parent,boxes,isLTR){var _assertClassBrand$cal=_assertClassBrand(_HighlightToolbar_brand,this,_getLastPoint).call(this,boxes,isLTR),_assertClassBrand$cal2=_slicedToArray(_assertClassBrand$cal,2),x=_assertClassBrand$cal2[0],y=_assertClassBrand$cal2[1];var _ref4=_classPrivateFieldGet(_toolbar2,this)||_classPrivateFieldSet(_toolbar2,this,_assertClassBrand(_HighlightToolbar_brand,this,_render).call(this)),style=_ref4.style;parent.append(_classPrivateFieldGet(_toolbar2,this));style.insetInlineEnd="".concat(100*x,"%");style.top="calc(".concat(100*y,"% + var(--editor-toolbar-vert-offset))");}},{key:"hide",value:function hide(){_classPrivateFieldGet(_toolbar2,this).remove();}}]);}();function _render(){var editToolbar=_classPrivateFieldSet(_toolbar2,this,document.createElement("div"));editToolbar.className="editToolbar";editToolbar.setAttribute("role","toolbar");editToolbar.addEventListener("contextmenu",_noContextMenu,{signal:_classPrivateFieldGet(_uiManager2,this)._signal});var buttons=_classPrivateFieldSet(_buttons2,this,document.createElement("div"));buttons.className="buttons";editToolbar.append(buttons);_assertClassBrand(_HighlightToolbar_brand,this,_addHighlightButton).call(this);return editToolbar;}function _getLastPoint(boxes,isLTR){var lastY=0;var lastX=0;var _iterator170=_createForOfIteratorHelper(boxes),_step170;try{for(_iterator170.s();!(_step170=_iterator170.n()).done;){var box=_step170.value;var y=box.y+box.height;if(y<lastY){continue;}var x=box.x+(isLTR?box.width:0);if(y>lastY){lastX=x;lastY=y;continue;}if(isLTR){if(x>lastX){lastX=x;}}else if(x<lastX){lastX=x;}}}catch(err){_iterator170.e(err);}finally{_iterator170.f();}return[isLTR?1-lastX:lastX,lastY];}function _addHighlightButton(){var _this107=this;var button=document.createElement("button");button.className="highlightButton";button.tabIndex=0;button.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");var span=document.createElement("span");button.append(span);span.className="visuallyHidden";span.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");var signal=_classPrivateFieldGet(_uiManager2,this)._signal;button.addEventListener("contextmenu",_noContextMenu,{signal:signal});button.addEventListener("click",function(){_classPrivateFieldGet(_uiManager2,_this107).highlightSelection("floating_button");},{signal:signal});_classPrivateFieldGet(_buttons2,this).append(button);};// ./src/display/editor/tools.js
function bindEvents(obj,element,names){var _iterator7=_createForOfIteratorHelper(names),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var name=_step7.value;element.addEventListener(name,obj[name].bind(obj));}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}}var _id=/*#__PURE__*/new WeakMap();var IdManager=/*#__PURE__*/function(){function IdManager(){_classCallCheck(this,IdManager);_classPrivateFieldInitSpec(this,_id,0);}return _createClass(IdManager,[{key:"id",get:function get(){var _this$id,_this$id2;return"".concat(AnnotationEditorPrefix).concat((_classPrivateFieldSet(_id,this,(_this$id=_classPrivateFieldGet(_id,this),_this$id2=_this$id++,_this$id)),_this$id2));}}]);}();var _baseId=/*#__PURE__*/new WeakMap();var _id2=/*#__PURE__*/new WeakMap();var _cache=/*#__PURE__*/new WeakMap();var _ImageManager_brand=/*#__PURE__*/new WeakSet();var ImageManager=/*#__PURE__*/function(){function ImageManager(){_classCallCheck(this,ImageManager);_classPrivateMethodInitSpec(this,_ImageManager_brand);_classPrivateFieldInitSpec(this,_baseId,_getUuid());_classPrivateFieldInitSpec(this,_id2,0);_classPrivateFieldInitSpec(this,_cache,null);}return _createClass(ImageManager,[{key:"getFromFile",value:function(){var _getFromFile=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(file){var lastModified,name,size,type;return _regenerator().w(function(_context3){while(1)switch(_context3.n){case 0:lastModified=file.lastModified,name=file.name,size=file.size,type=file.type;return _context3.a(2,_assertClassBrand(_ImageManager_brand,this,_get).call(this,"".concat(lastModified,"_").concat(name,"_").concat(size,"_").concat(type),file));}},_callee3,this);}));function getFromFile(_x5){return _getFromFile.apply(this,arguments);}return getFromFile;}()},{key:"getFromUrl",value:function(){var _getFromUrl=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(url){return _regenerator().w(function(_context4){while(1)switch(_context4.n){case 0:return _context4.a(2,_assertClassBrand(_ImageManager_brand,this,_get).call(this,url,url));}},_callee4,this);}));function getFromUrl(_x6){return _getFromUrl.apply(this,arguments);}return getFromUrl;}()},{key:"getFromBlob",value:function(){var _getFromBlob=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(id,blobPromise){var blob;return _regenerator().w(function(_context5){while(1)switch(_context5.n){case 0:_context5.n=1;return blobPromise;case 1:blob=_context5.v;return _context5.a(2,_assertClassBrand(_ImageManager_brand,this,_get).call(this,id,blob));}},_callee5,this);}));function getFromBlob(_x7,_x8){return _getFromBlob.apply(this,arguments);}return getFromBlob;}()},{key:"getFromId",value:function(){var _getFromId=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(id){var data,blobPromise;return _regenerator().w(function(_context6){while(1)switch(_context6.n){case 0:_classPrivateFieldGet(_cache,this)||_classPrivateFieldSet(_cache,this,new Map());data=_classPrivateFieldGet(_cache,this).get(id);if(data){_context6.n=1;break;}return _context6.a(2,null);case 1:if(!data.bitmap){_context6.n=2;break;}data.refCounter+=1;return _context6.a(2,data);case 2:if(!data.file){_context6.n=3;break;}return _context6.a(2,this.getFromFile(data.file));case 3:if(!data.blobPromise){_context6.n=4;break;}blobPromise=data.blobPromise;delete data.blobPromise;return _context6.a(2,this.getFromBlob(data.id,blobPromise));case 4:return _context6.a(2,this.getFromUrl(data.url));}},_callee6,this);}));function getFromId(_x9){return _getFromId.apply(this,arguments);}return getFromId;}()},{key:"getFromCanvas",value:function getFromCanvas(id,canvas){var _this$id5,_this$id6,_data2;_classPrivateFieldGet(_cache,this)||_classPrivateFieldSet(_cache,this,new Map());var data=_classPrivateFieldGet(_cache,this).get(id);if((_data2=data)!==null&&_data2!==void 0&&_data2.bitmap){data.refCounter+=1;return data;}var offscreen=new OffscreenCanvas(canvas.width,canvas.height);var ctx=offscreen.getContext("2d");ctx.drawImage(canvas,0,0);data={bitmap:offscreen.transferToImageBitmap(),id:"image_".concat(_classPrivateFieldGet(_baseId,this),"_").concat((_classPrivateFieldSet(_id2,this,(_this$id5=_classPrivateFieldGet(_id2,this),_this$id6=_this$id5++,_this$id5)),_this$id6)),refCounter:1,isSvg:false};_classPrivateFieldGet(_cache,this).set(id,data);_classPrivateFieldGet(_cache,this).set(data.id,data);return data;}},{key:"getSvgUrl",value:function getSvgUrl(id){var data=_classPrivateFieldGet(_cache,this).get(id);if(!(data!==null&&data!==void 0&&data.isSvg)){return null;}return data.svgUrl;}},{key:"deleteId",value:function deleteId(id){var _bitmap$close;_classPrivateFieldGet(_cache,this)||_classPrivateFieldSet(_cache,this,new Map());var data=_classPrivateFieldGet(_cache,this).get(id);if(!data){return;}data.refCounter-=1;if(data.refCounter!==0){return;}var bitmap=data.bitmap;if(!data.url&&!data.file){var canvas=new OffscreenCanvas(bitmap.width,bitmap.height);var ctx=canvas.getContext("bitmaprenderer");ctx.transferFromImageBitmap(bitmap);data.blobPromise=canvas.convertToBlob();}(_bitmap$close=bitmap.close)===null||_bitmap$close===void 0||_bitmap$close.call(bitmap);data.bitmap=null;}},{key:"isValidId",value:function isValidId(id){return id.startsWith("image_".concat(_classPrivateFieldGet(_baseId,this),"_"));}}],[{key:"_isSVGFittingCanvas",get:function get(){var svg="data:image/svg+xml;charset=UTF-8,<svg viewBox=\"0 0 1 1\" width=\"1\" height=\"1\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"1\" height=\"1\" style=\"fill:red;\"/></svg>";var canvas=new OffscreenCanvas(1,3);var ctx=canvas.getContext("2d",{willReadFrequently:true});var image=new Image();image.src=svg;var promise=image.decode().then(function(){ctx.drawImage(image,0,0,1,1,0,0,1,3);return new Uint32Array(ctx.getImageData(0,0,1,1).data.buffer)[0]===0;});return _shadow(this,"_isSVGFittingCanvas",promise);}}]);}();_ImageManager=ImageManager;function _get(_x63,_x64){return _get3.apply(this,arguments);}function _get3(){_get3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee64(key,rawData){var _data10;var data,_this$id3,_this$id4,image,mustRemoveAspectRatioPromise,fileReader,imageElement,imagePromise,_t31;return _regenerator().w(function(_context65){while(1)switch(_context65.n){case 0:_classPrivateFieldGet(_cache,this)||_classPrivateFieldSet(_cache,this,new Map());data=_classPrivateFieldGet(_cache,this).get(key);if(!(data===null)){_context65.n=1;break;}return _context65.a(2,null);case 1:if(!((_data10=data)!==null&&_data10!==void 0&&_data10.bitmap)){_context65.n=2;break;}data.refCounter+=1;return _context65.a(2,data);case 2:_context65.p=2;data||(data={bitmap:null,id:"image_".concat(_classPrivateFieldGet(_baseId,this),"_").concat((_classPrivateFieldSet(_id2,this,(_this$id3=_classPrivateFieldGet(_id2,this),_this$id4=_this$id3++,_this$id3)),_this$id4)),refCounter:0,isSvg:false});if(!(typeof rawData==="string")){_context65.n=4;break;}data.url=rawData;_context65.n=3;return _fetchData(rawData,"blob");case 3:image=_context65.v;_context65.n=5;break;case 4:if(rawData instanceof File){image=data.file=rawData;}else if(rawData instanceof Blob){image=rawData;}case 5:if(!(image.type==="image/svg+xml")){_context65.n=7;break;}mustRemoveAspectRatioPromise=_ImageManager._isSVGFittingCanvas;fileReader=new FileReader();imageElement=new Image();imagePromise=new Promise(function(resolve,reject){imageElement.onload=function(){data.bitmap=imageElement;data.isSvg=true;resolve();};fileReader.onload=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee63(){var url,_t30;return _regenerator().w(function(_context64){while(1)switch(_context64.n){case 0:url=data.svgUrl=fileReader.result;_context64.n=1;return mustRemoveAspectRatioPromise;case 1:if(!_context64.v){_context64.n=2;break;}_t30="".concat(url,"#svgView(preserveAspectRatio(none))");_context64.n=3;break;case 2:_t30=url;case 3:imageElement.src=_t30;case 4:return _context64.a(2);}},_callee63);}));imageElement.onerror=fileReader.onerror=reject;});fileReader.readAsDataURL(image);_context65.n=6;return imagePromise;case 6:_context65.n=9;break;case 7:_context65.n=8;return createImageBitmap(image);case 8:data.bitmap=_context65.v;case 9:data.refCounter=1;_context65.n=11;break;case 10:_context65.p=10;_t31=_context65.v;warn(_t31);data=null;case 11:_classPrivateFieldGet(_cache,this).set(key,data);if(data){_classPrivateFieldGet(_cache,this).set(data.id,data);}return _context65.a(2,data);}},_callee64,this,[[2,10]]);}));return _get3.apply(this,arguments);}var _commands=/*#__PURE__*/new WeakMap();var _locked=/*#__PURE__*/new WeakMap();var _maxSize=/*#__PURE__*/new WeakMap();var _position=/*#__PURE__*/new WeakMap();var CommandManager=/*#__PURE__*/function(){function CommandManager(){var maxSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:128;_classCallCheck(this,CommandManager);_classPrivateFieldInitSpec(this,_commands,[]);_classPrivateFieldInitSpec(this,_locked,false);_classPrivateFieldInitSpec(this,_maxSize,void 0);_classPrivateFieldInitSpec(this,_position,-1);_classPrivateFieldSet(_maxSize,this,maxSize);}return _createClass(CommandManager,[{key:"add",value:function add(_ref5){var cmd=_ref5.cmd,undo=_ref5.undo,post=_ref5.post,mustExec=_ref5.mustExec,_ref5$type=_ref5.type,type=_ref5$type===void 0?NaN:_ref5$type,_ref5$overwriteIfSame=_ref5.overwriteIfSameType,overwriteIfSameType=_ref5$overwriteIfSame===void 0?false:_ref5$overwriteIfSame,_ref5$keepUndo=_ref5.keepUndo,keepUndo=_ref5$keepUndo===void 0?false:_ref5$keepUndo;if(mustExec){cmd();}if(_classPrivateFieldGet(_locked,this)){return;}var save={cmd:cmd,undo:undo,post:post,type:type};if(_classPrivateFieldGet(_position,this)===-1){if(_classPrivateFieldGet(_commands,this).length>0){_classPrivateFieldGet(_commands,this).length=0;}_classPrivateFieldSet(_position,this,0);_classPrivateFieldGet(_commands,this).push(save);return;}if(overwriteIfSameType&&_classPrivateFieldGet(_commands,this)[_classPrivateFieldGet(_position,this)].type===type){if(keepUndo){save.undo=_classPrivateFieldGet(_commands,this)[_classPrivateFieldGet(_position,this)].undo;}_classPrivateFieldGet(_commands,this)[_classPrivateFieldGet(_position,this)]=save;return;}var next=_classPrivateFieldGet(_position,this)+1;if(next===_classPrivateFieldGet(_maxSize,this)){_classPrivateFieldGet(_commands,this).splice(0,1);}else{_classPrivateFieldSet(_position,this,next);if(next<_classPrivateFieldGet(_commands,this).length){_classPrivateFieldGet(_commands,this).splice(next);}}_classPrivateFieldGet(_commands,this).push(save);}},{key:"undo",value:function undo(){if(_classPrivateFieldGet(_position,this)===-1){return;}_classPrivateFieldSet(_locked,this,true);var _classPrivateFieldGet5=_classPrivateFieldGet(_commands,this)[_classPrivateFieldGet(_position,this)],undo=_classPrivateFieldGet5.undo,post=_classPrivateFieldGet5.post;undo();post===null||post===void 0||post();_classPrivateFieldSet(_locked,this,false);_classPrivateFieldSet(_position,this,_classPrivateFieldGet(_position,this)-1);}},{key:"redo",value:function redo(){if(_classPrivateFieldGet(_position,this)<_classPrivateFieldGet(_commands,this).length-1){_classPrivateFieldSet(_position,this,_classPrivateFieldGet(_position,this)+1);_classPrivateFieldSet(_locked,this,true);var _classPrivateFieldGet6=_classPrivateFieldGet(_commands,this)[_classPrivateFieldGet(_position,this)],cmd=_classPrivateFieldGet6.cmd,post=_classPrivateFieldGet6.post;cmd();post===null||post===void 0||post();_classPrivateFieldSet(_locked,this,false);}}},{key:"hasSomethingToUndo",value:function hasSomethingToUndo(){return _classPrivateFieldGet(_position,this)!==-1;}},{key:"hasSomethingToRedo",value:function hasSomethingToRedo(){return _classPrivateFieldGet(_position,this)<_classPrivateFieldGet(_commands,this).length-1;}},{key:"cleanType",value:function cleanType(type){if(_classPrivateFieldGet(_position,this)===-1){return;}for(var i=_classPrivateFieldGet(_position,this);i>=0;i--){if(_classPrivateFieldGet(_commands,this)[i].type!==type){_classPrivateFieldGet(_commands,this).splice(i+1,_classPrivateFieldGet(_position,this)-i);_classPrivateFieldSet(_position,this,i);return;}}_classPrivateFieldGet(_commands,this).length=0;_classPrivateFieldSet(_position,this,-1);}},{key:"destroy",value:function destroy(){_classPrivateFieldSet(_commands,this,null);}}]);}();var _KeyboardManager_brand=/*#__PURE__*/new WeakSet();var KeyboardManager=/*#__PURE__*/function(){function KeyboardManager(callbacks){_classCallCheck(this,KeyboardManager);_classPrivateMethodInitSpec(this,_KeyboardManager_brand);this.buffer=[];this.callbacks=new Map();this.allKeys=new Set();var isMac=util_FeatureTest.platform.isMac;var _iterator8=_createForOfIteratorHelper(callbacks),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var _step8$value=_slicedToArray(_step8.value,3),keys=_step8$value[0],callback=_step8$value[1],_step8$value$=_step8$value[2],options=_step8$value$===void 0?{}:_step8$value$;var _iterator9=_createForOfIteratorHelper(keys),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var key=_step9.value;var isMacKey=key.startsWith("mac+");if(isMac&&isMacKey){this.callbacks.set(key.slice(4),{callback:callback,options:options});this.allKeys.add(key.split("+").at(-1));}else if(!isMac&&!isMacKey){this.callbacks.set(key,{callback:callback,options:options});this.allKeys.add(key.split("+").at(-1));}}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}}return _createClass(KeyboardManager,[{key:"exec",value:function exec(self,event){if(!this.allKeys.has(event.key)){return;}var info=this.callbacks.get(_assertClassBrand(_KeyboardManager_brand,this,_serialize).call(this,event));if(!info){return;}var callback=info.callback,_info$options=info.options,_info$options$bubbles=_info$options.bubbles,bubbles=_info$options$bubbles===void 0?false:_info$options$bubbles,_info$options$args=_info$options.args,args=_info$options$args===void 0?[]:_info$options$args,_info$options$checker=_info$options.checker,checker=_info$options$checker===void 0?null:_info$options$checker;if(checker&&!checker(self,event)){return;}callback.bind.apply(callback,[self].concat(_toConsumableArray(args),[event]))();if(!bubbles){_stopEvent(event);}}}]);}();function _serialize(event){if(event.altKey){this.buffer.push("alt");}if(event.ctrlKey){this.buffer.push("ctrl");}if(event.metaKey){this.buffer.push("meta");}if(event.shiftKey){this.buffer.push("shift");}this.buffer.push(event.key);var str=this.buffer.join("+");this.buffer.length=0;return str;}var ColorManager=/*#__PURE__*/function(){function ColorManager(){_classCallCheck(this,ColorManager);}return _createClass(ColorManager,[{key:"_colors",get:function get(){var colors=new Map([["CanvasText",null],["Canvas",null]]);getColorValues(colors);return _shadow(this,"_colors",colors);}},{key:"convert",value:function convert(color){var rgb=getRGB(color);if(!window.matchMedia("(forced-colors: active)").matches){return rgb;}var _iterator0=_createForOfIteratorHelper(this._colors),_step0;try{for(_iterator0.s();!(_step0=_iterator0.n()).done;){var _step0$value=_slicedToArray(_step0.value,2),name=_step0$value[0],RGB=_step0$value[1];if(RGB.every(function(x,i){return x===rgb[i];})){return ColorManager._colorsMapping.get(name);}}}catch(err){_iterator0.e(err);}finally{_iterator0.f();}return rgb;}},{key:"getHexCode",value:function getHexCode(name){var rgb=this._colors.get(name);if(!rgb){return name;}return _Util.makeHexColor.apply(_Util,_toConsumableArray(rgb));}}]);}();_defineProperty(ColorManager,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var _abortController=/*#__PURE__*/new WeakMap();var _activeEditor=/*#__PURE__*/new WeakMap();var _allEditors=/*#__PURE__*/new WeakMap();var _allLayers=/*#__PURE__*/new WeakMap();var _altTextManager=/*#__PURE__*/new WeakMap();var _annotationStorage=/*#__PURE__*/new WeakMap();var _changedExistingAnnotations=/*#__PURE__*/new WeakMap();var _commandManager=/*#__PURE__*/new WeakMap();var _copyPasteAC=/*#__PURE__*/new WeakMap();var _currentDrawingSession=/*#__PURE__*/new WeakMap();var _currentPageIndex=/*#__PURE__*/new WeakMap();var _deletedAnnotationsElementIds=/*#__PURE__*/new WeakMap();var _draggingEditors=/*#__PURE__*/new WeakMap();var _editorTypes=/*#__PURE__*/new WeakMap();var _editorsToRescale=/*#__PURE__*/new WeakMap();var _enableHighlightFloatingButton=/*#__PURE__*/new WeakMap();var _enableUpdatedAddImage=/*#__PURE__*/new WeakMap();var _enableNewAltTextWhenAddingImage=/*#__PURE__*/new WeakMap();var _filterFactory=/*#__PURE__*/new WeakMap();var _focusMainContainerTimeoutId=/*#__PURE__*/new WeakMap();var _focusManagerAC=/*#__PURE__*/new WeakMap();var _highlightColors=/*#__PURE__*/new WeakMap();var _highlightWhenShiftUp=/*#__PURE__*/new WeakMap();var _highlightToolbar=/*#__PURE__*/new WeakMap();var _idManager=/*#__PURE__*/new WeakMap();var _isEnabled=/*#__PURE__*/new WeakMap();var _isWaiting=/*#__PURE__*/new WeakMap();var _keyboardManagerAC=/*#__PURE__*/new WeakMap();var _lastActiveElement=/*#__PURE__*/new WeakMap();var _mainHighlightColorPicker=/*#__PURE__*/new WeakMap();var _missingCanvases=/*#__PURE__*/new WeakMap();var _mlManager=/*#__PURE__*/new WeakMap();var _mode=/*#__PURE__*/new WeakMap();var _selectedEditors=/*#__PURE__*/new WeakMap();var _selectedTextNode=/*#__PURE__*/new WeakMap();var _signatureManager=/*#__PURE__*/new WeakMap();var _pageColors=/*#__PURE__*/new WeakMap();var _showAllStates=/*#__PURE__*/new WeakMap();var _previousStates=/*#__PURE__*/new WeakMap();var _translation=/*#__PURE__*/new WeakMap();var _translationTimeoutId=/*#__PURE__*/new WeakMap();var _container=/*#__PURE__*/new WeakMap();var _viewer=/*#__PURE__*/new WeakMap();var _updateModeCapability=/*#__PURE__*/new WeakMap();var _AnnotationEditorUIManager_brand=/*#__PURE__*/new WeakSet();var _AnnotationEditorUIManager=/*#__PURE__*/function(){function _AnnotationEditorUIManager(container,viewer,altTextManager,signatureManager,eventBus,pdfDocument,pageColors,highlightColors,enableHighlightFloatingButton,enableUpdatedAddImage,enableNewAltTextWhenAddingImage,mlManager,editorUndoBar,supportsPinchToZoom){var _this7=this;_classCallCheck(this,_AnnotationEditorUIManager);_classPrivateMethodInitSpec(this,_AnnotationEditorUIManager_brand);_classPrivateFieldInitSpec(this,_abortController,new AbortController());_classPrivateFieldInitSpec(this,_activeEditor,null);_classPrivateFieldInitSpec(this,_allEditors,new Map());_classPrivateFieldInitSpec(this,_allLayers,new Map());_classPrivateFieldInitSpec(this,_altTextManager,null);_classPrivateFieldInitSpec(this,_annotationStorage,null);_classPrivateFieldInitSpec(this,_changedExistingAnnotations,null);_classPrivateFieldInitSpec(this,_commandManager,new CommandManager());_classPrivateFieldInitSpec(this,_copyPasteAC,null);_classPrivateFieldInitSpec(this,_currentDrawingSession,null);_classPrivateFieldInitSpec(this,_currentPageIndex,0);_classPrivateFieldInitSpec(this,_deletedAnnotationsElementIds,new Set());_classPrivateFieldInitSpec(this,_draggingEditors,null);_classPrivateFieldInitSpec(this,_editorTypes,null);_classPrivateFieldInitSpec(this,_editorsToRescale,new Set());_defineProperty(this,"_editorUndoBar",null);_classPrivateFieldInitSpec(this,_enableHighlightFloatingButton,false);_classPrivateFieldInitSpec(this,_enableUpdatedAddImage,false);_classPrivateFieldInitSpec(this,_enableNewAltTextWhenAddingImage,false);_classPrivateFieldInitSpec(this,_filterFactory,null);_classPrivateFieldInitSpec(this,_focusMainContainerTimeoutId,null);_classPrivateFieldInitSpec(this,_focusManagerAC,null);_classPrivateFieldInitSpec(this,_highlightColors,null);_classPrivateFieldInitSpec(this,_highlightWhenShiftUp,false);_classPrivateFieldInitSpec(this,_highlightToolbar,null);_classPrivateFieldInitSpec(this,_idManager,new IdManager());_classPrivateFieldInitSpec(this,_isEnabled,false);_classPrivateFieldInitSpec(this,_isWaiting,false);_classPrivateFieldInitSpec(this,_keyboardManagerAC,null);_classPrivateFieldInitSpec(this,_lastActiveElement,null);_classPrivateFieldInitSpec(this,_mainHighlightColorPicker,null);_classPrivateFieldInitSpec(this,_missingCanvases,null);_classPrivateFieldInitSpec(this,_mlManager,null);_classPrivateFieldInitSpec(this,_mode,_AnnotationEditorType.NONE);_classPrivateFieldInitSpec(this,_selectedEditors,new Set());_classPrivateFieldInitSpec(this,_selectedTextNode,null);_classPrivateFieldInitSpec(this,_signatureManager,null);_classPrivateFieldInitSpec(this,_pageColors,null);_classPrivateFieldInitSpec(this,_showAllStates,null);_classPrivateFieldInitSpec(this,_previousStates,{isEditing:false,isEmpty:true,hasSomethingToUndo:false,hasSomethingToRedo:false,hasSelectedEditor:false,hasSelectedText:false});_classPrivateFieldInitSpec(this,_translation,[0,0]);_classPrivateFieldInitSpec(this,_translationTimeoutId,null);_classPrivateFieldInitSpec(this,_container,null);_classPrivateFieldInitSpec(this,_viewer,null);_classPrivateFieldInitSpec(this,_updateModeCapability,null);var _signal=this._signal=_classPrivateFieldGet(_abortController,this).signal;_classPrivateFieldSet(_container,this,container);_classPrivateFieldSet(_viewer,this,viewer);_classPrivateFieldSet(_altTextManager,this,altTextManager);_classPrivateFieldSet(_signatureManager,this,signatureManager);this._eventBus=eventBus;eventBus._on("editingaction",this.onEditingAction.bind(this),{signal:_signal});eventBus._on("pagechanging",this.onPageChanging.bind(this),{signal:_signal});eventBus._on("scalechanging",this.onScaleChanging.bind(this),{signal:_signal});eventBus._on("rotationchanging",this.onRotationChanging.bind(this),{signal:_signal});eventBus._on("setpreference",this.onSetPreference.bind(this),{signal:_signal});eventBus._on("switchannotationeditorparams",function(evt){return _this7.updateParams(evt.type,evt.value);},{signal:_signal});_assertClassBrand(_AnnotationEditorUIManager_brand,this,_addSelectionListener).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_addDragAndDropListeners).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_addKeyboardManager).call(this);_classPrivateFieldSet(_annotationStorage,this,pdfDocument.annotationStorage);_classPrivateFieldSet(_filterFactory,this,pdfDocument.filterFactory);_classPrivateFieldSet(_pageColors,this,pageColors);_classPrivateFieldSet(_highlightColors,this,highlightColors||null);_classPrivateFieldSet(_enableHighlightFloatingButton,this,enableHighlightFloatingButton);_classPrivateFieldSet(_enableUpdatedAddImage,this,enableUpdatedAddImage);_classPrivateFieldSet(_enableNewAltTextWhenAddingImage,this,enableNewAltTextWhenAddingImage);_classPrivateFieldSet(_mlManager,this,mlManager||null);this.viewParameters={realScale:_PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0};this.isShiftKeyDown=false;this._editorUndoBar=editorUndoBar||null;this._supportsPinchToZoom=supportsPinchToZoom!==false;}return _createClass(_AnnotationEditorUIManager,[{key:"destroy",value:function destroy(){var _classPrivateFieldGet7,_classPrivateFieldGet8,_classPrivateFieldGet9,_classPrivateFieldGet0,_classPrivateFieldGet1,_classPrivateFieldGet10,_classPrivateFieldGet11,_this$_editorUndoBar;(_classPrivateFieldGet7=_classPrivateFieldGet(_updateModeCapability,this))===null||_classPrivateFieldGet7===void 0||_classPrivateFieldGet7.resolve();_classPrivateFieldSet(_updateModeCapability,this,null);(_classPrivateFieldGet8=_classPrivateFieldGet(_abortController,this))===null||_classPrivateFieldGet8===void 0||_classPrivateFieldGet8.abort();_classPrivateFieldSet(_abortController,this,null);this._signal=null;var _iterator1=_createForOfIteratorHelper(_classPrivateFieldGet(_allLayers,this).values()),_step1;try{for(_iterator1.s();!(_step1=_iterator1.n()).done;){var layer=_step1.value;layer.destroy();}}catch(err){_iterator1.e(err);}finally{_iterator1.f();}_classPrivateFieldGet(_allLayers,this).clear();_classPrivateFieldGet(_allEditors,this).clear();_classPrivateFieldGet(_editorsToRescale,this).clear();(_classPrivateFieldGet9=_classPrivateFieldGet(_missingCanvases,this))===null||_classPrivateFieldGet9===void 0||_classPrivateFieldGet9.clear();_classPrivateFieldSet(_activeEditor,this,null);_classPrivateFieldGet(_selectedEditors,this).clear();_classPrivateFieldGet(_commandManager,this).destroy();(_classPrivateFieldGet0=_classPrivateFieldGet(_altTextManager,this))===null||_classPrivateFieldGet0===void 0||_classPrivateFieldGet0.destroy();(_classPrivateFieldGet1=_classPrivateFieldGet(_signatureManager,this))===null||_classPrivateFieldGet1===void 0||_classPrivateFieldGet1.destroy();(_classPrivateFieldGet10=_classPrivateFieldGet(_highlightToolbar,this))===null||_classPrivateFieldGet10===void 0||_classPrivateFieldGet10.hide();_classPrivateFieldSet(_highlightToolbar,this,null);(_classPrivateFieldGet11=_classPrivateFieldGet(_mainHighlightColorPicker,this))===null||_classPrivateFieldGet11===void 0||_classPrivateFieldGet11.destroy();_classPrivateFieldSet(_mainHighlightColorPicker,this,null);if(_classPrivateFieldGet(_focusMainContainerTimeoutId,this)){clearTimeout(_classPrivateFieldGet(_focusMainContainerTimeoutId,this));_classPrivateFieldSet(_focusMainContainerTimeoutId,this,null);}if(_classPrivateFieldGet(_translationTimeoutId,this)){clearTimeout(_classPrivateFieldGet(_translationTimeoutId,this));_classPrivateFieldSet(_translationTimeoutId,this,null);}(_this$_editorUndoBar=this._editorUndoBar)===null||_this$_editorUndoBar===void 0||_this$_editorUndoBar.destroy();}},{key:"combinedSignal",value:function combinedSignal(ac){return AbortSignal.any([this._signal,ac.signal]);}},{key:"mlManager",get:function get(){return _classPrivateFieldGet(_mlManager,this);}},{key:"useNewAltTextFlow",get:function get(){return _classPrivateFieldGet(_enableUpdatedAddImage,this);}},{key:"useNewAltTextWhenAddingImage",get:function get(){return _classPrivateFieldGet(_enableNewAltTextWhenAddingImage,this);}},{key:"hcmFilter",get:function get(){return _shadow(this,"hcmFilter",_classPrivateFieldGet(_pageColors,this)?_classPrivateFieldGet(_filterFactory,this).addHCMFilter(_classPrivateFieldGet(_pageColors,this).foreground,_classPrivateFieldGet(_pageColors,this).background):"none");}},{key:"direction",get:function get(){return _shadow(this,"direction",getComputedStyle(_classPrivateFieldGet(_container,this)).direction);}},{key:"highlightColors",get:function get(){return _shadow(this,"highlightColors",_classPrivateFieldGet(_highlightColors,this)?new Map(_classPrivateFieldGet(_highlightColors,this).split(",").map(function(pair){return pair.split("=").map(function(x){return x.trim();});})):null);}},{key:"highlightColorNames",get:function get(){return _shadow(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,function(e){return e.reverse();})):null);}},{key:"setCurrentDrawingSession",value:function setCurrentDrawingSession(layer){if(layer){this.unselectAll();this.disableUserSelect(true);}else{this.disableUserSelect(false);}_classPrivateFieldSet(_currentDrawingSession,this,layer);}},{key:"setMainHighlightColorPicker",value:function setMainHighlightColorPicker(colorPicker){_classPrivateFieldSet(_mainHighlightColorPicker,this,colorPicker);}},{key:"editAltText",value:function editAltText(editor){var _classPrivateFieldGet12;var firstTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;(_classPrivateFieldGet12=_classPrivateFieldGet(_altTextManager,this))===null||_classPrivateFieldGet12===void 0||_classPrivateFieldGet12.editAltText(this,editor,firstTime);}},{key:"getSignature",value:function getSignature(editor){var _classPrivateFieldGet13;(_classPrivateFieldGet13=_classPrivateFieldGet(_signatureManager,this))===null||_classPrivateFieldGet13===void 0||_classPrivateFieldGet13.getSignature({uiManager:this,editor:editor});}},{key:"signatureManager",get:function get(){return _classPrivateFieldGet(_signatureManager,this);}},{key:"switchToMode",value:function switchToMode(mode,callback){this._eventBus.on("annotationeditormodechanged",callback,{once:true,signal:this._signal});this._eventBus.dispatch("showannotationeditorui",{source:this,mode:mode});}},{key:"setPreference",value:function setPreference(name,value){this._eventBus.dispatch("setpreference",{source:this,name:name,value:value});}},{key:"onSetPreference",value:function onSetPreference(_ref6){var name=_ref6.name,value=_ref6.value;switch(name){case"enableNewAltTextWhenAddingImage":_classPrivateFieldSet(_enableNewAltTextWhenAddingImage,this,value);break;}}},{key:"onPageChanging",value:function onPageChanging(_ref7){var pageNumber=_ref7.pageNumber;_classPrivateFieldSet(_currentPageIndex,this,pageNumber-1);}},{key:"focusMainContainer",value:function focusMainContainer(){_classPrivateFieldGet(_container,this).focus();}},{key:"findParent",value:function findParent(x,y){var _iterator10=_createForOfIteratorHelper(_classPrivateFieldGet(_allLayers,this).values()),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var layer=_step10.value;var _layer$div$getBoundin=layer.div.getBoundingClientRect(),layerX=_layer$div$getBoundin.x,layerY=_layer$div$getBoundin.y,width=_layer$div$getBoundin.width,height=_layer$div$getBoundin.height;if(x>=layerX&&x<=layerX+width&&y>=layerY&&y<=layerY+height){return layer;}}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}return null;}},{key:"disableUserSelect",value:function disableUserSelect(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classPrivateFieldGet(_viewer,this).classList.toggle("noUserSelect",value);}},{key:"addShouldRescale",value:function addShouldRescale(editor){_classPrivateFieldGet(_editorsToRescale,this).add(editor);}},{key:"removeShouldRescale",value:function removeShouldRescale(editor){_classPrivateFieldGet(_editorsToRescale,this)["delete"](editor);}},{key:"onScaleChanging",value:function onScaleChanging(_ref8){var _classPrivateFieldGet14;var scale=_ref8.scale;this.commitOrRemove();this.viewParameters.realScale=scale*_PixelsPerInch.PDF_TO_CSS_UNITS;var _iterator11=_createForOfIteratorHelper(_classPrivateFieldGet(_editorsToRescale,this)),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var editor=_step11.value;editor.onScaleChanging();}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}(_classPrivateFieldGet14=_classPrivateFieldGet(_currentDrawingSession,this))===null||_classPrivateFieldGet14===void 0||_classPrivateFieldGet14.onScaleChanging();}},{key:"onRotationChanging",value:function onRotationChanging(_ref9){var pagesRotation=_ref9.pagesRotation;this.commitOrRemove();this.viewParameters.rotation=pagesRotation;}},{key:"highlightSelection",value:function highlightSelection(){var _this8=this;var methodOfCreation=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var selection=document.getSelection();if(!selection||selection.isCollapsed){return;}var anchorNode=selection.anchorNode,anchorOffset=selection.anchorOffset,focusNode=selection.focusNode,focusOffset=selection.focusOffset;var text=selection.toString();var anchorElement=_assertClassBrand(_AnnotationEditorUIManager_brand,this,_getAnchorElementForSelection).call(this,selection);var textLayer=anchorElement.closest(".textLayer");var boxes=this.getSelectionBoxes(textLayer);if(!boxes){return;}selection.empty();var layer=_assertClassBrand(_AnnotationEditorUIManager_brand,this,_getLayerForTextLayer).call(this,textLayer);var isNoneMode=_classPrivateFieldGet(_mode,this)===_AnnotationEditorType.NONE;var callback=function callback(){layer===null||layer===void 0||layer.createAndAddNewEditor({x:0,y:0},false,{methodOfCreation:methodOfCreation,boxes:boxes,anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset,text:text});if(isNoneMode){_this8.showAllEditors("highlight",true,true);}};if(isNoneMode){this.switchToMode(_AnnotationEditorType.HIGHLIGHT,callback);return;}callback();}},{key:"addToAnnotationStorage",value:function addToAnnotationStorage(editor){if(!editor.isEmpty()&&_classPrivateFieldGet(_annotationStorage,this)&&!_classPrivateFieldGet(_annotationStorage,this).has(editor.id)){_classPrivateFieldGet(_annotationStorage,this).setValue(editor.id,editor);}}},{key:"blur",value:function blur(){this.isShiftKeyDown=false;if(_classPrivateFieldGet(_highlightWhenShiftUp,this)){_classPrivateFieldSet(_highlightWhenShiftUp,this,false);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_onSelectEnd).call(this,"main_toolbar");}if(!this.hasSelection){return;}var _document=document,activeElement=_document.activeElement;var _iterator12=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var editor=_step12.value;if(editor.div.contains(activeElement)){_classPrivateFieldSet(_lastActiveElement,this,[editor,activeElement]);editor._focusEventsAllowed=false;break;}}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}}},{key:"focus",value:function focus(){if(!_classPrivateFieldGet(_lastActiveElement,this)){return;}var _classPrivateFieldGet15=_classPrivateFieldGet(_lastActiveElement,this),_classPrivateFieldGet16=_slicedToArray(_classPrivateFieldGet15,2),lastEditor=_classPrivateFieldGet16[0],lastActiveElement=_classPrivateFieldGet16[1];_classPrivateFieldSet(_lastActiveElement,this,null);lastActiveElement.addEventListener("focusin",function(){lastEditor._focusEventsAllowed=true;},{once:true,signal:this._signal});lastActiveElement.focus();}},{key:"addEditListeners",value:function addEditListeners(){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_addKeyboardManager).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_addCopyPasteListeners).call(this);}},{key:"removeEditListeners",value:function removeEditListeners(){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_removeKeyboardManager).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_removeCopyPasteListeners).call(this);}},{key:"dragOver",value:function dragOver(event){var _iterator13=_createForOfIteratorHelper(event.dataTransfer.items),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var type=_step13.value.type;var _iterator14=_createForOfIteratorHelper(_classPrivateFieldGet(_editorTypes,this)),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var editorType=_step14.value;if(editorType.isHandlingMimeForPasting(type)){event.dataTransfer.dropEffect="copy";event.preventDefault();return;}}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}}},{key:"drop",value:function drop(event){var _iterator15=_createForOfIteratorHelper(event.dataTransfer.items),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var item=_step15.value;var _iterator16=_createForOfIteratorHelper(_classPrivateFieldGet(_editorTypes,this)),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var editorType=_step16.value;if(editorType.isHandlingMimeForPasting(item.type)){editorType.paste(item,this.currentLayer);event.preventDefault();return;}}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}}},{key:"copy",value:function copy(event){var _classPrivateFieldGet17;event.preventDefault();(_classPrivateFieldGet17=_classPrivateFieldGet(_activeEditor,this))===null||_classPrivateFieldGet17===void 0||_classPrivateFieldGet17.commitOrRemove();if(!this.hasSelection){return;}var editors=[];var _iterator17=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var editor=_step17.value;var serialized=editor.serialize(true);if(serialized){editors.push(serialized);}}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}if(editors.length===0){return;}event.clipboardData.setData("application/pdfjs",JSON.stringify(editors));}},{key:"cut",value:function cut(event){this.copy(event);this["delete"]();}},{key:"paste",value:function(){var _paste=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(event){var _this9=this;var clipboardData,_iterator18,_step18,item,_iterator20,_step20,editorType,data,layer,newEditors,_iterator19,_step19,editor,deserializedEditor,cmd,undo,_t5,_t6,_t7,_t8,_t9;return _regenerator().w(function(_context7){while(1)switch(_context7.n){case 0:event.preventDefault();clipboardData=event.clipboardData;_iterator18=_createForOfIteratorHelper(clipboardData.items);_context7.p=1;_iterator18.s();case 2:if((_step18=_iterator18.n()).done){_context7.n=10;break;}item=_step18.value;_iterator20=_createForOfIteratorHelper(_classPrivateFieldGet(_editorTypes,this));_context7.p=3;_iterator20.s();case 4:if((_step20=_iterator20.n()).done){_context7.n=6;break;}editorType=_step20.value;if(!editorType.isHandlingMimeForPasting(item.type)){_context7.n=5;break;}editorType.paste(item,this.currentLayer);return _context7.a(2);case 5:_context7.n=4;break;case 6:_context7.n=8;break;case 7:_context7.p=7;_t5=_context7.v;_iterator20.e(_t5);case 8:_context7.p=8;_iterator20.f();return _context7.f(8);case 9:_context7.n=2;break;case 10:_context7.n=12;break;case 11:_context7.p=11;_t6=_context7.v;_iterator18.e(_t6);case 12:_context7.p=12;_iterator18.f();return _context7.f(12);case 13:data=clipboardData.getData("application/pdfjs");if(data){_context7.n=14;break;}return _context7.a(2);case 14:_context7.p=14;data=JSON.parse(data);_context7.n=16;break;case 15:_context7.p=15;_t7=_context7.v;warn("paste: \"".concat(_t7.message,"\"."));return _context7.a(2);case 16:if(Array.isArray(data)){_context7.n=17;break;}return _context7.a(2);case 17:this.unselectAll();layer=this.currentLayer;_context7.p=18;newEditors=[];_iterator19=_createForOfIteratorHelper(data);_context7.p=19;_iterator19.s();case 20:if((_step19=_iterator19.n()).done){_context7.n=24;break;}editor=_step19.value;_context7.n=21;return layer.deserialize(editor);case 21:deserializedEditor=_context7.v;if(deserializedEditor){_context7.n=22;break;}return _context7.a(2);case 22:newEditors.push(deserializedEditor);case 23:_context7.n=20;break;case 24:_context7.n=26;break;case 25:_context7.p=25;_t8=_context7.v;_iterator19.e(_t8);case 26:_context7.p=26;_iterator19.f();return _context7.f(26);case 27:cmd=function cmd(){for(var _i=0,_newEditors=newEditors;_i<_newEditors.length;_i++){var editor=_newEditors[_i];_assertClassBrand(_AnnotationEditorUIManager_brand,_this9,_addEditorToLayer).call(_this9,editor);}_assertClassBrand(_AnnotationEditorUIManager_brand,_this9,_selectEditors).call(_this9,newEditors);};undo=function undo(){for(var _i2=0,_newEditors2=newEditors;_i2<_newEditors2.length;_i2++){var editor=_newEditors2[_i2];editor.remove();}};this.addCommands({cmd:cmd,undo:undo,mustExec:true});_context7.n=29;break;case 28:_context7.p=28;_t9=_context7.v;warn("paste: \"".concat(_t9.message,"\"."));case 29:return _context7.a(2);}},_callee7,this,[[19,25,26,27],[18,28],[14,15],[3,7,8,9],[1,11,12,13]]);}));function paste(_x0){return _paste.apply(this,arguments);}return paste;}()},{key:"keydown",value:function keydown(event){if(!this.isShiftKeyDown&&event.key==="Shift"){this.isShiftKeyDown=true;}if(_classPrivateFieldGet(_mode,this)!==_AnnotationEditorType.NONE&&!this.isEditorHandlingKeyboard){_AnnotationEditorUIManager._keyboardManager.exec(this,event);}}},{key:"keyup",value:function keyup(event){if(this.isShiftKeyDown&&event.key==="Shift"){this.isShiftKeyDown=false;if(_classPrivateFieldGet(_highlightWhenShiftUp,this)){_classPrivateFieldSet(_highlightWhenShiftUp,this,false);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_onSelectEnd).call(this,"main_toolbar");}}}},{key:"onEditingAction",value:function onEditingAction(_ref0){var name=_ref0.name;switch(name){case"undo":case"redo":case"delete":case"selectAll":this[name]();break;case"highlightSelection":this.highlightSelection("context_menu");break;}}},{key:"setEditingState",value:function setEditingState(isEditing){if(isEditing){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_addFocusManager).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_addCopyPasteListeners).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{isEditing:_classPrivateFieldGet(_mode,this)!==_AnnotationEditorType.NONE,isEmpty:_assertClassBrand(_AnnotationEditorUIManager_brand,this,_isEmpty).call(this),hasSomethingToUndo:_classPrivateFieldGet(_commandManager,this).hasSomethingToUndo(),hasSomethingToRedo:_classPrivateFieldGet(_commandManager,this).hasSomethingToRedo(),hasSelectedEditor:false});}else{_assertClassBrand(_AnnotationEditorUIManager_brand,this,_removeFocusManager).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_removeCopyPasteListeners).call(this);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{isEditing:false});this.disableUserSelect(false);}}},{key:"registerEditorTypes",value:function registerEditorTypes(types){if(_classPrivateFieldGet(_editorTypes,this)){return;}_classPrivateFieldSet(_editorTypes,this,types);var _iterator21=_createForOfIteratorHelper(_classPrivateFieldGet(_editorTypes,this)),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var editorType=_step21.value;_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,editorType.defaultPropertiesToUpdate);}}catch(err){_iterator21.e(err);}finally{_iterator21.f();}}},{key:"getId",value:function getId(){return _classPrivateFieldGet(_idManager,this).id;}},{key:"currentLayer",get:function get(){return _classPrivateFieldGet(_allLayers,this).get(_classPrivateFieldGet(_currentPageIndex,this));}},{key:"getLayer",value:function getLayer(pageIndex){return _classPrivateFieldGet(_allLayers,this).get(pageIndex);}},{key:"currentPageIndex",get:function get(){return _classPrivateFieldGet(_currentPageIndex,this);}},{key:"addLayer",value:function addLayer(layer){_classPrivateFieldGet(_allLayers,this).set(layer.pageIndex,layer);if(_classPrivateFieldGet(_isEnabled,this)){layer.enable();}else{layer.disable();}}},{key:"removeLayer",value:function removeLayer(layer){_classPrivateFieldGet(_allLayers,this)["delete"](layer.pageIndex);}},{key:"updateMode",value:function(){var _updateMode=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(mode){var editId,isFromKeyboard,_this$_editorUndoBar2,_classPrivateFieldGet18,_iterator22,_step22,layer,_iterator23,_step23,editor,_args8=arguments;return _regenerator().w(function(_context8){while(1)switch(_context8.n){case 0:editId=_args8.length>1&&_args8[1]!==undefined?_args8[1]:null;isFromKeyboard=_args8.length>2&&_args8[2]!==undefined?_args8[2]:false;if(!(_classPrivateFieldGet(_mode,this)===mode)){_context8.n=1;break;}return _context8.a(2);case 1:if(!_classPrivateFieldGet(_updateModeCapability,this)){_context8.n=3;break;}_context8.n=2;return _classPrivateFieldGet(_updateModeCapability,this).promise;case 2:if(_classPrivateFieldGet(_updateModeCapability,this)){_context8.n=3;break;}return _context8.a(2);case 3:_classPrivateFieldSet(_updateModeCapability,this,Promise.withResolvers());_classPrivateFieldSet(_mode,this,mode);if(!(mode===_AnnotationEditorType.NONE)){_context8.n=4;break;}this.setEditingState(false);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_disableAll).call(this);(_this$_editorUndoBar2=this._editorUndoBar)===null||_this$_editorUndoBar2===void 0||_this$_editorUndoBar2.hide();_classPrivateFieldGet(_updateModeCapability,this).resolve();return _context8.a(2);case 4:if(!(mode===_AnnotationEditorType.SIGNATURE)){_context8.n=5;break;}_context8.n=5;return(_classPrivateFieldGet18=_classPrivateFieldGet(_signatureManager,this))===null||_classPrivateFieldGet18===void 0?void 0:_classPrivateFieldGet18.loadSignatures();case 5:this.setEditingState(true);_context8.n=6;return _assertClassBrand(_AnnotationEditorUIManager_brand,this,_enableAll).call(this);case 6:this.unselectAll();_iterator22=_createForOfIteratorHelper(_classPrivateFieldGet(_allLayers,this).values());try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){layer=_step22.value;layer.updateMode(mode);}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}if(editId){_context8.n=7;break;}if(isFromKeyboard){this.addNewEditorFromKeyboard();}_classPrivateFieldGet(_updateModeCapability,this).resolve();return _context8.a(2);case 7:_iterator23=_createForOfIteratorHelper(_classPrivateFieldGet(_allEditors,this).values());try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){editor=_step23.value;if(editor.annotationElementId===editId){this.setSelected(editor);editor.enterInEditMode();}else{editor.unselect();}}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}_classPrivateFieldGet(_updateModeCapability,this).resolve();case 8:return _context8.a(2);}},_callee8,this);}));function updateMode(_x1){return _updateMode.apply(this,arguments);}return updateMode;}()},{key:"addNewEditorFromKeyboard",value:function addNewEditorFromKeyboard(){if(this.currentLayer.canCreateNewEmptyEditor()){this.currentLayer.addNewEditor();}}},{key:"updateToolbar",value:function updateToolbar(mode){if(mode===_classPrivateFieldGet(_mode,this)){return;}this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:mode});}},{key:"updateParams",value:function updateParams(type,value){var _classPrivateFieldGet19;if(!_classPrivateFieldGet(_editorTypes,this)){return;}switch(type){case _AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor(value);return;case _AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:(_classPrivateFieldGet19=_classPrivateFieldGet(_mainHighlightColorPicker,this))===null||_classPrivateFieldGet19===void 0||_classPrivateFieldGet19.updateColor(value);break;case _AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}});(_classPrivateFieldGet(_showAllStates,this)||_classPrivateFieldSet(_showAllStates,this,new Map())).set(type,value);this.showAllEditors("highlight",value);break;}var _iterator24=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var editor=_step24.value;editor.updateParams(type,value);}}catch(err){_iterator24.e(err);}finally{_iterator24.f();}var _iterator25=_createForOfIteratorHelper(_classPrivateFieldGet(_editorTypes,this)),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var editorType=_step25.value;editorType.updateDefaultParams(type,value);}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}}},{key:"showAllEditors",value:function showAllEditors(type,visible){var _classPrivateFieldGet20,_classPrivateFieldGet21;var updateButton=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var _iterator26=_createForOfIteratorHelper(_classPrivateFieldGet(_allEditors,this).values()),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var editor=_step26.value;if(editor.editorType===type){editor.show(visible);}}}catch(err){_iterator26.e(err);}finally{_iterator26.f();}var state=(_classPrivateFieldGet20=(_classPrivateFieldGet21=_classPrivateFieldGet(_showAllStates,this))===null||_classPrivateFieldGet21===void 0?void 0:_classPrivateFieldGet21.get(_AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL))!==null&&_classPrivateFieldGet20!==void 0?_classPrivateFieldGet20:true;if(state!==visible){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,[[_AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,visible]]);}}},{key:"enableWaiting",value:function enableWaiting(){var mustWait=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(_classPrivateFieldGet(_isWaiting,this)===mustWait){return;}_classPrivateFieldSet(_isWaiting,this,mustWait);var _iterator27=_createForOfIteratorHelper(_classPrivateFieldGet(_allLayers,this).values()),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var layer=_step27.value;if(mustWait){layer.disableClick();}else{layer.enableClick();}layer.div.classList.toggle("waiting",mustWait);}}catch(err){_iterator27.e(err);}finally{_iterator27.f();}}},{key:"getEditors",value:function getEditors(pageIndex){var editors=[];var _iterator28=_createForOfIteratorHelper(_classPrivateFieldGet(_allEditors,this).values()),_step28;try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var editor=_step28.value;if(editor.pageIndex===pageIndex){editors.push(editor);}}}catch(err){_iterator28.e(err);}finally{_iterator28.f();}return editors;}},{key:"getEditor",value:function getEditor(id){return _classPrivateFieldGet(_allEditors,this).get(id);}},{key:"addEditor",value:function addEditor(editor){_classPrivateFieldGet(_allEditors,this).set(editor.id,editor);}},{key:"removeEditor",value:function removeEditor(editor){var _this0=this;if(editor.div.contains(document.activeElement)){if(_classPrivateFieldGet(_focusMainContainerTimeoutId,this)){clearTimeout(_classPrivateFieldGet(_focusMainContainerTimeoutId,this));}_classPrivateFieldSet(_focusMainContainerTimeoutId,this,setTimeout(function(){_this0.focusMainContainer();_classPrivateFieldSet(_focusMainContainerTimeoutId,_this0,null);},0));}_classPrivateFieldGet(_allEditors,this)["delete"](editor.id);if(editor.annotationElementId){var _classPrivateFieldGet22;(_classPrivateFieldGet22=_classPrivateFieldGet(_missingCanvases,this))===null||_classPrivateFieldGet22===void 0||_classPrivateFieldGet22["delete"](editor.annotationElementId);}this.unselect(editor);if(!editor.annotationElementId||!_classPrivateFieldGet(_deletedAnnotationsElementIds,this).has(editor.annotationElementId)){var _classPrivateFieldGet23;(_classPrivateFieldGet23=_classPrivateFieldGet(_annotationStorage,this))===null||_classPrivateFieldGet23===void 0||_classPrivateFieldGet23.remove(editor.id);}}},{key:"addDeletedAnnotationElement",value:function addDeletedAnnotationElement(editor){_classPrivateFieldGet(_deletedAnnotationsElementIds,this).add(editor.annotationElementId);this.addChangedExistingAnnotation(editor);editor.deleted=true;}},{key:"isDeletedAnnotationElement",value:function isDeletedAnnotationElement(annotationElementId){return _classPrivateFieldGet(_deletedAnnotationsElementIds,this).has(annotationElementId);}},{key:"removeDeletedAnnotationElement",value:function removeDeletedAnnotationElement(editor){_classPrivateFieldGet(_deletedAnnotationsElementIds,this)["delete"](editor.annotationElementId);this.removeChangedExistingAnnotation(editor);editor.deleted=false;}},{key:"setActiveEditor",value:function setActiveEditor(editor){if(_classPrivateFieldGet(_activeEditor,this)===editor){return;}_classPrivateFieldSet(_activeEditor,this,editor);if(editor){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,editor.propertiesToUpdate);}}},{key:"updateUI",value:function updateUI(editor){if(_classPrivateGetter(_AnnotationEditorUIManager_brand,this,_get_lastSelectedEditor)===editor){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,editor.propertiesToUpdate);}}},{key:"updateUIForDefaultProperties",value:function updateUIForDefaultProperties(editorType){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,editorType.defaultPropertiesToUpdate);}},{key:"toggleSelected",value:function toggleSelected(editor){if(_classPrivateFieldGet(_selectedEditors,this).has(editor)){_classPrivateFieldGet(_selectedEditors,this)["delete"](editor);editor.unselect();_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:this.hasSelection});return;}_classPrivateFieldGet(_selectedEditors,this).add(editor);editor.select();_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,editor.propertiesToUpdate);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:true});}},{key:"setSelected",value:function setSelected(editor){var _classPrivateFieldGet24;(_classPrivateFieldGet24=_classPrivateFieldGet(_currentDrawingSession,this))===null||_classPrivateFieldGet24===void 0||_classPrivateFieldGet24.commitOrRemove();var _iterator29=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step29;try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var ed=_step29.value;if(ed!==editor){ed.unselect();}}}catch(err){_iterator29.e(err);}finally{_iterator29.f();}_classPrivateFieldGet(_selectedEditors,this).clear();_classPrivateFieldGet(_selectedEditors,this).add(editor);editor.select();_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,editor.propertiesToUpdate);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:true});}},{key:"isSelected",value:function isSelected(editor){return _classPrivateFieldGet(_selectedEditors,this).has(editor);}},{key:"firstSelectedEditor",get:function get(){return _classPrivateFieldGet(_selectedEditors,this).values().next().value;}},{key:"unselect",value:function unselect(editor){editor.unselect();_classPrivateFieldGet(_selectedEditors,this)["delete"](editor);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:this.hasSelection});}},{key:"hasSelection",get:function get(){return _classPrivateFieldGet(_selectedEditors,this).size!==0;}},{key:"isEnterHandled",get:function get(){return _classPrivateFieldGet(_selectedEditors,this).size===1&&this.firstSelectedEditor.isEnterHandled;}},{key:"undo",value:function undo(){var _this$_editorUndoBar3;_classPrivateFieldGet(_commandManager,this).undo();_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSomethingToUndo:_classPrivateFieldGet(_commandManager,this).hasSomethingToUndo(),hasSomethingToRedo:true,isEmpty:_assertClassBrand(_AnnotationEditorUIManager_brand,this,_isEmpty).call(this)});(_this$_editorUndoBar3=this._editorUndoBar)===null||_this$_editorUndoBar3===void 0||_this$_editorUndoBar3.hide();}},{key:"redo",value:function redo(){_classPrivateFieldGet(_commandManager,this).redo();_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSomethingToUndo:true,hasSomethingToRedo:_classPrivateFieldGet(_commandManager,this).hasSomethingToRedo(),isEmpty:_assertClassBrand(_AnnotationEditorUIManager_brand,this,_isEmpty).call(this)});}},{key:"addCommands",value:function addCommands(params){_classPrivateFieldGet(_commandManager,this).add(params);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSomethingToUndo:true,hasSomethingToRedo:false,isEmpty:_assertClassBrand(_AnnotationEditorUIManager_brand,this,_isEmpty).call(this)});}},{key:"cleanUndoStack",value:function cleanUndoStack(type){_classPrivateFieldGet(_commandManager,this).cleanType(type);}},{key:"delete",value:function _delete(){var _this$currentLayer,_this1=this;this.commitOrRemove();var drawingEditor=(_this$currentLayer=this.currentLayer)===null||_this$currentLayer===void 0?void 0:_this$currentLayer.endDrawingSession(true);if(!this.hasSelection&&!drawingEditor){return;}var editors=drawingEditor?[drawingEditor]:_toConsumableArray(_classPrivateFieldGet(_selectedEditors,this));var cmd=function cmd(){var _this1$_editorUndoBar;(_this1$_editorUndoBar=_this1._editorUndoBar)===null||_this1$_editorUndoBar===void 0||_this1$_editorUndoBar.show(undo,editors.length===1?editors[0].editorType:editors.length);var _iterator30=_createForOfIteratorHelper(editors),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var editor=_step30.value;editor.remove();}}catch(err){_iterator30.e(err);}finally{_iterator30.f();}};var undo=function undo(){var _iterator31=_createForOfIteratorHelper(editors),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var editor=_step31.value;_assertClassBrand(_AnnotationEditorUIManager_brand,_this1,_addEditorToLayer).call(_this1,editor);}}catch(err){_iterator31.e(err);}finally{_iterator31.f();}};this.addCommands({cmd:cmd,undo:undo,mustExec:true});}},{key:"commitOrRemove",value:function commitOrRemove(){var _classPrivateFieldGet25;(_classPrivateFieldGet25=_classPrivateFieldGet(_activeEditor,this))===null||_classPrivateFieldGet25===void 0||_classPrivateFieldGet25.commitOrRemove();}},{key:"hasSomethingToControl",value:function hasSomethingToControl(){return _classPrivateFieldGet(_activeEditor,this)||this.hasSelection;}},{key:"selectAll",value:function selectAll(){var _iterator32=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step32;try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){var editor=_step32.value;editor.commit();}}catch(err){_iterator32.e(err);}finally{_iterator32.f();}_assertClassBrand(_AnnotationEditorUIManager_brand,this,_selectEditors).call(this,_classPrivateFieldGet(_allEditors,this).values());}},{key:"unselectAll",value:function unselectAll(){var _classPrivateFieldGet26;if(_classPrivateFieldGet(_activeEditor,this)){_classPrivateFieldGet(_activeEditor,this).commitOrRemove();if(_classPrivateFieldGet(_mode,this)!==_AnnotationEditorType.NONE){return;}}if((_classPrivateFieldGet26=_classPrivateFieldGet(_currentDrawingSession,this))!==null&&_classPrivateFieldGet26!==void 0&&_classPrivateFieldGet26.commitOrRemove()){return;}if(!this.hasSelection){return;}var _iterator33=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step33;try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){var editor=_step33.value;editor.unselect();}}catch(err){_iterator33.e(err);}finally{_iterator33.f();}_classPrivateFieldGet(_selectedEditors,this).clear();_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:false});}},{key:"translateSelectedEditors",value:function translateSelectedEditors(x,y){var _this10=this;var noCommit=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!noCommit){this.commitOrRemove();}if(!this.hasSelection){return;}_classPrivateFieldGet(_translation,this)[0]+=x;_classPrivateFieldGet(_translation,this)[1]+=y;var _classPrivateFieldGet27=_classPrivateFieldGet(_translation,this),_classPrivateFieldGet28=_slicedToArray(_classPrivateFieldGet27,2),totalX=_classPrivateFieldGet28[0],totalY=_classPrivateFieldGet28[1];var editors=_toConsumableArray(_classPrivateFieldGet(_selectedEditors,this));var TIME_TO_WAIT=1000;if(_classPrivateFieldGet(_translationTimeoutId,this)){clearTimeout(_classPrivateFieldGet(_translationTimeoutId,this));}_classPrivateFieldSet(_translationTimeoutId,this,setTimeout(function(){_classPrivateFieldSet(_translationTimeoutId,_this10,null);_classPrivateFieldGet(_translation,_this10)[0]=_classPrivateFieldGet(_translation,_this10)[1]=0;_this10.addCommands({cmd:function cmd(){var _iterator34=_createForOfIteratorHelper(editors),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var editor=_step34.value;if(_classPrivateFieldGet(_allEditors,_this10).has(editor.id)){editor.translateInPage(totalX,totalY);editor.translationDone();}}}catch(err){_iterator34.e(err);}finally{_iterator34.f();}},undo:function undo(){var _iterator35=_createForOfIteratorHelper(editors),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var editor=_step35.value;if(_classPrivateFieldGet(_allEditors,_this10).has(editor.id)){editor.translateInPage(-totalX,-totalY);editor.translationDone();}}}catch(err){_iterator35.e(err);}finally{_iterator35.f();}},mustExec:false});},TIME_TO_WAIT));var _iterator36=_createForOfIteratorHelper(editors),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var editor=_step36.value;editor.translateInPage(x,y);editor.translationDone();}}catch(err){_iterator36.e(err);}finally{_iterator36.f();}}},{key:"setUpDragSession",value:function setUpDragSession(){if(!this.hasSelection){return;}this.disableUserSelect(true);_classPrivateFieldSet(_draggingEditors,this,new Map());var _iterator37=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step37;try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var editor=_step37.value;_classPrivateFieldGet(_draggingEditors,this).set(editor,{savedX:editor.x,savedY:editor.y,savedPageIndex:editor.pageIndex,newX:0,newY:0,newPageIndex:-1});}}catch(err){_iterator37.e(err);}finally{_iterator37.f();}}},{key:"endDragSession",value:function endDragSession(){var _this11=this;if(!_classPrivateFieldGet(_draggingEditors,this)){return false;}this.disableUserSelect(false);var map=_classPrivateFieldGet(_draggingEditors,this);_classPrivateFieldSet(_draggingEditors,this,null);var mustBeAddedInUndoStack=false;var _iterator38=_createForOfIteratorHelper(map),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var _step38$value=_slicedToArray(_step38.value,2),_step38$value$=_step38$value[0],x=_step38$value$.x,y=_step38$value$.y,pageIndex=_step38$value$.pageIndex,value=_step38$value[1];value.newX=x;value.newY=y;value.newPageIndex=pageIndex;mustBeAddedInUndoStack||(mustBeAddedInUndoStack=x!==value.savedX||y!==value.savedY||pageIndex!==value.savedPageIndex);}}catch(err){_iterator38.e(err);}finally{_iterator38.f();}if(!mustBeAddedInUndoStack){return false;}var move=function move(editor,x,y,pageIndex){if(_classPrivateFieldGet(_allEditors,_this11).has(editor.id)){var parent=_classPrivateFieldGet(_allLayers,_this11).get(pageIndex);if(parent){editor._setParentAndPosition(parent,x,y);}else{editor.pageIndex=pageIndex;editor.x=x;editor.y=y;}}};this.addCommands({cmd:function cmd(){var _iterator39=_createForOfIteratorHelper(map),_step39;try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var _step39$value=_slicedToArray(_step39.value,2),editor=_step39$value[0],_step39$value$=_step39$value[1],newX=_step39$value$.newX,newY=_step39$value$.newY,newPageIndex=_step39$value$.newPageIndex;move(editor,newX,newY,newPageIndex);}}catch(err){_iterator39.e(err);}finally{_iterator39.f();}},undo:function undo(){var _iterator40=_createForOfIteratorHelper(map),_step40;try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var _step40$value=_slicedToArray(_step40.value,2),editor=_step40$value[0],_step40$value$=_step40$value[1],savedX=_step40$value$.savedX,savedY=_step40$value$.savedY,savedPageIndex=_step40$value$.savedPageIndex;move(editor,savedX,savedY,savedPageIndex);}}catch(err){_iterator40.e(err);}finally{_iterator40.f();}},mustExec:true});return true;}},{key:"dragSelectedEditors",value:function dragSelectedEditors(tx,ty){if(!_classPrivateFieldGet(_draggingEditors,this)){return;}var _iterator41=_createForOfIteratorHelper(_classPrivateFieldGet(_draggingEditors,this).keys()),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var editor=_step41.value;editor.drag(tx,ty);}}catch(err){_iterator41.e(err);}finally{_iterator41.f();}}},{key:"rebuild",value:function rebuild(editor){if(editor.parent===null){var parent=this.getLayer(editor.pageIndex);if(parent){parent.changeParent(editor);parent.addOrRebuild(editor);}else{this.addEditor(editor);this.addToAnnotationStorage(editor);editor.rebuild();}}else{editor.parent.addOrRebuild(editor);}}},{key:"isEditorHandlingKeyboard",get:function get(){var _this$getActive;return((_this$getActive=this.getActive())===null||_this$getActive===void 0?void 0:_this$getActive.shouldGetKeyboardEvents())||_classPrivateFieldGet(_selectedEditors,this).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents();}},{key:"isActive",value:function isActive(editor){return _classPrivateFieldGet(_activeEditor,this)===editor;}},{key:"getActive",value:function getActive(){return _classPrivateFieldGet(_activeEditor,this);}},{key:"getMode",value:function getMode(){return _classPrivateFieldGet(_mode,this);}},{key:"imageManager",get:function get(){return _shadow(this,"imageManager",new ImageManager());}},{key:"getSelectionBoxes",value:function getSelectionBoxes(textLayer){if(!textLayer){return null;}var selection=document.getSelection();for(var i=0,ii=selection.rangeCount;i<ii;i++){if(!textLayer.contains(selection.getRangeAt(i).commonAncestorContainer)){return null;}}var _textLayer$getBoundin=textLayer.getBoundingClientRect(),layerX=_textLayer$getBoundin.x,layerY=_textLayer$getBoundin.y,parentWidth=_textLayer$getBoundin.width,parentHeight=_textLayer$getBoundin.height;var rotator;switch(textLayer.getAttribute("data-main-rotation")){case"90":rotator=function rotator(x,y,w,h){return{x:(y-layerY)/parentHeight,y:1-(x+w-layerX)/parentWidth,width:h/parentHeight,height:w/parentWidth};};break;case"180":rotator=function rotator(x,y,w,h){return{x:1-(x+w-layerX)/parentWidth,y:1-(y+h-layerY)/parentHeight,width:w/parentWidth,height:h/parentHeight};};break;case"270":rotator=function rotator(x,y,w,h){return{x:1-(y+h-layerY)/parentHeight,y:(x-layerX)/parentWidth,width:h/parentHeight,height:w/parentWidth};};break;default:rotator=function rotator(x,y,w,h){return{x:(x-layerX)/parentWidth,y:(y-layerY)/parentHeight,width:w/parentWidth,height:h/parentHeight};};break;}var boxes=[];for(var _i3=0,_ii=selection.rangeCount;_i3<_ii;_i3++){var range=selection.getRangeAt(_i3);if(range.collapsed){continue;}var _iterator42=_createForOfIteratorHelper(range.getClientRects()),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var _step42$value=_step42.value,x=_step42$value.x,y=_step42$value.y,width=_step42$value.width,height=_step42$value.height;if(width===0||height===0){continue;}boxes.push(rotator(x,y,width,height));}}catch(err){_iterator42.e(err);}finally{_iterator42.f();}}return boxes.length===0?null:boxes;}},{key:"addChangedExistingAnnotation",value:function addChangedExistingAnnotation(_ref1){var annotationElementId=_ref1.annotationElementId,id=_ref1.id;(_classPrivateFieldGet(_changedExistingAnnotations,this)||_classPrivateFieldSet(_changedExistingAnnotations,this,new Map())).set(annotationElementId,id);}},{key:"removeChangedExistingAnnotation",value:function removeChangedExistingAnnotation(_ref10){var _classPrivateFieldGet29;var annotationElementId=_ref10.annotationElementId;(_classPrivateFieldGet29=_classPrivateFieldGet(_changedExistingAnnotations,this))===null||_classPrivateFieldGet29===void 0||_classPrivateFieldGet29["delete"](annotationElementId);}},{key:"renderAnnotationElement",value:function renderAnnotationElement(annotation){var _classPrivateFieldGet30;var editorId=(_classPrivateFieldGet30=_classPrivateFieldGet(_changedExistingAnnotations,this))===null||_classPrivateFieldGet30===void 0?void 0:_classPrivateFieldGet30.get(annotation.data.id);if(!editorId){return;}var editor=_classPrivateFieldGet(_annotationStorage,this).getRawValue(editorId);if(!editor){return;}if(_classPrivateFieldGet(_mode,this)===_AnnotationEditorType.NONE&&!editor.hasBeenModified){return;}editor.renderAnnotationElement(annotation);}},{key:"setMissingCanvas",value:function setMissingCanvas(annotationId,annotationElementId,canvas){var _classPrivateFieldGet31;var editor=(_classPrivateFieldGet31=_classPrivateFieldGet(_missingCanvases,this))===null||_classPrivateFieldGet31===void 0?void 0:_classPrivateFieldGet31.get(annotationId);if(!editor){return;}editor.setCanvas(annotationElementId,canvas);_classPrivateFieldGet(_missingCanvases,this)["delete"](annotationId);}},{key:"addMissingCanvas",value:function addMissingCanvas(annotationId,editor){(_classPrivateFieldGet(_missingCanvases,this)||_classPrivateFieldSet(_missingCanvases,this,new Map())).set(annotationId,editor);}}],[{key:"_keyboardManager",get:function get(){var proto=_AnnotationEditorUIManager.prototype;var arrowChecker=function arrowChecker(self){return _classPrivateFieldGet(_container,self).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&self.hasSomethingToControl();};var textInputChecker=function textInputChecker(_self,_ref11){var el=_ref11.target;if(el instanceof HTMLInputElement){var type=el.type;return type!=="text"&&type!=="number";}return true;};var small=this.TRANSLATE_SMALL;var big=this.TRANSLATE_BIG;return _shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+a","mac+meta+a"],proto.selectAll,{checker:textInputChecker}],[["ctrl+z","mac+meta+z"],proto.undo,{checker:textInputChecker}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],proto.redo,{checker:textInputChecker}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],proto["delete"],{checker:textInputChecker}],[["Enter","mac+Enter"],proto.addNewEditorFromKeyboard,{checker:function checker(self,_ref12){var el=_ref12.target;return!(el instanceof HTMLButtonElement)&&_classPrivateFieldGet(_container,self).contains(el)&&!self.isEnterHandled;}}],[[" ","mac+ "],proto.addNewEditorFromKeyboard,{checker:function checker(self,_ref13){var el=_ref13.target;return!(el instanceof HTMLButtonElement)&&_classPrivateFieldGet(_container,self).contains(document.activeElement);}}],[["Escape","mac+Escape"],proto.unselectAll],[["ArrowLeft","mac+ArrowLeft"],proto.translateSelectedEditors,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto.translateSelectedEditors,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto.translateSelectedEditors,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto.translateSelectedEditors,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto.translateSelectedEditors,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto.translateSelectedEditors,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto.translateSelectedEditors,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto.translateSelectedEditors,{args:[0,big],checker:arrowChecker}]]));}}]);}();function _getAnchorElementForSelection(_ref133){var anchorNode=_ref133.anchorNode;return anchorNode.nodeType===Node.TEXT_NODE?anchorNode.parentElement:anchorNode;}function _getLayerForTextLayer(textLayer){var currentLayer=this.currentLayer;if(currentLayer.hasTextLayer(textLayer)){return currentLayer;}var _iterator171=_createForOfIteratorHelper(_classPrivateFieldGet(_allLayers,this).values()),_step171;try{for(_iterator171.s();!(_step171=_iterator171.n()).done;){var layer=_step171.value;if(layer.hasTextLayer(textLayer)){return layer;}}}catch(err){_iterator171.e(err);}finally{_iterator171.f();}return null;}function _displayHighlightToolbar(){var selection=document.getSelection();if(!selection||selection.isCollapsed){return;}var anchorElement=_assertClassBrand(_AnnotationEditorUIManager_brand,this,_getAnchorElementForSelection).call(this,selection);var textLayer=anchorElement.closest(".textLayer");var boxes=this.getSelectionBoxes(textLayer);if(!boxes){return;}_classPrivateFieldGet(_highlightToolbar,this)||_classPrivateFieldSet(_highlightToolbar,this,new HighlightToolbar(this));_classPrivateFieldGet(_highlightToolbar,this).show(textLayer,boxes,this.direction==="ltr");}function _selectionChange(){var _classPrivateFieldGet132,_this108=this;var selection=document.getSelection();if(!selection||selection.isCollapsed){if(_classPrivateFieldGet(_selectedTextNode,this)){var _classPrivateFieldGet130;(_classPrivateFieldGet130=_classPrivateFieldGet(_highlightToolbar,this))===null||_classPrivateFieldGet130===void 0||_classPrivateFieldGet130.hide();_classPrivateFieldSet(_selectedTextNode,this,null);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedText:false});}return;}var anchorNode=selection.anchorNode;if(anchorNode===_classPrivateFieldGet(_selectedTextNode,this)){return;}var anchorElement=_assertClassBrand(_AnnotationEditorUIManager_brand,this,_getAnchorElementForSelection).call(this,selection);var textLayer=anchorElement.closest(".textLayer");if(!textLayer){if(_classPrivateFieldGet(_selectedTextNode,this)){var _classPrivateFieldGet131;(_classPrivateFieldGet131=_classPrivateFieldGet(_highlightToolbar,this))===null||_classPrivateFieldGet131===void 0||_classPrivateFieldGet131.hide();_classPrivateFieldSet(_selectedTextNode,this,null);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedText:false});}return;}(_classPrivateFieldGet132=_classPrivateFieldGet(_highlightToolbar,this))===null||_classPrivateFieldGet132===void 0||_classPrivateFieldGet132.hide();_classPrivateFieldSet(_selectedTextNode,this,anchorNode);_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedText:true});if(_classPrivateFieldGet(_mode,this)!==_AnnotationEditorType.HIGHLIGHT&&_classPrivateFieldGet(_mode,this)!==_AnnotationEditorType.NONE){return;}if(_classPrivateFieldGet(_mode,this)===_AnnotationEditorType.HIGHLIGHT){this.showAllEditors("highlight",true,true);}_classPrivateFieldSet(_highlightWhenShiftUp,this,this.isShiftKeyDown);if(!this.isShiftKeyDown){var activeLayer=_classPrivateFieldGet(_mode,this)===_AnnotationEditorType.HIGHLIGHT?_assertClassBrand(_AnnotationEditorUIManager_brand,this,_getLayerForTextLayer).call(this,textLayer):null;activeLayer===null||activeLayer===void 0||activeLayer.toggleDrawing();var ac=new AbortController();var signal=this.combinedSignal(ac);var pointerup=function pointerup(e){if(e.type==="pointerup"&&e.button!==0){return;}ac.abort();activeLayer===null||activeLayer===void 0||activeLayer.toggleDrawing(true);if(e.type==="pointerup"){_assertClassBrand(_AnnotationEditorUIManager_brand,_this108,_onSelectEnd).call(_this108,"main_toolbar");}};window.addEventListener("pointerup",pointerup,{signal:signal});window.addEventListener("blur",pointerup,{signal:signal});}}function _onSelectEnd(){var methodOfCreation=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";if(_classPrivateFieldGet(_mode,this)===_AnnotationEditorType.HIGHLIGHT){this.highlightSelection(methodOfCreation);}else if(_classPrivateFieldGet(_enableHighlightFloatingButton,this)){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_displayHighlightToolbar).call(this);}}function _addSelectionListener(){document.addEventListener("selectionchange",_assertClassBrand(_AnnotationEditorUIManager_brand,this,_selectionChange).bind(this),{signal:this._signal});}function _addFocusManager(){if(_classPrivateFieldGet(_focusManagerAC,this)){return;}_classPrivateFieldSet(_focusManagerAC,this,new AbortController());var signal=this.combinedSignal(_classPrivateFieldGet(_focusManagerAC,this));window.addEventListener("focus",this.focus.bind(this),{signal:signal});window.addEventListener("blur",this.blur.bind(this),{signal:signal});}function _removeFocusManager(){var _classPrivateFieldGet133;(_classPrivateFieldGet133=_classPrivateFieldGet(_focusManagerAC,this))===null||_classPrivateFieldGet133===void 0||_classPrivateFieldGet133.abort();_classPrivateFieldSet(_focusManagerAC,this,null);}function _addKeyboardManager(){if(_classPrivateFieldGet(_keyboardManagerAC,this)){return;}_classPrivateFieldSet(_keyboardManagerAC,this,new AbortController());var signal=this.combinedSignal(_classPrivateFieldGet(_keyboardManagerAC,this));window.addEventListener("keydown",this.keydown.bind(this),{signal:signal});window.addEventListener("keyup",this.keyup.bind(this),{signal:signal});}function _removeKeyboardManager(){var _classPrivateFieldGet134;(_classPrivateFieldGet134=_classPrivateFieldGet(_keyboardManagerAC,this))===null||_classPrivateFieldGet134===void 0||_classPrivateFieldGet134.abort();_classPrivateFieldSet(_keyboardManagerAC,this,null);}function _addCopyPasteListeners(){if(_classPrivateFieldGet(_copyPasteAC,this)){return;}_classPrivateFieldSet(_copyPasteAC,this,new AbortController());var signal=this.combinedSignal(_classPrivateFieldGet(_copyPasteAC,this));document.addEventListener("copy",this.copy.bind(this),{signal:signal});document.addEventListener("cut",this.cut.bind(this),{signal:signal});document.addEventListener("paste",this.paste.bind(this),{signal:signal});}function _removeCopyPasteListeners(){var _classPrivateFieldGet135;(_classPrivateFieldGet135=_classPrivateFieldGet(_copyPasteAC,this))===null||_classPrivateFieldGet135===void 0||_classPrivateFieldGet135.abort();_classPrivateFieldSet(_copyPasteAC,this,null);}function _addDragAndDropListeners(){var signal=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:signal});document.addEventListener("drop",this.drop.bind(this),{signal:signal});}function _dispatchUpdateStates(details){var _this109=this;var hasChanged=Object.entries(details).some(function(_ref134){var _ref135=_slicedToArray(_ref134,2),key=_ref135[0],value=_ref135[1];return _classPrivateFieldGet(_previousStates,_this109)[key]!==value;});if(hasChanged){this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(_classPrivateFieldGet(_previousStates,this),details)});if(_classPrivateFieldGet(_mode,this)===_AnnotationEditorType.HIGHLIGHT&&details.hasSelectedEditor===false){_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateUI).call(this,[[_AnnotationEditorParamsType.HIGHLIGHT_FREE,true]]);}}}function _dispatchUpdateUI(details){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:details});}function _enableAll(){return _enableAll2.apply(this,arguments);}function _enableAll2(){_enableAll2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee65(){var promises,_iterator193,_step193,layer,_iterator194,_step194,editor;return _regenerator().w(function(_context66){while(1)switch(_context66.n){case 0:if(_classPrivateFieldGet(_isEnabled,this)){_context66.n=2;break;}_classPrivateFieldSet(_isEnabled,this,true);promises=[];_iterator193=_createForOfIteratorHelper(_classPrivateFieldGet(_allLayers,this).values());try{for(_iterator193.s();!(_step193=_iterator193.n()).done;){layer=_step193.value;promises.push(layer.enable());}}catch(err){_iterator193.e(err);}finally{_iterator193.f();}_context66.n=1;return Promise.all(promises);case 1:_iterator194=_createForOfIteratorHelper(_classPrivateFieldGet(_allEditors,this).values());try{for(_iterator194.s();!(_step194=_iterator194.n()).done;){editor=_step194.value;editor.enable();}}catch(err){_iterator194.e(err);}finally{_iterator194.f();}case 2:return _context66.a(2);}},_callee65,this);}));return _enableAll2.apply(this,arguments);}function _disableAll(){this.unselectAll();if(_classPrivateFieldGet(_isEnabled,this)){_classPrivateFieldSet(_isEnabled,this,false);var _iterator172=_createForOfIteratorHelper(_classPrivateFieldGet(_allLayers,this).values()),_step172;try{for(_iterator172.s();!(_step172=_iterator172.n()).done;){var layer=_step172.value;layer.disable();}}catch(err){_iterator172.e(err);}finally{_iterator172.f();}var _iterator173=_createForOfIteratorHelper(_classPrivateFieldGet(_allEditors,this).values()),_step173;try{for(_iterator173.s();!(_step173=_iterator173.n()).done;){var editor=_step173.value;editor.disable();}}catch(err){_iterator173.e(err);}finally{_iterator173.f();}}}function _addEditorToLayer(editor){var layer=_classPrivateFieldGet(_allLayers,this).get(editor.pageIndex);if(layer){layer.addOrRebuild(editor);}else{this.addEditor(editor);this.addToAnnotationStorage(editor);}}function _get_lastSelectedEditor(_this6){var ed=null;var _iterator174=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,_this6)),_step174;try{for(_iterator174.s();!(_step174=_iterator174.n()).done;){ed=_step174.value;}}catch(err){_iterator174.e(err);}finally{_iterator174.f();}return ed;}function _isEmpty(){if(_classPrivateFieldGet(_allEditors,this).size===0){return true;}if(_classPrivateFieldGet(_allEditors,this).size===1){var _iterator175=_createForOfIteratorHelper(_classPrivateFieldGet(_allEditors,this).values()),_step175;try{for(_iterator175.s();!(_step175=_iterator175.n()).done;){var editor=_step175.value;return editor.isEmpty();}}catch(err){_iterator175.e(err);}finally{_iterator175.f();}}return false;}function _selectEditors(editors){var _iterator176=_createForOfIteratorHelper(_classPrivateFieldGet(_selectedEditors,this)),_step176;try{for(_iterator176.s();!(_step176=_iterator176.n()).done;){var editor=_step176.value;editor.unselect();}}catch(err){_iterator176.e(err);}finally{_iterator176.f();}_classPrivateFieldGet(_selectedEditors,this).clear();var _iterator177=_createForOfIteratorHelper(editors),_step177;try{for(_iterator177.s();!(_step177=_iterator177.n()).done;){var _editor6=_step177.value;if(_editor6.isEmpty()){continue;}_classPrivateFieldGet(_selectedEditors,this).add(_editor6);_editor6.select();}}catch(err){_iterator177.e(err);}finally{_iterator177.f();}_assertClassBrand(_AnnotationEditorUIManager_brand,this,_dispatchUpdateStates).call(this,{hasSelectedEditor:this.hasSelection});}_defineProperty(_AnnotationEditorUIManager,"TRANSLATE_SMALL",1);_defineProperty(_AnnotationEditorUIManager,"TRANSLATE_BIG",10);;// ./src/display/editor/alt_text.js
var _altText2=/*#__PURE__*/new WeakMap();var _altTextDecorative=/*#__PURE__*/new WeakMap();var _altTextButton=/*#__PURE__*/new WeakMap();var _altTextButtonLabel=/*#__PURE__*/new WeakMap();var _altTextTooltip=/*#__PURE__*/new WeakMap();var _altTextTooltipTimeout=/*#__PURE__*/new WeakMap();var _altTextWasFromKeyBoard=/*#__PURE__*/new WeakMap();var _badge=/*#__PURE__*/new WeakMap();var _editor2=/*#__PURE__*/new WeakMap();var _guessedText=/*#__PURE__*/new WeakMap();var _textWithDisclaimer=/*#__PURE__*/new WeakMap();var _useNewAltTextFlow=/*#__PURE__*/new WeakMap();var _AltText_brand=/*#__PURE__*/new WeakSet();var AltText=/*#__PURE__*/function(){function AltText(editor){_classCallCheck(this,AltText);_classPrivateMethodInitSpec(this,_AltText_brand);_classPrivateFieldInitSpec(this,_altText2,null);_classPrivateFieldInitSpec(this,_altTextDecorative,false);_classPrivateFieldInitSpec(this,_altTextButton,null);_classPrivateFieldInitSpec(this,_altTextButtonLabel,null);_classPrivateFieldInitSpec(this,_altTextTooltip,null);_classPrivateFieldInitSpec(this,_altTextTooltipTimeout,null);_classPrivateFieldInitSpec(this,_altTextWasFromKeyBoard,false);_classPrivateFieldInitSpec(this,_badge,null);_classPrivateFieldInitSpec(this,_editor2,null);_classPrivateFieldInitSpec(this,_guessedText,null);_classPrivateFieldInitSpec(this,_textWithDisclaimer,null);_classPrivateFieldInitSpec(this,_useNewAltTextFlow,false);_classPrivateFieldSet(_editor2,this,editor);_classPrivateFieldSet(_useNewAltTextFlow,this,editor._uiManager.useNewAltTextFlow);_l10nNewButton._||(_l10nNewButton._=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}));}return _createClass(AltText,[{key:"render",value:function(){var _render2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(){var _this13=this;var altText,label,signal,onClick;return _regenerator().w(function(_context9){while(1)switch(_context9.n){case 0:altText=_classPrivateFieldSet(_altTextButton,this,document.createElement("button"));altText.className="altText";altText.tabIndex="0";label=_classPrivateFieldSet(_altTextButtonLabel,this,document.createElement("span"));altText.append(label);if(_classPrivateFieldGet(_useNewAltTextFlow,this)){altText.classList.add("new");altText.setAttribute("data-l10n-id",_l10nNewButton._.missing);label.setAttribute("data-l10n-id",_l10nNewButton._["missing-label"]);}else{altText.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button");label.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label");}signal=_classPrivateFieldGet(_editor2,this)._uiManager._signal;altText.addEventListener("contextmenu",_noContextMenu,{signal:signal});altText.addEventListener("pointerdown",function(event){return event.stopPropagation();},{signal:signal});onClick=function onClick(event){event.preventDefault();_classPrivateFieldGet(_editor2,_this13)._uiManager.editAltText(_classPrivateFieldGet(_editor2,_this13));if(_classPrivateFieldGet(_useNewAltTextFlow,_this13)){_classPrivateFieldGet(_editor2,_this13)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:_classPrivateGetter(_AltText_brand,_this13,_get_label)}});}};altText.addEventListener("click",onClick,{capture:true,signal:signal});altText.addEventListener("keydown",function(event){if(event.target===altText&&event.key==="Enter"){_classPrivateFieldSet(_altTextWasFromKeyBoard,_this13,true);onClick(event);}},{signal:signal});_context9.n=1;return _assertClassBrand(_AltText_brand,this,_setState).call(this);case 1:return _context9.a(2,altText);}},_callee9,this);}));function render(){return _render2.apply(this,arguments);}return render;}()},{key:"finish",value:function finish(){if(!_classPrivateFieldGet(_altTextButton,this)){return;}_classPrivateFieldGet(_altTextButton,this).focus({focusVisible:_classPrivateFieldGet(_altTextWasFromKeyBoard,this)});_classPrivateFieldSet(_altTextWasFromKeyBoard,this,false);}},{key:"isEmpty",value:function isEmpty(){if(_classPrivateFieldGet(_useNewAltTextFlow,this)){return _classPrivateFieldGet(_altText2,this)===null;}return!_classPrivateFieldGet(_altText2,this)&&!_classPrivateFieldGet(_altTextDecorative,this);}},{key:"hasData",value:function hasData(){if(_classPrivateFieldGet(_useNewAltTextFlow,this)){return _classPrivateFieldGet(_altText2,this)!==null||!!_classPrivateFieldGet(_guessedText,this);}return this.isEmpty();}},{key:"guessedText",get:function get(){return _classPrivateFieldGet(_guessedText,this);}},{key:"setGuessedText",value:function(){var _setGuessedText=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0(guessedText){var _t0,_t1,_t10,_t11;return _regenerator().w(function(_context0){while(1)switch(_context0.n){case 0:if(!(_classPrivateFieldGet(_altText2,this)!==null)){_context0.n=1;break;}return _context0.a(2);case 1:_classPrivateFieldSet(_guessedText,this,guessedText);_t0=_classPrivateFieldSet;_t1=_textWithDisclaimer;_t10=this;_context0.n=2;return AltText._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:guessedText});case 2:_t11=_context0.v;_t0(_t1,_t10,_t11);_assertClassBrand(_AltText_brand,this,_setState).call(this);case 3:return _context0.a(2);}},_callee0,this);}));function setGuessedText(_x10){return _setGuessedText.apply(this,arguments);}return setGuessedText;}()},{key:"toggleAltTextBadge",value:function toggleAltTextBadge(){var visibility=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!_classPrivateFieldGet(_useNewAltTextFlow,this)||_classPrivateFieldGet(_altText2,this)){var _classPrivateFieldGet32;(_classPrivateFieldGet32=_classPrivateFieldGet(_badge,this))===null||_classPrivateFieldGet32===void 0||_classPrivateFieldGet32.remove();_classPrivateFieldSet(_badge,this,null);return;}if(!_classPrivateFieldGet(_badge,this)){var badge=_classPrivateFieldSet(_badge,this,document.createElement("div"));badge.className="noAltTextBadge";_classPrivateFieldGet(_editor2,this).div.append(badge);}_classPrivateFieldGet(_badge,this).classList.toggle("hidden",!visibility);}},{key:"serialize",value:function serialize(isForCopying){var altText=_classPrivateFieldGet(_altText2,this);if(!isForCopying&&_classPrivateFieldGet(_guessedText,this)===altText){altText=_classPrivateFieldGet(_textWithDisclaimer,this);}return{altText:altText,decorative:_classPrivateFieldGet(_altTextDecorative,this),guessedText:_classPrivateFieldGet(_guessedText,this),textWithDisclaimer:_classPrivateFieldGet(_textWithDisclaimer,this)};}},{key:"data",get:function get(){return{altText:_classPrivateFieldGet(_altText2,this),decorative:_classPrivateFieldGet(_altTextDecorative,this)};},set:function set(_ref14){var altText=_ref14.altText,decorative=_ref14.decorative,guessedText=_ref14.guessedText,textWithDisclaimer=_ref14.textWithDisclaimer,_ref14$cancel=_ref14.cancel,cancel=_ref14$cancel===void 0?false:_ref14$cancel;if(guessedText){_classPrivateFieldSet(_guessedText,this,guessedText);_classPrivateFieldSet(_textWithDisclaimer,this,textWithDisclaimer);}if(_classPrivateFieldGet(_altText2,this)===altText&&_classPrivateFieldGet(_altTextDecorative,this)===decorative){return;}if(!cancel){_classPrivateFieldSet(_altText2,this,altText);_classPrivateFieldSet(_altTextDecorative,this,decorative);}_assertClassBrand(_AltText_brand,this,_setState).call(this);}},{key:"toggle",value:function toggle(){var enabled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!_classPrivateFieldGet(_altTextButton,this)){return;}if(!enabled&&_classPrivateFieldGet(_altTextTooltipTimeout,this)){clearTimeout(_classPrivateFieldGet(_altTextTooltipTimeout,this));_classPrivateFieldSet(_altTextTooltipTimeout,this,null);}_classPrivateFieldGet(_altTextButton,this).disabled=!enabled;}},{key:"shown",value:function shown(){_classPrivateFieldGet(_editor2,this)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:_classPrivateGetter(_AltText_brand,this,_get_label)}});}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet33,_classPrivateFieldGet34;(_classPrivateFieldGet33=_classPrivateFieldGet(_altTextButton,this))===null||_classPrivateFieldGet33===void 0||_classPrivateFieldGet33.remove();_classPrivateFieldSet(_altTextButton,this,null);_classPrivateFieldSet(_altTextButtonLabel,this,null);_classPrivateFieldSet(_altTextTooltip,this,null);(_classPrivateFieldGet34=_classPrivateFieldGet(_badge,this))===null||_classPrivateFieldGet34===void 0||_classPrivateFieldGet34.remove();_classPrivateFieldSet(_badge,this,null);}}],[{key:"initialize",value:function initialize(l10n){var _AltText$_l10n;(_AltText$_l10n=AltText._l10n)!==null&&_AltText$_l10n!==void 0?_AltText$_l10n:AltText._l10n=l10n;}}]);}();function _get_label(_this12){return _classPrivateFieldGet(_altText2,_this12)&&"added"||_classPrivateFieldGet(_altText2,_this12)===null&&_this12.guessedText&&"review"||"missing";}function _setState(){return _setState2.apply(this,arguments);}function _setState2(){_setState2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee66(){var _this121=this;var button,_classPrivateFieldGet178,_classPrivateFieldGet179,_classPrivateFieldGet180,tooltip,DELAY_TO_SHOW_TOOLTIP,signal,element;return _regenerator().w(function(_context67){while(1)switch(_context67.n){case 0:button=_classPrivateFieldGet(_altTextButton,this);if(button){_context67.n=1;break;}return _context67.a(2);case 1:if(!_classPrivateFieldGet(_useNewAltTextFlow,this)){_context67.n=3;break;}button.classList.toggle("done",!!_classPrivateFieldGet(_altText2,this));button.setAttribute("data-l10n-id",_l10nNewButton._[_classPrivateGetter(_AltText_brand,this,_get_label)]);(_classPrivateFieldGet178=_classPrivateFieldGet(_altTextButtonLabel,this))===null||_classPrivateFieldGet178===void 0||_classPrivateFieldGet178.setAttribute("data-l10n-id",_l10nNewButton._["".concat(_classPrivateGetter(_AltText_brand,this,_get_label),"-label")]);if(_classPrivateFieldGet(_altText2,this)){_context67.n=2;break;}(_classPrivateFieldGet179=_classPrivateFieldGet(_altTextTooltip,this))===null||_classPrivateFieldGet179===void 0||_classPrivateFieldGet179.remove();return _context67.a(2);case 2:_context67.n=5;break;case 3:if(!(!_classPrivateFieldGet(_altText2,this)&&!_classPrivateFieldGet(_altTextDecorative,this))){_context67.n=4;break;}button.classList.remove("done");(_classPrivateFieldGet180=_classPrivateFieldGet(_altTextTooltip,this))===null||_classPrivateFieldGet180===void 0||_classPrivateFieldGet180.remove();return _context67.a(2);case 4:button.classList.add("done");button.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button");case 5:tooltip=_classPrivateFieldGet(_altTextTooltip,this);if(!tooltip){_classPrivateFieldSet(_altTextTooltip,this,tooltip=document.createElement("span"));tooltip.className="tooltip";tooltip.setAttribute("role","tooltip");tooltip.id="alt-text-tooltip-".concat(_classPrivateFieldGet(_editor2,this).id);DELAY_TO_SHOW_TOOLTIP=100;signal=_classPrivateFieldGet(_editor2,this)._uiManager._signal;signal.addEventListener("abort",function(){clearTimeout(_classPrivateFieldGet(_altTextTooltipTimeout,_this121));_classPrivateFieldSet(_altTextTooltipTimeout,_this121,null);},{once:true});button.addEventListener("mouseenter",function(){_classPrivateFieldSet(_altTextTooltipTimeout,_this121,setTimeout(function(){_classPrivateFieldSet(_altTextTooltipTimeout,_this121,null);_classPrivateFieldGet(_altTextTooltip,_this121).classList.add("show");_classPrivateFieldGet(_editor2,_this121)._reportTelemetry({action:"alt_text_tooltip"});},DELAY_TO_SHOW_TOOLTIP));},{signal:signal});button.addEventListener("mouseleave",function(){var _classPrivateFieldGet181;if(_classPrivateFieldGet(_altTextTooltipTimeout,_this121)){clearTimeout(_classPrivateFieldGet(_altTextTooltipTimeout,_this121));_classPrivateFieldSet(_altTextTooltipTimeout,_this121,null);}(_classPrivateFieldGet181=_classPrivateFieldGet(_altTextTooltip,_this121))===null||_classPrivateFieldGet181===void 0||_classPrivateFieldGet181.classList.remove("show");},{signal:signal});}if(_classPrivateFieldGet(_altTextDecorative,this)){tooltip.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip");}else{tooltip.removeAttribute("data-l10n-id");tooltip.textContent=_classPrivateFieldGet(_altText2,this);}if(!tooltip.parentNode){button.append(tooltip);}element=_classPrivateFieldGet(_editor2,this).getElementForAltText();element===null||element===void 0||element.setAttribute("aria-describedby",tooltip.id);case 6:return _context67.a(2);}},_callee66,this);}));return _setState2.apply(this,arguments);}var _l10nNewButton={_:null};_defineProperty(AltText,"_l10n",null);;// ./src/display/touch_manager.js
var _container2=/*#__PURE__*/new WeakMap();var _isPinching=/*#__PURE__*/new WeakMap();var _isPinchingStopped=/*#__PURE__*/new WeakMap();var _isPinchingDisabled=/*#__PURE__*/new WeakMap();var _onPinchStart=/*#__PURE__*/new WeakMap();var _onPinching=/*#__PURE__*/new WeakMap();var _onPinchEnd=/*#__PURE__*/new WeakMap();var _pointerDownAC=/*#__PURE__*/new WeakMap();var _signal2=/*#__PURE__*/new WeakMap();var _touchInfo=/*#__PURE__*/new WeakMap();var _touchManagerAC=/*#__PURE__*/new WeakMap();var _touchMoveAC=/*#__PURE__*/new WeakMap();var _TouchManager_brand=/*#__PURE__*/new WeakSet();var _TouchManager=/*#__PURE__*/function(){function _TouchManager(_ref15){var _container3=_ref15.container,_ref15$isPinchingDisa=_ref15.isPinchingDisabled,isPinchingDisabled=_ref15$isPinchingDisa===void 0?null:_ref15$isPinchingDisa,_ref15$isPinchingStop=_ref15.isPinchingStopped,isPinchingStopped=_ref15$isPinchingStop===void 0?null:_ref15$isPinchingStop,_ref15$onPinchStart=_ref15.onPinchStart,onPinchStart=_ref15$onPinchStart===void 0?null:_ref15$onPinchStart,_ref15$onPinching=_ref15.onPinching,onPinching=_ref15$onPinching===void 0?null:_ref15$onPinching,_ref15$onPinchEnd=_ref15.onPinchEnd,onPinchEnd=_ref15$onPinchEnd===void 0?null:_ref15$onPinchEnd,_signal3=_ref15.signal;_classCallCheck(this,_TouchManager);_classPrivateMethodInitSpec(this,_TouchManager_brand);_classPrivateFieldInitSpec(this,_container2,void 0);_classPrivateFieldInitSpec(this,_isPinching,false);_classPrivateFieldInitSpec(this,_isPinchingStopped,null);_classPrivateFieldInitSpec(this,_isPinchingDisabled,void 0);_classPrivateFieldInitSpec(this,_onPinchStart,void 0);_classPrivateFieldInitSpec(this,_onPinching,void 0);_classPrivateFieldInitSpec(this,_onPinchEnd,void 0);_classPrivateFieldInitSpec(this,_pointerDownAC,null);_classPrivateFieldInitSpec(this,_signal2,void 0);_classPrivateFieldInitSpec(this,_touchInfo,null);_classPrivateFieldInitSpec(this,_touchManagerAC,void 0);_classPrivateFieldInitSpec(this,_touchMoveAC,null);_classPrivateFieldSet(_container2,this,_container3);_classPrivateFieldSet(_isPinchingStopped,this,isPinchingStopped);_classPrivateFieldSet(_isPinchingDisabled,this,isPinchingDisabled);_classPrivateFieldSet(_onPinchStart,this,onPinchStart);_classPrivateFieldSet(_onPinching,this,onPinching);_classPrivateFieldSet(_onPinchEnd,this,onPinchEnd);_classPrivateFieldSet(_touchManagerAC,this,new AbortController());_classPrivateFieldSet(_signal2,this,AbortSignal.any([_signal3,_classPrivateFieldGet(_touchManagerAC,this).signal]));_container3.addEventListener("touchstart",_assertClassBrand(_TouchManager_brand,this,_onTouchStart).bind(this),{passive:false,signal:_classPrivateFieldGet(_signal2,this)});}return _createClass(_TouchManager,[{key:"MIN_TOUCH_DISTANCE_TO_PINCH",get:function get(){return 35/_OutputScale.pixelRatio;}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet35,_classPrivateFieldGet36;(_classPrivateFieldGet35=_classPrivateFieldGet(_touchManagerAC,this))===null||_classPrivateFieldGet35===void 0||_classPrivateFieldGet35.abort();_classPrivateFieldSet(_touchManagerAC,this,null);(_classPrivateFieldGet36=_classPrivateFieldGet(_pointerDownAC,this))===null||_classPrivateFieldGet36===void 0||_classPrivateFieldGet36.abort();_classPrivateFieldSet(_pointerDownAC,this,null);}}]);}();_TouchManager2=_TouchManager;function _onTouchStart(evt){var _classPrivateFieldGet136,_this110=this,_classPrivateFieldGet139;if((_classPrivateFieldGet136=_classPrivateFieldGet(_isPinchingDisabled,this))!==null&&_classPrivateFieldGet136!==void 0&&_classPrivateFieldGet136.call(this)){return;}if(evt.touches.length===1){if(_classPrivateFieldGet(_pointerDownAC,this)){return;}var pointerDownAC=_classPrivateFieldSet(_pointerDownAC,this,new AbortController());var signal=AbortSignal.any([_classPrivateFieldGet(_signal2,this),pointerDownAC.signal]);var container=_classPrivateFieldGet(_container2,this);var opts={capture:true,signal:signal,passive:false};var cancelPointerDown=function cancelPointerDown(e){if(e.pointerType==="touch"){var _classPrivateFieldGet137;(_classPrivateFieldGet137=_classPrivateFieldGet(_pointerDownAC,_this110))===null||_classPrivateFieldGet137===void 0||_classPrivateFieldGet137.abort();_classPrivateFieldSet(_pointerDownAC,_this110,null);}};container.addEventListener("pointerdown",function(e){if(e.pointerType==="touch"){_stopEvent(e);cancelPointerDown(e);}},opts);container.addEventListener("pointerup",cancelPointerDown,opts);container.addEventListener("pointercancel",cancelPointerDown,opts);return;}if(!_classPrivateFieldGet(_touchMoveAC,this)){var _classPrivateFieldGet138;_classPrivateFieldSet(_touchMoveAC,this,new AbortController());var _signal4=AbortSignal.any([_classPrivateFieldGet(_signal2,this),_classPrivateFieldGet(_touchMoveAC,this).signal]);var _container6=_classPrivateFieldGet(_container2,this);var opt={signal:_signal4,capture:false,passive:false};_container6.addEventListener("touchmove",_assertClassBrand(_TouchManager_brand,this,_onTouchMove).bind(this),opt);var onTouchEnd=_assertClassBrand(_TouchManager_brand,this,_onTouchEnd).bind(this);_container6.addEventListener("touchend",onTouchEnd,opt);_container6.addEventListener("touchcancel",onTouchEnd,opt);opt.capture=true;_container6.addEventListener("pointerdown",_stopEvent,opt);_container6.addEventListener("pointermove",_stopEvent,opt);_container6.addEventListener("pointercancel",_stopEvent,opt);_container6.addEventListener("pointerup",_stopEvent,opt);(_classPrivateFieldGet138=_classPrivateFieldGet(_onPinchStart,this))===null||_classPrivateFieldGet138===void 0||_classPrivateFieldGet138.call(this);}_stopEvent(evt);if(evt.touches.length!==2||(_classPrivateFieldGet139=_classPrivateFieldGet(_isPinchingStopped,this))!==null&&_classPrivateFieldGet139!==void 0&&_classPrivateFieldGet139.call(this)){_classPrivateFieldSet(_touchInfo,this,null);return;}var _evt$touches=_slicedToArray(evt.touches,2),touch0=_evt$touches[0],touch1=_evt$touches[1];if(touch0.identifier>touch1.identifier){var _ref136=[touch1,touch0];touch0=_ref136[0];touch1=_ref136[1];}_classPrivateFieldSet(_touchInfo,this,{touch0X:touch0.screenX,touch0Y:touch0.screenY,touch1X:touch1.screenX,touch1Y:touch1.screenY});}function _onTouchMove(evt){var _classPrivateFieldGet140;if(!_classPrivateFieldGet(_touchInfo,this)||evt.touches.length!==2){return;}_stopEvent(evt);var _evt$touches2=_slicedToArray(evt.touches,2),touch0=_evt$touches2[0],touch1=_evt$touches2[1];if(touch0.identifier>touch1.identifier){var _ref137=[touch1,touch0];touch0=_ref137[0];touch1=_ref137[1];}var _touch=touch0,screen0X=_touch.screenX,screen0Y=_touch.screenY;var _touch2=touch1,screen1X=_touch2.screenX,screen1Y=_touch2.screenY;var touchInfo=_classPrivateFieldGet(_touchInfo,this);var pTouch0X=touchInfo.touch0X,pTouch0Y=touchInfo.touch0Y,pTouch1X=touchInfo.touch1X,pTouch1Y=touchInfo.touch1Y;var prevGapX=pTouch1X-pTouch0X;var prevGapY=pTouch1Y-pTouch0Y;var currGapX=screen1X-screen0X;var currGapY=screen1Y-screen0Y;var distance=Math.hypot(currGapX,currGapY)||1;var pDistance=Math.hypot(prevGapX,prevGapY)||1;if(!_classPrivateFieldGet(_isPinching,this)&&Math.abs(pDistance-distance)<=_TouchManager2.MIN_TOUCH_DISTANCE_TO_PINCH){return;}touchInfo.touch0X=screen0X;touchInfo.touch0Y=screen0Y;touchInfo.touch1X=screen1X;touchInfo.touch1Y=screen1Y;if(!_classPrivateFieldGet(_isPinching,this)){_classPrivateFieldSet(_isPinching,this,true);return;}var origin=[(screen0X+screen1X)/2,(screen0Y+screen1Y)/2];(_classPrivateFieldGet140=_classPrivateFieldGet(_onPinching,this))===null||_classPrivateFieldGet140===void 0||_classPrivateFieldGet140.call(this,origin,pDistance,distance);}function _onTouchEnd(evt){var _classPrivateFieldGet141;if(evt.touches.length>=2){return;}_classPrivateFieldGet(_touchMoveAC,this).abort();_classPrivateFieldSet(_touchMoveAC,this,null);(_classPrivateFieldGet141=_classPrivateFieldGet(_onPinchEnd,this))===null||_classPrivateFieldGet141===void 0||_classPrivateFieldGet141.call(this);if(!_classPrivateFieldGet(_touchInfo,this)){return;}_stopEvent(evt);_classPrivateFieldSet(_touchInfo,this,null);_classPrivateFieldSet(_isPinching,this,false);};// ./src/display/editor/editor.js
var _accessibilityData=/*#__PURE__*/new WeakMap();var _allResizerDivs=/*#__PURE__*/new WeakMap();var _altText3=/*#__PURE__*/new WeakMap();var _disabled=/*#__PURE__*/new WeakMap();var _dragPointerId=/*#__PURE__*/new WeakMap();var _dragPointerType=/*#__PURE__*/new WeakMap();var _keepAspectRatio=/*#__PURE__*/new WeakMap();var _resizersDiv=/*#__PURE__*/new WeakMap();var _lastPointerCoords=/*#__PURE__*/new WeakMap();var _savedDimensions=/*#__PURE__*/new WeakMap();var _focusAC=/*#__PURE__*/new WeakMap();var _focusedResizerName=/*#__PURE__*/new WeakMap();var _hasBeenClicked=/*#__PURE__*/new WeakMap();var _initialRect=/*#__PURE__*/new WeakMap();var _isEditing=/*#__PURE__*/new WeakMap();var _isInEditMode=/*#__PURE__*/new WeakMap();var _isResizerEnabledForKeyboard=/*#__PURE__*/new WeakMap();var _moveInDOMTimeout=/*#__PURE__*/new WeakMap();var _prevDragX=/*#__PURE__*/new WeakMap();var _prevDragY=/*#__PURE__*/new WeakMap();var _telemetryTimeouts=/*#__PURE__*/new WeakMap();var _touchManager=/*#__PURE__*/new WeakMap();var _isDraggable=/*#__PURE__*/new WeakMap();var _zIndex=/*#__PURE__*/new WeakMap();var _AnnotationEditor_brand=/*#__PURE__*/new WeakSet();var AnnotationEditor=/*#__PURE__*/function(){function AnnotationEditor(parameters){_classCallCheck(this,AnnotationEditor);_classPrivateMethodInitSpec(this,_AnnotationEditor_brand);_classPrivateFieldInitSpec(this,_accessibilityData,null);_classPrivateFieldInitSpec(this,_allResizerDivs,null);_classPrivateFieldInitSpec(this,_altText3,null);_classPrivateFieldInitSpec(this,_disabled,false);_classPrivateFieldInitSpec(this,_dragPointerId,null);_classPrivateFieldInitSpec(this,_dragPointerType,"");_classPrivateFieldInitSpec(this,_keepAspectRatio,false);_classPrivateFieldInitSpec(this,_resizersDiv,null);_classPrivateFieldInitSpec(this,_lastPointerCoords,null);_classPrivateFieldInitSpec(this,_savedDimensions,null);_classPrivateFieldInitSpec(this,_focusAC,null);_classPrivateFieldInitSpec(this,_focusedResizerName,"");_classPrivateFieldInitSpec(this,_hasBeenClicked,false);_classPrivateFieldInitSpec(this,_initialRect,null);_classPrivateFieldInitSpec(this,_isEditing,false);_classPrivateFieldInitSpec(this,_isInEditMode,false);_classPrivateFieldInitSpec(this,_isResizerEnabledForKeyboard,false);_classPrivateFieldInitSpec(this,_moveInDOMTimeout,null);_classPrivateFieldInitSpec(this,_prevDragX,0);_classPrivateFieldInitSpec(this,_prevDragY,0);_classPrivateFieldInitSpec(this,_telemetryTimeouts,null);_classPrivateFieldInitSpec(this,_touchManager,null);_defineProperty(this,"_isCopy",false);_defineProperty(this,"_editToolbar",null);_defineProperty(this,"_initialOptions",Object.create(null));_defineProperty(this,"_initialData",null);_defineProperty(this,"_isVisible",true);_defineProperty(this,"_uiManager",null);_defineProperty(this,"_focusEventsAllowed",true);_classPrivateFieldInitSpec(this,_isDraggable,false);_classPrivateFieldInitSpec(this,_zIndex,AnnotationEditor._zIndex++);this.parent=parameters.parent;this.id=parameters.id;this.width=this.height=null;this.pageIndex=parameters.parent.pageIndex;this.name=parameters.name;this.div=null;this._uiManager=parameters.uiManager;this.annotationElementId=null;this._willKeepAspectRatio=false;this._initialOptions.isCentered=parameters.isCentered;this._structTreeParentId=null;var _this$parent$viewport=this.parent.viewport,_rotation2=_this$parent$viewport.rotation,_this$parent$viewport2=_this$parent$viewport.rawDims,_pageWidth2=_this$parent$viewport2.pageWidth,_pageHeight2=_this$parent$viewport2.pageHeight,pageX=_this$parent$viewport2.pageX,pageY=_this$parent$viewport2.pageY;this.rotation=_rotation2;this.pageRotation=(360+_rotation2-this._uiManager.viewParameters.rotation)%360;this.pageDimensions=[_pageWidth2,_pageHeight2];this.pageTranslation=[pageX,pageY];var _this$parentDimension=_slicedToArray(this.parentDimensions,2),_width=_this$parentDimension[0],_height=_this$parentDimension[1];this.x=parameters.x/_width;this.y=parameters.y/_height;this.isAttachedToDOM=false;this.deleted=false;}return _createClass(AnnotationEditor,[{key:"editorType",get:function get(){return Object.getPrototypeOf(this).constructor._type;}},{key:"propertiesToUpdate",get:function get(){return[];}},{key:"_isDraggable",get:function get(){return _classPrivateFieldGet(_isDraggable,this);},set:function set(value){var _this$div;_classPrivateFieldSet(_isDraggable,this,value);(_this$div=this.div)===null||_this$div===void 0||_this$div.classList.toggle("draggable",value);}},{key:"isEnterHandled",get:function get(){return true;}},{key:"center",value:function center(){var _this$pageDimensions=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions[0],pageHeight=_this$pageDimensions[1];switch(this.parentRotation){case 90:this.x-=this.height*pageHeight/(pageWidth*2);this.y+=this.width*pageWidth/(pageHeight*2);break;case 180:this.x+=this.width/2;this.y+=this.height/2;break;case 270:this.x+=this.height*pageHeight/(pageWidth*2);this.y-=this.width*pageWidth/(pageHeight*2);break;default:this.x-=this.width/2;this.y-=this.height/2;break;}this.fixAndSetPosition();}},{key:"addCommands",value:function addCommands(params){this._uiManager.addCommands(params);}},{key:"currentLayer",get:function get(){return this._uiManager.currentLayer;}},{key:"setInBackground",value:function setInBackground(){this.div.style.zIndex=0;}},{key:"setInForeground",value:function setInForeground(){this.div.style.zIndex=_classPrivateFieldGet(_zIndex,this);}},{key:"setParent",value:function setParent(parent){if(parent!==null){this.pageIndex=parent.pageIndex;this.pageDimensions=parent.pageDimensions;}else{_assertClassBrand(_AnnotationEditor_brand,this,_stopResizing).call(this);}this.parent=parent;}},{key:"focusin",value:function focusin(event){if(!this._focusEventsAllowed){return;}if(!_classPrivateFieldGet(_hasBeenClicked,this)){this.parent.setSelected(this);}else{_classPrivateFieldSet(_hasBeenClicked,this,false);}}},{key:"focusout",value:function focusout(event){var _this$parent;if(!this._focusEventsAllowed){return;}if(!this.isAttachedToDOM){return;}var target=event.relatedTarget;if(target!==null&&target!==void 0&&target.closest("#".concat(this.id))){return;}event.preventDefault();if(!((_this$parent=this.parent)!==null&&_this$parent!==void 0&&_this$parent.isMultipleSelection)){this.commitOrRemove();}}},{key:"commitOrRemove",value:function commitOrRemove(){if(this.isEmpty()){this.remove();}else{this.commit();}}},{key:"commit",value:function commit(){this.addToAnnotationStorage();}},{key:"addToAnnotationStorage",value:function addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this);}},{key:"setAt",value:function setAt(x,y,tx,ty){var _this$parentDimension2=_slicedToArray(this.parentDimensions,2),width=_this$parentDimension2[0],height=_this$parentDimension2[1];var _this$screenToPageTra=this.screenToPageTranslation(tx,ty);var _this$screenToPageTra2=_slicedToArray(_this$screenToPageTra,2);tx=_this$screenToPageTra2[0];ty=_this$screenToPageTra2[1];this.x=(x+tx)/width;this.y=(y+ty)/height;this.fixAndSetPosition();}},{key:"_moveAfterPaste",value:function _moveAfterPaste(baseX,baseY){var _this$parentDimension3=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension3[0],parentHeight=_this$parentDimension3[1];this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight);this._onTranslated();}},{key:"translate",value:function translate(x,y){_assertClassBrand(_AnnotationEditor_brand,this,_translate).call(this,this.parentDimensions,x,y);}},{key:"translateInPage",value:function translateInPage(x,y){_classPrivateFieldGet(_initialRect,this)||_classPrivateFieldSet(_initialRect,this,[this.x,this.y,this.width,this.height]);_assertClassBrand(_AnnotationEditor_brand,this,_translate).call(this,this.pageDimensions,x,y);this.div.scrollIntoView({block:"nearest"});}},{key:"translationDone",value:function translationDone(){this._onTranslated(this.x,this.y);}},{key:"drag",value:function drag(tx,ty){_classPrivateFieldGet(_initialRect,this)||_classPrivateFieldSet(_initialRect,this,[this.x,this.y,this.width,this.height]);var div=this.div,_this$parentDimension4=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension4[0],parentHeight=_this$parentDimension4[1];this.x+=tx/parentWidth;this.y+=ty/parentHeight;if(this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){var _this$div$getBounding=this.div.getBoundingClientRect(),_x11=_this$div$getBounding.x,_y2=_this$div$getBounding.y;if(this.parent.findNewParent(this,_x11,_y2)){this.x-=Math.floor(this.x);this.y-=Math.floor(this.y);}}var x=this.x,y=this.y;var _this$getBaseTranslat=this.getBaseTranslation(),_this$getBaseTranslat2=_slicedToArray(_this$getBaseTranslat,2),bx=_this$getBaseTranslat2[0],by=_this$getBaseTranslat2[1];x+=bx;y+=by;var style=div.style;style.left="".concat((100*x).toFixed(2),"%");style.top="".concat((100*y).toFixed(2),"%");this._onTranslating(x,y);div.scrollIntoView({block:"nearest"});}},{key:"_onTranslating",value:function _onTranslating(x,y){}},{key:"_onTranslated",value:function _onTranslated(x,y){}},{key:"_hasBeenMoved",get:function get(){return!!_classPrivateFieldGet(_initialRect,this)&&(_classPrivateFieldGet(_initialRect,this)[0]!==this.x||_classPrivateFieldGet(_initialRect,this)[1]!==this.y);}},{key:"_hasBeenResized",get:function get(){return!!_classPrivateFieldGet(_initialRect,this)&&(_classPrivateFieldGet(_initialRect,this)[2]!==this.width||_classPrivateFieldGet(_initialRect,this)[3]!==this.height);}},{key:"getBaseTranslation",value:function getBaseTranslation(){var _this$parentDimension5=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension5[0],parentHeight=_this$parentDimension5[1];var _borderLineWidth=AnnotationEditor._borderLineWidth;var x=_borderLineWidth/parentWidth;var y=_borderLineWidth/parentHeight;switch(this.rotation){case 90:return[-x,y];case 180:return[x,y];case 270:return[x,-y];default:return[-x,-y];}}},{key:"_mustFixPosition",get:function get(){return true;}},{key:"fixAndSetPosition",value:function fixAndSetPosition(){var rotation=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.rotation;var style=this.div.style,_this$pageDimensions2=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions2[0],pageHeight=_this$pageDimensions2[1];var x=this.x,y=this.y,width=this.width,height=this.height;width*=pageWidth;height*=pageHeight;x*=pageWidth;y*=pageHeight;if(this._mustFixPosition){switch(rotation){case 0:x=_MathClamp(x,0,pageWidth-width);y=_MathClamp(y,0,pageHeight-height);break;case 90:x=_MathClamp(x,0,pageWidth-height);y=_MathClamp(y,width,pageHeight);break;case 180:x=_MathClamp(x,width,pageWidth);y=_MathClamp(y,height,pageHeight);break;case 270:x=_MathClamp(x,height,pageWidth);y=_MathClamp(y,0,pageHeight-width);break;}}this.x=x/=pageWidth;this.y=y/=pageHeight;var _this$getBaseTranslat3=this.getBaseTranslation(),_this$getBaseTranslat4=_slicedToArray(_this$getBaseTranslat3,2),bx=_this$getBaseTranslat4[0],by=_this$getBaseTranslat4[1];x+=bx;y+=by;style.left="".concat((100*x).toFixed(2),"%");style.top="".concat((100*y).toFixed(2),"%");this.moveInDOM();}},{key:"screenToPageTranslation",value:function screenToPageTranslation(x,y){return _rotatePoint.call(AnnotationEditor,x,y,this.parentRotation);}},{key:"pageTranslationToScreen",value:function pageTranslationToScreen(x,y){return _rotatePoint.call(AnnotationEditor,x,y,360-this.parentRotation);}},{key:"parentScale",get:function get(){return this._uiManager.viewParameters.realScale;}},{key:"parentRotation",get:function get(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360;}},{key:"parentDimensions",get:function get(){var parentScale=this.parentScale,_this$pageDimensions3=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions3[0],pageHeight=_this$pageDimensions3[1];return[pageWidth*parentScale,pageHeight*parentScale];}},{key:"setDims",value:function setDims(width,height){var _this$parentDimension6=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension6[0],parentHeight=_this$parentDimension6[1];var style=this.div.style;style.width="".concat((100*width/parentWidth).toFixed(2),"%");if(!_classPrivateFieldGet(_keepAspectRatio,this)){style.height="".concat((100*height/parentHeight).toFixed(2),"%");}}},{key:"fixDims",value:function fixDims(){var style=this.div.style;var height=style.height,width=style.width;var widthPercent=width.endsWith("%");var heightPercent=!_classPrivateFieldGet(_keepAspectRatio,this)&&height.endsWith("%");if(widthPercent&&heightPercent){return;}var _this$parentDimension7=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension7[0],parentHeight=_this$parentDimension7[1];if(!widthPercent){style.width="".concat((100*parseFloat(width)/parentWidth).toFixed(2),"%");}if(!_classPrivateFieldGet(_keepAspectRatio,this)&&!heightPercent){style.height="".concat((100*parseFloat(height)/parentHeight).toFixed(2),"%");}}},{key:"getInitialTranslation",value:function getInitialTranslation(){return[0,0];}},{key:"_onResized",value:function _onResized(){}},{key:"_onResizing",value:function _onResizing(){}},{key:"altTextFinish",value:function altTextFinish(){var _classPrivateFieldGet37;(_classPrivateFieldGet37=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet37===void 0||_classPrivateFieldGet37.finish();}},{key:"addEditToolbar",value:function(){var _addEditToolbar=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee1(){return _regenerator().w(function(_context1){while(1)switch(_context1.n){case 0:if(!(this._editToolbar||_classPrivateFieldGet(_isInEditMode,this))){_context1.n=1;break;}return _context1.a(2,this._editToolbar);case 1:this._editToolbar=new EditorToolbar(this);this.div.append(this._editToolbar.render());if(!_classPrivateFieldGet(_altText3,this)){_context1.n=2;break;}_context1.n=2;return this._editToolbar.addAltText(_classPrivateFieldGet(_altText3,this));case 2:return _context1.a(2,this._editToolbar);}},_callee1,this);}));function addEditToolbar(){return _addEditToolbar.apply(this,arguments);}return addEditToolbar;}()},{key:"removeEditToolbar",value:function removeEditToolbar(){var _classPrivateFieldGet38;if(!this._editToolbar){return;}this._editToolbar.remove();this._editToolbar=null;(_classPrivateFieldGet38=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet38===void 0||_classPrivateFieldGet38.destroy();}},{key:"addContainer",value:function addContainer(container){var _this$_editToolbar;var editToolbarDiv=(_this$_editToolbar=this._editToolbar)===null||_this$_editToolbar===void 0?void 0:_this$_editToolbar.div;if(editToolbarDiv){editToolbarDiv.before(container);}else{this.div.append(container);}}},{key:"getClientDimensions",value:function getClientDimensions(){return this.div.getBoundingClientRect();}},{key:"addAltTextButton",value:function(){var _addAltTextButton=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee10(){return _regenerator().w(function(_context10){while(1)switch(_context10.n){case 0:if(!_classPrivateFieldGet(_altText3,this)){_context10.n=1;break;}return _context10.a(2);case 1:AltText.initialize(AnnotationEditor._l10n);_classPrivateFieldSet(_altText3,this,new AltText(this));if(_classPrivateFieldGet(_accessibilityData,this)){_classPrivateFieldGet(_altText3,this).data=_classPrivateFieldGet(_accessibilityData,this);_classPrivateFieldSet(_accessibilityData,this,null);}_context10.n=2;return this.addEditToolbar();case 2:return _context10.a(2);}},_callee10,this);}));function addAltTextButton(){return _addAltTextButton.apply(this,arguments);}return addAltTextButton;}()},{key:"altTextData",get:function get(){var _classPrivateFieldGet39;return(_classPrivateFieldGet39=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet39===void 0?void 0:_classPrivateFieldGet39.data;},set:function set(data){if(!_classPrivateFieldGet(_altText3,this)){return;}_classPrivateFieldGet(_altText3,this).data=data;}},{key:"guessedAltText",get:function get(){var _classPrivateFieldGet40;return(_classPrivateFieldGet40=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet40===void 0?void 0:_classPrivateFieldGet40.guessedText;}},{key:"setGuessedAltText",value:function(){var _setGuessedAltText=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee11(text){var _classPrivateFieldGet41;return _regenerator().w(function(_context11){while(1)switch(_context11.n){case 0:_context11.n=1;return(_classPrivateFieldGet41=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet41===void 0?void 0:_classPrivateFieldGet41.setGuessedText(text);case 1:return _context11.a(2);}},_callee11,this);}));function setGuessedAltText(_x12){return _setGuessedAltText.apply(this,arguments);}return setGuessedAltText;}()},{key:"serializeAltText",value:function serializeAltText(isForCopying){var _classPrivateFieldGet42;return(_classPrivateFieldGet42=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet42===void 0?void 0:_classPrivateFieldGet42.serialize(isForCopying);}},{key:"hasAltText",value:function hasAltText(){return!!_classPrivateFieldGet(_altText3,this)&&!_classPrivateFieldGet(_altText3,this).isEmpty();}},{key:"hasAltTextData",value:function hasAltTextData(){var _classPrivateFieldGet43,_classPrivateFieldGet44;return(_classPrivateFieldGet43=(_classPrivateFieldGet44=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet44===void 0?void 0:_classPrivateFieldGet44.hasData())!==null&&_classPrivateFieldGet43!==void 0?_classPrivateFieldGet43:false;}},{key:"render",value:function render(){var _this14=this,_this$_uiManager$_edi;var div=this.div=document.createElement("div");div.setAttribute("data-editor-rotation",(360-this.rotation)%360);div.className=this.name;div.setAttribute("id",this.id);div.tabIndex=_classPrivateFieldGet(_disabled,this)?-1:0;div.setAttribute("role","application");if(this.defaultL10nId){div.setAttribute("data-l10n-id",this.defaultL10nId);}if(!this._isVisible){div.classList.add("hidden");}this.setInForeground();_assertClassBrand(_AnnotationEditor_brand,this,_addFocusListeners).call(this);var _this$parentDimension8=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension8[0],parentHeight=_this$parentDimension8[1];if(this.parentRotation%180!==0){div.style.maxWidth="".concat((100*parentHeight/parentWidth).toFixed(2),"%");div.style.maxHeight="".concat((100*parentWidth/parentHeight).toFixed(2),"%");}var _this$getInitialTrans=this.getInitialTranslation(),_this$getInitialTrans2=_slicedToArray(_this$getInitialTrans,2),tx=_this$getInitialTrans2[0],ty=_this$getInitialTrans2[1];this.translate(tx,ty);bindEvents(this,div,["keydown","pointerdown"]);if(this.isResizable&&this._uiManager._supportsPinchToZoom){_classPrivateFieldGet(_touchManager,this)||_classPrivateFieldSet(_touchManager,this,new _TouchManager({container:div,isPinchingDisabled:function isPinchingDisabled(){return!_this14.isSelected;},onPinchStart:_assertClassBrand(_AnnotationEditor_brand,this,_touchPinchStartCallback).bind(this),onPinching:_assertClassBrand(_AnnotationEditor_brand,this,_touchPinchCallback).bind(this),onPinchEnd:_assertClassBrand(_AnnotationEditor_brand,this,_touchPinchEndCallback).bind(this),signal:this._uiManager._signal}));}(_this$_uiManager$_edi=this._uiManager._editorUndoBar)===null||_this$_uiManager$_edi===void 0||_this$_uiManager$_edi.hide();return div;}},{key:"pointerdown",value:function pointerdown(event){var isMac=util_FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){event.preventDefault();return;}_classPrivateFieldSet(_hasBeenClicked,this,true);if(this._isDraggable){_assertClassBrand(_AnnotationEditor_brand,this,_setUpDragSession).call(this,event);return;}_assertClassBrand(_AnnotationEditor_brand,this,_selectOnPointerEvent).call(this,event);}},{key:"isSelected",get:function get(){return this._uiManager.isSelected(this);}},{key:"_onStartDragging",value:function _onStartDragging(){}},{key:"_onStopDragging",value:function _onStopDragging(){}},{key:"moveInDOM",value:function moveInDOM(){var _this15=this;if(_classPrivateFieldGet(_moveInDOMTimeout,this)){clearTimeout(_classPrivateFieldGet(_moveInDOMTimeout,this));}_classPrivateFieldSet(_moveInDOMTimeout,this,setTimeout(function(){var _this15$parent;_classPrivateFieldSet(_moveInDOMTimeout,_this15,null);(_this15$parent=_this15.parent)===null||_this15$parent===void 0||_this15$parent.moveEditorInDOM(_this15);},0));}},{key:"_setParentAndPosition",value:function _setParentAndPosition(parent,x,y){parent.changeParent(this);this.x=x;this.y=y;this.fixAndSetPosition();this._onTranslated();}},{key:"getRect",value:function getRect(tx,ty){var rotation=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.rotation;var scale=this.parentScale;var _this$pageDimensions4=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions4[0],pageHeight=_this$pageDimensions4[1];var _this$pageTranslation=_slicedToArray(this.pageTranslation,2),pageX=_this$pageTranslation[0],pageY=_this$pageTranslation[1];var shiftX=tx/scale;var shiftY=ty/scale;var x=this.x*pageWidth;var y=this.y*pageHeight;var width=this.width*pageWidth;var height=this.height*pageHeight;switch(rotation){case 0:return[x+shiftX+pageX,pageHeight-y-shiftY-height+pageY,x+shiftX+width+pageX,pageHeight-y-shiftY+pageY];case 90:return[x+shiftY+pageX,pageHeight-y+shiftX+pageY,x+shiftY+height+pageX,pageHeight-y+shiftX+width+pageY];case 180:return[x-shiftX-width+pageX,pageHeight-y+shiftY+pageY,x-shiftX+pageX,pageHeight-y+shiftY+height+pageY];case 270:return[x-shiftY-height+pageX,pageHeight-y-shiftX-width+pageY,x-shiftY+pageX,pageHeight-y-shiftX+pageY];default:throw new Error("Invalid rotation");}}},{key:"getRectInCurrentCoords",value:function getRectInCurrentCoords(rect,pageHeight){var _rect=_slicedToArray(rect,4),x1=_rect[0],y1=_rect[1],x2=_rect[2],y2=_rect[3];var width=x2-x1;var height=y2-y1;switch(this.rotation){case 0:return[x1,pageHeight-y2,width,height];case 90:return[x1,pageHeight-y1,height,width];case 180:return[x2,pageHeight-y1,width,height];case 270:return[x2,pageHeight-y2,height,width];default:throw new Error("Invalid rotation");}}},{key:"onceAdded",value:function onceAdded(focus){}},{key:"isEmpty",value:function isEmpty(){return false;}},{key:"enableEditMode",value:function enableEditMode(){_classPrivateFieldSet(_isInEditMode,this,true);}},{key:"disableEditMode",value:function disableEditMode(){_classPrivateFieldSet(_isInEditMode,this,false);}},{key:"isInEditMode",value:function isInEditMode(){return _classPrivateFieldGet(_isInEditMode,this);}},{key:"shouldGetKeyboardEvents",value:function shouldGetKeyboardEvents(){return _classPrivateFieldGet(_isResizerEnabledForKeyboard,this);}},{key:"needsToBeRebuilt",value:function needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM;}},{key:"isOnScreen",get:function get(){var _this$getClientDimens=this.getClientDimensions(),top=_this$getClientDimens.top,left=_this$getClientDimens.left,bottom=_this$getClientDimens.bottom,right=_this$getClientDimens.right;var _window=window,innerHeight=_window.innerHeight,innerWidth=_window.innerWidth;return left<innerWidth&&right>0&&top<innerHeight&&bottom>0;}},{key:"rebuild",value:function rebuild(){_assertClassBrand(_AnnotationEditor_brand,this,_addFocusListeners).call(this);}},{key:"rotate",value:function rotate(_angle){}},{key:"resize",value:function resize(){}},{key:"serializeDeleted",value:function serializeDeleted(){var _this$_initialData;return{id:this.annotationElementId,deleted:true,pageIndex:this.pageIndex,popupRef:((_this$_initialData=this._initialData)===null||_this$_initialData===void 0?void 0:_this$_initialData.popupRef)||""};}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;unreachable("An editor must be serializable");}},{key:"hasBeenModified",get:function get(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null);}},{key:"remove",value:function remove(){var _classPrivateFieldGet45,_classPrivateFieldGet46;(_classPrivateFieldGet45=_classPrivateFieldGet(_focusAC,this))===null||_classPrivateFieldGet45===void 0||_classPrivateFieldGet45.abort();_classPrivateFieldSet(_focusAC,this,null);if(!this.isEmpty()){this.commit();}if(this.parent){this.parent.remove(this);}else{this._uiManager.removeEditor(this);}if(_classPrivateFieldGet(_moveInDOMTimeout,this)){clearTimeout(_classPrivateFieldGet(_moveInDOMTimeout,this));_classPrivateFieldSet(_moveInDOMTimeout,this,null);}_assertClassBrand(_AnnotationEditor_brand,this,_stopResizing).call(this);this.removeEditToolbar();if(_classPrivateFieldGet(_telemetryTimeouts,this)){var _iterator43=_createForOfIteratorHelper(_classPrivateFieldGet(_telemetryTimeouts,this).values()),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var timeout=_step43.value;clearTimeout(timeout);}}catch(err){_iterator43.e(err);}finally{_iterator43.f();}_classPrivateFieldSet(_telemetryTimeouts,this,null);}this.parent=null;(_classPrivateFieldGet46=_classPrivateFieldGet(_touchManager,this))===null||_classPrivateFieldGet46===void 0||_classPrivateFieldGet46.destroy();_classPrivateFieldSet(_touchManager,this,null);}},{key:"isResizable",get:function get(){return false;}},{key:"makeResizable",value:function makeResizable(){if(this.isResizable){_assertClassBrand(_AnnotationEditor_brand,this,_createResizers).call(this);_classPrivateFieldGet(_resizersDiv,this).classList.remove("hidden");}}},{key:"toolbarPosition",get:function get(){return null;}},{key:"keydown",value:function keydown(event){if(!this.isResizable||event.target!==this.div||event.key!=="Enter"){return;}this._uiManager.setSelected(this);_classPrivateFieldSet(_savedDimensions,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});var children=_classPrivateFieldGet(_resizersDiv,this).children;if(!_classPrivateFieldGet(_allResizerDivs,this)){_classPrivateFieldSet(_allResizerDivs,this,Array.from(children));var boundResizerKeydown=_assertClassBrand(_AnnotationEditor_brand,this,_resizerKeydown).bind(this);var boundResizerBlur=_assertClassBrand(_AnnotationEditor_brand,this,_resizerBlur).bind(this);var signal=this._uiManager._signal;var _iterator44=_createForOfIteratorHelper(_classPrivateFieldGet(_allResizerDivs,this)),_step44;try{for(_iterator44.s();!(_step44=_iterator44.n()).done;){var div=_step44.value;var name=div.getAttribute("data-resizer-name");div.setAttribute("role","spinbutton");div.addEventListener("keydown",boundResizerKeydown,{signal:signal});div.addEventListener("blur",boundResizerBlur,{signal:signal});div.addEventListener("focus",_assertClassBrand(_AnnotationEditor_brand,this,_resizerFocus).bind(this,name),{signal:signal});div.setAttribute("data-l10n-id",AnnotationEditor._l10nResizer[name]);}}catch(err){_iterator44.e(err);}finally{_iterator44.f();}}var first=_classPrivateFieldGet(_allResizerDivs,this)[0];var firstPosition=0;var _iterator45=_createForOfIteratorHelper(children),_step45;try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var _div2=_step45.value;if(_div2===first){break;}firstPosition++;}}catch(err){_iterator45.e(err);}finally{_iterator45.f();}var nextFirstPosition=(360-this.rotation+this.parentRotation)%360/90*(_classPrivateFieldGet(_allResizerDivs,this).length/4);if(nextFirstPosition!==firstPosition){if(nextFirstPosition<firstPosition){for(var _i4=0;_i4<firstPosition-nextFirstPosition;_i4++){_classPrivateFieldGet(_resizersDiv,this).append(_classPrivateFieldGet(_resizersDiv,this).firstChild);}}else if(nextFirstPosition>firstPosition){for(var _i5=0;_i5<nextFirstPosition-firstPosition;_i5++){_classPrivateFieldGet(_resizersDiv,this).firstChild.before(_classPrivateFieldGet(_resizersDiv,this).lastChild);}}var i=0;var _iterator46=_createForOfIteratorHelper(children),_step46;try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var child=_step46.value;var _div=_classPrivateFieldGet(_allResizerDivs,this)[i++];var _name2=_div.getAttribute("data-resizer-name");child.setAttribute("data-l10n-id",AnnotationEditor._l10nResizer[_name2]);}}catch(err){_iterator46.e(err);}finally{_iterator46.f();}}_assertClassBrand(_AnnotationEditor_brand,this,_setResizerTabIndex).call(this,0);_classPrivateFieldSet(_isResizerEnabledForKeyboard,this,true);_classPrivateFieldGet(_resizersDiv,this).firstChild.focus({focusVisible:true});event.preventDefault();event.stopImmediatePropagation();}},{key:"_resizeWithKeyboard",value:function _resizeWithKeyboard(x,y){if(!_classPrivateFieldGet(_isResizerEnabledForKeyboard,this)){return;}_assertClassBrand(_AnnotationEditor_brand,this,_resizerPointermove).call(this,_classPrivateFieldGet(_focusedResizerName,this),{deltaX:x,deltaY:y,fromKeyboard:true});}},{key:"_stopResizingWithKeyboard",value:function _stopResizingWithKeyboard(){_assertClassBrand(_AnnotationEditor_brand,this,_stopResizing).call(this);this.div.focus();}},{key:"select",value:function select(){var _this$div2,_this16=this,_this$_editToolbar2,_classPrivateFieldGet47;this.makeResizable();(_this$div2=this.div)===null||_this$div2===void 0||_this$div2.classList.add("selectedEditor");if(!this._editToolbar){this.addEditToolbar().then(function(){var _this16$div;if((_this16$div=_this16.div)!==null&&_this16$div!==void 0&&_this16$div.classList.contains("selectedEditor")){var _this16$_editToolbar;(_this16$_editToolbar=_this16._editToolbar)===null||_this16$_editToolbar===void 0||_this16$_editToolbar.show();}});return;}(_this$_editToolbar2=this._editToolbar)===null||_this$_editToolbar2===void 0||_this$_editToolbar2.show();(_classPrivateFieldGet47=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet47===void 0||_classPrivateFieldGet47.toggleAltTextBadge(false);}},{key:"unselect",value:function unselect(){var _classPrivateFieldGet48,_this$div3,_this$div4,_this$_editToolbar3,_classPrivateFieldGet49;(_classPrivateFieldGet48=_classPrivateFieldGet(_resizersDiv,this))===null||_classPrivateFieldGet48===void 0||_classPrivateFieldGet48.classList.add("hidden");(_this$div3=this.div)===null||_this$div3===void 0||_this$div3.classList.remove("selectedEditor");if((_this$div4=this.div)!==null&&_this$div4!==void 0&&_this$div4.contains(document.activeElement)){this._uiManager.currentLayer.div.focus({preventScroll:true});}(_this$_editToolbar3=this._editToolbar)===null||_this$_editToolbar3===void 0||_this$_editToolbar3.hide();(_classPrivateFieldGet49=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet49===void 0||_classPrivateFieldGet49.toggleAltTextBadge(true);}},{key:"updateParams",value:function updateParams(type,value){}},{key:"disableEditing",value:function disableEditing(){}},{key:"enableEditing",value:function enableEditing(){}},{key:"enterInEditMode",value:function enterInEditMode(){}},{key:"getElementForAltText",value:function getElementForAltText(){return this.div;}},{key:"contentDiv",get:function get(){return this.div;}},{key:"isEditing",get:function get(){return _classPrivateFieldGet(_isEditing,this);},set:function set(value){_classPrivateFieldSet(_isEditing,this,value);if(!this.parent){return;}if(value){this.parent.setSelected(this);this.parent.setActiveEditor(this);}else{this.parent.setActiveEditor(null);}}},{key:"setAspectRatio",value:function setAspectRatio(width,height){_classPrivateFieldSet(_keepAspectRatio,this,true);var aspectRatio=width/height;var style=this.div.style;style.aspectRatio=aspectRatio;style.height="auto";}},{key:"telemetryInitialData",get:function get(){return{action:"added"};}},{key:"telemetryFinalData",get:function get(){return null;}},{key:"_reportTelemetry",value:function _reportTelemetry(data){var _this17=this;var mustWait=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(mustWait){_classPrivateFieldGet(_telemetryTimeouts,this)||_classPrivateFieldSet(_telemetryTimeouts,this,new Map());var action=data.action;var timeout=_classPrivateFieldGet(_telemetryTimeouts,this).get(action);if(timeout){clearTimeout(timeout);}timeout=setTimeout(function(){_this17._reportTelemetry(data);_classPrivateFieldGet(_telemetryTimeouts,_this17)["delete"](action);if(_classPrivateFieldGet(_telemetryTimeouts,_this17).size===0){_classPrivateFieldSet(_telemetryTimeouts,_this17,null);}},AnnotationEditor._telemetryTimeout);_classPrivateFieldGet(_telemetryTimeouts,this).set(action,timeout);return;}data.type||(data.type=this.editorType);this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:data}});}},{key:"show",value:function show(){var visible=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!visible);this._isVisible=visible;}},{key:"enable",value:function enable(){if(this.div){this.div.tabIndex=0;}_classPrivateFieldSet(_disabled,this,false);}},{key:"disable",value:function disable(){if(this.div){this.div.tabIndex=-1;}_classPrivateFieldSet(_disabled,this,true);}},{key:"renderAnnotationElement",value:function renderAnnotationElement(annotation){var content=annotation.container.querySelector(".annotationContent");if(!content){content=document.createElement("div");content.classList.add("annotationContent",this.editorType);annotation.container.prepend(content);}else if(content.nodeName==="CANVAS"){var canvas=content;content=document.createElement("div");content.classList.add("annotationContent",this.editorType);canvas.before(content);}return content;}},{key:"resetAnnotationElement",value:function resetAnnotationElement(annotation){var firstChild=annotation.container.firstChild;if((firstChild===null||firstChild===void 0?void 0:firstChild.nodeName)==="DIV"&&firstChild.classList.contains("annotationContent")){firstChild.remove();}}}],[{key:"_resizerKeyboardManager",get:function get(){var resize=AnnotationEditor.prototype._resizeWithKeyboard;var small=_AnnotationEditorUIManager.TRANSLATE_SMALL;var big=_AnnotationEditorUIManager.TRANSLATE_BIG;return _shadow(this,"_resizerKeyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],resize,{args:[-small,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],resize,{args:[-big,0]}],[["ArrowRight","mac+ArrowRight"],resize,{args:[small,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],resize,{args:[big,0]}],[["ArrowUp","mac+ArrowUp"],resize,{args:[0,-small]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],resize,{args:[0,-big]}],[["ArrowDown","mac+ArrowDown"],resize,{args:[0,small]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],resize,{args:[0,big]}],[["Escape","mac+Escape"],AnnotationEditor.prototype._stopResizingWithKeyboard]]));}},{key:"isDrawer",get:function get(){return false;}},{key:"_defaultLineColor",get:function get(){return _shadow(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"));}},{key:"deleteAnnotationElement",value:function deleteAnnotationElement(editor){var fakeEditor=new FakeEditor({id:editor.parent.getNextId(),parent:editor.parent,uiManager:editor._uiManager});fakeEditor.annotationElementId=editor.annotationElementId;fakeEditor.deleted=true;fakeEditor._uiManager.addToAnnotationStorage(fakeEditor);}},{key:"initialize",value:function initialize(l10n,_uiManager){var _AnnotationEditor$_l;(_AnnotationEditor$_l=AnnotationEditor._l10n)!==null&&_AnnotationEditor$_l!==void 0?_AnnotationEditor$_l:AnnotationEditor._l10n=l10n;AnnotationEditor._l10nResizer||(AnnotationEditor._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}));if(AnnotationEditor._borderLineWidth!==-1){return;}var style=getComputedStyle(document.documentElement);AnnotationEditor._borderLineWidth=parseFloat(style.getPropertyValue("--outline-width"))||0;}},{key:"updateDefaultParams",value:function updateDefaultParams(_type,_value){}},{key:"defaultPropertiesToUpdate",get:function get(){return[];}},{key:"isHandlingMimeForPasting",value:function isHandlingMimeForPasting(mime){return false;}},{key:"paste",value:function paste(item,parent){unreachable("Not implemented");}},{key:"_round",value:function _round(x){return Math.round(x*10000)/10000;}},{key:"deserialize",value:function(){var _deserialize=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee12(data,parent,uiManager){var editor,_editor$pageDimension,pageWidth,pageHeight,_editor$getRectInCurr,_editor$getRectInCurr2,x,y,width,height;return _regenerator().w(function(_context12){while(1)switch(_context12.n){case 0:editor=new this.prototype.constructor({parent:parent,id:parent.getNextId(),uiManager:uiManager});editor.rotation=data.rotation;_classPrivateFieldSet(_accessibilityData,editor,data.accessibilityData);editor._isCopy=data.isCopy||false;_editor$pageDimension=_slicedToArray(editor.pageDimensions,2),pageWidth=_editor$pageDimension[0],pageHeight=_editor$pageDimension[1];_editor$getRectInCurr=editor.getRectInCurrentCoords(data.rect,pageHeight),_editor$getRectInCurr2=_slicedToArray(_editor$getRectInCurr,4),x=_editor$getRectInCurr2[0],y=_editor$getRectInCurr2[1],width=_editor$getRectInCurr2[2],height=_editor$getRectInCurr2[3];editor.x=x/pageWidth;editor.y=y/pageHeight;editor.width=width/pageWidth;editor.height=height/pageHeight;return _context12.a(2,editor);}},_callee12,this);}));function deserialize(_x13,_x14,_x15){return _deserialize.apply(this,arguments);}return deserialize;}()},{key:"MIN_SIZE",get:function get(){return 16;}},{key:"canCreateNewEmptyEditor",value:function canCreateNewEmptyEditor(){return true;}}]);}();_AnnotationEditor=AnnotationEditor;function _translate(_ref138,x,y){var _ref139=_slicedToArray(_ref138,2),width=_ref139[0],height=_ref139[1];var _this$screenToPageTra3=this.screenToPageTranslation(x,y);var _this$screenToPageTra4=_slicedToArray(_this$screenToPageTra3,2);x=_this$screenToPageTra4[0];y=_this$screenToPageTra4[1];this.x+=x/width;this.y+=y/height;this._onTranslating(this.x,this.y);this.fixAndSetPosition();}function _rotatePoint(x,y,angle){switch(angle){case 90:return[y,-x];case 180:return[-x,-y];case 270:return[-y,x];default:return[x,y];}}function _getRotationMatrix(rotation){switch(rotation){case 90:{var _this$pageDimensions8=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions8[0],pageHeight=_this$pageDimensions8[1];return[0,-pageWidth/pageHeight,pageHeight/pageWidth,0];}case 180:return[-1,0,0,-1];case 270:{var _this$pageDimensions9=_slicedToArray(this.pageDimensions,2),_pageWidth4=_this$pageDimensions9[0],_pageHeight4=_this$pageDimensions9[1];return[0,_pageWidth4/_pageHeight4,-_pageHeight4/_pageWidth4,0];}default:return[1,0,0,1];}}function _createResizers(){if(_classPrivateFieldGet(_resizersDiv,this)){return;}_classPrivateFieldSet(_resizersDiv,this,document.createElement("div"));_classPrivateFieldGet(_resizersDiv,this).classList.add("resizers");var classes=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];var signal=this._uiManager._signal;for(var _i31=0,_classes=classes;_i31<_classes.length;_i31++){var name=_classes[_i31];var div=document.createElement("div");_classPrivateFieldGet(_resizersDiv,this).append(div);div.classList.add("resizer",name);div.setAttribute("data-resizer-name",name);div.addEventListener("pointerdown",_assertClassBrand(_AnnotationEditor_brand,this,_resizerPointerdown).bind(this,name),{signal:signal});div.addEventListener("contextmenu",_noContextMenu,{signal:signal});div.tabIndex=-1;}this.div.prepend(_classPrivateFieldGet(_resizersDiv,this));}function _resizerPointerdown(name,event){var _classPrivateFieldGet142,_this111=this;event.preventDefault();var isMac=util_FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){return;}(_classPrivateFieldGet142=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet142===void 0||_classPrivateFieldGet142.toggle(false);var savedDraggable=this._isDraggable;this._isDraggable=false;_classPrivateFieldSet(_lastPointerCoords,this,[event.screenX,event.screenY]);var ac=new AbortController();var signal=this._uiManager.combinedSignal(ac);this.parent.togglePointerEvents(false);window.addEventListener("pointermove",_assertClassBrand(_AnnotationEditor_brand,this,_resizerPointermove).bind(this,name),{passive:true,capture:true,signal:signal});window.addEventListener("touchmove",_stopEvent,{passive:false,signal:signal});window.addEventListener("contextmenu",_noContextMenu,{signal:signal});_classPrivateFieldSet(_savedDimensions,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});var savedParentCursor=this.parent.div.style.cursor;var savedCursor=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(event.target).cursor;var pointerUpCallback=function pointerUpCallback(){var _classPrivateFieldGet143;ac.abort();_this111.parent.togglePointerEvents(true);(_classPrivateFieldGet143=_classPrivateFieldGet(_altText3,_this111))===null||_classPrivateFieldGet143===void 0||_classPrivateFieldGet143.toggle(true);_this111._isDraggable=savedDraggable;_this111.parent.div.style.cursor=savedParentCursor;_this111.div.style.cursor=savedCursor;_assertClassBrand(_AnnotationEditor_brand,_this111,_addResizeToUndoStack).call(_this111);};window.addEventListener("pointerup",pointerUpCallback,{signal:signal});window.addEventListener("blur",pointerUpCallback,{signal:signal});}function _resize(x,y,width,height){this.width=width;this.height=height;this.x=x;this.y=y;var _this$parentDimension11=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension11[0],parentHeight=_this$parentDimension11[1];this.setDims(parentWidth*width,parentHeight*height);this.fixAndSetPosition();this._onResized();}function _addResizeToUndoStack(){if(!_classPrivateFieldGet(_savedDimensions,this)){return;}var _classPrivateFieldGet144=_classPrivateFieldGet(_savedDimensions,this),savedX=_classPrivateFieldGet144.savedX,savedY=_classPrivateFieldGet144.savedY,savedWidth=_classPrivateFieldGet144.savedWidth,savedHeight=_classPrivateFieldGet144.savedHeight;_classPrivateFieldSet(_savedDimensions,this,null);var newX=this.x;var newY=this.y;var newWidth=this.width;var newHeight=this.height;if(newX===savedX&&newY===savedY&&newWidth===savedWidth&&newHeight===savedHeight){return;}this.addCommands({cmd:_assertClassBrand(_AnnotationEditor_brand,this,_resize).bind(this,newX,newY,newWidth,newHeight),undo:_assertClassBrand(_AnnotationEditor_brand,this,_resize).bind(this,savedX,savedY,savedWidth,savedHeight),mustExec:true});}function _resizerPointermove(name,event){var _this$parentDimension12=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension12[0],parentHeight=_this$parentDimension12[1];var savedX=this.x;var savedY=this.y;var savedWidth=this.width;var savedHeight=this.height;var minWidth=_AnnotationEditor.MIN_SIZE/parentWidth;var minHeight=_AnnotationEditor.MIN_SIZE/parentHeight;var rotationMatrix=_assertClassBrand(_AnnotationEditor_brand,this,_getRotationMatrix).call(this,this.rotation);var transf=function transf(x,y){return[rotationMatrix[0]*x+rotationMatrix[2]*y,rotationMatrix[1]*x+rotationMatrix[3]*y];};var invRotationMatrix=_assertClassBrand(_AnnotationEditor_brand,this,_getRotationMatrix).call(this,360-this.rotation);var invTransf=function invTransf(x,y){return[invRotationMatrix[0]*x+invRotationMatrix[2]*y,invRotationMatrix[1]*x+invRotationMatrix[3]*y];};var getPoint;var getOpposite;var isDiagonal=false;var isHorizontal=false;switch(name){case"topLeft":isDiagonal=true;getPoint=function getPoint(w,h){return[0,0];};getOpposite=function getOpposite(w,h){return[w,h];};break;case"topMiddle":getPoint=function getPoint(w,h){return[w/2,0];};getOpposite=function getOpposite(w,h){return[w/2,h];};break;case"topRight":isDiagonal=true;getPoint=function getPoint(w,h){return[w,0];};getOpposite=function getOpposite(w,h){return[0,h];};break;case"middleRight":isHorizontal=true;getPoint=function getPoint(w,h){return[w,h/2];};getOpposite=function getOpposite(w,h){return[0,h/2];};break;case"bottomRight":isDiagonal=true;getPoint=function getPoint(w,h){return[w,h];};getOpposite=function getOpposite(w,h){return[0,0];};break;case"bottomMiddle":getPoint=function getPoint(w,h){return[w/2,h];};getOpposite=function getOpposite(w,h){return[w/2,0];};break;case"bottomLeft":isDiagonal=true;getPoint=function getPoint(w,h){return[0,h];};getOpposite=function getOpposite(w,h){return[w,0];};break;case"middleLeft":isHorizontal=true;getPoint=function getPoint(w,h){return[0,h/2];};getOpposite=function getOpposite(w,h){return[w,h/2];};break;}var point=getPoint(savedWidth,savedHeight);var oppositePoint=getOpposite(savedWidth,savedHeight);var transfOppositePoint=transf.apply(void 0,_toConsumableArray(oppositePoint));var oppositeX=_AnnotationEditor._round(savedX+transfOppositePoint[0]);var oppositeY=_AnnotationEditor._round(savedY+transfOppositePoint[1]);var ratioX=1;var ratioY=1;var deltaX,deltaY;if(!event.fromKeyboard){var screenX=event.screenX,screenY=event.screenY;var _classPrivateFieldGet145=_classPrivateFieldGet(_lastPointerCoords,this),_classPrivateFieldGet146=_slicedToArray(_classPrivateFieldGet145,2),lastScreenX=_classPrivateFieldGet146[0],lastScreenY=_classPrivateFieldGet146[1];var _this$screenToPageTra5=this.screenToPageTranslation(screenX-lastScreenX,screenY-lastScreenY);var _this$screenToPageTra6=_slicedToArray(_this$screenToPageTra5,2);deltaX=_this$screenToPageTra6[0];deltaY=_this$screenToPageTra6[1];_classPrivateFieldGet(_lastPointerCoords,this)[0]=screenX;_classPrivateFieldGet(_lastPointerCoords,this)[1]=screenY;}else{deltaX=event.deltaX;deltaY=event.deltaY;}var _invTransf=invTransf(deltaX/parentWidth,deltaY/parentHeight);var _invTransf2=_slicedToArray(_invTransf,2);deltaX=_invTransf2[0];deltaY=_invTransf2[1];if(isDiagonal){var oldDiag=Math.hypot(savedWidth,savedHeight);ratioX=ratioY=Math.max(Math.min(Math.hypot(oppositePoint[0]-point[0]-deltaX,oppositePoint[1]-point[1]-deltaY)/oldDiag,1/savedWidth,1/savedHeight),minWidth/savedWidth,minHeight/savedHeight);}else if(isHorizontal){ratioX=_MathClamp(Math.abs(oppositePoint[0]-point[0]-deltaX),minWidth,1)/savedWidth;}else{ratioY=_MathClamp(Math.abs(oppositePoint[1]-point[1]-deltaY),minHeight,1)/savedHeight;}var newWidth=_AnnotationEditor._round(savedWidth*ratioX);var newHeight=_AnnotationEditor._round(savedHeight*ratioY);transfOppositePoint=transf.apply(void 0,_toConsumableArray(getOpposite(newWidth,newHeight)));var newX=oppositeX-transfOppositePoint[0];var newY=oppositeY-transfOppositePoint[1];_classPrivateFieldGet(_initialRect,this)||_classPrivateFieldSet(_initialRect,this,[this.x,this.y,this.width,this.height]);this.width=newWidth;this.height=newHeight;this.x=newX;this.y=newY;this.setDims(parentWidth*newWidth,parentHeight*newHeight);this.fixAndSetPosition();this._onResizing();}function _touchPinchStartCallback(){var _classPrivateFieldGet147;_classPrivateFieldSet(_savedDimensions,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});(_classPrivateFieldGet147=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet147===void 0||_classPrivateFieldGet147.toggle(false);this.parent.togglePointerEvents(false);}function _touchPinchCallback(_origin,prevDistance,distance){var slowDownFactor=0.7;var factor=slowDownFactor*(distance/prevDistance)+1-slowDownFactor;if(factor===1){return;}var rotationMatrix=_assertClassBrand(_AnnotationEditor_brand,this,_getRotationMatrix).call(this,this.rotation);var transf=function transf(x,y){return[rotationMatrix[0]*x+rotationMatrix[2]*y,rotationMatrix[1]*x+rotationMatrix[3]*y];};var _this$parentDimension13=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension13[0],parentHeight=_this$parentDimension13[1];var savedX=this.x;var savedY=this.y;var savedWidth=this.width;var savedHeight=this.height;var minWidth=_AnnotationEditor.MIN_SIZE/parentWidth;var minHeight=_AnnotationEditor.MIN_SIZE/parentHeight;factor=Math.max(Math.min(factor,1/savedWidth,1/savedHeight),minWidth/savedWidth,minHeight/savedHeight);var newWidth=_AnnotationEditor._round(savedWidth*factor);var newHeight=_AnnotationEditor._round(savedHeight*factor);if(newWidth===savedWidth&&newHeight===savedHeight){return;}_classPrivateFieldGet(_initialRect,this)||_classPrivateFieldSet(_initialRect,this,[savedX,savedY,savedWidth,savedHeight]);var transfCenterPoint=transf(savedWidth/2,savedHeight/2);var centerX=_AnnotationEditor._round(savedX+transfCenterPoint[0]);var centerY=_AnnotationEditor._round(savedY+transfCenterPoint[1]);var newTransfCenterPoint=transf(newWidth/2,newHeight/2);this.x=centerX-newTransfCenterPoint[0];this.y=centerY-newTransfCenterPoint[1];this.width=newWidth;this.height=newHeight;this.setDims(parentWidth*newWidth,parentHeight*newHeight);this.fixAndSetPosition();this._onResizing();}function _touchPinchEndCallback(){var _classPrivateFieldGet148;(_classPrivateFieldGet148=_classPrivateFieldGet(_altText3,this))===null||_classPrivateFieldGet148===void 0||_classPrivateFieldGet148.toggle(true);this.parent.togglePointerEvents(true);_assertClassBrand(_AnnotationEditor_brand,this,_addResizeToUndoStack).call(this);}function _selectOnPointerEvent(event){var isMac=util_FeatureTest.platform.isMac;if(event.ctrlKey&&!isMac||event.shiftKey||event.metaKey&&isMac){this.parent.toggleSelected(this);}else{this.parent.setSelected(this);}}function _setUpDragSession(event){var _this112=this;var isSelected=this.isSelected;this._uiManager.setUpDragSession();var hasDraggingStarted=false;var ac=new AbortController();var signal=this._uiManager.combinedSignal(ac);var opts={capture:true,passive:false,signal:signal};var cancelDrag=function cancelDrag(e){ac.abort();_classPrivateFieldSet(_dragPointerId,_this112,null);_classPrivateFieldSet(_hasBeenClicked,_this112,false);if(!_this112._uiManager.endDragSession()){_assertClassBrand(_AnnotationEditor_brand,_this112,_selectOnPointerEvent).call(_this112,e);}if(hasDraggingStarted){_this112._onStopDragging();}};if(isSelected){_classPrivateFieldSet(_prevDragX,this,event.clientX);_classPrivateFieldSet(_prevDragY,this,event.clientY);_classPrivateFieldSet(_dragPointerId,this,event.pointerId);_classPrivateFieldSet(_dragPointerType,this,event.pointerType);window.addEventListener("pointermove",function(e){if(!hasDraggingStarted){hasDraggingStarted=true;_this112._onStartDragging();}var x=e.clientX,y=e.clientY,pointerId=e.pointerId;if(pointerId!==_classPrivateFieldGet(_dragPointerId,_this112)){_stopEvent(e);return;}var _this112$screenToPage=_this112.screenToPageTranslation(x-_classPrivateFieldGet(_prevDragX,_this112),y-_classPrivateFieldGet(_prevDragY,_this112)),_this112$screenToPage2=_slicedToArray(_this112$screenToPage,2),tx=_this112$screenToPage2[0],ty=_this112$screenToPage2[1];_classPrivateFieldSet(_prevDragX,_this112,x);_classPrivateFieldSet(_prevDragY,_this112,y);_this112._uiManager.dragSelectedEditors(tx,ty);},opts);window.addEventListener("touchmove",_stopEvent,opts);window.addEventListener("pointerdown",function(e){if(e.pointerType===_classPrivateFieldGet(_dragPointerType,_this112)){if(_classPrivateFieldGet(_touchManager,_this112)||e.isPrimary){cancelDrag(e);}}_stopEvent(e);},opts);}var pointerUpCallback=function pointerUpCallback(e){if(!_classPrivateFieldGet(_dragPointerId,_this112)||_classPrivateFieldGet(_dragPointerId,_this112)===e.pointerId){cancelDrag(e);return;}_stopEvent(e);};window.addEventListener("pointerup",pointerUpCallback,{signal:signal});window.addEventListener("blur",pointerUpCallback,{signal:signal});}function _addFocusListeners(){if(_classPrivateFieldGet(_focusAC,this)||!this.div){return;}_classPrivateFieldSet(_focusAC,this,new AbortController());var signal=this._uiManager.combinedSignal(_classPrivateFieldGet(_focusAC,this));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:signal});this.div.addEventListener("focusout",this.focusout.bind(this),{signal:signal});}function _resizerKeydown(event){_AnnotationEditor._resizerKeyboardManager.exec(this,event);}function _resizerBlur(event){var _event$relatedTarget;if(_classPrivateFieldGet(_isResizerEnabledForKeyboard,this)&&((_event$relatedTarget=event.relatedTarget)===null||_event$relatedTarget===void 0?void 0:_event$relatedTarget.parentNode)!==_classPrivateFieldGet(_resizersDiv,this)){_assertClassBrand(_AnnotationEditor_brand,this,_stopResizing).call(this);}}function _resizerFocus(name){_classPrivateFieldSet(_focusedResizerName,this,_classPrivateFieldGet(_isResizerEnabledForKeyboard,this)?name:"");}function _setResizerTabIndex(value){if(!_classPrivateFieldGet(_allResizerDivs,this)){return;}var _iterator178=_createForOfIteratorHelper(_classPrivateFieldGet(_allResizerDivs,this)),_step178;try{for(_iterator178.s();!(_step178=_iterator178.n()).done;){var div=_step178.value;div.tabIndex=value;}}catch(err){_iterator178.e(err);}finally{_iterator178.f();}}function _stopResizing(){_classPrivateFieldSet(_isResizerEnabledForKeyboard,this,false);_assertClassBrand(_AnnotationEditor_brand,this,_setResizerTabIndex).call(this,-1);_assertClassBrand(_AnnotationEditor_brand,this,_addResizeToUndoStack).call(this);}_defineProperty(AnnotationEditor,"_l10n",null);_defineProperty(AnnotationEditor,"_l10nResizer",null);_defineProperty(AnnotationEditor,"_borderLineWidth",-1);_defineProperty(AnnotationEditor,"_colorManager",new ColorManager());_defineProperty(AnnotationEditor,"_zIndex",1);_defineProperty(AnnotationEditor,"_telemetryTimeout",1000);var FakeEditor=/*#__PURE__*/function(_AnnotationEditor2){function FakeEditor(params){var _this18;_classCallCheck(this,FakeEditor);_this18=_callSuper(this,FakeEditor,[params]);_this18.annotationElementId=params.annotationElementId;_this18.deleted=true;return _this18;}_inherits(FakeEditor,_AnnotationEditor2);return _createClass(FakeEditor,[{key:"serialize",value:function serialize(){return this.serializeDeleted();}}]);}(AnnotationEditor);;// ./src/shared/murmurhash3.js
var SEED=0xc3d2e1f0;var MASK_HIGH=0xffff0000;var MASK_LOW=0xffff;var MurmurHash3_64=/*#__PURE__*/function(){function MurmurHash3_64(seed){_classCallCheck(this,MurmurHash3_64);this.h1=seed?seed&0xffffffff:SEED;this.h2=seed?seed&0xffffffff:SEED;}return _createClass(MurmurHash3_64,[{key:"update",value:function update(input){var data,length;if(typeof input==="string"){data=new Uint8Array(input.length*2);length=0;for(var i=0,ii=input.length;i<ii;i++){var code=input.charCodeAt(i);if(code<=0xff){data[length++]=code;}else{data[length++]=code>>>8;data[length++]=code&0xff;}}}else if(ArrayBuffer.isView(input)){data=input.slice();length=data.byteLength;}else{throw new Error("Invalid data format, must be a string or TypedArray.");}var blockCounts=length>>2;var tailLength=length-blockCounts*4;var dataUint32=new Uint32Array(data.buffer,0,blockCounts);var k1=0,k2=0;var h1=this.h1,h2=this.h2;var C1=0xcc9e2d51,C2=0x1b873593;var C1_LOW=C1&MASK_LOW,C2_LOW=C2&MASK_LOW;for(var _i6=0;_i6<blockCounts;_i6++){if(_i6&1){k1=dataUint32[_i6];k1=k1*C1&MASK_HIGH|k1*C1_LOW&MASK_LOW;k1=k1<<15|k1>>>17;k1=k1*C2&MASK_HIGH|k1*C2_LOW&MASK_LOW;h1^=k1;h1=h1<<13|h1>>>19;h1=h1*5+0xe6546b64;}else{k2=dataUint32[_i6];k2=k2*C1&MASK_HIGH|k2*C1_LOW&MASK_LOW;k2=k2<<15|k2>>>17;k2=k2*C2&MASK_HIGH|k2*C2_LOW&MASK_LOW;h2^=k2;h2=h2<<13|h2>>>19;h2=h2*5+0xe6546b64;}}k1=0;switch(tailLength){case 3:k1^=data[blockCounts*4+2]<<16;case 2:k1^=data[blockCounts*4+1]<<8;case 1:k1^=data[blockCounts*4];k1=k1*C1&MASK_HIGH|k1*C1_LOW&MASK_LOW;k1=k1<<15|k1>>>17;k1=k1*C2&MASK_HIGH|k1*C2_LOW&MASK_LOW;if(blockCounts&1){h1^=k1;}else{h2^=k1;}}this.h1=h1;this.h2=h2;}},{key:"hexdigest",value:function hexdigest(){var h1=this.h1,h2=this.h2;h1^=h2>>>1;h1=h1*0xed558ccd&MASK_HIGH|h1*0x8ccd&MASK_LOW;h2=h2*0xff51afd7&MASK_HIGH|((h2<<16|h1>>>16)*0xafd7ed55&MASK_HIGH)>>>16;h1^=h2>>>1;h1=h1*0x1a85ec53&MASK_HIGH|h1*0xec53&MASK_LOW;h2=h2*0xc4ceb9fe&MASK_HIGH|((h2<<16|h1>>>16)*0xb9fe1a85&MASK_HIGH)>>>16;h1^=h2>>>1;return(h1>>>0).toString(16).padStart(8,"0")+(h2>>>0).toString(16).padStart(8,"0");}}]);}();;// ./src/display/annotation_storage.js
var SerializableEmpty=Object.freeze({map:null,hash:"",transfer:undefined});var _modified=/*#__PURE__*/new WeakMap();var _modifiedIds=/*#__PURE__*/new WeakMap();var _storage=/*#__PURE__*/new WeakMap();var _AnnotationStorage_brand=/*#__PURE__*/new WeakSet();var AnnotationStorage=/*#__PURE__*/function(){function AnnotationStorage(){_classCallCheck(this,AnnotationStorage);_classPrivateMethodInitSpec(this,_AnnotationStorage_brand);_classPrivateFieldInitSpec(this,_modified,false);_classPrivateFieldInitSpec(this,_modifiedIds,null);_classPrivateFieldInitSpec(this,_storage,new Map());this.onSetModified=null;this.onResetModified=null;this.onAnnotationEditor=null;}return _createClass(AnnotationStorage,[{key:"getValue",value:function getValue(key,defaultValue){var value=_classPrivateFieldGet(_storage,this).get(key);if(value===undefined){return defaultValue;}return Object.assign(defaultValue,value);}},{key:"getRawValue",value:function getRawValue(key){return _classPrivateFieldGet(_storage,this).get(key);}},{key:"remove",value:function remove(key){_classPrivateFieldGet(_storage,this)["delete"](key);if(_classPrivateFieldGet(_storage,this).size===0){this.resetModified();}if(typeof this.onAnnotationEditor==="function"){var _iterator47=_createForOfIteratorHelper(_classPrivateFieldGet(_storage,this).values()),_step47;try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var value=_step47.value;if(value instanceof AnnotationEditor){return;}}}catch(err){_iterator47.e(err);}finally{_iterator47.f();}this.onAnnotationEditor(null);}}},{key:"setValue",value:function setValue(key,value){var obj=_classPrivateFieldGet(_storage,this).get(key);var modified=false;if(obj!==undefined){for(var _i7=0,_Object$entries=Object.entries(value);_i7<_Object$entries.length;_i7++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i7],2),entry=_Object$entries$_i[0],val=_Object$entries$_i[1];if(obj[entry]!==val){modified=true;obj[entry]=val;}}}else{modified=true;_classPrivateFieldGet(_storage,this).set(key,value);}if(modified){_assertClassBrand(_AnnotationStorage_brand,this,_setModified).call(this);}if(value instanceof AnnotationEditor&&typeof this.onAnnotationEditor==="function"){this.onAnnotationEditor(value.constructor._type);}}},{key:"has",value:function has(key){return _classPrivateFieldGet(_storage,this).has(key);}},{key:"getAll",value:function getAll(){return _classPrivateFieldGet(_storage,this).size>0?objectFromMap(_classPrivateFieldGet(_storage,this)):null;}},{key:"setAll",value:function setAll(obj){for(var _i8=0,_Object$entries2=Object.entries(obj);_i8<_Object$entries2.length;_i8++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i8],2),key=_Object$entries2$_i[0],val=_Object$entries2$_i[1];this.setValue(key,val);}}},{key:"size",get:function get(){return _classPrivateFieldGet(_storage,this).size;}},{key:"resetModified",value:function resetModified(){if(_classPrivateFieldGet(_modified,this)){_classPrivateFieldSet(_modified,this,false);if(typeof this.onResetModified==="function"){this.onResetModified();}}}},{key:"print",get:function get(){return new PrintAnnotationStorage(this);}},{key:"serializable",get:function get(){if(_classPrivateFieldGet(_storage,this).size===0){return SerializableEmpty;}var map=new Map(),hash=new MurmurHash3_64(),transfer=[];var context=Object.create(null);var hasBitmap=false;var _iterator48=_createForOfIteratorHelper(_classPrivateFieldGet(_storage,this)),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var _step48$value=_slicedToArray(_step48.value,2),key=_step48$value[0],val=_step48$value[1];var serialized=val instanceof AnnotationEditor?val.serialize(false,context):val;if(serialized){map.set(key,serialized);hash.update("".concat(key,":").concat(JSON.stringify(serialized)));hasBitmap||(hasBitmap=!!serialized.bitmap);}}}catch(err){_iterator48.e(err);}finally{_iterator48.f();}if(hasBitmap){var _iterator49=_createForOfIteratorHelper(map.values()),_step49;try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var value=_step49.value;if(value.bitmap){transfer.push(value.bitmap);}}}catch(err){_iterator49.e(err);}finally{_iterator49.f();}}return map.size>0?{map:map,hash:hash.hexdigest(),transfer:transfer}:SerializableEmpty;}},{key:"editorStats",get:function get(){var stats=null;var typeToEditor=new Map();var _iterator50=_createForOfIteratorHelper(_classPrivateFieldGet(_storage,this).values()),_step50;try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var _stats;var value=_step50.value;if(!(value instanceof AnnotationEditor)){continue;}var editorStats=value.telemetryFinalData;if(!editorStats){continue;}var type=editorStats.type;if(!typeToEditor.has(type)){typeToEditor.set(type,Object.getPrototypeOf(value).constructor);}stats||(stats=Object.create(null));var map=(_stats=stats)[type]||(_stats[type]=new Map());for(var _i9=0,_Object$entries3=Object.entries(editorStats);_i9<_Object$entries3.length;_i9++){var _counters$get;var _Object$entries3$_i=_slicedToArray(_Object$entries3[_i9],2),key=_Object$entries3$_i[0],val=_Object$entries3$_i[1];if(key==="type"){continue;}var counters=map.get(key);if(!counters){counters=new Map();map.set(key,counters);}var count=(_counters$get=counters.get(val))!==null&&_counters$get!==void 0?_counters$get:0;counters.set(val,count+1);}}}catch(err){_iterator50.e(err);}finally{_iterator50.f();}var _iterator51=_createForOfIteratorHelper(typeToEditor),_step51;try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var _step51$value=_slicedToArray(_step51.value,2),_type2=_step51$value[0],editor=_step51$value[1];stats[_type2]=editor.computeTelemetryFinalData(stats[_type2]);}}catch(err){_iterator51.e(err);}finally{_iterator51.f();}return stats;}},{key:"resetModifiedIds",value:function resetModifiedIds(){_classPrivateFieldSet(_modifiedIds,this,null);}},{key:"modifiedIds",get:function get(){if(_classPrivateFieldGet(_modifiedIds,this)){return _classPrivateFieldGet(_modifiedIds,this);}var ids=[];var _iterator52=_createForOfIteratorHelper(_classPrivateFieldGet(_storage,this).values()),_step52;try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var value=_step52.value;if(!(value instanceof AnnotationEditor)||!value.annotationElementId||!value.serialize()){continue;}ids.push(value.annotationElementId);}}catch(err){_iterator52.e(err);}finally{_iterator52.f();}return _classPrivateFieldSet(_modifiedIds,this,{ids:new Set(ids),hash:ids.join(",")});}}]);}();function _setModified(){if(!_classPrivateFieldGet(_modified,this)){_classPrivateFieldSet(_modified,this,true);if(typeof this.onSetModified==="function"){this.onSetModified();}}}var _serializable=/*#__PURE__*/new WeakMap();var PrintAnnotationStorage=/*#__PURE__*/function(_AnnotationStorage2){function PrintAnnotationStorage(parent){var _this19;_classCallCheck(this,PrintAnnotationStorage);_this19=_callSuper(this,PrintAnnotationStorage);_classPrivateFieldInitSpec(_this19,_serializable,void 0);var _parent$serializable=parent.serializable,map=_parent$serializable.map,hash=_parent$serializable.hash,transfer=_parent$serializable.transfer;var clone=structuredClone(map,transfer?{transfer:transfer}:null);_classPrivateFieldSet(_serializable,_this19,{map:clone,hash:hash,transfer:transfer});return _this19;}_inherits(PrintAnnotationStorage,_AnnotationStorage2);return _createClass(PrintAnnotationStorage,[{key:"print",get:function get(){unreachable("Should not call PrintAnnotationStorage.print");}},{key:"serializable",get:function get(){return _classPrivateFieldGet(_serializable,this);}},{key:"modifiedIds",get:function get(){return _shadow(this,"modifiedIds",{ids:new Set(),hash:""});}}]);}(AnnotationStorage);;// ./src/display/font_loader.js
var _systemFonts=/*#__PURE__*/new WeakMap();var FontLoader=/*#__PURE__*/function(){function FontLoader(_ref16){var _ref16$ownerDocument=_ref16.ownerDocument,ownerDocument=_ref16$ownerDocument===void 0?globalThis.document:_ref16$ownerDocument,_ref16$styleElement=_ref16.styleElement,styleElement=_ref16$styleElement===void 0?null:_ref16$styleElement;_classCallCheck(this,FontLoader);_classPrivateFieldInitSpec(this,_systemFonts,new Set());this._document=ownerDocument;this.nativeFontFaces=new Set();this.styleElement=null;this.loadingRequests=[];this.loadTestFontId=0;}return _createClass(FontLoader,[{key:"addNativeFontFace",value:function addNativeFontFace(nativeFontFace){this.nativeFontFaces.add(nativeFontFace);this._document.fonts.add(nativeFontFace);}},{key:"removeNativeFontFace",value:function removeNativeFontFace(nativeFontFace){this.nativeFontFaces["delete"](nativeFontFace);this._document.fonts["delete"](nativeFontFace);}},{key:"insertRule",value:function insertRule(rule){if(!this.styleElement){this.styleElement=this._document.createElement("style");this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement);}var styleSheet=this.styleElement.sheet;styleSheet.insertRule(rule,styleSheet.cssRules.length);}},{key:"clear",value:function clear(){var _iterator53=_createForOfIteratorHelper(this.nativeFontFaces),_step53;try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var nativeFontFace=_step53.value;this._document.fonts["delete"](nativeFontFace);}}catch(err){_iterator53.e(err);}finally{_iterator53.f();}this.nativeFontFaces.clear();_classPrivateFieldGet(_systemFonts,this).clear();if(this.styleElement){this.styleElement.remove();this.styleElement=null;}}},{key:"loadSystemFont",value:function(){var _loadSystemFont=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee13(_ref17){var info,disableFontFace,_inspectFont,loadedName,src,style,fontFace,_t12;return _regenerator().w(function(_context13){while(1)switch(_context13.n){case 0:info=_ref17.systemFontInfo,disableFontFace=_ref17.disableFontFace,_inspectFont=_ref17._inspectFont;if(!(!info||_classPrivateFieldGet(_systemFonts,this).has(info.loadedName))){_context13.n=1;break;}return _context13.a(2);case 1:assert(!disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set.");if(!this.isFontLoadingAPISupported){_context13.n=6;break;}loadedName=info.loadedName,src=info.src,style=info.style;fontFace=new FontFace(loadedName,src,style);this.addNativeFontFace(fontFace);_context13.p=2;_context13.n=3;return fontFace.load();case 3:_classPrivateFieldGet(_systemFonts,this).add(loadedName);_inspectFont===null||_inspectFont===void 0||_inspectFont(info);_context13.n=5;break;case 4:_context13.p=4;_t12=_context13.v;warn("Cannot load system font: ".concat(info.baseFontName,", installing it could help to improve PDF rendering."));this.removeNativeFontFace(fontFace);case 5:return _context13.a(2);case 6:unreachable("Not implemented: loadSystemFont without the Font Loading API.");case 7:return _context13.a(2);}},_callee13,this,[[2,4]]);}));function loadSystemFont(_x16){return _loadSystemFont.apply(this,arguments);}return loadSystemFont;}()},{key:"bind",value:function(){var _bind=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee14(font){var _this20=this;var nativeFontFace,rule,_t13;return _regenerator().w(function(_context14){while(1)switch(_context14.n){case 0:if(!(font.attached||font.missingFile&&!font.systemFontInfo)){_context14.n=1;break;}return _context14.a(2);case 1:font.attached=true;if(!font.systemFontInfo){_context14.n=3;break;}_context14.n=2;return this.loadSystemFont(font);case 2:return _context14.a(2);case 3:if(!this.isFontLoadingAPISupported){_context14.n=8;break;}nativeFontFace=font.createNativeFontFace();if(!nativeFontFace){_context14.n=7;break;}this.addNativeFontFace(nativeFontFace);_context14.p=4;_context14.n=5;return nativeFontFace.loaded;case 5:_context14.n=7;break;case 6:_context14.p=6;_t13=_context14.v;warn("Failed to load font '".concat(nativeFontFace.family,"': '").concat(_t13,"'."));font.disableFontFace=true;throw _t13;case 7:return _context14.a(2);case 8:rule=font.createFontFaceRule();if(!rule){_context14.n=10;break;}this.insertRule(rule);if(!this.isSyncFontLoadingSupported){_context14.n=9;break;}return _context14.a(2);case 9:_context14.n=10;return new Promise(function(resolve){var request=_this20._queueLoadingCallback(resolve);_this20._prepareFontLoadEvent(font,request);});case 10:return _context14.a(2);}},_callee14,this,[[4,6]]);}));function bind(_x17){return _bind.apply(this,arguments);}return bind;}()},{key:"isFontLoadingAPISupported",get:function get(){var _this$_document;var hasFonts=!!((_this$_document=this._document)!==null&&_this$_document!==void 0&&_this$_document.fonts);return _shadow(this,"isFontLoadingAPISupported",hasFonts);}},{key:"isSyncFontLoadingSupported",get:function get(){return _shadow(this,"isSyncFontLoadingSupported",isNodeJS||util_FeatureTest.platform.isFirefox);}},{key:"_queueLoadingCallback",value:function _queueLoadingCallback(callback){function completeRequest(){assert(!request.done,"completeRequest() cannot be called twice.");request.done=true;while(loadingRequests.length>0&&loadingRequests[0].done){var otherRequest=loadingRequests.shift();setTimeout(otherRequest.callback,0);}}var loadingRequests=this.loadingRequests;var request={done:false,complete:completeRequest,callback:callback};loadingRequests.push(request);return request;}},{key:"_loadTestFont",get:function get(){var testFont=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA"+"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA"+"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA"+"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1"+"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD"+"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM"+"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D"+"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA"+"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA"+"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB"+"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY"+"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA"+"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA"+"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC"+"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3"+"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj"+"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return _shadow(this,"_loadTestFont",testFont);}},{key:"_prepareFontLoadEvent",value:function _prepareFontLoadEvent(font,request){function int32(data,offset){return data.charCodeAt(offset)<<24|data.charCodeAt(offset+1)<<16|data.charCodeAt(offset+2)<<8|data.charCodeAt(offset+3)&0xff;}function spliceString(s,offset,remove,insert){var chunk1=s.substring(0,offset);var chunk2=s.substring(offset+remove);return chunk1+insert+chunk2;}var i,ii;var canvas=this._document.createElement("canvas");canvas.width=1;canvas.height=1;var ctx=canvas.getContext("2d");var called=0;function isFontReady(name,callback){if(++called>30){warn("Load test font never loaded.");callback();return;}ctx.font="30px "+name;ctx.fillText(".",0,20);var imageData=ctx.getImageData(0,0,1,1);if(imageData.data[3]>0){callback();return;}setTimeout(isFontReady.bind(null,name,callback));}var loadTestFontId="lt".concat(Date.now()).concat(this.loadTestFontId++);var data=this._loadTestFont;var COMMENT_OFFSET=976;data=spliceString(data,COMMENT_OFFSET,loadTestFontId.length,loadTestFontId);var CFF_CHECKSUM_OFFSET=16;var XXXX_VALUE=0x58585858;var checksum=int32(data,CFF_CHECKSUM_OFFSET);for(i=0,ii=loadTestFontId.length-3;i<ii;i+=4){checksum=checksum-XXXX_VALUE+int32(loadTestFontId,i)|0;}if(i<loadTestFontId.length){checksum=checksum-XXXX_VALUE+int32(loadTestFontId+"XXX",i)|0;}data=spliceString(data,CFF_CHECKSUM_OFFSET,4,string32(checksum));var url="url(data:font/opentype;base64,".concat(btoa(data),");");var rule="@font-face {font-family:\"".concat(loadTestFontId,"\";src:").concat(url,"}");this.insertRule(rule);var div=this._document.createElement("div");div.style.visibility="hidden";div.style.width=div.style.height="10px";div.style.position="absolute";div.style.top=div.style.left="0px";for(var _i0=0,_arr=[font.loadedName,loadTestFontId];_i0<_arr.length;_i0++){var name=_arr[_i0];var span=this._document.createElement("span");span.textContent="Hi";span.style.fontFamily=name;div.append(span);}this._document.body.append(div);isFontReady(loadTestFontId,function(){div.remove();request.complete();});}}]);}();var FontFaceObject=/*#__PURE__*/function(){function FontFaceObject(translatedData){var inspectFont=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,FontFaceObject);this.compiledGlyphs=Object.create(null);for(var i in translatedData){this[i]=translatedData[i];}this._inspectFont=inspectFont;}return _createClass(FontFaceObject,[{key:"createNativeFontFace",value:function createNativeFontFace(){var _this$_inspectFont;if(!this.data||this.disableFontFace){return null;}var nativeFontFace;if(!this.cssFontInfo){nativeFontFace=new FontFace(this.loadedName,this.data,{});}else{var css={weight:this.cssFontInfo.fontWeight};if(this.cssFontInfo.italicAngle){css.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg");}nativeFontFace=new FontFace(this.cssFontInfo.fontFamily,this.data,css);}(_this$_inspectFont=this._inspectFont)===null||_this$_inspectFont===void 0||_this$_inspectFont.call(this,this);return nativeFontFace;}},{key:"createFontFaceRule",value:function createFontFaceRule(){var _this$_inspectFont2;if(!this.data||this.disableFontFace){return null;}var url="url(data:".concat(this.mimetype,";base64,").concat(toBase64Util(this.data),");");var rule;if(!this.cssFontInfo){rule="@font-face {font-family:\"".concat(this.loadedName,"\";src:").concat(url,"}");}else{var css="font-weight: ".concat(this.cssFontInfo.fontWeight,";");if(this.cssFontInfo.italicAngle){css+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;");}rule="@font-face {font-family:\"".concat(this.cssFontInfo.fontFamily,"\";").concat(css,"src:").concat(url,"}");}(_this$_inspectFont2=this._inspectFont)===null||_this$_inspectFont2===void 0||_this$_inspectFont2.call(this,this,url);return rule;}},{key:"getPathGenerator",value:function getPathGenerator(objs,character){if(this.compiledGlyphs[character]!==undefined){return this.compiledGlyphs[character];}var objId=this.loadedName+"_path_"+character;var cmds;try{cmds=objs.get(objId);}catch(ex){warn("getPathGenerator - ignoring character: \"".concat(ex,"\"."));}var path=new Path2D(cmds||"");if(!this.fontExtraProperties){objs["delete"](objId);}return this.compiledGlyphs[character]=path;}}]);}();;// ./src/shared/message_handler.js
var CallbackKind={DATA:1,ERROR:2};var StreamKind={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function onFn(){}function wrapReason(ex){if(ex instanceof _AbortException||ex instanceof _InvalidPDFException||ex instanceof PasswordException||ex instanceof _ResponseException||ex instanceof UnknownErrorException){return ex;}if(!(ex instanceof Error||_typeof(ex)==="object"&&ex!==null)){unreachable('wrapReason: Expected "reason" to be a (possibly cloned) Error.');}switch(ex.name){case"AbortException":return new _AbortException(ex.message);case"InvalidPDFException":return new _InvalidPDFException(ex.message);case"PasswordException":return new PasswordException(ex.message,ex.code);case"ResponseException":return new _ResponseException(ex.message,ex.status,ex.missing);case"UnknownErrorException":return new UnknownErrorException(ex.message,ex.details);}return new UnknownErrorException(ex.message,ex.toString());}var _messageAC=/*#__PURE__*/new WeakMap();var _MessageHandler_brand=/*#__PURE__*/new WeakSet();var MessageHandler=/*#__PURE__*/function(){function MessageHandler(_sourceName,_targetName,_comObj){_classCallCheck(this,MessageHandler);_classPrivateMethodInitSpec(this,_MessageHandler_brand);_classPrivateFieldInitSpec(this,_messageAC,new AbortController());this.sourceName=_sourceName;this.targetName=_targetName;this.comObj=_comObj;this.callbackId=1;this.streamId=1;this.streamSinks=Object.create(null);this.streamControllers=Object.create(null);this.callbackCapabilities=Object.create(null);this.actionHandler=Object.create(null);_comObj.addEventListener("message",_assertClassBrand(_MessageHandler_brand,this,_onMessage).bind(this),{signal:_classPrivateFieldGet(_messageAC,this).signal});}return _createClass(MessageHandler,[{key:"on",value:function on(actionName,handler){var ah=this.actionHandler;if(ah[actionName]){throw new Error("There is already an actionName called \"".concat(actionName,"\""));}ah[actionName]=handler;}},{key:"send",value:function send(actionName,data,transfers){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,data:data},transfers);}},{key:"sendWithPromise",value:function sendWithPromise(actionName,data,transfers){var callbackId=this.callbackId++;var capability=Promise.withResolvers();this.callbackCapabilities[callbackId]=capability;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,callbackId:callbackId,data:data},transfers);}catch(ex){capability.reject(ex);}return capability.promise;}},{key:"sendWithStream",value:function sendWithStream(actionName,data,queueingStrategy,transfers){var _this21=this;var streamId=this.streamId++,sourceName=this.sourceName,targetName=this.targetName,comObj=this.comObj;return new ReadableStream({start:function start(controller){var startCapability=Promise.withResolvers();_this21.streamControllers[streamId]={controller:controller,startCall:startCapability,pullCall:null,cancelCall:null,isClosed:false};comObj.postMessage({sourceName:sourceName,targetName:targetName,action:actionName,streamId:streamId,data:data,desiredSize:controller.desiredSize},transfers);return startCapability.promise;},pull:function pull(controller){var pullCapability=Promise.withResolvers();_this21.streamControllers[streamId].pullCall=pullCapability;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL,streamId:streamId,desiredSize:controller.desiredSize});return pullCapability.promise;},cancel:function cancel(reason){assert(reason instanceof Error,"cancel must have a valid reason");var cancelCapability=Promise.withResolvers();_this21.streamControllers[streamId].cancelCall=cancelCapability;_this21.streamControllers[streamId].isClosed=true;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CANCEL,streamId:streamId,reason:wrapReason(reason)});return cancelCapability.promise;}},queueingStrategy);}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet50;(_classPrivateFieldGet50=_classPrivateFieldGet(_messageAC,this))===null||_classPrivateFieldGet50===void 0||_classPrivateFieldGet50.abort();_classPrivateFieldSet(_messageAC,this,null);}}]);}();function _onMessage(_ref140){var data=_ref140.data;if(data.targetName!==this.sourceName){return;}if(data.stream){_assertClassBrand(_MessageHandler_brand,this,_processStreamMessage).call(this,data);return;}if(data.callback){var callbackId=data.callbackId;var capability=this.callbackCapabilities[callbackId];if(!capability){throw new Error("Cannot resolve callback ".concat(callbackId));}delete this.callbackCapabilities[callbackId];if(data.callback===CallbackKind.DATA){capability.resolve(data.data);}else if(data.callback===CallbackKind.ERROR){capability.reject(wrapReason(data.reason));}else{throw new Error("Unexpected callback case");}return;}var action=this.actionHandler[data.action];if(!action){throw new Error("Unknown action from worker: ".concat(data.action));}if(data.callbackId){var sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj;Promise["try"](action,data.data).then(function(result){comObj.postMessage({sourceName:sourceName,targetName:targetName,callback:CallbackKind.DATA,callbackId:data.callbackId,data:result});},function(reason){comObj.postMessage({sourceName:sourceName,targetName:targetName,callback:CallbackKind.ERROR,callbackId:data.callbackId,reason:wrapReason(reason)});});return;}if(data.streamId){_assertClassBrand(_MessageHandler_brand,this,_createStreamSink).call(this,data);return;}action(data.data);}function _createStreamSink(data){var streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj;var self=this,action=this.actionHandler[data.action];var streamSink={enqueue:function enqueue(chunk){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var transfers=arguments.length>2?arguments[2]:undefined;if(this.isCancelled){return;}var lastDesiredSize=this.desiredSize;this.desiredSize-=size;if(lastDesiredSize>0&&this.desiredSize<=0){this.sinkCapability=Promise.withResolvers();this.ready=this.sinkCapability.promise;}comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.ENQUEUE,streamId:streamId,chunk:chunk},transfers);},close:function close(){if(this.isCancelled){return;}this.isCancelled=true;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CLOSE,streamId:streamId});delete self.streamSinks[streamId];},error:function error(reason){assert(reason instanceof Error,"error must have a valid reason");if(this.isCancelled){return;}this.isCancelled=true;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.ERROR,streamId:streamId,reason:wrapReason(reason)});},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:false,desiredSize:data.desiredSize,ready:null};streamSink.sinkCapability.resolve();streamSink.ready=streamSink.sinkCapability.promise;this.streamSinks[streamId]=streamSink;Promise["try"](action,data.data,streamSink).then(function(){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.START_COMPLETE,streamId:streamId,success:true});},function(reason){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.START_COMPLETE,streamId:streamId,reason:wrapReason(reason)});});}function _processStreamMessage(data){var streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj;var streamController=this.streamControllers[streamId],streamSink=this.streamSinks[streamId];switch(data.stream){case StreamKind.START_COMPLETE:if(data.success){streamController.startCall.resolve();}else{streamController.startCall.reject(wrapReason(data.reason));}break;case StreamKind.PULL_COMPLETE:if(data.success){streamController.pullCall.resolve();}else{streamController.pullCall.reject(wrapReason(data.reason));}break;case StreamKind.PULL:if(!streamSink){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL_COMPLETE,streamId:streamId,success:true});break;}if(streamSink.desiredSize<=0&&data.desiredSize>0){streamSink.sinkCapability.resolve();}streamSink.desiredSize=data.desiredSize;Promise["try"](streamSink.onPull||onFn).then(function(){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL_COMPLETE,streamId:streamId,success:true});},function(reason){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL_COMPLETE,streamId:streamId,reason:wrapReason(reason)});});break;case StreamKind.ENQUEUE:assert(streamController,"enqueue should have stream controller");if(streamController.isClosed){break;}streamController.controller.enqueue(data.chunk);break;case StreamKind.CLOSE:assert(streamController,"close should have stream controller");if(streamController.isClosed){break;}streamController.isClosed=true;streamController.controller.close();_assertClassBrand(_MessageHandler_brand,this,_deleteStreamController).call(this,streamController,streamId);break;case StreamKind.ERROR:assert(streamController,"error should have stream controller");streamController.controller.error(wrapReason(data.reason));_assertClassBrand(_MessageHandler_brand,this,_deleteStreamController).call(this,streamController,streamId);break;case StreamKind.CANCEL_COMPLETE:if(data.success){streamController.cancelCall.resolve();}else{streamController.cancelCall.reject(wrapReason(data.reason));}_assertClassBrand(_MessageHandler_brand,this,_deleteStreamController).call(this,streamController,streamId);break;case StreamKind.CANCEL:if(!streamSink){break;}var dataReason=wrapReason(data.reason);Promise["try"](streamSink.onCancel||onFn,dataReason).then(function(){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CANCEL_COMPLETE,streamId:streamId,success:true});},function(reason){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CANCEL_COMPLETE,streamId:streamId,reason:wrapReason(reason)});});streamSink.sinkCapability.reject(dataReason);streamSink.isCancelled=true;delete this.streamSinks[streamId];break;default:throw new Error("Unexpected stream case");}}function _deleteStreamController(_x65,_x66){return _deleteStreamController2.apply(this,arguments);}function _deleteStreamController2(){_deleteStreamController2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee67(streamController,streamId){var _streamController$sta,_streamController$pul,_streamController$can;return _regenerator().w(function(_context68){while(1)switch(_context68.n){case 0:_context68.n=1;return Promise.allSettled([(_streamController$sta=streamController.startCall)===null||_streamController$sta===void 0?void 0:_streamController$sta.promise,(_streamController$pul=streamController.pullCall)===null||_streamController$pul===void 0?void 0:_streamController$pul.promise,(_streamController$can=streamController.cancelCall)===null||_streamController$can===void 0?void 0:_streamController$can.promise]);case 1:delete this.streamControllers[streamId];case 2:return _context68.a(2);}},_callee67,this);}));return _deleteStreamController2.apply(this,arguments);};// ./src/display/canvas_factory.js
var _enableHWA=/*#__PURE__*/new WeakMap();var BaseCanvasFactory=/*#__PURE__*/function(){function BaseCanvasFactory(_ref18){var _ref18$enableHWA=_ref18.enableHWA,enableHWA=_ref18$enableHWA===void 0?false:_ref18$enableHWA;_classCallCheck(this,BaseCanvasFactory);_classPrivateFieldInitSpec(this,_enableHWA,false);_classPrivateFieldSet(_enableHWA,this,enableHWA);}return _createClass(BaseCanvasFactory,[{key:"create",value:function create(width,height){if(width<=0||height<=0){throw new Error("Invalid canvas size");}var canvas=this._createCanvas(width,height);return{canvas:canvas,context:canvas.getContext("2d",{willReadFrequently:!_classPrivateFieldGet(_enableHWA,this)})};}},{key:"reset",value:function reset(canvasAndContext,width,height){if(!canvasAndContext.canvas){throw new Error("Canvas is not specified");}if(width<=0||height<=0){throw new Error("Invalid canvas size");}canvasAndContext.canvas.width=width;canvasAndContext.canvas.height=height;}},{key:"destroy",value:function destroy(canvasAndContext){if(!canvasAndContext.canvas){throw new Error("Canvas is not specified");}canvasAndContext.canvas.width=0;canvasAndContext.canvas.height=0;canvasAndContext.canvas=null;canvasAndContext.context=null;}},{key:"_createCanvas",value:function _createCanvas(width,height){unreachable("Abstract method `_createCanvas` called.");}}]);}();var DOMCanvasFactory=/*#__PURE__*/function(_BaseCanvasFactory2){function DOMCanvasFactory(_ref19){var _this22;var _ref19$ownerDocument=_ref19.ownerDocument,ownerDocument=_ref19$ownerDocument===void 0?globalThis.document:_ref19$ownerDocument,_ref19$enableHWA=_ref19.enableHWA,enableHWA=_ref19$enableHWA===void 0?false:_ref19$enableHWA;_classCallCheck(this,DOMCanvasFactory);_this22=_callSuper(this,DOMCanvasFactory,[{enableHWA:enableHWA}]);_this22._document=ownerDocument;return _this22;}_inherits(DOMCanvasFactory,_BaseCanvasFactory2);return _createClass(DOMCanvasFactory,[{key:"_createCanvas",value:function _createCanvas(width,height){var canvas=this._document.createElement("canvas");canvas.width=width;canvas.height=height;return canvas;}}]);}(BaseCanvasFactory);;// ./src/display/cmap_reader_factory.js
var BaseCMapReaderFactory=/*#__PURE__*/function(){function BaseCMapReaderFactory(_ref20){var _ref20$baseUrl=_ref20.baseUrl,baseUrl=_ref20$baseUrl===void 0?null:_ref20$baseUrl,_ref20$isCompressed=_ref20.isCompressed,isCompressed=_ref20$isCompressed===void 0?true:_ref20$isCompressed;_classCallCheck(this,BaseCMapReaderFactory);this.baseUrl=baseUrl;this.isCompressed=isCompressed;}return _createClass(BaseCMapReaderFactory,[{key:"fetch",value:function(){var _fetch2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee15(_ref21){var _this23=this;var name,url;return _regenerator().w(function(_context15){while(1)switch(_context15.n){case 0:name=_ref21.name;if(this.baseUrl){_context15.n=1;break;}throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");case 1:if(name){_context15.n=2;break;}throw new Error("CMap name must be specified.");case 2:url=this.baseUrl+name+(this.isCompressed?".bcmap":"");return _context15.a(2,this._fetch(url).then(function(cMapData){return{cMapData:cMapData,isCompressed:_this23.isCompressed};})["catch"](function(reason){throw new Error("Unable to load ".concat(_this23.isCompressed?"binary ":"","CMap at: ").concat(url));}));}},_callee15,this);}));function fetch(_x18){return _fetch2.apply(this,arguments);}return fetch;}()},{key:"_fetch",value:function(){var _fetch3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee16(url){return _regenerator().w(function(_context16){while(1)switch(_context16.n){case 0:unreachable("Abstract method `_fetch` called.");case 1:return _context16.a(2);}},_callee16);}));function _fetch(_x19){return _fetch3.apply(this,arguments);}return _fetch;}()}]);}();var DOMCMapReaderFactory=/*#__PURE__*/function(_BaseCMapReaderFactor){function DOMCMapReaderFactory(){_classCallCheck(this,DOMCMapReaderFactory);return _callSuper(this,DOMCMapReaderFactory,arguments);}_inherits(DOMCMapReaderFactory,_BaseCMapReaderFactor);return _createClass(DOMCMapReaderFactory,[{key:"_fetch",value:function(){var _fetch4=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee17(url){var data;return _regenerator().w(function(_context17){while(1)switch(_context17.n){case 0:_context17.n=1;return _fetchData(url,this.isCompressed?"arraybuffer":"text");case 1:data=_context17.v;return _context17.a(2,data instanceof ArrayBuffer?new Uint8Array(data):stringToBytes(data));}},_callee17,this);}));function _fetch(_x20){return _fetch4.apply(this,arguments);}return _fetch;}()}]);}(BaseCMapReaderFactory);;// ./src/display/filter_factory.js
var BaseFilterFactory=/*#__PURE__*/function(){function BaseFilterFactory(){_classCallCheck(this,BaseFilterFactory);}return _createClass(BaseFilterFactory,[{key:"addFilter",value:function addFilter(maps){return"none";}},{key:"addHCMFilter",value:function addHCMFilter(fgColor,bgColor){return"none";}},{key:"addAlphaFilter",value:function addAlphaFilter(map){return"none";}},{key:"addLuminosityFilter",value:function addLuminosityFilter(map){return"none";}},{key:"addHighlightHCMFilter",value:function addHighlightHCMFilter(filterName,fgColor,bgColor,newFgColor,newBgColor){return"none";}},{key:"destroy",value:function destroy(){var keepHCM=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;}}]);}();var _baseUrl=/*#__PURE__*/new WeakMap();var _cache2=/*#__PURE__*/new WeakMap();var _defs=/*#__PURE__*/new WeakMap();var _docId=/*#__PURE__*/new WeakMap();var _document2=/*#__PURE__*/new WeakMap();var _hcmCache=/*#__PURE__*/new WeakMap();var _id3=/*#__PURE__*/new WeakMap();var _DOMFilterFactory_brand=/*#__PURE__*/new WeakSet();var DOMFilterFactory=/*#__PURE__*/function(_BaseFilterFactory){function DOMFilterFactory(_ref22){var _this27;var docId=_ref22.docId,_ref22$ownerDocument=_ref22.ownerDocument,ownerDocument=_ref22$ownerDocument===void 0?globalThis.document:_ref22$ownerDocument;_classCallCheck(this,DOMFilterFactory);_this27=_callSuper(this,DOMFilterFactory);_classPrivateMethodInitSpec(_this27,_DOMFilterFactory_brand);_classPrivateFieldInitSpec(_this27,_baseUrl,void 0);_classPrivateFieldInitSpec(_this27,_cache2,void 0);_classPrivateFieldInitSpec(_this27,_defs,void 0);_classPrivateFieldInitSpec(_this27,_docId,void 0);_classPrivateFieldInitSpec(_this27,_document2,void 0);_classPrivateFieldInitSpec(_this27,_hcmCache,void 0);_classPrivateFieldInitSpec(_this27,_id3,0);_classPrivateFieldSet(_docId,_this27,docId);_classPrivateFieldSet(_document2,_this27,ownerDocument);return _this27;}_inherits(DOMFilterFactory,_BaseFilterFactory);return _createClass(DOMFilterFactory,[{key:"addFilter",value:function addFilter(maps){var _this$id7,_this$id8;if(!maps){return"none";}var value=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).get(maps);if(value){return value;}var _assertClassBrand$cal3=_assertClassBrand(_DOMFilterFactory_brand,this,_createTables).call(this,maps),_assertClassBrand$cal4=_slicedToArray(_assertClassBrand$cal3,3),tableR=_assertClassBrand$cal4[0],tableG=_assertClassBrand$cal4[1],tableB=_assertClassBrand$cal4[2];var key=maps.length===1?tableR:"".concat(tableR).concat(tableG).concat(tableB);value=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).get(key);if(value){_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(maps,value);return value;}var id="g_".concat(_classPrivateFieldGet(_docId,this),"_transfer_map_").concat((_classPrivateFieldSet(_id3,this,(_this$id7=_classPrivateFieldGet(_id3,this),_this$id8=_this$id7++,_this$id7)),_this$id8));var url=_assertClassBrand(_DOMFilterFactory_brand,this,_createUrl).call(this,id);_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(maps,url);_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(key,url);var filter=_assertClassBrand(_DOMFilterFactory_brand,this,_createFilter).call(this,id);_assertClassBrand(_DOMFilterFactory_brand,this,_addTransferMapConversion).call(this,tableR,tableG,tableB,filter);return url;}},{key:"addHCMFilter",value:function addHCMFilter(fgColor,bgColor){var _info;var key="".concat(fgColor,"-").concat(bgColor);var filterName="base";var info=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_hcmCache).get(filterName);if(((_info=info)===null||_info===void 0?void 0:_info.key)===key){return info.url;}if(info){var _info$filter;(_info$filter=info.filter)===null||_info$filter===void 0||_info$filter.remove();info.key=key;info.url="none";info.filter=null;}else{info={key:key,url:"none",filter:null};_classPrivateGetter(_DOMFilterFactory_brand,this,_get_hcmCache).set(filterName,info);}if(!fgColor||!bgColor){return info.url;}var fgRGB=_assertClassBrand(_DOMFilterFactory_brand,this,_getRGB).call(this,fgColor);fgColor=_Util.makeHexColor.apply(_Util,_toConsumableArray(fgRGB));var bgRGB=_assertClassBrand(_DOMFilterFactory_brand,this,_getRGB).call(this,bgColor);bgColor=_Util.makeHexColor.apply(_Util,_toConsumableArray(bgRGB));_classPrivateGetter(_DOMFilterFactory_brand,this,_get_defs).style.color="";if(fgColor==="#000000"&&bgColor==="#ffffff"||fgColor===bgColor){return info.url;}var map=new Array(256);for(var i=0;i<=255;i++){var x=i/255;map[i]=x<=0.03928?x/12.92:Math.pow((x+0.055)/1.055,2.4);}var table=map.join(",");var id="g_".concat(_classPrivateFieldGet(_docId,this),"_hcm_filter");var filter=info.filter=_assertClassBrand(_DOMFilterFactory_brand,this,_createFilter).call(this,id);_assertClassBrand(_DOMFilterFactory_brand,this,_addTransferMapConversion).call(this,table,table,table,filter);_assertClassBrand(_DOMFilterFactory_brand,this,_addGrayConversion).call(this,filter);var getSteps=function getSteps(c,n){var start=fgRGB[c]/255;var end=bgRGB[c]/255;var arr=new Array(n+1);for(var _i1=0;_i1<=n;_i1++){arr[_i1]=start+_i1/n*(end-start);}return arr.join(",");};_assertClassBrand(_DOMFilterFactory_brand,this,_addTransferMapConversion).call(this,getSteps(0,5),getSteps(1,5),getSteps(2,5),filter);info.url=_assertClassBrand(_DOMFilterFactory_brand,this,_createUrl).call(this,id);return info.url;}},{key:"addAlphaFilter",value:function addAlphaFilter(map){var _this$id9,_this$id0;var value=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).get(map);if(value){return value;}var _assertClassBrand$cal5=_assertClassBrand(_DOMFilterFactory_brand,this,_createTables).call(this,[map]),_assertClassBrand$cal6=_slicedToArray(_assertClassBrand$cal5,1),tableA=_assertClassBrand$cal6[0];var key="alpha_".concat(tableA);value=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).get(key);if(value){_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(map,value);return value;}var id="g_".concat(_classPrivateFieldGet(_docId,this),"_alpha_map_").concat((_classPrivateFieldSet(_id3,this,(_this$id9=_classPrivateFieldGet(_id3,this),_this$id0=_this$id9++,_this$id9)),_this$id0));var url=_assertClassBrand(_DOMFilterFactory_brand,this,_createUrl).call(this,id);_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(map,url);_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(key,url);var filter=_assertClassBrand(_DOMFilterFactory_brand,this,_createFilter).call(this,id);_assertClassBrand(_DOMFilterFactory_brand,this,_addTransferMapAlphaConversion).call(this,tableA,filter);return url;}},{key:"addLuminosityFilter",value:function addLuminosityFilter(map){var _this$id1,_this$id10;var value=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).get(map||"luminosity");if(value){return value;}var tableA,key;if(map){var _assertClassBrand$cal7=_assertClassBrand(_DOMFilterFactory_brand,this,_createTables).call(this,[map]);var _assertClassBrand$cal8=_slicedToArray(_assertClassBrand$cal7,1);tableA=_assertClassBrand$cal8[0];key="luminosity_".concat(tableA);}else{key="luminosity";}value=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).get(key);if(value){_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(map,value);return value;}var id="g_".concat(_classPrivateFieldGet(_docId,this),"_luminosity_map_").concat((_classPrivateFieldSet(_id3,this,(_this$id1=_classPrivateFieldGet(_id3,this),_this$id10=_this$id1++,_this$id1)),_this$id10));var url=_assertClassBrand(_DOMFilterFactory_brand,this,_createUrl).call(this,id);_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(map,url);_classPrivateGetter(_DOMFilterFactory_brand,this,_get_cache).set(key,url);var filter=_assertClassBrand(_DOMFilterFactory_brand,this,_createFilter).call(this,id);_assertClassBrand(_DOMFilterFactory_brand,this,_addLuminosityConversion).call(this,filter);if(map){_assertClassBrand(_DOMFilterFactory_brand,this,_addTransferMapAlphaConversion).call(this,tableA,filter);}return url;}},{key:"addHighlightHCMFilter",value:function addHighlightHCMFilter(filterName,fgColor,bgColor,newFgColor,newBgColor){var _info2;var key="".concat(fgColor,"-").concat(bgColor,"-").concat(newFgColor,"-").concat(newBgColor);var info=_classPrivateGetter(_DOMFilterFactory_brand,this,_get_hcmCache).get(filterName);if(((_info2=info)===null||_info2===void 0?void 0:_info2.key)===key){return info.url;}if(info){var _info$filter2;(_info$filter2=info.filter)===null||_info$filter2===void 0||_info$filter2.remove();info.key=key;info.url="none";info.filter=null;}else{info={key:key,url:"none",filter:null};_classPrivateGetter(_DOMFilterFactory_brand,this,_get_hcmCache).set(filterName,info);}if(!fgColor||!bgColor){return info.url;}var _map=[fgColor,bgColor].map(_assertClassBrand(_DOMFilterFactory_brand,this,_getRGB).bind(this)),_map2=_slicedToArray(_map,2),fgRGB=_map2[0],bgRGB=_map2[1];var fgGray=Math.round(0.2126*fgRGB[0]+0.7152*fgRGB[1]+0.0722*fgRGB[2]);var bgGray=Math.round(0.2126*bgRGB[0]+0.7152*bgRGB[1]+0.0722*bgRGB[2]);var _map3=[newFgColor,newBgColor].map(_assertClassBrand(_DOMFilterFactory_brand,this,_getRGB).bind(this)),_map4=_slicedToArray(_map3,2),newFgRGB=_map4[0],newBgRGB=_map4[1];if(bgGray<fgGray){var _ref23=[bgGray,fgGray,newBgRGB,newFgRGB];fgGray=_ref23[0];bgGray=_ref23[1];newFgRGB=_ref23[2];newBgRGB=_ref23[3];}_classPrivateGetter(_DOMFilterFactory_brand,this,_get_defs).style.color="";var getSteps=function getSteps(fg,bg,n){var arr=new Array(256);var step=(bgGray-fgGray)/n;var newStart=fg/255;var newStep=(bg-fg)/(255*n);var prev=0;for(var i=0;i<=n;i++){var k=Math.round(fgGray+i*step);var value=newStart+i*newStep;for(var j=prev;j<=k;j++){arr[j]=value;}prev=k+1;}for(var _i10=prev;_i10<256;_i10++){arr[_i10]=arr[prev-1];}return arr.join(",");};var id="g_".concat(_classPrivateFieldGet(_docId,this),"_hcm_").concat(filterName,"_filter");var filter=info.filter=_assertClassBrand(_DOMFilterFactory_brand,this,_createFilter).call(this,id);_assertClassBrand(_DOMFilterFactory_brand,this,_addGrayConversion).call(this,filter);_assertClassBrand(_DOMFilterFactory_brand,this,_addTransferMapConversion).call(this,getSteps(newFgRGB[0],newBgRGB[0],5),getSteps(newFgRGB[1],newBgRGB[1],5),getSteps(newFgRGB[2],newBgRGB[2],5),filter);info.url=_assertClassBrand(_DOMFilterFactory_brand,this,_createUrl).call(this,id);return info.url;}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet51,_classPrivateFieldGet52,_classPrivateFieldGet53,_classPrivateFieldGet54;var keepHCM=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(keepHCM&&(_classPrivateFieldGet51=_classPrivateFieldGet(_hcmCache,this))!==null&&_classPrivateFieldGet51!==void 0&&_classPrivateFieldGet51.size){return;}(_classPrivateFieldGet52=_classPrivateFieldGet(_defs,this))===null||_classPrivateFieldGet52===void 0||_classPrivateFieldGet52.parentNode.parentNode.remove();_classPrivateFieldSet(_defs,this,null);(_classPrivateFieldGet53=_classPrivateFieldGet(_cache2,this))===null||_classPrivateFieldGet53===void 0||_classPrivateFieldGet53.clear();_classPrivateFieldSet(_cache2,this,null);(_classPrivateFieldGet54=_classPrivateFieldGet(_hcmCache,this))===null||_classPrivateFieldGet54===void 0||_classPrivateFieldGet54.clear();_classPrivateFieldSet(_hcmCache,this,null);_classPrivateFieldSet(_id3,this,0);}}]);}(BaseFilterFactory);function _get_cache(_this24){return _classPrivateFieldGet(_cache2,_this24)||_classPrivateFieldSet(_cache2,_this24,new Map());}function _get_hcmCache(_this25){return _classPrivateFieldGet(_hcmCache,_this25)||_classPrivateFieldSet(_hcmCache,_this25,new Map());}function _get_defs(_this26){if(!_classPrivateFieldGet(_defs,_this26)){var div=_classPrivateFieldGet(_document2,_this26).createElement("div");var style=div.style;style.visibility="hidden";style.contain="strict";style.width=style.height=0;style.position="absolute";style.top=style.left=0;style.zIndex=-1;var svg=_classPrivateFieldGet(_document2,_this26).createElementNS(SVG_NS,"svg");svg.setAttribute("width",0);svg.setAttribute("height",0);_classPrivateFieldSet(_defs,_this26,_classPrivateFieldGet(_document2,_this26).createElementNS(SVG_NS,"defs"));div.append(svg);svg.append(_classPrivateFieldGet(_defs,_this26));_classPrivateFieldGet(_document2,_this26).body.append(div);}return _classPrivateFieldGet(_defs,_this26);}function _createTables(maps){if(maps.length===1){var _mapR=maps[0];var buffer=new Array(256);for(var i=0;i<256;i++){buffer[i]=_mapR[i]/255;}var table=buffer.join(",");return[table,table,table];}var _maps=_slicedToArray(maps,3),mapR=_maps[0],mapG=_maps[1],mapB=_maps[2];var bufferR=new Array(256);var bufferG=new Array(256);var bufferB=new Array(256);for(var _i32=0;_i32<256;_i32++){bufferR[_i32]=mapR[_i32]/255;bufferG[_i32]=mapG[_i32]/255;bufferB[_i32]=mapB[_i32]/255;}return[bufferR.join(","),bufferG.join(","),bufferB.join(",")];}function _createUrl(id){if(_classPrivateFieldGet(_baseUrl,this)===undefined){_classPrivateFieldSet(_baseUrl,this,"");var url=_classPrivateFieldGet(_document2,this).URL;if(url!==_classPrivateFieldGet(_document2,this).baseURI){if(_isDataScheme(url)){warn('#createUrl: ignore "data:"-URL for performance reasons.');}else{_classPrivateFieldSet(_baseUrl,this,url.split("#",1)[0]);}}}return"url(".concat(_classPrivateFieldGet(_baseUrl,this),"#").concat(id,")");}function _addLuminosityConversion(filter){var feColorMatrix=_classPrivateFieldGet(_document2,this).createElementNS(SVG_NS,"feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0");filter.append(feColorMatrix);}function _addGrayConversion(filter){var feColorMatrix=_classPrivateFieldGet(_document2,this).createElementNS(SVG_NS,"feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0");filter.append(feColorMatrix);}function _createFilter(id){var filter=_classPrivateFieldGet(_document2,this).createElementNS(SVG_NS,"filter");filter.setAttribute("color-interpolation-filters","sRGB");filter.setAttribute("id",id);_classPrivateGetter(_DOMFilterFactory_brand,this,_get_defs).append(filter);return filter;}function _appendFeFunc(feComponentTransfer,func,table){var feFunc=_classPrivateFieldGet(_document2,this).createElementNS(SVG_NS,func);feFunc.setAttribute("type","discrete");feFunc.setAttribute("tableValues",table);feComponentTransfer.append(feFunc);}function _addTransferMapConversion(rTable,gTable,bTable,filter){var feComponentTransfer=_classPrivateFieldGet(_document2,this).createElementNS(SVG_NS,"feComponentTransfer");filter.append(feComponentTransfer);_assertClassBrand(_DOMFilterFactory_brand,this,_appendFeFunc).call(this,feComponentTransfer,"feFuncR",rTable);_assertClassBrand(_DOMFilterFactory_brand,this,_appendFeFunc).call(this,feComponentTransfer,"feFuncG",gTable);_assertClassBrand(_DOMFilterFactory_brand,this,_appendFeFunc).call(this,feComponentTransfer,"feFuncB",bTable);}function _addTransferMapAlphaConversion(aTable,filter){var feComponentTransfer=_classPrivateFieldGet(_document2,this).createElementNS(SVG_NS,"feComponentTransfer");filter.append(feComponentTransfer);_assertClassBrand(_DOMFilterFactory_brand,this,_appendFeFunc).call(this,feComponentTransfer,"feFuncA",aTable);}function _getRGB(color){_classPrivateGetter(_DOMFilterFactory_brand,this,_get_defs).style.color=color;return getRGB(getComputedStyle(_classPrivateGetter(_DOMFilterFactory_brand,this,_get_defs)).getPropertyValue("color"));};// ./src/display/standard_fontdata_factory.js
var BaseStandardFontDataFactory=/*#__PURE__*/function(){function BaseStandardFontDataFactory(_ref24){var _ref24$baseUrl=_ref24.baseUrl,baseUrl=_ref24$baseUrl===void 0?null:_ref24$baseUrl;_classCallCheck(this,BaseStandardFontDataFactory);this.baseUrl=baseUrl;}return _createClass(BaseStandardFontDataFactory,[{key:"fetch",value:function(){var _fetch5=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee18(_ref25){var filename,url;return _regenerator().w(function(_context18){while(1)switch(_context18.n){case 0:filename=_ref25.filename;if(this.baseUrl){_context18.n=1;break;}throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");case 1:if(filename){_context18.n=2;break;}throw new Error("Font filename must be specified.");case 2:url="".concat(this.baseUrl).concat(filename);return _context18.a(2,this._fetch(url)["catch"](function(reason){throw new Error("Unable to load font data at: ".concat(url));}));}},_callee18,this);}));function fetch(_x21){return _fetch5.apply(this,arguments);}return fetch;}()},{key:"_fetch",value:function(){var _fetch6=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee19(url){return _regenerator().w(function(_context19){while(1)switch(_context19.n){case 0:unreachable("Abstract method `_fetch` called.");case 1:return _context19.a(2);}},_callee19);}));function _fetch(_x22){return _fetch6.apply(this,arguments);}return _fetch;}()}]);}();var DOMStandardFontDataFactory=/*#__PURE__*/function(_BaseStandardFontData){function DOMStandardFontDataFactory(){_classCallCheck(this,DOMStandardFontDataFactory);return _callSuper(this,DOMStandardFontDataFactory,arguments);}_inherits(DOMStandardFontDataFactory,_BaseStandardFontData);return _createClass(DOMStandardFontDataFactory,[{key:"_fetch",value:function(){var _fetch7=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee20(url){var data;return _regenerator().w(function(_context20){while(1)switch(_context20.n){case 0:_context20.n=1;return _fetchData(url,"arraybuffer");case 1:data=_context20.v;return _context20.a(2,new Uint8Array(data));}},_callee20);}));function _fetch(_x23){return _fetch7.apply(this,arguments);}return _fetch;}()}]);}(BaseStandardFontDataFactory);;// ./src/display/wasm_factory.js
var BaseWasmFactory=/*#__PURE__*/function(){function BaseWasmFactory(_ref26){var _ref26$baseUrl=_ref26.baseUrl,baseUrl=_ref26$baseUrl===void 0?null:_ref26$baseUrl;_classCallCheck(this,BaseWasmFactory);this.baseUrl=baseUrl;}return _createClass(BaseWasmFactory,[{key:"fetch",value:function(){var _fetch8=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee21(_ref27){var filename,url;return _regenerator().w(function(_context21){while(1)switch(_context21.n){case 0:filename=_ref27.filename;if(this.baseUrl){_context21.n=1;break;}throw new Error("Ensure that the `wasmUrl` API parameter is provided.");case 1:if(filename){_context21.n=2;break;}throw new Error("Wasm filename must be specified.");case 2:url="".concat(this.baseUrl).concat(filename);return _context21.a(2,this._fetch(url)["catch"](function(reason){throw new Error("Unable to load wasm data at: ".concat(url));}));}},_callee21,this);}));function fetch(_x24){return _fetch8.apply(this,arguments);}return fetch;}()},{key:"_fetch",value:function(){var _fetch9=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee22(url){return _regenerator().w(function(_context22){while(1)switch(_context22.n){case 0:unreachable("Abstract method `_fetch` called.");case 1:return _context22.a(2);}},_callee22);}));function _fetch(_x25){return _fetch9.apply(this,arguments);}return _fetch;}()}]);}();var DOMWasmFactory=/*#__PURE__*/function(_BaseWasmFactory){function DOMWasmFactory(){_classCallCheck(this,DOMWasmFactory);return _callSuper(this,DOMWasmFactory,arguments);}_inherits(DOMWasmFactory,_BaseWasmFactory);return _createClass(DOMWasmFactory,[{key:"_fetch",value:function(){var _fetch0=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee23(url){var data;return _regenerator().w(function(_context23){while(1)switch(_context23.n){case 0:_context23.n=1;return _fetchData(url,"arraybuffer");case 1:data=_context23.v;return _context23.a(2,new Uint8Array(data));}},_callee23);}));function _fetch(_x26){return _fetch0.apply(this,arguments);}return _fetch;}()}]);}(BaseWasmFactory);;// ./src/display/node_utils.js
if(isNodeJS){warn("Please use the `legacy` build in Node.js environments.");}function node_utils_fetchData(_x27){return _node_utils_fetchData.apply(this,arguments);}function _node_utils_fetchData(){_node_utils_fetchData=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee61(url){var fs,data;return _regenerator().w(function(_context62){while(1)switch(_context62.n){case 0:fs=process.getBuiltinModule("fs");_context62.n=1;return fs.promises.readFile(url);case 1:data=_context62.v;return _context62.a(2,new Uint8Array(data));}},_callee61);}));return _node_utils_fetchData.apply(this,arguments);}var NodeFilterFactory=/*#__PURE__*/function(_BaseFilterFactory2){function NodeFilterFactory(){_classCallCheck(this,NodeFilterFactory);return _callSuper(this,NodeFilterFactory,arguments);}_inherits(NodeFilterFactory,_BaseFilterFactory2);return _createClass(NodeFilterFactory);}(BaseFilterFactory);var NodeCanvasFactory=/*#__PURE__*/function(_BaseCanvasFactory3){function NodeCanvasFactory(){_classCallCheck(this,NodeCanvasFactory);return _callSuper(this,NodeCanvasFactory,arguments);}_inherits(NodeCanvasFactory,_BaseCanvasFactory3);return _createClass(NodeCanvasFactory,[{key:"_createCanvas",value:function _createCanvas(width,height){var require=process.getBuiltinModule("module").createRequire(import.meta.url);var canvas=require("@napi-rs/canvas");return canvas.createCanvas(width,height);}}]);}(BaseCanvasFactory);var NodeCMapReaderFactory=/*#__PURE__*/function(_BaseCMapReaderFactor2){function NodeCMapReaderFactory(){_classCallCheck(this,NodeCMapReaderFactory);return _callSuper(this,NodeCMapReaderFactory,arguments);}_inherits(NodeCMapReaderFactory,_BaseCMapReaderFactor2);return _createClass(NodeCMapReaderFactory,[{key:"_fetch",value:function(){var _fetch1=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee24(url){return _regenerator().w(function(_context24){while(1)switch(_context24.n){case 0:return _context24.a(2,node_utils_fetchData(url));}},_callee24);}));function _fetch(_x28){return _fetch1.apply(this,arguments);}return _fetch;}()}]);}(BaseCMapReaderFactory);var NodeStandardFontDataFactory=/*#__PURE__*/function(_BaseStandardFontData2){function NodeStandardFontDataFactory(){_classCallCheck(this,NodeStandardFontDataFactory);return _callSuper(this,NodeStandardFontDataFactory,arguments);}_inherits(NodeStandardFontDataFactory,_BaseStandardFontData2);return _createClass(NodeStandardFontDataFactory,[{key:"_fetch",value:function(){var _fetch10=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee25(url){return _regenerator().w(function(_context25){while(1)switch(_context25.n){case 0:return _context25.a(2,node_utils_fetchData(url));}},_callee25);}));function _fetch(_x29){return _fetch10.apply(this,arguments);}return _fetch;}()}]);}(BaseStandardFontDataFactory);var NodeWasmFactory=/*#__PURE__*/function(_BaseWasmFactory2){function NodeWasmFactory(){_classCallCheck(this,NodeWasmFactory);return _callSuper(this,NodeWasmFactory,arguments);}_inherits(NodeWasmFactory,_BaseWasmFactory2);return _createClass(NodeWasmFactory,[{key:"_fetch",value:function(){var _fetch11=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee26(url){return _regenerator().w(function(_context26){while(1)switch(_context26.n){case 0:return _context26.a(2,node_utils_fetchData(url));}},_callee26);}));function _fetch(_x30){return _fetch11.apply(this,arguments);}return _fetch;}()}]);}(BaseWasmFactory);;// ./src/display/pattern_helper.js
var PathType={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function applyBoundingBox(ctx,bbox){if(!bbox){return;}var width=bbox[2]-bbox[0];var height=bbox[3]-bbox[1];var region=new Path2D();region.rect(bbox[0],bbox[1],width,height);ctx.clip(region);}var BaseShadingPattern=/*#__PURE__*/function(){function BaseShadingPattern(){_classCallCheck(this,BaseShadingPattern);}return _createClass(BaseShadingPattern,[{key:"isModifyingCurrentTransform",value:function isModifyingCurrentTransform(){return false;}},{key:"getPattern",value:function getPattern(){unreachable("Abstract method `getPattern` called.");}}]);}();var RadialAxialShadingPattern=/*#__PURE__*/function(_BaseShadingPattern){function RadialAxialShadingPattern(IR){var _this28;_classCallCheck(this,RadialAxialShadingPattern);_this28=_callSuper(this,RadialAxialShadingPattern);_this28._type=IR[1];_this28._bbox=IR[2];_this28._colorStops=IR[3];_this28._p0=IR[4];_this28._p1=IR[5];_this28._r0=IR[6];_this28._r1=IR[7];_this28.matrix=null;return _this28;}_inherits(RadialAxialShadingPattern,_BaseShadingPattern);return _createClass(RadialAxialShadingPattern,[{key:"_createGradient",value:function _createGradient(ctx){var grad;if(this._type==="axial"){grad=ctx.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]);}else if(this._type==="radial"){grad=ctx.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1);}var _iterator54=_createForOfIteratorHelper(this._colorStops),_step54;try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var colorStop=_step54.value;grad.addColorStop(colorStop[0],colorStop[1]);}}catch(err){_iterator54.e(err);}finally{_iterator54.f();}return grad;}},{key:"getPattern",value:function getPattern(ctx,owner,inverse,pathType){var pattern;if(pathType===PathType.STROKE||pathType===PathType.FILL){var ownerBBox=owner.current.getClippedPathBoundingBox(pathType,getCurrentTransform(ctx))||[0,0,0,0];var width=Math.ceil(ownerBBox[2]-ownerBBox[0])||1;var height=Math.ceil(ownerBBox[3]-ownerBBox[1])||1;var tmpCanvas=owner.cachedCanvases.getCanvas("pattern",width,height);var tmpCtx=tmpCanvas.context;tmpCtx.clearRect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height);tmpCtx.beginPath();tmpCtx.rect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height);tmpCtx.translate(-ownerBBox[0],-ownerBBox[1]);inverse=_Util.transform(inverse,[1,0,0,1,ownerBBox[0],ownerBBox[1]]);tmpCtx.transform.apply(tmpCtx,_toConsumableArray(owner.baseTransform));if(this.matrix){tmpCtx.transform.apply(tmpCtx,_toConsumableArray(this.matrix));}applyBoundingBox(tmpCtx,this._bbox);tmpCtx.fillStyle=this._createGradient(tmpCtx);tmpCtx.fill();pattern=ctx.createPattern(tmpCanvas.canvas,"no-repeat");var domMatrix=new DOMMatrix(inverse);pattern.setTransform(domMatrix);}else{applyBoundingBox(ctx,this._bbox);pattern=this._createGradient(ctx);}return pattern;}}]);}(BaseShadingPattern);function drawTriangle(data,context,p1,p2,p3,c1,c2,c3){var coords=context.coords,colors=context.colors;var bytes=data.data,rowSize=data.width*4;var tmp;if(coords[p1+1]>coords[p2+1]){tmp=p1;p1=p2;p2=tmp;tmp=c1;c1=c2;c2=tmp;}if(coords[p2+1]>coords[p3+1]){tmp=p2;p2=p3;p3=tmp;tmp=c2;c2=c3;c3=tmp;}if(coords[p1+1]>coords[p2+1]){tmp=p1;p1=p2;p2=tmp;tmp=c1;c1=c2;c2=tmp;}var x1=(coords[p1]+context.offsetX)*context.scaleX;var y1=(coords[p1+1]+context.offsetY)*context.scaleY;var x2=(coords[p2]+context.offsetX)*context.scaleX;var y2=(coords[p2+1]+context.offsetY)*context.scaleY;var x3=(coords[p3]+context.offsetX)*context.scaleX;var y3=(coords[p3+1]+context.offsetY)*context.scaleY;if(y1>=y3){return;}var c1r=colors[c1],c1g=colors[c1+1],c1b=colors[c1+2];var c2r=colors[c2],c2g=colors[c2+1],c2b=colors[c2+2];var c3r=colors[c3],c3g=colors[c3+1],c3b=colors[c3+2];var minY=Math.round(y1),maxY=Math.round(y3);var xa,car,cag,cab;var xb,cbr,cbg,cbb;for(var y=minY;y<=maxY;y++){if(y<y2){var _k=y<y1?0:(y1-y)/(y1-y2);xa=x1-(x1-x2)*_k;car=c1r-(c1r-c2r)*_k;cag=c1g-(c1g-c2g)*_k;cab=c1b-(c1b-c2b)*_k;}else{var _k2=void 0;if(y>y3){_k2=1;}else if(y2===y3){_k2=0;}else{_k2=(y2-y)/(y2-y3);}xa=x2-(x2-x3)*_k2;car=c2r-(c2r-c3r)*_k2;cag=c2g-(c2g-c3g)*_k2;cab=c2b-(c2b-c3b)*_k2;}var k=void 0;if(y<y1){k=0;}else if(y>y3){k=1;}else{k=(y1-y)/(y1-y3);}xb=x1-(x1-x3)*k;cbr=c1r-(c1r-c3r)*k;cbg=c1g-(c1g-c3g)*k;cbb=c1b-(c1b-c3b)*k;var x1_=Math.round(Math.min(xa,xb));var x2_=Math.round(Math.max(xa,xb));var j=rowSize*y+x1_*4;for(var x=x1_;x<=x2_;x++){k=(xa-x)/(xa-xb);if(k<0){k=0;}else if(k>1){k=1;}bytes[j++]=car-(car-cbr)*k|0;bytes[j++]=cag-(cag-cbg)*k|0;bytes[j++]=cab-(cab-cbb)*k|0;bytes[j++]=255;}}}function drawFigure(data,figure,context){var ps=figure.coords;var cs=figure.colors;var i,ii;switch(figure.type){case"lattice":var verticesPerRow=figure.verticesPerRow;var rows=Math.floor(ps.length/verticesPerRow)-1;var cols=verticesPerRow-1;for(i=0;i<rows;i++){var q=i*verticesPerRow;for(var j=0;j<cols;j++,q++){drawTriangle(data,context,ps[q],ps[q+1],ps[q+verticesPerRow],cs[q],cs[q+1],cs[q+verticesPerRow]);drawTriangle(data,context,ps[q+verticesPerRow+1],ps[q+1],ps[q+verticesPerRow],cs[q+verticesPerRow+1],cs[q+1],cs[q+verticesPerRow]);}}break;case"triangles":for(i=0,ii=ps.length;i<ii;i+=3){drawTriangle(data,context,ps[i],ps[i+1],ps[i+2],cs[i],cs[i+1],cs[i+2]);}break;default:throw new Error("illegal figure");}}var MeshShadingPattern=/*#__PURE__*/function(_BaseShadingPattern2){function MeshShadingPattern(IR){var _this29;_classCallCheck(this,MeshShadingPattern);_this29=_callSuper(this,MeshShadingPattern);_this29._coords=IR[2];_this29._colors=IR[3];_this29._figures=IR[4];_this29._bounds=IR[5];_this29._bbox=IR[6];_this29._background=IR[7];_this29.matrix=null;return _this29;}_inherits(MeshShadingPattern,_BaseShadingPattern2);return _createClass(MeshShadingPattern,[{key:"_createMeshCanvas",value:function _createMeshCanvas(combinedScale,backgroundColor,cachedCanvases){var EXPECTED_SCALE=1.1;var MAX_PATTERN_SIZE=3000;var BORDER_SIZE=2;var offsetX=Math.floor(this._bounds[0]);var offsetY=Math.floor(this._bounds[1]);var boundsWidth=Math.ceil(this._bounds[2])-offsetX;var boundsHeight=Math.ceil(this._bounds[3])-offsetY;var width=Math.min(Math.ceil(Math.abs(boundsWidth*combinedScale[0]*EXPECTED_SCALE)),MAX_PATTERN_SIZE);var height=Math.min(Math.ceil(Math.abs(boundsHeight*combinedScale[1]*EXPECTED_SCALE)),MAX_PATTERN_SIZE);var scaleX=boundsWidth/width;var scaleY=boundsHeight/height;var context={coords:this._coords,colors:this._colors,offsetX:-offsetX,offsetY:-offsetY,scaleX:1/scaleX,scaleY:1/scaleY};var paddedWidth=width+BORDER_SIZE*2;var paddedHeight=height+BORDER_SIZE*2;var tmpCanvas=cachedCanvases.getCanvas("mesh",paddedWidth,paddedHeight);var tmpCtx=tmpCanvas.context;var data=tmpCtx.createImageData(width,height);if(backgroundColor){var bytes=data.data;for(var i=0,ii=bytes.length;i<ii;i+=4){bytes[i]=backgroundColor[0];bytes[i+1]=backgroundColor[1];bytes[i+2]=backgroundColor[2];bytes[i+3]=255;}}var _iterator55=_createForOfIteratorHelper(this._figures),_step55;try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var figure=_step55.value;drawFigure(data,figure,context);}}catch(err){_iterator55.e(err);}finally{_iterator55.f();}tmpCtx.putImageData(data,BORDER_SIZE,BORDER_SIZE);var canvas=tmpCanvas.canvas;return{canvas:canvas,offsetX:offsetX-BORDER_SIZE*scaleX,offsetY:offsetY-BORDER_SIZE*scaleY,scaleX:scaleX,scaleY:scaleY};}},{key:"isModifyingCurrentTransform",value:function isModifyingCurrentTransform(){return true;}},{key:"getPattern",value:function getPattern(ctx,owner,inverse,pathType){applyBoundingBox(ctx,this._bbox);var scale;if(pathType===PathType.SHADING){scale=_Util.singularValueDecompose2dScale(getCurrentTransform(ctx));}else{scale=_Util.singularValueDecompose2dScale(owner.baseTransform);if(this.matrix){var matrixScale=_Util.singularValueDecompose2dScale(this.matrix);scale=[scale[0]*matrixScale[0],scale[1]*matrixScale[1]];}}var temporaryPatternCanvas=this._createMeshCanvas(scale,pathType===PathType.SHADING?null:this._background,owner.cachedCanvases);if(pathType!==PathType.SHADING){ctx.setTransform.apply(ctx,_toConsumableArray(owner.baseTransform));if(this.matrix){ctx.transform.apply(ctx,_toConsumableArray(this.matrix));}}ctx.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY);ctx.scale(temporaryPatternCanvas.scaleX,temporaryPatternCanvas.scaleY);return ctx.createPattern(temporaryPatternCanvas.canvas,"no-repeat");}}]);}(BaseShadingPattern);var DummyShadingPattern=/*#__PURE__*/function(_BaseShadingPattern3){function DummyShadingPattern(){_classCallCheck(this,DummyShadingPattern);return _callSuper(this,DummyShadingPattern,arguments);}_inherits(DummyShadingPattern,_BaseShadingPattern3);return _createClass(DummyShadingPattern,[{key:"getPattern",value:function getPattern(){return"hotpink";}}]);}(BaseShadingPattern);function getShadingPattern(IR){switch(IR[0]){case"RadialAxial":return new RadialAxialShadingPattern(IR);case"Mesh":return new MeshShadingPattern(IR);case"Dummy":return new DummyShadingPattern();}throw new Error("Unknown IR type: ".concat(IR[0]));}var PaintType={COLORED:1,UNCOLORED:2};var TilingPattern=/*#__PURE__*/function(){function TilingPattern(IR,ctx,canvasGraphicsFactory,baseTransform){_classCallCheck(this,TilingPattern);this.color=IR[1];this.operatorList=IR[2];this.matrix=IR[3];this.bbox=IR[4];this.xstep=IR[5];this.ystep=IR[6];this.paintType=IR[7];this.tilingType=IR[8];this.ctx=ctx;this.canvasGraphicsFactory=canvasGraphicsFactory;this.baseTransform=baseTransform;}return _createClass(TilingPattern,[{key:"createPatternCanvas",value:function createPatternCanvas(owner){var bbox=this.bbox,operatorList=this.operatorList,paintType=this.paintType,tilingType=this.tilingType,color=this.color,canvasGraphicsFactory=this.canvasGraphicsFactory;var xstep=this.xstep,ystep=this.ystep;xstep=Math.abs(xstep);ystep=Math.abs(ystep);info("TilingType: "+tilingType);var x0=bbox[0],y0=bbox[1],x1=bbox[2],y1=bbox[3];var width=x1-x0;var height=y1-y0;var matrixScale=_Util.singularValueDecompose2dScale(this.matrix);var curMatrixScale=_Util.singularValueDecompose2dScale(this.baseTransform);var combinedScaleX=matrixScale[0]*curMatrixScale[0];var combinedScaleY=matrixScale[1]*curMatrixScale[1];var canvasWidth=width,canvasHeight=height,redrawHorizontally=false,redrawVertically=false;var xScaledStep=Math.ceil(xstep*combinedScaleX);var yScaledStep=Math.ceil(ystep*combinedScaleY);var xScaledWidth=Math.ceil(width*combinedScaleX);var yScaledHeight=Math.ceil(height*combinedScaleY);if(xScaledStep>=xScaledWidth){canvasWidth=xstep;}else{redrawHorizontally=true;}if(yScaledStep>=yScaledHeight){canvasHeight=ystep;}else{redrawVertically=true;}var dimx=this.getSizeAndScale(canvasWidth,this.ctx.canvas.width,combinedScaleX);var dimy=this.getSizeAndScale(canvasHeight,this.ctx.canvas.height,combinedScaleY);var tmpCanvas=owner.cachedCanvases.getCanvas("pattern",dimx.size,dimy.size);var tmpCtx=tmpCanvas.context;var graphics=canvasGraphicsFactory.createCanvasGraphics(tmpCtx);graphics.groupLevel=owner.groupLevel;this.setFillAndStrokeStyleToContext(graphics,paintType,color);tmpCtx.translate(-dimx.scale*x0,-dimy.scale*y0);graphics.transform(dimx.scale,0,0,dimy.scale,0,0);tmpCtx.save();this.clipBbox(graphics,x0,y0,x1,y1);graphics.baseTransform=getCurrentTransform(graphics.ctx);graphics.executeOperatorList(operatorList);graphics.endDrawing();tmpCtx.restore();if(redrawHorizontally||redrawVertically){var image=tmpCanvas.canvas;if(redrawHorizontally){canvasWidth=xstep;}if(redrawVertically){canvasHeight=ystep;}var dimx2=this.getSizeAndScale(canvasWidth,this.ctx.canvas.width,combinedScaleX);var dimy2=this.getSizeAndScale(canvasHeight,this.ctx.canvas.height,combinedScaleY);var xSize=dimx2.size;var ySize=dimy2.size;var tmpCanvas2=owner.cachedCanvases.getCanvas("pattern-workaround",xSize,ySize);var tmpCtx2=tmpCanvas2.context;var ii=redrawHorizontally?Math.floor(width/xstep):0;var jj=redrawVertically?Math.floor(height/ystep):0;for(var i=0;i<=ii;i++){for(var j=0;j<=jj;j++){tmpCtx2.drawImage(image,xSize*i,ySize*j,xSize,ySize,0,0,xSize,ySize);}}return{canvas:tmpCanvas2.canvas,scaleX:dimx2.scale,scaleY:dimy2.scale,offsetX:x0,offsetY:y0};}return{canvas:tmpCanvas.canvas,scaleX:dimx.scale,scaleY:dimy.scale,offsetX:x0,offsetY:y0};}},{key:"getSizeAndScale",value:function getSizeAndScale(step,realOutputSize,scale){var maxSize=Math.max(TilingPattern.MAX_PATTERN_SIZE,realOutputSize);var size=Math.ceil(step*scale);if(size>=maxSize){size=maxSize;}else{scale=size/step;}return{scale:scale,size:size};}},{key:"clipBbox",value:function clipBbox(graphics,x0,y0,x1,y1){var bboxWidth=x1-x0;var bboxHeight=y1-y0;graphics.ctx.rect(x0,y0,bboxWidth,bboxHeight);graphics.current.updateRectMinMax(getCurrentTransform(graphics.ctx),[x0,y0,x1,y1]);graphics.clip();graphics.endPath();}},{key:"setFillAndStrokeStyleToContext",value:function setFillAndStrokeStyleToContext(graphics,paintType,color){var context=graphics.ctx,current=graphics.current;switch(paintType){case PaintType.COLORED:var ctx=this.ctx;context.fillStyle=ctx.fillStyle;context.strokeStyle=ctx.strokeStyle;current.fillColor=ctx.fillStyle;current.strokeColor=ctx.strokeStyle;break;case PaintType.UNCOLORED:var cssColor=_Util.makeHexColor(color[0],color[1],color[2]);context.fillStyle=cssColor;context.strokeStyle=cssColor;current.fillColor=cssColor;current.strokeColor=cssColor;break;default:throw new FormatError("Unsupported paint type: ".concat(paintType));}}},{key:"isModifyingCurrentTransform",value:function isModifyingCurrentTransform(){return false;}},{key:"getPattern",value:function getPattern(ctx,owner,inverse,pathType){var matrix=inverse;if(pathType!==PathType.SHADING){matrix=_Util.transform(matrix,owner.baseTransform);if(this.matrix){matrix=_Util.transform(matrix,this.matrix);}}var temporaryPatternCanvas=this.createPatternCanvas(owner);var domMatrix=new DOMMatrix(matrix);domMatrix=domMatrix.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY);domMatrix=domMatrix.scale(1/temporaryPatternCanvas.scaleX,1/temporaryPatternCanvas.scaleY);var pattern=ctx.createPattern(temporaryPatternCanvas.canvas,"repeat");pattern.setTransform(domMatrix);return pattern;}}]);}();_defineProperty(TilingPattern,"MAX_PATTERN_SIZE",3000);;// ./src/shared/image_utils.js
function convertToRGBA(params){switch(params.kind){case ImageKind.GRAYSCALE_1BPP:return convertBlackAndWhiteToRGBA(params);case ImageKind.RGB_24BPP:return convertRGBToRGBA(params);}return null;}function convertBlackAndWhiteToRGBA(_ref28){var src=_ref28.src,_ref28$srcPos=_ref28.srcPos,srcPos=_ref28$srcPos===void 0?0:_ref28$srcPos,dest=_ref28.dest,width=_ref28.width,height=_ref28.height,_ref28$nonBlackColor=_ref28.nonBlackColor,nonBlackColor=_ref28$nonBlackColor===void 0?0xffffffff:_ref28$nonBlackColor,_ref28$inverseDecode=_ref28.inverseDecode,inverseDecode=_ref28$inverseDecode===void 0?false:_ref28$inverseDecode;var black=util_FeatureTest.isLittleEndian?0xff000000:0x000000ff;var _ref29=inverseDecode?[nonBlackColor,black]:[black,nonBlackColor],_ref30=_slicedToArray(_ref29,2),zeroMapping=_ref30[0],oneMapping=_ref30[1];var widthInSource=width>>3;var widthRemainder=width&7;var srcLength=src.length;dest=new Uint32Array(dest.buffer);var destPos=0;for(var i=0;i<height;i++){for(var max=srcPos+widthInSource;srcPos<max;srcPos++){var _elem=srcPos<srcLength?src[srcPos]:255;dest[destPos++]=_elem&128?oneMapping:zeroMapping;dest[destPos++]=_elem&64?oneMapping:zeroMapping;dest[destPos++]=_elem&32?oneMapping:zeroMapping;dest[destPos++]=_elem&16?oneMapping:zeroMapping;dest[destPos++]=_elem&8?oneMapping:zeroMapping;dest[destPos++]=_elem&4?oneMapping:zeroMapping;dest[destPos++]=_elem&2?oneMapping:zeroMapping;dest[destPos++]=_elem&1?oneMapping:zeroMapping;}if(widthRemainder===0){continue;}var elem=srcPos<srcLength?src[srcPos++]:255;for(var j=0;j<widthRemainder;j++){dest[destPos++]=elem&1<<7-j?oneMapping:zeroMapping;}}return{srcPos:srcPos,destPos:destPos};}function convertRGBToRGBA(_ref31){var src=_ref31.src,_ref31$srcPos=_ref31.srcPos,srcPos=_ref31$srcPos===void 0?0:_ref31$srcPos,dest=_ref31.dest,_ref31$destPos=_ref31.destPos,destPos=_ref31$destPos===void 0?0:_ref31$destPos,width=_ref31.width,height=_ref31.height;var i=0;var len=width*height*3;var len32=len>>2;var src32=new Uint32Array(src.buffer,srcPos,len32);if(FeatureTest.isLittleEndian){for(;i<len32-2;i+=3,destPos+=4){var s1=src32[i];var s2=src32[i+1];var s3=src32[i+2];dest[destPos]=s1|0xff000000;dest[destPos+1]=s1>>>24|s2<<8|0xff000000;dest[destPos+2]=s2>>>16|s3<<16|0xff000000;dest[destPos+3]=s3>>>8|0xff000000;}for(var j=i*4,jj=srcPos+len;j<jj;j+=3){dest[destPos++]=src[j]|src[j+1]<<8|src[j+2]<<16|0xff000000;}}else{for(;i<len32-2;i+=3,destPos+=4){var _s=src32[i];var _s2=src32[i+1];var _s3=src32[i+2];dest[destPos]=_s|0xff;dest[destPos+1]=_s<<24|_s2>>>8|0xff;dest[destPos+2]=_s2<<16|_s3>>>16|0xff;dest[destPos+3]=_s3<<8|0xff;}for(var _j=i*4,_jj=srcPos+len;_j<_jj;_j+=3){dest[destPos++]=src[_j]<<24|src[_j+1]<<16|src[_j+2]<<8|0xff;}}return{srcPos:srcPos+len,destPos:destPos};}function grayToRGBA(src,dest){if(FeatureTest.isLittleEndian){for(var i=0,ii=src.length;i<ii;i++){dest[i]=src[i]*0x10101|0xff000000;}}else{for(var _i11=0,_ii2=src.length;_i11<_ii2;_i11++){dest[_i11]=src[_i11]*0x1010100|0x000000ff;}}};// ./src/display/canvas.js
var MIN_FONT_SIZE=16;var MAX_FONT_SIZE=100;var EXECUTION_TIME=15;var EXECUTION_STEPS=10;var MAX_SIZE_TO_COMPILE=1000;var FULL_CHUNK_HEIGHT=16;var SCALE_MATRIX=new DOMMatrix();function mirrorContextOperations(ctx,destCtx){if(ctx._removeMirroring){throw new Error("Context is already forwarding operations.");}ctx.__originalSave=ctx.save;ctx.__originalRestore=ctx.restore;ctx.__originalRotate=ctx.rotate;ctx.__originalScale=ctx.scale;ctx.__originalTranslate=ctx.translate;ctx.__originalTransform=ctx.transform;ctx.__originalSetTransform=ctx.setTransform;ctx.__originalResetTransform=ctx.resetTransform;ctx.__originalClip=ctx.clip;ctx.__originalMoveTo=ctx.moveTo;ctx.__originalLineTo=ctx.lineTo;ctx.__originalBezierCurveTo=ctx.bezierCurveTo;ctx.__originalRect=ctx.rect;ctx.__originalClosePath=ctx.closePath;ctx.__originalBeginPath=ctx.beginPath;ctx._removeMirroring=function(){ctx.save=ctx.__originalSave;ctx.restore=ctx.__originalRestore;ctx.rotate=ctx.__originalRotate;ctx.scale=ctx.__originalScale;ctx.translate=ctx.__originalTranslate;ctx.transform=ctx.__originalTransform;ctx.setTransform=ctx.__originalSetTransform;ctx.resetTransform=ctx.__originalResetTransform;ctx.clip=ctx.__originalClip;ctx.moveTo=ctx.__originalMoveTo;ctx.lineTo=ctx.__originalLineTo;ctx.bezierCurveTo=ctx.__originalBezierCurveTo;ctx.rect=ctx.__originalRect;ctx.closePath=ctx.__originalClosePath;ctx.beginPath=ctx.__originalBeginPath;delete ctx._removeMirroring;};ctx.save=function ctxSave(){destCtx.save();this.__originalSave();};ctx.restore=function ctxRestore(){destCtx.restore();this.__originalRestore();};ctx.translate=function ctxTranslate(x,y){destCtx.translate(x,y);this.__originalTranslate(x,y);};ctx.scale=function ctxScale(x,y){destCtx.scale(x,y);this.__originalScale(x,y);};ctx.transform=function ctxTransform(a,b,c,d,e,f){destCtx.transform(a,b,c,d,e,f);this.__originalTransform(a,b,c,d,e,f);};ctx.setTransform=function ctxSetTransform(a,b,c,d,e,f){destCtx.setTransform(a,b,c,d,e,f);this.__originalSetTransform(a,b,c,d,e,f);};ctx.resetTransform=function ctxResetTransform(){destCtx.resetTransform();this.__originalResetTransform();};ctx.rotate=function ctxRotate(angle){destCtx.rotate(angle);this.__originalRotate(angle);};ctx.clip=function ctxRotate(rule){destCtx.clip(rule);this.__originalClip(rule);};ctx.moveTo=function(x,y){destCtx.moveTo(x,y);this.__originalMoveTo(x,y);};ctx.lineTo=function(x,y){destCtx.lineTo(x,y);this.__originalLineTo(x,y);};ctx.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){destCtx.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y);this.__originalBezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y);};ctx.rect=function(x,y,width,height){destCtx.rect(x,y,width,height);this.__originalRect(x,y,width,height);};ctx.closePath=function(){destCtx.closePath();this.__originalClosePath();};ctx.beginPath=function(){destCtx.beginPath();this.__originalBeginPath();};}var CachedCanvases=/*#__PURE__*/function(){function CachedCanvases(canvasFactory){_classCallCheck(this,CachedCanvases);this.canvasFactory=canvasFactory;this.cache=Object.create(null);}return _createClass(CachedCanvases,[{key:"getCanvas",value:function getCanvas(id,width,height){var canvasEntry;if(this.cache[id]!==undefined){canvasEntry=this.cache[id];this.canvasFactory.reset(canvasEntry,width,height);}else{canvasEntry=this.canvasFactory.create(width,height);this.cache[id]=canvasEntry;}return canvasEntry;}},{key:"delete",value:function _delete(id){delete this.cache[id];}},{key:"clear",value:function clear(){for(var id in this.cache){var canvasEntry=this.cache[id];this.canvasFactory.destroy(canvasEntry);delete this.cache[id];}}}]);}();function drawImageAtIntegerCoords(ctx,srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH){var _getCurrentTransform=getCurrentTransform(ctx),_getCurrentTransform2=_slicedToArray(_getCurrentTransform,6),a=_getCurrentTransform2[0],b=_getCurrentTransform2[1],c=_getCurrentTransform2[2],d=_getCurrentTransform2[3],tx=_getCurrentTransform2[4],ty=_getCurrentTransform2[5];if(b===0&&c===0){var tlX=destX*a+tx;var rTlX=Math.round(tlX);var tlY=destY*d+ty;var rTlY=Math.round(tlY);var brX=(destX+destW)*a+tx;var rWidth=Math.abs(Math.round(brX)-rTlX)||1;var brY=(destY+destH)*d+ty;var rHeight=Math.abs(Math.round(brY)-rTlY)||1;ctx.setTransform(Math.sign(a),0,0,Math.sign(d),rTlX,rTlY);ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,rWidth,rHeight);ctx.setTransform(a,b,c,d,tx,ty);return[rWidth,rHeight];}if(a===0&&d===0){var _tlX=destY*c+tx;var _rTlX=Math.round(_tlX);var _tlY=destX*b+ty;var _rTlY=Math.round(_tlY);var _brX=(destY+destH)*c+tx;var _rWidth=Math.abs(Math.round(_brX)-_rTlX)||1;var _brY=(destX+destW)*b+ty;var _rHeight=Math.abs(Math.round(_brY)-_rTlY)||1;ctx.setTransform(0,Math.sign(b),Math.sign(c),0,_rTlX,_rTlY);ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,_rHeight,_rWidth);ctx.setTransform(a,b,c,d,tx,ty);return[_rHeight,_rWidth];}ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH);var scaleX=Math.hypot(a,b);var scaleY=Math.hypot(c,d);return[scaleX*destW,scaleY*destH];}function compileType3Glyph(imgData){var width=imgData.width,height=imgData.height;if(width>MAX_SIZE_TO_COMPILE||height>MAX_SIZE_TO_COMPILE){return null;}var POINT_TO_PROCESS_LIMIT=1000;var POINT_TYPES=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]);var width1=width+1;var points=new Uint8Array(width1*(height+1));var i,j,j0;var lineSize=width+7&~7;var data=new Uint8Array(lineSize*height);var pos=0;var _iterator56=_createForOfIteratorHelper(imgData.data),_step56;try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var elem=_step56.value;var mask=128;while(mask>0){data[pos++]=elem&mask?0:255;mask>>=1;}}}catch(err){_iterator56.e(err);}finally{_iterator56.f();}var count=0;pos=0;if(data[pos]!==0){points[0]=1;++count;}for(j=1;j<width;j++){if(data[pos]!==data[pos+1]){points[j]=data[pos]?2:1;++count;}pos++;}if(data[pos]!==0){points[j]=2;++count;}for(i=1;i<height;i++){pos=i*lineSize;j0=i*width1;if(data[pos-lineSize]!==data[pos]){points[j0]=data[pos]?1:8;++count;}var sum=(data[pos]?4:0)+(data[pos-lineSize]?8:0);for(j=1;j<width;j++){sum=(sum>>2)+(data[pos+1]?4:0)+(data[pos-lineSize+1]?8:0);if(POINT_TYPES[sum]){points[j0+j]=POINT_TYPES[sum];++count;}pos++;}if(data[pos-lineSize]!==data[pos]){points[j0+j]=data[pos]?2:4;++count;}if(count>POINT_TO_PROCESS_LIMIT){return null;}}pos=lineSize*(height-1);j0=i*width1;if(data[pos]!==0){points[j0]=8;++count;}for(j=1;j<width;j++){if(data[pos]!==data[pos+1]){points[j0+j]=data[pos]?4:8;++count;}pos++;}if(data[pos]!==0){points[j0+j]=4;++count;}if(count>POINT_TO_PROCESS_LIMIT){return null;}var steps=new Int32Array([0,width1,-1,0,-width1,0,0,0,1]);var path=new Path2D();var _DOMMatrix$scaleSelf$=new DOMMatrix().scaleSelf(1/width,-1/height).translateSelf(0,-height),a=_DOMMatrix$scaleSelf$.a,b=_DOMMatrix$scaleSelf$.b,c=_DOMMatrix$scaleSelf$.c,d=_DOMMatrix$scaleSelf$.d,e=_DOMMatrix$scaleSelf$.e,f=_DOMMatrix$scaleSelf$.f;for(i=0;count&&i<=height;i++){var p=i*width1;var end=p+width;while(p<end&&!points[p]){p++;}if(p===end){continue;}var x=p%width1;var y=i;path.moveTo(a*x+c*y+e,b*x+d*y+f);var p0=p;var type=points[p];do{var step=steps[type];do{p+=step;}while(!points[p]);var pp=points[p];if(pp!==5&&pp!==10){type=pp;points[p]=0;}else{type=pp&0x33*type>>4;points[p]&=type>>2|type<<2;}x=p%width1;y=p/width1|0;path.lineTo(a*x+c*y+e,b*x+d*y+f);if(!points[p]){--count;}}while(p0!==p);--i;}return path;}var CanvasExtraState=/*#__PURE__*/function(){function CanvasExtraState(width,height){_classCallCheck(this,CanvasExtraState);this.alphaIsShape=false;this.fontSize=0;this.fontSizeScale=1;this.textMatrix=IDENTITY_MATRIX;this.textMatrixScale=1;this.fontMatrix=FONT_IDENTITY_MATRIX;this.leading=0;this.x=0;this.y=0;this.lineX=0;this.lineY=0;this.charSpacing=0;this.wordSpacing=0;this.textHScale=1;this.textRenderingMode=TextRenderingMode.FILL;this.textRise=0;this.fillColor="#000000";this.strokeColor="#000000";this.patternFill=false;this.patternStroke=false;this.fillAlpha=1;this.strokeAlpha=1;this.lineWidth=1;this.activeSMask=null;this.transferMaps="none";this.startNewPathAndClipBox([0,0,width,height]);}return _createClass(CanvasExtraState,[{key:"clone",value:function clone(){var clone=Object.create(this);clone.clipBox=this.clipBox.slice();return clone;}},{key:"updateRectMinMax",value:function updateRectMinMax(transform,rect){var p1=_Util.applyTransform(rect,transform);var p2=_Util.applyTransform(rect.slice(2),transform);var p3=_Util.applyTransform([rect[0],rect[3]],transform);var p4=_Util.applyTransform([rect[2],rect[1]],transform);this.minX=Math.min(this.minX,p1[0],p2[0],p3[0],p4[0]);this.minY=Math.min(this.minY,p1[1],p2[1],p3[1],p4[1]);this.maxX=Math.max(this.maxX,p1[0],p2[0],p3[0],p4[0]);this.maxY=Math.max(this.maxY,p1[1],p2[1],p3[1],p4[1]);}},{key:"getPathBoundingBox",value:function getPathBoundingBox(){var pathType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:PathType.FILL;var transform=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var box=[this.minX,this.minY,this.maxX,this.maxY];if(pathType===PathType.STROKE){if(!transform){unreachable("Stroke bounding box must include transform.");}var scale=_Util.singularValueDecompose2dScale(transform);var xStrokePad=scale[0]*this.lineWidth/2;var yStrokePad=scale[1]*this.lineWidth/2;box[0]-=xStrokePad;box[1]-=yStrokePad;box[2]+=xStrokePad;box[3]+=yStrokePad;}return box;}},{key:"updateClipFromPath",value:function updateClipFromPath(){var intersect=_Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(intersect||[0,0,0,0]);}},{key:"isEmptyClip",value:function isEmptyClip(){return this.minX===Infinity;}},{key:"startNewPathAndClipBox",value:function startNewPathAndClipBox(box){this.clipBox=box;this.minX=Infinity;this.minY=Infinity;this.maxX=0;this.maxY=0;}},{key:"getClippedPathBoundingBox",value:function getClippedPathBoundingBox(){var pathType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:PathType.FILL;var transform=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return _Util.intersect(this.clipBox,this.getPathBoundingBox(pathType,transform));}}]);}();function putBinaryImageData(ctx,imgData){if(imgData instanceof ImageData){ctx.putImageData(imgData,0,0);return;}var height=imgData.height,width=imgData.width;var partialChunkHeight=height%FULL_CHUNK_HEIGHT;var fullChunks=(height-partialChunkHeight)/FULL_CHUNK_HEIGHT;var totalChunks=partialChunkHeight===0?fullChunks:fullChunks+1;var chunkImgData=ctx.createImageData(width,FULL_CHUNK_HEIGHT);var srcPos=0,destPos;var src=imgData.data;var dest=chunkImgData.data;var i,j,thisChunkHeight,elemsInThisChunk;if(imgData.kind===util_ImageKind.GRAYSCALE_1BPP){var srcLength=src.byteLength;var dest32=new Uint32Array(dest.buffer,0,dest.byteLength>>2);var dest32DataLength=dest32.length;var fullSrcDiff=width+7>>3;var white=0xffffffff;var black=util_FeatureTest.isLittleEndian?0xff000000:0x000000ff;for(i=0;i<totalChunks;i++){thisChunkHeight=i<fullChunks?FULL_CHUNK_HEIGHT:partialChunkHeight;destPos=0;for(j=0;j<thisChunkHeight;j++){var srcDiff=srcLength-srcPos;var k=0;var kEnd=srcDiff>fullSrcDiff?width:srcDiff*8-7;var kEndUnrolled=kEnd&~7;var mask=0;var srcByte=0;for(;k<kEndUnrolled;k+=8){srcByte=src[srcPos++];dest32[destPos++]=srcByte&128?white:black;dest32[destPos++]=srcByte&64?white:black;dest32[destPos++]=srcByte&32?white:black;dest32[destPos++]=srcByte&16?white:black;dest32[destPos++]=srcByte&8?white:black;dest32[destPos++]=srcByte&4?white:black;dest32[destPos++]=srcByte&2?white:black;dest32[destPos++]=srcByte&1?white:black;}for(;k<kEnd;k++){if(mask===0){srcByte=src[srcPos++];mask=128;}dest32[destPos++]=srcByte&mask?white:black;mask>>=1;}}while(destPos<dest32DataLength){dest32[destPos++]=0;}ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT);}}else if(imgData.kind===util_ImageKind.RGBA_32BPP){j=0;elemsInThisChunk=width*FULL_CHUNK_HEIGHT*4;for(i=0;i<fullChunks;i++){dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk));srcPos+=elemsInThisChunk;ctx.putImageData(chunkImgData,0,j);j+=FULL_CHUNK_HEIGHT;}if(i<totalChunks){elemsInThisChunk=width*partialChunkHeight*4;dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk));ctx.putImageData(chunkImgData,0,j);}}else if(imgData.kind===util_ImageKind.RGB_24BPP){thisChunkHeight=FULL_CHUNK_HEIGHT;elemsInThisChunk=width*thisChunkHeight;for(i=0;i<totalChunks;i++){if(i>=fullChunks){thisChunkHeight=partialChunkHeight;elemsInThisChunk=width*thisChunkHeight;}destPos=0;for(j=elemsInThisChunk;j--;){dest[destPos++]=src[srcPos++];dest[destPos++]=src[srcPos++];dest[destPos++]=src[srcPos++];dest[destPos++]=255;}ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT);}}else{throw new Error("bad image kind: ".concat(imgData.kind));}}function putBinaryImageMask(ctx,imgData){if(imgData.bitmap){ctx.drawImage(imgData.bitmap,0,0);return;}var height=imgData.height,width=imgData.width;var partialChunkHeight=height%FULL_CHUNK_HEIGHT;var fullChunks=(height-partialChunkHeight)/FULL_CHUNK_HEIGHT;var totalChunks=partialChunkHeight===0?fullChunks:fullChunks+1;var chunkImgData=ctx.createImageData(width,FULL_CHUNK_HEIGHT);var srcPos=0;var src=imgData.data;var dest=chunkImgData.data;for(var i=0;i<totalChunks;i++){var thisChunkHeight=i<fullChunks?FULL_CHUNK_HEIGHT:partialChunkHeight;var _convertBlackAndWhite=convertBlackAndWhiteToRGBA({src:src,srcPos:srcPos,dest:dest,width:width,height:thisChunkHeight,nonBlackColor:0});srcPos=_convertBlackAndWhite.srcPos;ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT);}}function copyCtxState(sourceCtx,destCtx){var properties=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(var _i12=0,_properties=properties;_i12<_properties.length;_i12++){var property=_properties[_i12];if(sourceCtx[property]!==undefined){destCtx[property]=sourceCtx[property];}}if(sourceCtx.setLineDash!==undefined){destCtx.setLineDash(sourceCtx.getLineDash());destCtx.lineDashOffset=sourceCtx.lineDashOffset;}}function resetCtxToDefault(ctx){ctx.strokeStyle=ctx.fillStyle="#000000";ctx.fillRule="nonzero";ctx.globalAlpha=1;ctx.lineWidth=1;ctx.lineCap="butt";ctx.lineJoin="miter";ctx.miterLimit=10;ctx.globalCompositeOperation="source-over";ctx.font="10px sans-serif";if(ctx.setLineDash!==undefined){ctx.setLineDash([]);ctx.lineDashOffset=0;}if(!isNodeJS){var filter=ctx.filter;if(filter!=="none"&&filter!==""){ctx.filter="none";}}}function getImageSmoothingEnabled(transform,interpolate){if(interpolate){return true;}var scale=_Util.singularValueDecompose2dScale(transform);scale[0]=Math.fround(scale[0]);scale[1]=Math.fround(scale[1]);var actualScale=Math.fround(_OutputScale.pixelRatio*_PixelsPerInch.PDF_TO_CSS_UNITS);return scale[0]<=actualScale&&scale[1]<=actualScale;}var LINE_CAP_STYLES=["butt","round","square"];var LINE_JOIN_STYLES=["miter","round","bevel"];var NORMAL_CLIP={};var EO_CLIP={};var _CanvasGraphics_brand=/*#__PURE__*/new WeakSet();var CanvasGraphics=/*#__PURE__*/function(){function CanvasGraphics(canvasCtx,commonObjs,objs,canvasFactory,filterFactory,_ref32,annotationCanvasMap,pageColors){var optionalContentConfig=_ref32.optionalContentConfig,_ref32$markedContentS=_ref32.markedContentStack,markedContentStack=_ref32$markedContentS===void 0?null:_ref32$markedContentS;_classCallCheck(this,CanvasGraphics);_classPrivateMethodInitSpec(this,_CanvasGraphics_brand);this.ctx=canvasCtx;this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height);this.stateStack=[];this.pendingClip=null;this.pendingEOFill=false;this.res=null;this.xobjs=null;this.commonObjs=commonObjs;this.objs=objs;this.canvasFactory=canvasFactory;this.filterFactory=filterFactory;this.groupStack=[];this.processingType3=null;this.baseTransform=null;this.baseTransformStack=[];this.groupLevel=0;this.smaskStack=[];this.smaskCounter=0;this.tempSMask=null;this.suspendedCtx=null;this.contentVisible=true;this.markedContentStack=markedContentStack||[];this.optionalContentConfig=optionalContentConfig;this.cachedCanvases=new CachedCanvases(this.canvasFactory);this.cachedPatterns=new Map();this.annotationCanvasMap=annotationCanvasMap;this.viewportScale=1;this.outputScaleX=1;this.outputScaleY=1;this.pageColors=pageColors;this._cachedScaleForStroking=[-1,0];this._cachedGetSinglePixelWidth=null;this._cachedBitmapsMap=new Map();}return _createClass(CanvasGraphics,[{key:"getObject",value:function getObject(data){var fallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(typeof data==="string"){return data.startsWith("g_")?this.commonObjs.get(data):this.objs.get(data);}return fallback;}},{key:"beginDrawing",value:function beginDrawing(_ref33){var _this$ctx3;var transform=_ref33.transform,viewport=_ref33.viewport,_ref33$transparency=_ref33.transparency,transparency=_ref33$transparency===void 0?false:_ref33$transparency,_ref33$background=_ref33.background,background=_ref33$background===void 0?null:_ref33$background;var width=this.ctx.canvas.width;var height=this.ctx.canvas.height;var savedFillStyle=this.ctx.fillStyle;this.ctx.fillStyle=background||"#ffffff";this.ctx.fillRect(0,0,width,height);this.ctx.fillStyle=savedFillStyle;if(transparency){var _this$ctx;var transparentCanvas=this.cachedCanvases.getCanvas("transparent",width,height);this.compositeCtx=this.ctx;this.transparentCanvas=transparentCanvas.canvas;this.ctx=transparentCanvas.context;this.ctx.save();(_this$ctx=this.ctx).transform.apply(_this$ctx,_toConsumableArray(getCurrentTransform(this.compositeCtx)));}this.ctx.save();resetCtxToDefault(this.ctx);if(transform){var _this$ctx2;(_this$ctx2=this.ctx).transform.apply(_this$ctx2,_toConsumableArray(transform));this.outputScaleX=transform[0];this.outputScaleY=transform[0];}(_this$ctx3=this.ctx).transform.apply(_this$ctx3,_toConsumableArray(viewport.transform));this.viewportScale=viewport.scale;this.baseTransform=getCurrentTransform(this.ctx);}},{key:"executeOperatorList",value:function executeOperatorList(operatorList,executionStartIdx,continueCallback,stepper){var argsArray=operatorList.argsArray;var fnArray=operatorList.fnArray;var i=executionStartIdx||0;var argsArrayLen=argsArray.length;if(argsArrayLen===i){return i;}var chunkOperations=argsArrayLen-i>EXECUTION_STEPS&&typeof continueCallback==="function";var endTime=chunkOperations?Date.now()+EXECUTION_TIME:0;var steps=0;var commonObjs=this.commonObjs;var objs=this.objs;var fnId;while(true){if(stepper!==undefined&&i===stepper.nextBreakPoint){stepper.breakIt(i,continueCallback);return i;}fnId=fnArray[i];if(fnId!==_OPS.dependency){this[fnId].apply(this,argsArray[i]);}else{var _iterator57=_createForOfIteratorHelper(argsArray[i]),_step57;try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var depObjId=_step57.value;var objsPool=depObjId.startsWith("g_")?commonObjs:objs;if(!objsPool.has(depObjId)){objsPool.get(depObjId,continueCallback);return i;}}}catch(err){_iterator57.e(err);}finally{_iterator57.f();}}i++;if(i===argsArrayLen){return i;}if(chunkOperations&&++steps>EXECUTION_STEPS){if(Date.now()>endTime){continueCallback();return i;}steps=0;}}}},{key:"endDrawing",value:function endDrawing(){_assertClassBrand(_CanvasGraphics_brand,this,_restoreInitialState).call(this);this.cachedCanvases.clear();this.cachedPatterns.clear();var _iterator58=_createForOfIteratorHelper(this._cachedBitmapsMap.values()),_step58;try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var cache=_step58.value;var _iterator59=_createForOfIteratorHelper(cache.values()),_step59;try{for(_iterator59.s();!(_step59=_iterator59.n()).done;){var canvas=_step59.value;if(typeof HTMLCanvasElement!=="undefined"&&canvas instanceof HTMLCanvasElement){canvas.width=canvas.height=0;}}}catch(err){_iterator59.e(err);}finally{_iterator59.f();}cache.clear();}}catch(err){_iterator58.e(err);}finally{_iterator58.f();}this._cachedBitmapsMap.clear();_assertClassBrand(_CanvasGraphics_brand,this,_drawFilter).call(this);}},{key:"_scaleImage",value:function _scaleImage(img,inverseTransform){var _img$width,_img$height;var width=(_img$width=img.width)!==null&&_img$width!==void 0?_img$width:img.displayWidth;var height=(_img$height=img.height)!==null&&_img$height!==void 0?_img$height:img.displayHeight;var widthScale=Math.max(Math.hypot(inverseTransform[0],inverseTransform[1]),1);var heightScale=Math.max(Math.hypot(inverseTransform[2],inverseTransform[3]),1);var paintWidth=width,paintHeight=height;var tmpCanvasId="prescale1";var tmpCanvas,tmpCtx;while(widthScale>2&&paintWidth>1||heightScale>2&&paintHeight>1){var newWidth=paintWidth,newHeight=paintHeight;if(widthScale>2&&paintWidth>1){newWidth=paintWidth>=16384?Math.floor(paintWidth/2)-1||1:Math.ceil(paintWidth/2);widthScale/=paintWidth/newWidth;}if(heightScale>2&&paintHeight>1){newHeight=paintHeight>=16384?Math.floor(paintHeight/2)-1||1:Math.ceil(paintHeight)/2;heightScale/=paintHeight/newHeight;}tmpCanvas=this.cachedCanvases.getCanvas(tmpCanvasId,newWidth,newHeight);tmpCtx=tmpCanvas.context;tmpCtx.clearRect(0,0,newWidth,newHeight);tmpCtx.drawImage(img,0,0,paintWidth,paintHeight,0,0,newWidth,newHeight);img=tmpCanvas.canvas;paintWidth=newWidth;paintHeight=newHeight;tmpCanvasId=tmpCanvasId==="prescale1"?"prescale2":"prescale1";}return{img:img,paintWidth:paintWidth,paintHeight:paintHeight};}},{key:"_createMaskCanvas",value:function _createMaskCanvas(img){var ctx=this.ctx;var width=img.width,height=img.height;var fillColor=this.current.fillColor;var isPatternFill=this.current.patternFill;var currentTransform=getCurrentTransform(ctx);var cache,cacheKey,scaled,maskCanvas;if((img.bitmap||img.data)&&img.count>1){var mainKey=img.bitmap||img.data.buffer;cacheKey=JSON.stringify(isPatternFill?currentTransform:[currentTransform.slice(0,4),fillColor]);cache=this._cachedBitmapsMap.get(mainKey);if(!cache){cache=new Map();this._cachedBitmapsMap.set(mainKey,cache);}var cachedImage=cache.get(cacheKey);if(cachedImage&&!isPatternFill){var _offsetX=Math.round(Math.min(currentTransform[0],currentTransform[2])+currentTransform[4]);var _offsetY=Math.round(Math.min(currentTransform[1],currentTransform[3])+currentTransform[5]);return{canvas:cachedImage,offsetX:_offsetX,offsetY:_offsetY};}scaled=cachedImage;}if(!scaled){maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height);putBinaryImageMask(maskCanvas.context,img);}var maskToCanvas=_Util.transform(currentTransform,[1/width,0,0,-1/height,0,0]);maskToCanvas=_Util.transform(maskToCanvas,[1,0,0,1,0,-height]);var _Util$getAxialAligned=_Util.getAxialAlignedBoundingBox([0,0,width,height],maskToCanvas),_Util$getAxialAligned2=_slicedToArray(_Util$getAxialAligned,4),minX=_Util$getAxialAligned2[0],minY=_Util$getAxialAligned2[1],maxX=_Util$getAxialAligned2[2],maxY=_Util$getAxialAligned2[3];var drawnWidth=Math.round(maxX-minX)||1;var drawnHeight=Math.round(maxY-minY)||1;var fillCanvas=this.cachedCanvases.getCanvas("fillCanvas",drawnWidth,drawnHeight);var fillCtx=fillCanvas.context;var offsetX=minX;var offsetY=minY;fillCtx.translate(-offsetX,-offsetY);fillCtx.transform.apply(fillCtx,_toConsumableArray(maskToCanvas));if(!scaled){scaled=this._scaleImage(maskCanvas.canvas,getCurrentTransformInverse(fillCtx));scaled=scaled.img;if(cache&&isPatternFill){cache.set(cacheKey,scaled);}}fillCtx.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(fillCtx),img.interpolate);drawImageAtIntegerCoords(fillCtx,scaled,0,0,scaled.width,scaled.height,0,0,width,height);fillCtx.globalCompositeOperation="source-in";var inverse=_Util.transform(getCurrentTransformInverse(fillCtx),[1,0,0,1,-offsetX,-offsetY]);fillCtx.fillStyle=isPatternFill?fillColor.getPattern(ctx,this,inverse,PathType.FILL):fillColor;fillCtx.fillRect(0,0,width,height);if(cache&&!isPatternFill){this.cachedCanvases["delete"]("fillCanvas");cache.set(cacheKey,fillCanvas.canvas);}return{canvas:fillCanvas.canvas,offsetX:Math.round(offsetX),offsetY:Math.round(offsetY)};}},{key:"setLineWidth",value:function setLineWidth(width){if(width!==this.current.lineWidth){this._cachedScaleForStroking[0]=-1;}this.current.lineWidth=width;this.ctx.lineWidth=width;}},{key:"setLineCap",value:function setLineCap(style){this.ctx.lineCap=LINE_CAP_STYLES[style];}},{key:"setLineJoin",value:function setLineJoin(style){this.ctx.lineJoin=LINE_JOIN_STYLES[style];}},{key:"setMiterLimit",value:function setMiterLimit(limit){this.ctx.miterLimit=limit;}},{key:"setDash",value:function setDash(dashArray,dashPhase){var ctx=this.ctx;if(ctx.setLineDash!==undefined){ctx.setLineDash(dashArray);ctx.lineDashOffset=dashPhase;}}},{key:"setRenderingIntent",value:function setRenderingIntent(intent){}},{key:"setFlatness",value:function setFlatness(flatness){}},{key:"setGState",value:function setGState(states){var _iterator60=_createForOfIteratorHelper(states),_step60;try{for(_iterator60.s();!(_step60=_iterator60.n()).done;){var _step60$value=_slicedToArray(_step60.value,2),key=_step60$value[0],value=_step60$value[1];switch(key){case"LW":this.setLineWidth(value);break;case"LC":this.setLineCap(value);break;case"LJ":this.setLineJoin(value);break;case"ML":this.setMiterLimit(value);break;case"D":this.setDash(value[0],value[1]);break;case"RI":this.setRenderingIntent(value);break;case"FL":this.setFlatness(value);break;case"Font":this.setFont(value[0],value[1]);break;case"CA":this.current.strokeAlpha=value;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=value;break;case"BM":this.ctx.globalCompositeOperation=value;break;case"SMask":this.current.activeSMask=value?this.tempSMask:null;this.tempSMask=null;this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(value);break;}}}catch(err){_iterator60.e(err);}finally{_iterator60.f();}}},{key:"inSMaskMode",get:function get(){return!!this.suspendedCtx;}},{key:"checkSMaskState",value:function checkSMaskState(){var inSMaskMode=this.inSMaskMode;if(this.current.activeSMask&&!inSMaskMode){this.beginSMaskMode();}else if(!this.current.activeSMask&&inSMaskMode){this.endSMaskMode();}}},{key:"beginSMaskMode",value:function beginSMaskMode(){if(this.inSMaskMode){throw new Error("beginSMaskMode called while already in smask mode");}var drawnWidth=this.ctx.canvas.width;var drawnHeight=this.ctx.canvas.height;var cacheId="smaskGroupAt"+this.groupLevel;var scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight);this.suspendedCtx=this.ctx;var ctx=this.ctx=scratchCanvas.context;ctx.setTransform(this.suspendedCtx.getTransform());copyCtxState(this.suspendedCtx,ctx);mirrorContextOperations(ctx,this.suspendedCtx);this.setGState([["BM","source-over"]]);}},{key:"endSMaskMode",value:function endSMaskMode(){if(!this.inSMaskMode){throw new Error("endSMaskMode called while not in smask mode");}this.ctx._removeMirroring();copyCtxState(this.ctx,this.suspendedCtx);this.ctx=this.suspendedCtx;this.suspendedCtx=null;}},{key:"compose",value:function compose(dirtyBox){if(!this.current.activeSMask){return;}if(!dirtyBox){dirtyBox=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];}else{dirtyBox[0]=Math.floor(dirtyBox[0]);dirtyBox[1]=Math.floor(dirtyBox[1]);dirtyBox[2]=Math.ceil(dirtyBox[2]);dirtyBox[3]=Math.ceil(dirtyBox[3]);}var smask=this.current.activeSMask;var suspendedCtx=this.suspendedCtx;this.composeSMask(suspendedCtx,smask,this.ctx,dirtyBox);this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);this.ctx.restore();}},{key:"composeSMask",value:function composeSMask(ctx,smask,layerCtx,layerBox){var layerOffsetX=layerBox[0];var layerOffsetY=layerBox[1];var layerWidth=layerBox[2]-layerOffsetX;var layerHeight=layerBox[3]-layerOffsetY;if(layerWidth===0||layerHeight===0){return;}this.genericComposeSMask(smask.context,layerCtx,layerWidth,layerHeight,smask.subtype,smask.backdrop,smask.transferMap,layerOffsetX,layerOffsetY,smask.offsetX,smask.offsetY);ctx.save();ctx.globalAlpha=1;ctx.globalCompositeOperation="source-over";ctx.setTransform(1,0,0,1,0,0);ctx.drawImage(layerCtx.canvas,0,0);ctx.restore();}},{key:"genericComposeSMask",value:function genericComposeSMask(maskCtx,layerCtx,width,height,subtype,backdrop,transferMap,layerOffsetX,layerOffsetY,maskOffsetX,maskOffsetY){var maskCanvas=maskCtx.canvas;var maskX=layerOffsetX-maskOffsetX;var maskY=layerOffsetY-maskOffsetY;if(backdrop){var backdropRGB=_Util.makeHexColor.apply(_Util,_toConsumableArray(backdrop));if(maskX<0||maskY<0||maskX+width>maskCanvas.width||maskY+height>maskCanvas.height){var canvas=this.cachedCanvases.getCanvas("maskExtension",width,height);var ctx=canvas.context;ctx.drawImage(maskCanvas,-maskX,-maskY);ctx.globalCompositeOperation="destination-atop";ctx.fillStyle=backdropRGB;ctx.fillRect(0,0,width,height);ctx.globalCompositeOperation="source-over";maskCanvas=canvas.canvas;maskX=maskY=0;}else{maskCtx.save();maskCtx.globalAlpha=1;maskCtx.setTransform(1,0,0,1,0,0);var _clip=new Path2D();_clip.rect(maskX,maskY,width,height);maskCtx.clip(_clip);maskCtx.globalCompositeOperation="destination-atop";maskCtx.fillStyle=backdropRGB;maskCtx.fillRect(maskX,maskY,width,height);maskCtx.restore();}}layerCtx.save();layerCtx.globalAlpha=1;layerCtx.setTransform(1,0,0,1,0,0);if(subtype==="Alpha"&&transferMap){layerCtx.filter=this.filterFactory.addAlphaFilter(transferMap);}else if(subtype==="Luminosity"){layerCtx.filter=this.filterFactory.addLuminosityFilter(transferMap);}var clip=new Path2D();clip.rect(layerOffsetX,layerOffsetY,width,height);layerCtx.clip(clip);layerCtx.globalCompositeOperation="destination-in";layerCtx.drawImage(maskCanvas,maskX,maskY,width,height,layerOffsetX,layerOffsetY,width,height);layerCtx.restore();}},{key:"save",value:function save(){if(this.inSMaskMode){copyCtxState(this.ctx,this.suspendedCtx);}this.ctx.save();var old=this.current;this.stateStack.push(old);this.current=old.clone();}},{key:"restore",value:function restore(){if(this.stateStack.length===0){if(this.inSMaskMode){this.endSMaskMode();}return;}this.current=this.stateStack.pop();this.ctx.restore();if(this.inSMaskMode){copyCtxState(this.suspendedCtx,this.ctx);}this.checkSMaskState();this.pendingClip=null;this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null;}},{key:"transform",value:function transform(a,b,c,d,e,f){this.ctx.transform(a,b,c,d,e,f);this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null;}},{key:"constructPath",value:function constructPath(op,data,minMax){var _data3=_slicedToArray(data,1),path=_data3[0];if(!minMax){path||(path=data[0]=new Path2D());this[op](path);return;}if(!(path instanceof Path2D)){var path2d=data[0]=new Path2D();for(var i=0,ii=path.length;i<ii;){switch(path[i++]){case DrawOPS.moveTo:path2d.moveTo(path[i++],path[i++]);break;case DrawOPS.lineTo:path2d.lineTo(path[i++],path[i++]);break;case DrawOPS.curveTo:path2d.bezierCurveTo(path[i++],path[i++],path[i++],path[i++],path[i++],path[i++]);break;case DrawOPS.closePath:path2d.closePath();break;default:warn("Unrecognized drawing path operator: ".concat(path[i-1]));break;}}path=path2d;}this.current.updateRectMinMax(getCurrentTransform(this.ctx),minMax);this[op](path);}},{key:"closePath",value:function closePath(){this.ctx.closePath();}},{key:"stroke",value:function stroke(path){var consumePath=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var ctx=this.ctx;var strokeColor=this.current.strokeColor;ctx.globalAlpha=this.current.strokeAlpha;if(this.contentVisible){if(_typeof(strokeColor)==="object"&&strokeColor!==null&&strokeColor!==void 0&&strokeColor.getPattern){var baseTransform=strokeColor.isModifyingCurrentTransform()?ctx.getTransform():null;ctx.save();ctx.strokeStyle=strokeColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.STROKE);if(baseTransform){var newPath=new Path2D();newPath.addPath(path,ctx.getTransform().invertSelf().multiplySelf(baseTransform));path=newPath;}this.rescaleAndStroke(path,false);ctx.restore();}else{this.rescaleAndStroke(path,true);}}if(consumePath){this.consumePath(path,this.current.getClippedPathBoundingBox(PathType.STROKE,getCurrentTransform(this.ctx)));}ctx.globalAlpha=this.current.fillAlpha;}},{key:"closeStroke",value:function closeStroke(path){this.stroke(path);}},{key:"fill",value:function fill(path){var consumePath=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var ctx=this.ctx;var fillColor=this.current.fillColor;var isPatternFill=this.current.patternFill;var needRestore=false;if(isPatternFill){var baseTransform=fillColor.isModifyingCurrentTransform()?ctx.getTransform():null;ctx.save();ctx.fillStyle=fillColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.FILL);if(baseTransform){var newPath=new Path2D();newPath.addPath(path,ctx.getTransform().invertSelf().multiplySelf(baseTransform));path=newPath;}needRestore=true;}var intersect=this.current.getClippedPathBoundingBox();if(this.contentVisible&&intersect!==null){if(this.pendingEOFill){ctx.fill(path,"evenodd");this.pendingEOFill=false;}else{ctx.fill(path);}}if(needRestore){ctx.restore();}if(consumePath){this.consumePath(path,intersect);}}},{key:"eoFill",value:function eoFill(path){this.pendingEOFill=true;this.fill(path);}},{key:"fillStroke",value:function fillStroke(path){this.fill(path,false);this.stroke(path,false);this.consumePath(path);}},{key:"eoFillStroke",value:function eoFillStroke(path){this.pendingEOFill=true;this.fillStroke(path);}},{key:"closeFillStroke",value:function closeFillStroke(path){this.fillStroke(path);}},{key:"closeEOFillStroke",value:function closeEOFillStroke(path){this.pendingEOFill=true;this.fillStroke(path);}},{key:"endPath",value:function endPath(path){this.consumePath(path);}},{key:"clip",value:function clip(){this.pendingClip=NORMAL_CLIP;}},{key:"eoClip",value:function eoClip(){this.pendingClip=EO_CLIP;}},{key:"beginText",value:function beginText(){this.current.textMatrix=IDENTITY_MATRIX;this.current.textMatrixScale=1;this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0;}},{key:"endText",value:function endText(){var paths=this.pendingTextPaths;var ctx=this.ctx;if(paths===undefined){ctx.beginPath();return;}var newPath=new Path2D();var invTransf=ctx.getTransform().invertSelf();var _iterator61=_createForOfIteratorHelper(paths),_step61;try{for(_iterator61.s();!(_step61=_iterator61.n()).done;){var _step61$value=_step61.value,transform=_step61$value.transform,x=_step61$value.x,y=_step61$value.y,fontSize=_step61$value.fontSize,path=_step61$value.path;newPath.addPath(path,new DOMMatrix(transform).preMultiplySelf(invTransf).translate(x,y).scale(fontSize,-fontSize));}}catch(err){_iterator61.e(err);}finally{_iterator61.f();}ctx.clip(newPath);ctx.beginPath();delete this.pendingTextPaths;}},{key:"setCharSpacing",value:function setCharSpacing(spacing){this.current.charSpacing=spacing;}},{key:"setWordSpacing",value:function setWordSpacing(spacing){this.current.wordSpacing=spacing;}},{key:"setHScale",value:function setHScale(scale){this.current.textHScale=scale/100;}},{key:"setLeading",value:function setLeading(leading){this.current.leading=-leading;}},{key:"setFont",value:function setFont(fontRefName,size){var _fontObj$systemFontIn;var fontObj=this.commonObjs.get(fontRefName);var current=this.current;if(!fontObj){throw new Error("Can't find font for ".concat(fontRefName));}current.fontMatrix=fontObj.fontMatrix||FONT_IDENTITY_MATRIX;if(current.fontMatrix[0]===0||current.fontMatrix[3]===0){warn("Invalid font matrix for font "+fontRefName);}if(size<0){size=-size;current.fontDirection=-1;}else{current.fontDirection=1;}this.current.font=fontObj;this.current.fontSize=size;if(fontObj.isType3Font){return;}var name=fontObj.loadedName||"sans-serif";var typeface=((_fontObj$systemFontIn=fontObj.systemFontInfo)===null||_fontObj$systemFontIn===void 0?void 0:_fontObj$systemFontIn.css)||"\"".concat(name,"\", ").concat(fontObj.fallbackName);var bold="normal";if(fontObj.black){bold="900";}else if(fontObj.bold){bold="bold";}var italic=fontObj.italic?"italic":"normal";var browserFontSize=size;if(size<MIN_FONT_SIZE){browserFontSize=MIN_FONT_SIZE;}else if(size>MAX_FONT_SIZE){browserFontSize=MAX_FONT_SIZE;}this.current.fontSizeScale=size/browserFontSize;this.ctx.font="".concat(italic," ").concat(bold," ").concat(browserFontSize,"px ").concat(typeface);}},{key:"setTextRenderingMode",value:function setTextRenderingMode(mode){this.current.textRenderingMode=mode;}},{key:"setTextRise",value:function setTextRise(rise){this.current.textRise=rise;}},{key:"moveText",value:function moveText(x,y){this.current.x=this.current.lineX+=x;this.current.y=this.current.lineY+=y;}},{key:"setLeadingMoveText",value:function setLeadingMoveText(x,y){this.setLeading(-y);this.moveText(x,y);}},{key:"setTextMatrix",value:function setTextMatrix(a,b,c,d,e,f){this.current.textMatrix=[a,b,c,d,e,f];this.current.textMatrixScale=Math.hypot(a,b);this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0;}},{key:"nextLine",value:function nextLine(){this.moveText(0,this.current.leading);}},{key:"paintChar",value:function paintChar(character,x,y,patternFillTransform,patternStrokeTransform){var ctx=this.ctx;var current=this.current;var font=current.font;var textRenderingMode=current.textRenderingMode;var fontSize=current.fontSize/current.fontSizeScale;var fillStrokeMode=textRenderingMode&TextRenderingMode.FILL_STROKE_MASK;var isAddToPathSet=!!(textRenderingMode&TextRenderingMode.ADD_TO_PATH_FLAG);var patternFill=current.patternFill&&!font.missingFile;var patternStroke=current.patternStroke&&!font.missingFile;var path;if(font.disableFontFace||isAddToPathSet||patternFill||patternStroke){path=font.getPathGenerator(this.commonObjs,character);}if(font.disableFontFace||patternFill||patternStroke){ctx.save();ctx.translate(x,y);ctx.scale(fontSize,-fontSize);var currentTransform;if(fillStrokeMode===TextRenderingMode.FILL||fillStrokeMode===TextRenderingMode.FILL_STROKE){if(patternFillTransform){currentTransform=ctx.getTransform();ctx.setTransform.apply(ctx,_toConsumableArray(patternFillTransform));ctx.fill(_assertClassBrand(_CanvasGraphics_brand,this,_getScaledPath).call(this,path,currentTransform,patternFillTransform));}else{ctx.fill(path);}}if(fillStrokeMode===TextRenderingMode.STROKE||fillStrokeMode===TextRenderingMode.FILL_STROKE){if(patternStrokeTransform){currentTransform||(currentTransform=ctx.getTransform());ctx.setTransform.apply(ctx,_toConsumableArray(patternStrokeTransform));var _currentTransform=currentTransform,a=_currentTransform.a,b=_currentTransform.b,c=_currentTransform.c,d=_currentTransform.d;var invPatternTransform=_Util.inverseTransform(patternStrokeTransform);var transf=_Util.transform([a,b,c,d,0,0],invPatternTransform);var _Util$singularValueDe=_Util.singularValueDecompose2dScale(transf),_Util$singularValueDe2=_slicedToArray(_Util$singularValueDe,2),sx=_Util$singularValueDe2[0],sy=_Util$singularValueDe2[1];ctx.lineWidth*=Math.max(sx,sy)/fontSize;ctx.stroke(_assertClassBrand(_CanvasGraphics_brand,this,_getScaledPath).call(this,path,currentTransform,patternStrokeTransform));}else{ctx.lineWidth/=fontSize;ctx.stroke(path);}}ctx.restore();}else{if(fillStrokeMode===TextRenderingMode.FILL||fillStrokeMode===TextRenderingMode.FILL_STROKE){ctx.fillText(character,x,y);}if(fillStrokeMode===TextRenderingMode.STROKE||fillStrokeMode===TextRenderingMode.FILL_STROKE){ctx.strokeText(character,x,y);}}if(isAddToPathSet){var paths=this.pendingTextPaths||(this.pendingTextPaths=[]);paths.push({transform:getCurrentTransform(ctx),x:x,y:y,fontSize:fontSize,path:path});}}},{key:"isFontSubpixelAAEnabled",get:function get(){var _this$cachedCanvases$=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10),ctx=_this$cachedCanvases$.context;ctx.scale(1.5,1);ctx.fillText("I",0,10);var data=ctx.getImageData(0,0,10,10).data;var enabled=false;for(var i=3;i<data.length;i+=4){if(data[i]>0&&data[i]<255){enabled=true;break;}}return _shadow(this,"isFontSubpixelAAEnabled",enabled);}},{key:"showText",value:function showText(glyphs){var current=this.current;var font=current.font;if(font.isType3Font){return this.showType3Text(glyphs);}var fontSize=current.fontSize;if(fontSize===0){return undefined;}var ctx=this.ctx;var fontSizeScale=current.fontSizeScale;var charSpacing=current.charSpacing;var wordSpacing=current.wordSpacing;var fontDirection=current.fontDirection;var textHScale=current.textHScale*fontDirection;var glyphsLength=glyphs.length;var vertical=font.vertical;var spacingDir=vertical?1:-1;var defaultVMetrics=font.defaultVMetrics;var widthAdvanceScale=fontSize*current.fontMatrix[0];var simpleFillText=current.textRenderingMode===TextRenderingMode.FILL&&!font.disableFontFace&&!current.patternFill;ctx.save();ctx.transform.apply(ctx,_toConsumableArray(current.textMatrix));ctx.translate(current.x,current.y+current.textRise);if(fontDirection>0){ctx.scale(textHScale,-1);}else{ctx.scale(textHScale,1);}var patternFillTransform,patternStrokeTransform;if(current.patternFill){ctx.save();var pattern=current.fillColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.FILL);patternFillTransform=getCurrentTransform(ctx);ctx.restore();ctx.fillStyle=pattern;}if(current.patternStroke){ctx.save();var _pattern=current.strokeColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.STROKE);patternStrokeTransform=getCurrentTransform(ctx);ctx.restore();ctx.strokeStyle=_pattern;}var lineWidth=current.lineWidth;var scale=current.textMatrixScale;if(scale===0||lineWidth===0){var fillStrokeMode=current.textRenderingMode&TextRenderingMode.FILL_STROKE_MASK;if(fillStrokeMode===TextRenderingMode.STROKE||fillStrokeMode===TextRenderingMode.FILL_STROKE){lineWidth=this.getSinglePixelWidth();}}else{lineWidth/=scale;}if(fontSizeScale!==1.0){ctx.scale(fontSizeScale,fontSizeScale);lineWidth/=fontSizeScale;}ctx.lineWidth=lineWidth;if(font.isInvalidPDFjsFont){var chars=[];var width=0;var _iterator62=_createForOfIteratorHelper(glyphs),_step62;try{for(_iterator62.s();!(_step62=_iterator62.n()).done;){var glyph=_step62.value;chars.push(glyph.unicode);width+=glyph.width;}}catch(err){_iterator62.e(err);}finally{_iterator62.f();}ctx.fillText(chars.join(""),0,0);current.x+=width*widthAdvanceScale*textHScale;ctx.restore();this.compose();return undefined;}var x=0,i;for(i=0;i<glyphsLength;++i){var _glyph=glyphs[i];if(typeof _glyph==="number"){x+=spacingDir*_glyph*fontSize/1000;continue;}var restoreNeeded=false;var spacing=(_glyph.isSpace?wordSpacing:0)+charSpacing;var character=_glyph.fontChar;var accent=_glyph.accent;var scaledX=void 0,scaledY=void 0;var _width2=_glyph.width;if(vertical){var vmetric=_glyph.vmetric||defaultVMetrics;var vx=-(_glyph.vmetric?vmetric[1]:_width2*0.5)*widthAdvanceScale;var vy=vmetric[2]*widthAdvanceScale;_width2=vmetric?-vmetric[0]:_width2;scaledX=vx/fontSizeScale;scaledY=(x+vy)/fontSizeScale;}else{scaledX=x/fontSizeScale;scaledY=0;}if(font.remeasure&&_width2>0){var measuredWidth=ctx.measureText(character).width*1000/fontSize*fontSizeScale;if(_width2<measuredWidth&&this.isFontSubpixelAAEnabled){var characterScaleX=_width2/measuredWidth;restoreNeeded=true;ctx.save();ctx.scale(characterScaleX,1);scaledX/=characterScaleX;}else if(_width2!==measuredWidth){scaledX+=(_width2-measuredWidth)/2000*fontSize/fontSizeScale;}}if(this.contentVisible&&(_glyph.isInFont||font.missingFile)){if(simpleFillText&&!accent){ctx.fillText(character,scaledX,scaledY);}else{this.paintChar(character,scaledX,scaledY,patternFillTransform,patternStrokeTransform);if(accent){var scaledAccentX=scaledX+fontSize*accent.offset.x/fontSizeScale;var scaledAccentY=scaledY-fontSize*accent.offset.y/fontSizeScale;this.paintChar(accent.fontChar,scaledAccentX,scaledAccentY,patternFillTransform,patternStrokeTransform);}}}var charWidth=vertical?_width2*widthAdvanceScale-spacing*fontDirection:_width2*widthAdvanceScale+spacing*fontDirection;x+=charWidth;if(restoreNeeded){ctx.restore();}}if(vertical){current.y-=x;}else{current.x+=x*textHScale;}ctx.restore();this.compose();return undefined;}},{key:"showType3Text",value:function showType3Text(glyphs){var ctx=this.ctx;var current=this.current;var font=current.font;var fontSize=current.fontSize;var fontDirection=current.fontDirection;var spacingDir=font.vertical?1:-1;var charSpacing=current.charSpacing;var wordSpacing=current.wordSpacing;var textHScale=current.textHScale*fontDirection;var fontMatrix=current.fontMatrix||FONT_IDENTITY_MATRIX;var glyphsLength=glyphs.length;var isTextInvisible=current.textRenderingMode===TextRenderingMode.INVISIBLE;var i,glyph,width,spacingLength;if(isTextInvisible||fontSize===0){return;}this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null;ctx.save();ctx.transform.apply(ctx,_toConsumableArray(current.textMatrix));ctx.translate(current.x,current.y+current.textRise);ctx.scale(textHScale,fontDirection);for(i=0;i<glyphsLength;++i){glyph=glyphs[i];if(typeof glyph==="number"){spacingLength=spacingDir*glyph*fontSize/1000;this.ctx.translate(spacingLength,0);current.x+=spacingLength*textHScale;continue;}var spacing=(glyph.isSpace?wordSpacing:0)+charSpacing;var operatorList=font.charProcOperatorList[glyph.operatorListId];if(!operatorList){warn("Type3 character \"".concat(glyph.operatorListId,"\" is not available."));}else if(this.contentVisible){this.processingType3=glyph;this.save();ctx.scale(fontSize,fontSize);ctx.transform.apply(ctx,_toConsumableArray(fontMatrix));this.executeOperatorList(operatorList);this.restore();}var transformed=_Util.applyTransform([glyph.width,0],fontMatrix);width=transformed[0]*fontSize+spacing;ctx.translate(width,0);current.x+=width*textHScale;}ctx.restore();this.processingType3=null;}},{key:"setCharWidth",value:function setCharWidth(xWidth,yWidth){}},{key:"setCharWidthAndBounds",value:function setCharWidthAndBounds(xWidth,yWidth,llx,lly,urx,ury){this.ctx.rect(llx,lly,urx-llx,ury-lly);this.ctx.clip();this.endPath();}},{key:"getColorN_Pattern",value:function getColorN_Pattern(IR){var _this30=this;var pattern;if(IR[0]==="TilingPattern"){var baseTransform=this.baseTransform||getCurrentTransform(this.ctx);var canvasGraphicsFactory={createCanvasGraphics:function createCanvasGraphics(ctx){return new CanvasGraphics(ctx,_this30.commonObjs,_this30.objs,_this30.canvasFactory,_this30.filterFactory,{optionalContentConfig:_this30.optionalContentConfig,markedContentStack:_this30.markedContentStack});}};pattern=new TilingPattern(IR,this.ctx,canvasGraphicsFactory,baseTransform);}else{pattern=this._getPattern(IR[1],IR[2]);}return pattern;}},{key:"setStrokeColorN",value:function setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments);this.current.patternStroke=true;}},{key:"setFillColorN",value:function setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments);this.current.patternFill=true;}},{key:"setStrokeRGBColor",value:function setStrokeRGBColor(r,g,b){this.ctx.strokeStyle=this.current.strokeColor=_Util.makeHexColor(r,g,b);this.current.patternStroke=false;}},{key:"setStrokeTransparent",value:function setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent";this.current.patternStroke=false;}},{key:"setFillRGBColor",value:function setFillRGBColor(r,g,b){this.ctx.fillStyle=this.current.fillColor=_Util.makeHexColor(r,g,b);this.current.patternFill=false;}},{key:"setFillTransparent",value:function setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent";this.current.patternFill=false;}},{key:"_getPattern",value:function _getPattern(objId){var matrix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var pattern;if(this.cachedPatterns.has(objId)){pattern=this.cachedPatterns.get(objId);}else{pattern=getShadingPattern(this.getObject(objId));this.cachedPatterns.set(objId,pattern);}if(matrix){pattern.matrix=matrix;}return pattern;}},{key:"shadingFill",value:function shadingFill(objId){if(!this.contentVisible){return;}var ctx=this.ctx;this.save();var pattern=this._getPattern(objId);ctx.fillStyle=pattern.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.SHADING);var inv=getCurrentTransformInverse(ctx);if(inv){var _ctx$canvas=ctx.canvas,width=_ctx$canvas.width,height=_ctx$canvas.height;var _Util$getAxialAligned3=_Util.getAxialAlignedBoundingBox([0,0,width,height],inv),_Util$getAxialAligned4=_slicedToArray(_Util$getAxialAligned3,4),x0=_Util$getAxialAligned4[0],y0=_Util$getAxialAligned4[1],x1=_Util$getAxialAligned4[2],y1=_Util$getAxialAligned4[3];this.ctx.fillRect(x0,y0,x1-x0,y1-y0);}else{this.ctx.fillRect(-1e10,-1e10,2e10,2e10);}this.compose(this.current.getClippedPathBoundingBox());this.restore();}},{key:"beginInlineImage",value:function beginInlineImage(){unreachable("Should not call beginInlineImage");}},{key:"beginImageData",value:function beginImageData(){unreachable("Should not call beginImageData");}},{key:"paintFormXObjectBegin",value:function paintFormXObjectBegin(matrix,bbox){if(!this.contentVisible){return;}this.save();this.baseTransformStack.push(this.baseTransform);if(matrix){this.transform.apply(this,_toConsumableArray(matrix));}this.baseTransform=getCurrentTransform(this.ctx);if(bbox){var width=bbox[2]-bbox[0];var height=bbox[3]-bbox[1];this.ctx.rect(bbox[0],bbox[1],width,height);this.current.updateRectMinMax(getCurrentTransform(this.ctx),bbox);this.clip();this.endPath();}}},{key:"paintFormXObjectEnd",value:function paintFormXObjectEnd(){if(!this.contentVisible){return;}this.restore();this.baseTransform=this.baseTransformStack.pop();}},{key:"beginGroup",value:function beginGroup(group){if(!this.contentVisible){return;}this.save();if(this.inSMaskMode){this.endSMaskMode();this.current.activeSMask=null;}var currentCtx=this.ctx;if(!group.isolated){info("TODO: Support non-isolated groups.");}if(group.knockout){warn("Knockout groups not supported.");}var currentTransform=getCurrentTransform(currentCtx);if(group.matrix){currentCtx.transform.apply(currentCtx,_toConsumableArray(group.matrix));}if(!group.bbox){throw new Error("Bounding box is required.");}var bounds=_Util.getAxialAlignedBoundingBox(group.bbox,getCurrentTransform(currentCtx));var canvasBounds=[0,0,currentCtx.canvas.width,currentCtx.canvas.height];bounds=_Util.intersect(bounds,canvasBounds)||[0,0,0,0];var offsetX=Math.floor(bounds[0]);var offsetY=Math.floor(bounds[1]);var drawnWidth=Math.max(Math.ceil(bounds[2])-offsetX,1);var drawnHeight=Math.max(Math.ceil(bounds[3])-offsetY,1);this.current.startNewPathAndClipBox([0,0,drawnWidth,drawnHeight]);var cacheId="groupAt"+this.groupLevel;if(group.smask){cacheId+="_smask_"+this.smaskCounter++%2;}var scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight);var groupCtx=scratchCanvas.context;groupCtx.translate(-offsetX,-offsetY);groupCtx.transform.apply(groupCtx,_toConsumableArray(currentTransform));var clip=new Path2D();var _group$bbox=_slicedToArray(group.bbox,4),x0=_group$bbox[0],y0=_group$bbox[1],x1=_group$bbox[2],y1=_group$bbox[3];clip.rect(x0,y0,x1-x0,y1-y0);if(group.matrix){var path=new Path2D();path.addPath(clip,new DOMMatrix(group.matrix));clip=path;}groupCtx.clip(clip);if(group.smask){this.smaskStack.push({canvas:scratchCanvas.canvas,context:groupCtx,offsetX:offsetX,offsetY:offsetY,subtype:group.smask.subtype,backdrop:group.smask.backdrop,transferMap:group.smask.transferMap||null,startTransformInverse:null});}else{currentCtx.setTransform(1,0,0,1,0,0);currentCtx.translate(offsetX,offsetY);currentCtx.save();}copyCtxState(currentCtx,groupCtx);this.ctx=groupCtx;this.setGState([["BM","source-over"],["ca",1],["CA",1]]);this.groupStack.push(currentCtx);this.groupLevel++;}},{key:"endGroup",value:function endGroup(group){if(!this.contentVisible){return;}this.groupLevel--;var groupCtx=this.ctx;var ctx=this.groupStack.pop();this.ctx=ctx;this.ctx.imageSmoothingEnabled=false;if(group.smask){this.tempSMask=this.smaskStack.pop();this.restore();}else{var _this$ctx4;this.ctx.restore();var currentMtx=getCurrentTransform(this.ctx);this.restore();this.ctx.save();(_this$ctx4=this.ctx).setTransform.apply(_this$ctx4,_toConsumableArray(currentMtx));var dirtyBox=_Util.getAxialAlignedBoundingBox([0,0,groupCtx.canvas.width,groupCtx.canvas.height],currentMtx);this.ctx.drawImage(groupCtx.canvas,0,0);this.ctx.restore();this.compose(dirtyBox);}}},{key:"beginAnnotation",value:function beginAnnotation(id,rect,transform,matrix,hasOwnCanvas){_assertClassBrand(_CanvasGraphics_brand,this,_restoreInitialState).call(this);resetCtxToDefault(this.ctx);this.ctx.save();this.save();if(this.baseTransform){var _this$ctx5;(_this$ctx5=this.ctx).setTransform.apply(_this$ctx5,_toConsumableArray(this.baseTransform));}if(rect){var width=rect[2]-rect[0];var height=rect[3]-rect[1];if(hasOwnCanvas&&this.annotationCanvasMap){transform=transform.slice();transform[4]-=rect[0];transform[5]-=rect[1];rect=rect.slice();rect[0]=rect[1]=0;rect[2]=width;rect[3]=height;var _Util$singularValueDe3=_Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx)),_Util$singularValueDe4=_slicedToArray(_Util$singularValueDe3,2),scaleX=_Util$singularValueDe4[0],scaleY=_Util$singularValueDe4[1];var viewportScale=this.viewportScale;var canvasWidth=Math.ceil(width*this.outputScaleX*viewportScale);var canvasHeight=Math.ceil(height*this.outputScaleY*viewportScale);this.annotationCanvas=this.canvasFactory.create(canvasWidth,canvasHeight);var _this$annotationCanva=this.annotationCanvas,canvas=_this$annotationCanva.canvas,context=_this$annotationCanva.context;this.annotationCanvasMap.set(id,canvas);this.annotationCanvas.savedCtx=this.ctx;this.ctx=context;this.ctx.save();this.ctx.setTransform(scaleX,0,0,-scaleY,0,height*scaleY);resetCtxToDefault(this.ctx);}else{resetCtxToDefault(this.ctx);this.endPath();this.ctx.rect(rect[0],rect[1],width,height);this.ctx.clip();this.ctx.beginPath();}}this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height);this.transform.apply(this,_toConsumableArray(transform));this.transform.apply(this,_toConsumableArray(matrix));}},{key:"endAnnotation",value:function endAnnotation(){if(this.annotationCanvas){this.ctx.restore();_assertClassBrand(_CanvasGraphics_brand,this,_drawFilter).call(this);this.ctx=this.annotationCanvas.savedCtx;delete this.annotationCanvas.savedCtx;delete this.annotationCanvas;}}},{key:"paintImageMaskXObject",value:function paintImageMaskXObject(img){if(!this.contentVisible){return;}var count=img.count;img=this.getObject(img.data,img);img.count=count;var ctx=this.ctx;var glyph=this.processingType3;if(glyph){if(glyph.compiled===undefined){glyph.compiled=compileType3Glyph(img);}if(glyph.compiled){ctx.fill(glyph.compiled);return;}}var mask=this._createMaskCanvas(img);var maskCanvas=mask.canvas;ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.drawImage(maskCanvas,mask.offsetX,mask.offsetY);ctx.restore();this.compose();}},{key:"paintImageMaskXObjectRepeat",value:function paintImageMaskXObjectRepeat(img,scaleX){var skewX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var skewY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var scaleY=arguments.length>4?arguments[4]:undefined;var positions=arguments.length>5?arguments[5]:undefined;if(!this.contentVisible){return;}img=this.getObject(img.data,img);var ctx=this.ctx;ctx.save();var currentTransform=getCurrentTransform(ctx);ctx.transform(scaleX,skewX,skewY,scaleY,0,0);var mask=this._createMaskCanvas(img);ctx.setTransform(1,0,0,1,mask.offsetX-currentTransform[4],mask.offsetY-currentTransform[5]);for(var i=0,ii=positions.length;i<ii;i+=2){var trans=_Util.transform(currentTransform,[scaleX,skewX,skewY,scaleY,positions[i],positions[i+1]]);var _Util$applyTransform=_Util.applyTransform([0,0],trans),_Util$applyTransform2=_slicedToArray(_Util$applyTransform,2),x=_Util$applyTransform2[0],y=_Util$applyTransform2[1];ctx.drawImage(mask.canvas,x,y);}ctx.restore();this.compose();}},{key:"paintImageMaskXObjectGroup",value:function paintImageMaskXObjectGroup(images){if(!this.contentVisible){return;}var ctx=this.ctx;var fillColor=this.current.fillColor;var isPatternFill=this.current.patternFill;var _iterator63=_createForOfIteratorHelper(images),_step63;try{for(_iterator63.s();!(_step63=_iterator63.n()).done;){var image=_step63.value;var data=image.data,width=image.width,height=image.height,transform=image.transform;var maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height);var maskCtx=maskCanvas.context;maskCtx.save();var img=this.getObject(data,image);putBinaryImageMask(maskCtx,img);maskCtx.globalCompositeOperation="source-in";maskCtx.fillStyle=isPatternFill?fillColor.getPattern(maskCtx,this,getCurrentTransformInverse(ctx),PathType.FILL):fillColor;maskCtx.fillRect(0,0,width,height);maskCtx.restore();ctx.save();ctx.transform.apply(ctx,_toConsumableArray(transform));ctx.scale(1,-1);drawImageAtIntegerCoords(ctx,maskCanvas.canvas,0,0,width,height,0,-1,1,1);ctx.restore();}}catch(err){_iterator63.e(err);}finally{_iterator63.f();}this.compose();}},{key:"paintImageXObject",value:function paintImageXObject(objId){if(!this.contentVisible){return;}var imgData=this.getObject(objId);if(!imgData){warn("Dependent image isn't ready yet");return;}this.paintInlineImageXObject(imgData);}},{key:"paintImageXObjectRepeat",value:function paintImageXObjectRepeat(objId,scaleX,scaleY,positions){if(!this.contentVisible){return;}var imgData=this.getObject(objId);if(!imgData){warn("Dependent image isn't ready yet");return;}var width=imgData.width;var height=imgData.height;var map=[];for(var i=0,ii=positions.length;i<ii;i+=2){map.push({transform:[scaleX,0,0,scaleY,positions[i],positions[i+1]],x:0,y:0,w:width,h:height});}this.paintInlineImageXObjectGroup(imgData,map);}},{key:"applyTransferMapsToCanvas",value:function applyTransferMapsToCanvas(ctx){if(this.current.transferMaps!=="none"){ctx.filter=this.current.transferMaps;ctx.drawImage(ctx.canvas,0,0);ctx.filter="none";}return ctx.canvas;}},{key:"applyTransferMapsToBitmap",value:function applyTransferMapsToBitmap(imgData){if(this.current.transferMaps==="none"){return imgData.bitmap;}var bitmap=imgData.bitmap,width=imgData.width,height=imgData.height;var tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",width,height);var tmpCtx=tmpCanvas.context;tmpCtx.filter=this.current.transferMaps;tmpCtx.drawImage(bitmap,0,0);tmpCtx.filter="none";return tmpCanvas.canvas;}},{key:"paintInlineImageXObject",value:function paintInlineImageXObject(imgData){if(!this.contentVisible){return;}var width=imgData.width;var height=imgData.height;var ctx=this.ctx;this.save();if(!isNodeJS){var filter=ctx.filter;if(filter!=="none"&&filter!==""){ctx.filter="none";}}ctx.scale(1/width,-1/height);var imgToPaint;if(imgData.bitmap){imgToPaint=this.applyTransferMapsToBitmap(imgData);}else if(typeof HTMLElement==="function"&&imgData instanceof HTMLElement||!imgData.data){imgToPaint=imgData;}else{var tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",width,height);var tmpCtx=tmpCanvas.context;putBinaryImageData(tmpCtx,imgData);imgToPaint=this.applyTransferMapsToCanvas(tmpCtx);}var scaled=this._scaleImage(imgToPaint,getCurrentTransformInverse(ctx));ctx.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(ctx),imgData.interpolate);drawImageAtIntegerCoords(ctx,scaled.img,0,0,scaled.paintWidth,scaled.paintHeight,0,-height,width,height);this.compose();this.restore();}},{key:"paintInlineImageXObjectGroup",value:function paintInlineImageXObjectGroup(imgData,map){if(!this.contentVisible){return;}var ctx=this.ctx;var imgToPaint;if(imgData.bitmap){imgToPaint=imgData.bitmap;}else{var w=imgData.width;var h=imgData.height;var tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",w,h);var tmpCtx=tmpCanvas.context;putBinaryImageData(tmpCtx,imgData);imgToPaint=this.applyTransferMapsToCanvas(tmpCtx);}var _iterator64=_createForOfIteratorHelper(map),_step64;try{for(_iterator64.s();!(_step64=_iterator64.n()).done;){var entry=_step64.value;ctx.save();ctx.transform.apply(ctx,_toConsumableArray(entry.transform));ctx.scale(1,-1);drawImageAtIntegerCoords(ctx,imgToPaint,entry.x,entry.y,entry.w,entry.h,0,-1,1,1);ctx.restore();}}catch(err){_iterator64.e(err);}finally{_iterator64.f();}this.compose();}},{key:"paintSolidColorImageMask",value:function paintSolidColorImageMask(){if(!this.contentVisible){return;}this.ctx.fillRect(0,0,1,1);this.compose();}},{key:"markPoint",value:function markPoint(tag){}},{key:"markPointProps",value:function markPointProps(tag,properties){}},{key:"beginMarkedContent",value:function beginMarkedContent(tag){this.markedContentStack.push({visible:true});}},{key:"beginMarkedContentProps",value:function beginMarkedContentProps(tag,properties){if(tag==="OC"){this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(properties)});}else{this.markedContentStack.push({visible:true});}this.contentVisible=this.isContentVisible();}},{key:"endMarkedContent",value:function endMarkedContent(){this.markedContentStack.pop();this.contentVisible=this.isContentVisible();}},{key:"beginCompat",value:function beginCompat(){}},{key:"endCompat",value:function endCompat(){}},{key:"consumePath",value:function consumePath(path,clipBox){var isEmpty=this.current.isEmptyClip();if(this.pendingClip){this.current.updateClipFromPath();}if(!this.pendingClip){this.compose(clipBox);}var ctx=this.ctx;if(this.pendingClip){if(!isEmpty){if(this.pendingClip===EO_CLIP){ctx.clip(path,"evenodd");}else{ctx.clip(path);}}this.pendingClip=null;}this.current.startNewPathAndClipBox(this.current.clipBox);ctx.beginPath();}},{key:"getSinglePixelWidth",value:function getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){var m=getCurrentTransform(this.ctx);if(m[1]===0&&m[2]===0){this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(m[0]),Math.abs(m[3]));}else{var absDet=Math.abs(m[0]*m[3]-m[2]*m[1]);var normX=Math.hypot(m[0],m[2]);var normY=Math.hypot(m[1],m[3]);this._cachedGetSinglePixelWidth=Math.max(normX,normY)/absDet;}}return this._cachedGetSinglePixelWidth;}},{key:"getScaleForStroking",value:function getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){var lineWidth=this.current.lineWidth;var _this$ctx$getTransfor=this.ctx.getTransform(),a=_this$ctx$getTransfor.a,b=_this$ctx$getTransfor.b,c=_this$ctx$getTransfor.c,d=_this$ctx$getTransfor.d;var scaleX,scaleY;if(b===0&&c===0){var normX=Math.abs(a);var normY=Math.abs(d);if(normX===normY){if(lineWidth===0){scaleX=scaleY=1/normX;}else{var scaledLineWidth=normX*lineWidth;scaleX=scaleY=scaledLineWidth<1?1/scaledLineWidth:1;}}else if(lineWidth===0){scaleX=1/normX;scaleY=1/normY;}else{var scaledXLineWidth=normX*lineWidth;var scaledYLineWidth=normY*lineWidth;scaleX=scaledXLineWidth<1?1/scaledXLineWidth:1;scaleY=scaledYLineWidth<1?1/scaledYLineWidth:1;}}else{var absDet=Math.abs(a*d-b*c);var _normX=Math.hypot(a,b);var _normY=Math.hypot(c,d);if(lineWidth===0){scaleX=_normY/absDet;scaleY=_normX/absDet;}else{var baseArea=lineWidth*absDet;scaleX=_normY>baseArea?_normY/baseArea:1;scaleY=_normX>baseArea?_normX/baseArea:1;}}this._cachedScaleForStroking[0]=scaleX;this._cachedScaleForStroking[1]=scaleY;}return this._cachedScaleForStroking;}},{key:"rescaleAndStroke",value:function rescaleAndStroke(path,saveRestore){var ctx=this.ctx,lineWidth=this.current.lineWidth;var _this$getScaleForStro=this.getScaleForStroking(),_this$getScaleForStro2=_slicedToArray(_this$getScaleForStro,2),scaleX=_this$getScaleForStro2[0],scaleY=_this$getScaleForStro2[1];if(scaleX===scaleY){ctx.lineWidth=(lineWidth||1)*scaleX;ctx.stroke(path);return;}var dashes=ctx.getLineDash();if(saveRestore){ctx.save();}ctx.scale(scaleX,scaleY);SCALE_MATRIX.a=1/scaleX;SCALE_MATRIX.d=1/scaleY;var newPath=new Path2D();newPath.addPath(path,SCALE_MATRIX);if(dashes.length>0){var scale=Math.max(scaleX,scaleY);ctx.setLineDash(dashes.map(function(x){return x/scale;}));ctx.lineDashOffset/=scale;}ctx.lineWidth=lineWidth||1;ctx.stroke(newPath);if(saveRestore){ctx.restore();}}},{key:"isContentVisible",value:function isContentVisible(){for(var i=this.markedContentStack.length-1;i>=0;i--){if(!this.markedContentStack[i].visible){return false;}}return true;}}]);}();function _restoreInitialState(){while(this.stateStack.length||this.inSMaskMode){this.restore();}this.current.activeSMask=null;this.ctx.restore();if(this.transparentCanvas){this.ctx=this.compositeCtx;this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.drawImage(this.transparentCanvas,0,0);this.ctx.restore();this.transparentCanvas=null;}}function _drawFilter(){if(this.pageColors){var hcmFilterId=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(hcmFilterId!=="none"){var savedFilter=this.ctx.filter;this.ctx.filter=hcmFilterId;this.ctx.drawImage(this.ctx.canvas,0,0);this.ctx.filter=savedFilter;}}}function _getScaledPath(path,currentTransform,transform){var newPath=new Path2D();newPath.addPath(path,new DOMMatrix(transform).invertSelf().multiplySelf(currentTransform));return newPath;}for(var op in _OPS){if(CanvasGraphics.prototype[op]!==undefined){CanvasGraphics.prototype[_OPS[op]]=CanvasGraphics.prototype[op];}};// ./src/display/worker_options.js
var _GlobalWorkerOptions=/*#__PURE__*/function(){function _GlobalWorkerOptions(){_classCallCheck(this,_GlobalWorkerOptions);}return _createClass(_GlobalWorkerOptions,null,[{key:"workerPort",get:function get(){return _assertClassBrand(_GlobalWorkerOptions,this,_port)._;},set:function set(val){if(!(typeof Worker!=="undefined"&&val instanceof Worker)&&val!==null){throw new Error("Invalid `workerPort` type.");}_port._=_assertClassBrand(_GlobalWorkerOptions,this,val);}},{key:"workerSrc",get:function get(){return _assertClassBrand(_GlobalWorkerOptions,this,_src)._;},set:function set(val){if(typeof val!=="string"){throw new Error("Invalid `workerSrc` type.");}_src._=_assertClassBrand(_GlobalWorkerOptions,this,val);}}]);}();var _port={_:null};var _src={_:""};;// ./src/display/metadata.js
var _metadataMap=/*#__PURE__*/new WeakMap();var _data4=/*#__PURE__*/new WeakMap();var Metadata=/*#__PURE__*/function(){function Metadata(_ref34){var parsedData=_ref34.parsedData,rawData=_ref34.rawData;_classCallCheck(this,Metadata);_classPrivateFieldInitSpec(this,_metadataMap,void 0);_classPrivateFieldInitSpec(this,_data4,void 0);_classPrivateFieldSet(_metadataMap,this,parsedData);_classPrivateFieldSet(_data4,this,rawData);}return _createClass(Metadata,[{key:"getRaw",value:function getRaw(){return _classPrivateFieldGet(_data4,this);}},{key:"get",value:function get(name){var _classPrivateFieldGet55;return(_classPrivateFieldGet55=_classPrivateFieldGet(_metadataMap,this).get(name))!==null&&_classPrivateFieldGet55!==void 0?_classPrivateFieldGet55:null;}},{key:"getAll",value:function getAll(){return objectFromMap(_classPrivateFieldGet(_metadataMap,this));}},{key:"has",value:function has(name){return _classPrivateFieldGet(_metadataMap,this).has(name);}}]);}();;// ./src/display/optional_content_config.js
var INTERNAL=Symbol("INTERNAL");var _isDisplay=/*#__PURE__*/new WeakMap();var _isPrint=/*#__PURE__*/new WeakMap();var _userSet=/*#__PURE__*/new WeakMap();var _visible=/*#__PURE__*/new WeakMap();var OptionalContentGroup=/*#__PURE__*/function(){function OptionalContentGroup(renderingIntent,_ref35){var name=_ref35.name,intent=_ref35.intent,usage=_ref35.usage,rbGroups=_ref35.rbGroups;_classCallCheck(this,OptionalContentGroup);_classPrivateFieldInitSpec(this,_isDisplay,false);_classPrivateFieldInitSpec(this,_isPrint,false);_classPrivateFieldInitSpec(this,_userSet,false);_classPrivateFieldInitSpec(this,_visible,true);_classPrivateFieldSet(_isDisplay,this,!!(renderingIntent&RenderingIntentFlag.DISPLAY));_classPrivateFieldSet(_isPrint,this,!!(renderingIntent&RenderingIntentFlag.PRINT));this.name=name;this.intent=intent;this.usage=usage;this.rbGroups=rbGroups;}return _createClass(OptionalContentGroup,[{key:"visible",get:function get(){if(_classPrivateFieldGet(_userSet,this)){return _classPrivateFieldGet(_visible,this);}if(!_classPrivateFieldGet(_visible,this)){return false;}var _this$usage=this.usage,print=_this$usage.print,view=_this$usage.view;if(_classPrivateFieldGet(_isDisplay,this)){return(view===null||view===void 0?void 0:view.viewState)!=="OFF";}else if(_classPrivateFieldGet(_isPrint,this)){return(print===null||print===void 0?void 0:print.printState)!=="OFF";}return true;}},{key:"_setVisible",value:function _setVisible(internal,visible){var userSet=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(internal!==INTERNAL){unreachable("Internal method `_setVisible` called.");}_classPrivateFieldSet(_userSet,this,userSet);_classPrivateFieldSet(_visible,this,visible);}}]);}();var _cachedGetHash=/*#__PURE__*/new WeakMap();var _groups=/*#__PURE__*/new WeakMap();var _initialHash=/*#__PURE__*/new WeakMap();var _order=/*#__PURE__*/new WeakMap();var _OptionalContentConfig_brand=/*#__PURE__*/new WeakSet();var OptionalContentConfig=/*#__PURE__*/function(){function OptionalContentConfig(data){var renderingIntent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:RenderingIntentFlag.DISPLAY;_classCallCheck(this,OptionalContentConfig);_classPrivateMethodInitSpec(this,_OptionalContentConfig_brand);_classPrivateFieldInitSpec(this,_cachedGetHash,null);_classPrivateFieldInitSpec(this,_groups,new Map());_classPrivateFieldInitSpec(this,_initialHash,null);_classPrivateFieldInitSpec(this,_order,null);this.renderingIntent=renderingIntent;this.name=null;this.creator=null;if(data===null){return;}this.name=data.name;this.creator=data.creator;_classPrivateFieldSet(_order,this,data.order);var _iterator65=_createForOfIteratorHelper(data.groups),_step65;try{for(_iterator65.s();!(_step65=_iterator65.n()).done;){var _group=_step65.value;_classPrivateFieldGet(_groups,this).set(_group.id,new OptionalContentGroup(renderingIntent,_group));}}catch(err){_iterator65.e(err);}finally{_iterator65.f();}if(data.baseState==="OFF"){var _iterator66=_createForOfIteratorHelper(_classPrivateFieldGet(_groups,this).values()),_step66;try{for(_iterator66.s();!(_step66=_iterator66.n()).done;){var group=_step66.value;group._setVisible(INTERNAL,false);}}catch(err){_iterator66.e(err);}finally{_iterator66.f();}}var _iterator67=_createForOfIteratorHelper(data.on),_step67;try{for(_iterator67.s();!(_step67=_iterator67.n()).done;){var on=_step67.value;_classPrivateFieldGet(_groups,this).get(on)._setVisible(INTERNAL,true);}}catch(err){_iterator67.e(err);}finally{_iterator67.f();}var _iterator68=_createForOfIteratorHelper(data.off),_step68;try{for(_iterator68.s();!(_step68=_iterator68.n()).done;){var off=_step68.value;_classPrivateFieldGet(_groups,this).get(off)._setVisible(INTERNAL,false);}}catch(err){_iterator68.e(err);}finally{_iterator68.f();}_classPrivateFieldSet(_initialHash,this,this.getHash());}return _createClass(OptionalContentConfig,[{key:"isVisible",value:function isVisible(group){if(_classPrivateFieldGet(_groups,this).size===0){return true;}if(!group){info("Optional content group not defined.");return true;}if(group.type==="OCG"){if(!_classPrivateFieldGet(_groups,this).has(group.id)){warn("Optional content group not found: ".concat(group.id));return true;}return _classPrivateFieldGet(_groups,this).get(group.id).visible;}else if(group.type==="OCMD"){if(group.expression){return _assertClassBrand(_OptionalContentConfig_brand,this,_evaluateVisibilityExpression).call(this,group.expression);}if(!group.policy||group.policy==="AnyOn"){var _iterator69=_createForOfIteratorHelper(group.ids),_step69;try{for(_iterator69.s();!(_step69=_iterator69.n()).done;){var id=_step69.value;if(!_classPrivateFieldGet(_groups,this).has(id)){warn("Optional content group not found: ".concat(id));return true;}if(_classPrivateFieldGet(_groups,this).get(id).visible){return true;}}}catch(err){_iterator69.e(err);}finally{_iterator69.f();}return false;}else if(group.policy==="AllOn"){var _iterator70=_createForOfIteratorHelper(group.ids),_step70;try{for(_iterator70.s();!(_step70=_iterator70.n()).done;){var _id4=_step70.value;if(!_classPrivateFieldGet(_groups,this).has(_id4)){warn("Optional content group not found: ".concat(_id4));return true;}if(!_classPrivateFieldGet(_groups,this).get(_id4).visible){return false;}}}catch(err){_iterator70.e(err);}finally{_iterator70.f();}return true;}else if(group.policy==="AnyOff"){var _iterator71=_createForOfIteratorHelper(group.ids),_step71;try{for(_iterator71.s();!(_step71=_iterator71.n()).done;){var _id5=_step71.value;if(!_classPrivateFieldGet(_groups,this).has(_id5)){warn("Optional content group not found: ".concat(_id5));return true;}if(!_classPrivateFieldGet(_groups,this).get(_id5).visible){return true;}}}catch(err){_iterator71.e(err);}finally{_iterator71.f();}return false;}else if(group.policy==="AllOff"){var _iterator72=_createForOfIteratorHelper(group.ids),_step72;try{for(_iterator72.s();!(_step72=_iterator72.n()).done;){var _id6=_step72.value;if(!_classPrivateFieldGet(_groups,this).has(_id6)){warn("Optional content group not found: ".concat(_id6));return true;}if(_classPrivateFieldGet(_groups,this).get(_id6).visible){return false;}}}catch(err){_iterator72.e(err);}finally{_iterator72.f();}return true;}warn("Unknown optional content policy ".concat(group.policy,"."));return true;}warn("Unknown group type ".concat(group.type,"."));return true;}},{key:"setVisibility",value:function setVisibility(id){var visible=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var preserveRB=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var group=_classPrivateFieldGet(_groups,this).get(id);if(!group){warn("Optional content group not found: ".concat(id));return;}if(preserveRB&&visible&&group.rbGroups.length){var _iterator73=_createForOfIteratorHelper(group.rbGroups),_step73;try{for(_iterator73.s();!(_step73=_iterator73.n()).done;){var rbGroup=_step73.value;var _iterator74=_createForOfIteratorHelper(rbGroup),_step74;try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var otherId=_step74.value;if(otherId!==id){var _classPrivateFieldGet56;(_classPrivateFieldGet56=_classPrivateFieldGet(_groups,this).get(otherId))===null||_classPrivateFieldGet56===void 0||_classPrivateFieldGet56._setVisible(INTERNAL,false,true);}}}catch(err){_iterator74.e(err);}finally{_iterator74.f();}}}catch(err){_iterator73.e(err);}finally{_iterator73.f();}}group._setVisible(INTERNAL,!!visible,true);_classPrivateFieldSet(_cachedGetHash,this,null);}},{key:"setOCGState",value:function setOCGState(_ref36){var state=_ref36.state,preserveRB=_ref36.preserveRB;var operator;var _iterator75=_createForOfIteratorHelper(state),_step75;try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var elem=_step75.value;switch(elem){case"ON":case"OFF":case"Toggle":operator=elem;continue;}var group=_classPrivateFieldGet(_groups,this).get(elem);if(!group){continue;}switch(operator){case"ON":this.setVisibility(elem,true,preserveRB);break;case"OFF":this.setVisibility(elem,false,preserveRB);break;case"Toggle":this.setVisibility(elem,!group.visible,preserveRB);break;}}}catch(err){_iterator75.e(err);}finally{_iterator75.f();}_classPrivateFieldSet(_cachedGetHash,this,null);}},{key:"hasInitialVisibility",get:function get(){return _classPrivateFieldGet(_initialHash,this)===null||this.getHash()===_classPrivateFieldGet(_initialHash,this);}},{key:"getOrder",value:function getOrder(){if(!_classPrivateFieldGet(_groups,this).size){return null;}if(_classPrivateFieldGet(_order,this)){return _classPrivateFieldGet(_order,this).slice();}return _toConsumableArray(_classPrivateFieldGet(_groups,this).keys());}},{key:"getGroups",value:function getGroups(){return _classPrivateFieldGet(_groups,this).size>0?objectFromMap(_classPrivateFieldGet(_groups,this)):null;}},{key:"getGroup",value:function getGroup(id){return _classPrivateFieldGet(_groups,this).get(id)||null;}},{key:"getHash",value:function getHash(){if(_classPrivateFieldGet(_cachedGetHash,this)!==null){return _classPrivateFieldGet(_cachedGetHash,this);}var hash=new MurmurHash3_64();var _iterator76=_createForOfIteratorHelper(_classPrivateFieldGet(_groups,this)),_step76;try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var _step76$value=_slicedToArray(_step76.value,2),id=_step76$value[0],group=_step76$value[1];hash.update("".concat(id,":").concat(group.visible));}}catch(err){_iterator76.e(err);}finally{_iterator76.f();}return _classPrivateFieldSet(_cachedGetHash,this,hash.hexdigest());}}]);}();function _evaluateVisibilityExpression(array){var length=array.length;if(length<2){return true;}var operator=array[0];for(var i=1;i<length;i++){var element=array[i];var state=void 0;if(Array.isArray(element)){state=_assertClassBrand(_OptionalContentConfig_brand,this,_evaluateVisibilityExpression).call(this,element);}else if(_classPrivateFieldGet(_groups,this).has(element)){state=_classPrivateFieldGet(_groups,this).get(element).visible;}else{warn("Optional content group not found: ".concat(element));return true;}switch(operator){case"And":if(!state){return false;}break;case"Or":if(state){return true;}break;case"Not":return!state;default:return true;}}return operator==="And";};// ./src/display/transport_stream.js
var PDFDataTransportStream=/*#__PURE__*/function(){function PDFDataTransportStream(pdfDataRangeTransport,_ref37){var _this31=this;var _ref37$disableRange=_ref37.disableRange,disableRange=_ref37$disableRange===void 0?false:_ref37$disableRange,_ref37$disableStream=_ref37.disableStream,disableStream=_ref37$disableStream===void 0?false:_ref37$disableStream;_classCallCheck(this,PDFDataTransportStream);assert(pdfDataRangeTransport,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');var length=pdfDataRangeTransport.length,initialData=pdfDataRangeTransport.initialData,progressiveDone=pdfDataRangeTransport.progressiveDone,contentDispositionFilename=pdfDataRangeTransport.contentDispositionFilename;this._queuedChunks=[];this._progressiveDone=progressiveDone;this._contentDispositionFilename=contentDispositionFilename;if((initialData===null||initialData===void 0?void 0:initialData.length)>0){var buffer=initialData instanceof Uint8Array&&initialData.byteLength===initialData.buffer.byteLength?initialData.buffer:new Uint8Array(initialData).buffer;this._queuedChunks.push(buffer);}this._pdfDataRangeTransport=pdfDataRangeTransport;this._isStreamingSupported=!disableStream;this._isRangeSupported=!disableRange;this._contentLength=length;this._fullRequestReader=null;this._rangeReaders=[];pdfDataRangeTransport.addRangeListener(function(begin,chunk){_this31._onReceiveData({begin:begin,chunk:chunk});});pdfDataRangeTransport.addProgressListener(function(loaded,total){_this31._onProgress({loaded:loaded,total:total});});pdfDataRangeTransport.addProgressiveReadListener(function(chunk){_this31._onReceiveData({chunk:chunk});});pdfDataRangeTransport.addProgressiveDoneListener(function(){_this31._onProgressiveDone();});pdfDataRangeTransport.transportReady();}return _createClass(PDFDataTransportStream,[{key:"_onReceiveData",value:function _onReceiveData(_ref38){var begin=_ref38.begin,chunk=_ref38.chunk;var buffer=chunk instanceof Uint8Array&&chunk.byteLength===chunk.buffer.byteLength?chunk.buffer:new Uint8Array(chunk).buffer;if(begin===undefined){if(this._fullRequestReader){this._fullRequestReader._enqueue(buffer);}else{this._queuedChunks.push(buffer);}}else{var found=this._rangeReaders.some(function(rangeReader){if(rangeReader._begin!==begin){return false;}rangeReader._enqueue(buffer);return true;});assert(found,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.");}}},{key:"_progressiveDataLength",get:function get(){var _this$_fullRequestRea,_this$_fullRequestRea2;return(_this$_fullRequestRea=(_this$_fullRequestRea2=this._fullRequestReader)===null||_this$_fullRequestRea2===void 0?void 0:_this$_fullRequestRea2._loaded)!==null&&_this$_fullRequestRea!==void 0?_this$_fullRequestRea:0;}},{key:"_onProgress",value:function _onProgress(evt){if(evt.total===undefined){var _this$_rangeReaders$,_this$_rangeReaders$$;(_this$_rangeReaders$=this._rangeReaders[0])===null||_this$_rangeReaders$===void 0||(_this$_rangeReaders$$=_this$_rangeReaders$.onProgress)===null||_this$_rangeReaders$$===void 0||_this$_rangeReaders$$.call(_this$_rangeReaders$,{loaded:evt.loaded});}else{var _this$_fullRequestRea3,_this$_fullRequestRea4;(_this$_fullRequestRea3=this._fullRequestReader)===null||_this$_fullRequestRea3===void 0||(_this$_fullRequestRea4=_this$_fullRequestRea3.onProgress)===null||_this$_fullRequestRea4===void 0||_this$_fullRequestRea4.call(_this$_fullRequestRea3,{loaded:evt.loaded,total:evt.total});}}},{key:"_onProgressiveDone",value:function _onProgressiveDone(){var _this$_fullRequestRea5;(_this$_fullRequestRea5=this._fullRequestReader)===null||_this$_fullRequestRea5===void 0||_this$_fullRequestRea5.progressiveDone();this._progressiveDone=true;}},{key:"_removeRangeReader",value:function _removeRangeReader(reader){var i=this._rangeReaders.indexOf(reader);if(i>=0){this._rangeReaders.splice(i,1);}}},{key:"getFullReader",value:function getFullReader(){assert(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var queuedChunks=this._queuedChunks;this._queuedChunks=null;return new PDFDataTransportStreamReader(this,queuedChunks,this._progressiveDone,this._contentDispositionFilename);}},{key:"getRangeReader",value:function getRangeReader(begin,end){if(end<=this._progressiveDataLength){return null;}var reader=new PDFDataTransportStreamRangeReader(this,begin,end);this._pdfDataRangeTransport.requestDataRange(begin,end);this._rangeReaders.push(reader);return reader;}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea6;(_this$_fullRequestRea6=this._fullRequestReader)===null||_this$_fullRequestRea6===void 0||_this$_fullRequestRea6.cancel(reason);var _iterator77=_createForOfIteratorHelper(this._rangeReaders.slice(0)),_step77;try{for(_iterator77.s();!(_step77=_iterator77.n()).done;){var reader=_step77.value;reader.cancel(reason);}}catch(err){_iterator77.e(err);}finally{_iterator77.f();}this._pdfDataRangeTransport.abort();}}]);}();var PDFDataTransportStreamReader=/*#__PURE__*/function(){function PDFDataTransportStreamReader(stream,queuedChunks){var progressiveDone=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var contentDispositionFilename=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck(this,PDFDataTransportStreamReader);this._stream=stream;this._done=progressiveDone||false;this._filename=_isPdfFile(contentDispositionFilename)?contentDispositionFilename:null;this._queuedChunks=queuedChunks||[];this._loaded=0;var _iterator78=_createForOfIteratorHelper(this._queuedChunks),_step78;try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var chunk=_step78.value;this._loaded+=chunk.byteLength;}}catch(err){_iterator78.e(err);}finally{_iterator78.f();}this._requests=[];this._headersReady=Promise.resolve();stream._fullRequestReader=this;this.onProgress=null;}return _createClass(PDFDataTransportStreamReader,[{key:"_enqueue",value:function _enqueue(chunk){if(this._done){return;}if(this._requests.length>0){var requestCapability=this._requests.shift();requestCapability.resolve({value:chunk,done:false});}else{this._queuedChunks.push(chunk);}this._loaded+=chunk.byteLength;}},{key:"headersReady",get:function get(){return this._headersReady;}},{key:"filename",get:function get(){return this._filename;}},{key:"isRangeSupported",get:function get(){return this._stream._isRangeSupported;}},{key:"isStreamingSupported",get:function get(){return this._stream._isStreamingSupported;}},{key:"contentLength",get:function get(){return this._stream._contentLength;}},{key:"read",value:function(){var _read=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee27(){var chunk,requestCapability;return _regenerator().w(function(_context27){while(1)switch(_context27.n){case 0:if(!(this._queuedChunks.length>0)){_context27.n=1;break;}chunk=this._queuedChunks.shift();return _context27.a(2,{value:chunk,done:false});case 1:if(!this._done){_context27.n=2;break;}return _context27.a(2,{value:undefined,done:true});case 2:requestCapability=Promise.withResolvers();this._requests.push(requestCapability);return _context27.a(2,requestCapability.promise);}},_callee27,this);}));function read(){return _read.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){this._done=true;var _iterator79=_createForOfIteratorHelper(this._requests),_step79;try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var requestCapability=_step79.value;requestCapability.resolve({value:undefined,done:true});}}catch(err){_iterator79.e(err);}finally{_iterator79.f();}this._requests.length=0;}},{key:"progressiveDone",value:function progressiveDone(){if(this._done){return;}this._done=true;}}]);}();var PDFDataTransportStreamRangeReader=/*#__PURE__*/function(){function PDFDataTransportStreamRangeReader(stream,begin,end){_classCallCheck(this,PDFDataTransportStreamRangeReader);this._stream=stream;this._begin=begin;this._end=end;this._queuedChunk=null;this._requests=[];this._done=false;this.onProgress=null;}return _createClass(PDFDataTransportStreamRangeReader,[{key:"_enqueue",value:function _enqueue(chunk){if(this._done){return;}if(this._requests.length===0){this._queuedChunk=chunk;}else{var requestsCapability=this._requests.shift();requestsCapability.resolve({value:chunk,done:false});var _iterator80=_createForOfIteratorHelper(this._requests),_step80;try{for(_iterator80.s();!(_step80=_iterator80.n()).done;){var requestCapability=_step80.value;requestCapability.resolve({value:undefined,done:true});}}catch(err){_iterator80.e(err);}finally{_iterator80.f();}this._requests.length=0;}this._done=true;this._stream._removeRangeReader(this);}},{key:"isStreamingSupported",get:function get(){return false;}},{key:"read",value:function(){var _read2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee28(){var chunk,requestCapability;return _regenerator().w(function(_context28){while(1)switch(_context28.n){case 0:if(!this._queuedChunk){_context28.n=1;break;}chunk=this._queuedChunk;this._queuedChunk=null;return _context28.a(2,{value:chunk,done:false});case 1:if(!this._done){_context28.n=2;break;}return _context28.a(2,{value:undefined,done:true});case 2:requestCapability=Promise.withResolvers();this._requests.push(requestCapability);return _context28.a(2,requestCapability.promise);}},_callee28,this);}));function read(){return _read2.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){this._done=true;var _iterator81=_createForOfIteratorHelper(this._requests),_step81;try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var requestCapability=_step81.value;requestCapability.resolve({value:undefined,done:true});}}catch(err){_iterator81.e(err);}finally{_iterator81.f();}this._requests.length=0;this._stream._removeRangeReader(this);}}]);}();;// ./src/display/content_disposition.js
function getFilenameFromContentDispositionHeader(contentDisposition){var needsEncodingFixup=true;var tmp=toParamRegExp("filename\\*","i").exec(contentDisposition);if(tmp){tmp=tmp[1];var filename=rfc2616unquote(tmp);filename=unescape(filename);filename=rfc5987decode(filename);filename=rfc2047decode(filename);return fixupEncoding(filename);}tmp=rfc2231getparam(contentDisposition);if(tmp){var _filename=rfc2047decode(tmp);return fixupEncoding(_filename);}tmp=toParamRegExp("filename","i").exec(contentDisposition);if(tmp){tmp=tmp[1];var _filename2=rfc2616unquote(tmp);_filename2=rfc2047decode(_filename2);return fixupEncoding(_filename2);}function toParamRegExp(attributePattern,flags){return new RegExp("(?:^|;)\\s*"+attributePattern+"\\s*=\\s*"+"("+'[^";\\s][^;\\s]*'+"|"+'"(?:[^"\\\\]|\\\\"?)+"?'+")",flags);}function textdecode(encoding,value){if(encoding){if(!/^[\x00-\xFF]+$/.test(value)){return value;}try{var decoder=new TextDecoder(encoding,{fatal:true});var buffer=stringToBytes(value);value=decoder.decode(buffer);needsEncodingFixup=false;}catch(_unused5){}}return value;}function fixupEncoding(value){if(needsEncodingFixup&&/[\x80-\xff]/.test(value)){value=textdecode("utf-8",value);if(needsEncodingFixup){value=textdecode("iso-8859-1",value);}}return value;}function rfc2231getparam(contentDispositionStr){var matches=[];var match;var iter=toParamRegExp("filename\\*((?!0\\d)\\d+)(\\*?)","ig");while((match=iter.exec(contentDispositionStr))!==null){var _match=match,_match2=_slicedToArray(_match,4),n=_match2[1],quot=_match2[2],part=_match2[3];n=parseInt(n,10);if(n in matches){if(n===0){break;}continue;}matches[n]=[quot,part];}var parts=[];for(var _n=0;_n<matches.length;++_n){if(!(_n in matches)){break;}var _matches$_n=_slicedToArray(matches[_n],2),_quot=_matches$_n[0],_part=_matches$_n[1];_part=rfc2616unquote(_part);if(_quot){_part=unescape(_part);if(_n===0){_part=rfc5987decode(_part);}}parts.push(_part);}return parts.join("");}function rfc2616unquote(value){if(value.startsWith('"')){var parts=value.slice(1).split('\\"');for(var i=0;i<parts.length;++i){var quotindex=parts[i].indexOf('"');if(quotindex!==-1){parts[i]=parts[i].slice(0,quotindex);parts.length=i+1;}parts[i]=parts[i].replaceAll(/\\(.)/g,"$1");}value=parts.join('"');}return value;}function rfc5987decode(extvalue){var encodingend=extvalue.indexOf("'");if(encodingend===-1){return extvalue;}var encoding=extvalue.slice(0,encodingend);var langvalue=extvalue.slice(encodingend+1);var value=langvalue.replace(/^[^']*'/,"");return textdecode(encoding,value);}function rfc2047decode(value){if(!value.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(value)){return value;}return value.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(matches,charset,encoding,text){if(encoding==="q"||encoding==="Q"){text=text.replaceAll("_"," ");text=text.replaceAll(/=([0-9a-fA-F]{2})/g,function(match,hex){return String.fromCharCode(parseInt(hex,16));});return textdecode(charset,text);}try{text=atob(text);}catch(_unused6){}return textdecode(charset,text);});}return"";};// ./src/display/network_utils.js
function createHeaders(isHttp,httpHeaders){var headers=new Headers();if(!isHttp||!httpHeaders||_typeof(httpHeaders)!=="object"){return headers;}for(var key in httpHeaders){var val=httpHeaders[key];if(val!==undefined){headers.append(key,val);}}return headers;}function getResponseOrigin(url){var _URL$parse$origin,_URL$parse;return(_URL$parse$origin=(_URL$parse=URL.parse(url))===null||_URL$parse===void 0?void 0:_URL$parse.origin)!==null&&_URL$parse$origin!==void 0?_URL$parse$origin:null;}function validateRangeRequestCapabilities(_ref39){var responseHeaders=_ref39.responseHeaders,isHttp=_ref39.isHttp,rangeChunkSize=_ref39.rangeChunkSize,disableRange=_ref39.disableRange;var returnValues={allowRangeRequests:false,suggestedLength:undefined};var length=parseInt(responseHeaders.get("Content-Length"),10);if(!Number.isInteger(length)){return returnValues;}returnValues.suggestedLength=length;if(length<=2*rangeChunkSize){return returnValues;}if(disableRange||!isHttp){return returnValues;}if(responseHeaders.get("Accept-Ranges")!=="bytes"){return returnValues;}var contentEncoding=responseHeaders.get("Content-Encoding")||"identity";if(contentEncoding!=="identity"){return returnValues;}returnValues.allowRangeRequests=true;return returnValues;}function extractFilenameFromHeader(responseHeaders){var contentDisposition=responseHeaders.get("Content-Disposition");if(contentDisposition){var filename=getFilenameFromContentDispositionHeader(contentDisposition);if(filename.includes("%")){try{filename=decodeURIComponent(filename);}catch(_unused7){}}if(_isPdfFile(filename)){return filename;}}return null;}function createResponseError(status,url){return new _ResponseException("Unexpected server response (".concat(status,") while retrieving PDF \"").concat(url,"\"."),status,status===404||status===0&&url.startsWith("file:"));}function validateResponseStatus(status){return status===200||status===206;};// ./src/display/fetch_stream.js
function createFetchOptions(headers,withCredentials,abortController){return{method:"GET",headers:headers,signal:abortController.signal,mode:"cors",credentials:withCredentials?"include":"same-origin",redirect:"follow"};}function getArrayBuffer(val){if(val instanceof Uint8Array){return val.buffer;}if(val instanceof ArrayBuffer){return val;}warn("getArrayBuffer - unexpected data format: ".concat(val));return new Uint8Array(val).buffer;}var PDFFetchStream=/*#__PURE__*/function(){function PDFFetchStream(source){_classCallCheck(this,PDFFetchStream);_defineProperty(this,"_responseOrigin",null);this.source=source;this.isHttp=/^https?:/i.test(source.url);this.headers=createHeaders(this.isHttp,source.httpHeaders);this._fullRequestReader=null;this._rangeRequestReaders=[];}return _createClass(PDFFetchStream,[{key:"_progressiveDataLength",get:function get(){var _this$_fullRequestRea7,_this$_fullRequestRea8;return(_this$_fullRequestRea7=(_this$_fullRequestRea8=this._fullRequestReader)===null||_this$_fullRequestRea8===void 0?void 0:_this$_fullRequestRea8._loaded)!==null&&_this$_fullRequestRea7!==void 0?_this$_fullRequestRea7:0;}},{key:"getFullReader",value:function getFullReader(){assert(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once.");this._fullRequestReader=new PDFFetchStreamReader(this);return this._fullRequestReader;}},{key:"getRangeReader",value:function getRangeReader(begin,end){if(end<=this._progressiveDataLength){return null;}var reader=new PDFFetchStreamRangeReader(this,begin,end);this._rangeRequestReaders.push(reader);return reader;}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea9;(_this$_fullRequestRea9=this._fullRequestReader)===null||_this$_fullRequestRea9===void 0||_this$_fullRequestRea9.cancel(reason);var _iterator82=_createForOfIteratorHelper(this._rangeRequestReaders.slice(0)),_step82;try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var reader=_step82.value;reader.cancel(reason);}}catch(err){_iterator82.e(err);}finally{_iterator82.f();}}}]);}();var PDFFetchStreamReader=/*#__PURE__*/function(){function PDFFetchStreamReader(stream){var _this32=this;_classCallCheck(this,PDFFetchStreamReader);this._stream=stream;this._reader=null;this._loaded=0;this._filename=null;var source=stream.source;this._withCredentials=source.withCredentials||false;this._contentLength=source.length;this._headersCapability=Promise.withResolvers();this._disableRange=source.disableRange||false;this._rangeChunkSize=source.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true;}this._abortController=new AbortController();this._isStreamingSupported=!source.disableStream;this._isRangeSupported=!source.disableRange;var headers=new Headers(stream.headers);var url=source.url;fetch(url,createFetchOptions(headers,this._withCredentials,this._abortController)).then(function(response){stream._responseOrigin=getResponseOrigin(response.url);if(!validateResponseStatus(response.status)){throw createResponseError(response.status,url);}_this32._reader=response.body.getReader();_this32._headersCapability.resolve();var responseHeaders=response.headers;var _validateRangeRequest=validateRangeRequestCapabilities({responseHeaders:responseHeaders,isHttp:stream.isHttp,rangeChunkSize:_this32._rangeChunkSize,disableRange:_this32._disableRange}),allowRangeRequests=_validateRangeRequest.allowRangeRequests,suggestedLength=_validateRangeRequest.suggestedLength;_this32._isRangeSupported=allowRangeRequests;_this32._contentLength=suggestedLength||_this32._contentLength;_this32._filename=extractFilenameFromHeader(responseHeaders);if(!_this32._isStreamingSupported&&_this32._isRangeSupported){_this32.cancel(new _AbortException("Streaming is disabled."));}})["catch"](this._headersCapability.reject);this.onProgress=null;}return _createClass(PDFFetchStreamReader,[{key:"headersReady",get:function get(){return this._headersCapability.promise;}},{key:"filename",get:function get(){return this._filename;}},{key:"contentLength",get:function get(){return this._contentLength;}},{key:"isRangeSupported",get:function get(){return this._isRangeSupported;}},{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported;}},{key:"read",value:function(){var _read3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee29(){var _this$onProgress;var _yield$this$_reader$r,value,done;return _regenerator().w(function(_context29){while(1)switch(_context29.n){case 0:_context29.n=1;return this._headersCapability.promise;case 1:_context29.n=2;return this._reader.read();case 2:_yield$this$_reader$r=_context29.v;value=_yield$this$_reader$r.value;done=_yield$this$_reader$r.done;if(!done){_context29.n=3;break;}return _context29.a(2,{value:value,done:done});case 3:this._loaded+=value.byteLength;(_this$onProgress=this.onProgress)===null||_this$onProgress===void 0||_this$onProgress.call(this,{loaded:this._loaded,total:this._contentLength});return _context29.a(2,{value:getArrayBuffer(value),done:false});}},_callee29,this);}));function read(){return _read3.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){var _this$_reader;(_this$_reader=this._reader)===null||_this$_reader===void 0||_this$_reader.cancel(reason);this._abortController.abort();}}]);}();var PDFFetchStreamRangeReader=/*#__PURE__*/function(){function PDFFetchStreamRangeReader(stream,begin,end){var _this33=this;_classCallCheck(this,PDFFetchStreamRangeReader);this._stream=stream;this._reader=null;this._loaded=0;var source=stream.source;this._withCredentials=source.withCredentials||false;this._readCapability=Promise.withResolvers();this._isStreamingSupported=!source.disableStream;this._abortController=new AbortController();var headers=new Headers(stream.headers);headers.append("Range","bytes=".concat(begin,"-").concat(end-1));var url=source.url;fetch(url,createFetchOptions(headers,this._withCredentials,this._abortController)).then(function(response){var responseOrigin=getResponseOrigin(response.url);if(responseOrigin!==stream._responseOrigin){throw new Error("Expected range response-origin \"".concat(responseOrigin,"\" to match \"").concat(stream._responseOrigin,"\"."));}if(!validateResponseStatus(response.status)){throw createResponseError(response.status,url);}_this33._readCapability.resolve();_this33._reader=response.body.getReader();})["catch"](this._readCapability.reject);this.onProgress=null;}return _createClass(PDFFetchStreamRangeReader,[{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported;}},{key:"read",value:function(){var _read4=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee30(){var _this$onProgress2;var _yield$this$_reader$r2,value,done;return _regenerator().w(function(_context30){while(1)switch(_context30.n){case 0:_context30.n=1;return this._readCapability.promise;case 1:_context30.n=2;return this._reader.read();case 2:_yield$this$_reader$r2=_context30.v;value=_yield$this$_reader$r2.value;done=_yield$this$_reader$r2.done;if(!done){_context30.n=3;break;}return _context30.a(2,{value:value,done:done});case 3:this._loaded+=value.byteLength;(_this$onProgress2=this.onProgress)===null||_this$onProgress2===void 0||_this$onProgress2.call(this,{loaded:this._loaded});return _context30.a(2,{value:getArrayBuffer(value),done:false});}},_callee30,this);}));function read(){return _read4.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){var _this$_reader2;(_this$_reader2=this._reader)===null||_this$_reader2===void 0||_this$_reader2.cancel(reason);this._abortController.abort();}}]);}();;// ./src/display/network.js
var OK_RESPONSE=200;var PARTIAL_CONTENT_RESPONSE=206;function network_getArrayBuffer(xhr){var data=xhr.response;if(typeof data!=="string"){return data;}return stringToBytes(data).buffer;}var NetworkManager=/*#__PURE__*/function(){function NetworkManager(_ref40){var url=_ref40.url,httpHeaders=_ref40.httpHeaders,withCredentials=_ref40.withCredentials;_classCallCheck(this,NetworkManager);_defineProperty(this,"_responseOrigin",null);this.url=url;this.isHttp=/^https?:/i.test(url);this.headers=createHeaders(this.isHttp,httpHeaders);this.withCredentials=withCredentials||false;this.currXhrId=0;this.pendingRequests=Object.create(null);}return _createClass(NetworkManager,[{key:"request",value:function request(args){var xhr=new XMLHttpRequest();var xhrId=this.currXhrId++;var pendingRequest=this.pendingRequests[xhrId]={xhr:xhr};xhr.open("GET",this.url);xhr.withCredentials=this.withCredentials;var _iterator83=_createForOfIteratorHelper(this.headers),_step83;try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var _step83$value=_slicedToArray(_step83.value,2),key=_step83$value[0],val=_step83$value[1];xhr.setRequestHeader(key,val);}}catch(err){_iterator83.e(err);}finally{_iterator83.f();}if(this.isHttp&&"begin"in args&&"end"in args){xhr.setRequestHeader("Range","bytes=".concat(args.begin,"-").concat(args.end-1));pendingRequest.expectedStatus=PARTIAL_CONTENT_RESPONSE;}else{pendingRequest.expectedStatus=OK_RESPONSE;}xhr.responseType="arraybuffer";assert(args.onError,"Expected `onError` callback to be provided.");xhr.onerror=function(){args.onError(xhr.status);};xhr.onreadystatechange=this.onStateChange.bind(this,xhrId);xhr.onprogress=this.onProgress.bind(this,xhrId);pendingRequest.onHeadersReceived=args.onHeadersReceived;pendingRequest.onDone=args.onDone;pendingRequest.onError=args.onError;pendingRequest.onProgress=args.onProgress;xhr.send(null);return xhrId;}},{key:"onProgress",value:function onProgress(xhrId,evt){var _pendingRequest$onPro;var pendingRequest=this.pendingRequests[xhrId];if(!pendingRequest){return;}(_pendingRequest$onPro=pendingRequest.onProgress)===null||_pendingRequest$onPro===void 0||_pendingRequest$onPro.call(pendingRequest,evt);}},{key:"onStateChange",value:function onStateChange(xhrId,evt){var pendingRequest=this.pendingRequests[xhrId];if(!pendingRequest){return;}var xhr=pendingRequest.xhr;if(xhr.readyState>=2&&pendingRequest.onHeadersReceived){pendingRequest.onHeadersReceived();delete pendingRequest.onHeadersReceived;}if(xhr.readyState!==4){return;}if(!(xhrId in this.pendingRequests)){return;}delete this.pendingRequests[xhrId];if(xhr.status===0&&this.isHttp){pendingRequest.onError(xhr.status);return;}var xhrStatus=xhr.status||OK_RESPONSE;var ok_response_on_range_request=xhrStatus===OK_RESPONSE&&pendingRequest.expectedStatus===PARTIAL_CONTENT_RESPONSE;if(!ok_response_on_range_request&&xhrStatus!==pendingRequest.expectedStatus){pendingRequest.onError(xhr.status);return;}var chunk=network_getArrayBuffer(xhr);if(xhrStatus===PARTIAL_CONTENT_RESPONSE){var rangeHeader=xhr.getResponseHeader("Content-Range");var matches=/bytes (\d+)-(\d+)\/(\d+)/.exec(rangeHeader);if(matches){pendingRequest.onDone({begin:parseInt(matches[1],10),chunk:chunk});}else{warn("Missing or invalid \"Content-Range\" header.");pendingRequest.onError(0);}}else if(chunk){pendingRequest.onDone({begin:0,chunk:chunk});}else{pendingRequest.onError(xhr.status);}}},{key:"getRequestXhr",value:function getRequestXhr(xhrId){return this.pendingRequests[xhrId].xhr;}},{key:"isPendingRequest",value:function isPendingRequest(xhrId){return xhrId in this.pendingRequests;}},{key:"abortRequest",value:function abortRequest(xhrId){var xhr=this.pendingRequests[xhrId].xhr;delete this.pendingRequests[xhrId];xhr.abort();}}]);}();var PDFNetworkStream=/*#__PURE__*/function(){function PDFNetworkStream(source){_classCallCheck(this,PDFNetworkStream);this._source=source;this._manager=new NetworkManager(source);this._rangeChunkSize=source.rangeChunkSize;this._fullRequestReader=null;this._rangeRequestReaders=[];}return _createClass(PDFNetworkStream,[{key:"_onRangeRequestReaderClosed",value:function _onRangeRequestReaderClosed(reader){var i=this._rangeRequestReaders.indexOf(reader);if(i>=0){this._rangeRequestReaders.splice(i,1);}}},{key:"getFullReader",value:function getFullReader(){assert(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once.");this._fullRequestReader=new PDFNetworkStreamFullRequestReader(this._manager,this._source);return this._fullRequestReader;}},{key:"getRangeReader",value:function getRangeReader(begin,end){var reader=new PDFNetworkStreamRangeRequestReader(this._manager,begin,end);reader.onClosed=this._onRangeRequestReaderClosed.bind(this);this._rangeRequestReaders.push(reader);return reader;}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea0;(_this$_fullRequestRea0=this._fullRequestReader)===null||_this$_fullRequestRea0===void 0||_this$_fullRequestRea0.cancel(reason);var _iterator84=_createForOfIteratorHelper(this._rangeRequestReaders.slice(0)),_step84;try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var reader=_step84.value;reader.cancel(reason);}}catch(err){_iterator84.e(err);}finally{_iterator84.f();}}}]);}();var PDFNetworkStreamFullRequestReader=/*#__PURE__*/function(){function PDFNetworkStreamFullRequestReader(manager,source){_classCallCheck(this,PDFNetworkStreamFullRequestReader);this._manager=manager;this._url=source.url;this._fullRequestId=manager.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)});this._headersCapability=Promise.withResolvers();this._disableRange=source.disableRange||false;this._contentLength=source.length;this._rangeChunkSize=source.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true;}this._isStreamingSupported=false;this._isRangeSupported=false;this._cachedChunks=[];this._requests=[];this._done=false;this._storedError=undefined;this._filename=null;this.onProgress=null;}return _createClass(PDFNetworkStreamFullRequestReader,[{key:"_onHeadersReceived",value:function _onHeadersReceived(){var fullRequestXhrId=this._fullRequestId;var fullRequestXhr=this._manager.getRequestXhr(fullRequestXhrId);this._manager._responseOrigin=getResponseOrigin(fullRequestXhr.responseURL);var rawResponseHeaders=fullRequestXhr.getAllResponseHeaders();var responseHeaders=new Headers(rawResponseHeaders?rawResponseHeaders.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(function(x){var _x$split=x.split(": "),_x$split2=_toArray(_x$split),key=_x$split2[0],val=_x$split2.slice(1);return[key,val.join(": ")];}):[]);var _validateRangeRequest2=validateRangeRequestCapabilities({responseHeaders:responseHeaders,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange}),allowRangeRequests=_validateRangeRequest2.allowRangeRequests,suggestedLength=_validateRangeRequest2.suggestedLength;if(allowRangeRequests){this._isRangeSupported=true;}this._contentLength=suggestedLength||this._contentLength;this._filename=extractFilenameFromHeader(responseHeaders);if(this._isRangeSupported){this._manager.abortRequest(fullRequestXhrId);}this._headersCapability.resolve();}},{key:"_onDone",value:function _onDone(data){if(data){if(this._requests.length>0){var requestCapability=this._requests.shift();requestCapability.resolve({value:data.chunk,done:false});}else{this._cachedChunks.push(data.chunk);}}this._done=true;if(this._cachedChunks.length>0){return;}var _iterator85=_createForOfIteratorHelper(this._requests),_step85;try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var _requestCapability=_step85.value;_requestCapability.resolve({value:undefined,done:true});}}catch(err){_iterator85.e(err);}finally{_iterator85.f();}this._requests.length=0;}},{key:"_onError",value:function _onError(status){this._storedError=createResponseError(status,this._url);this._headersCapability.reject(this._storedError);var _iterator86=_createForOfIteratorHelper(this._requests),_step86;try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var requestCapability=_step86.value;requestCapability.reject(this._storedError);}}catch(err){_iterator86.e(err);}finally{_iterator86.f();}this._requests.length=0;this._cachedChunks.length=0;}},{key:"_onProgress",value:function _onProgress(evt){var _this$onProgress3;(_this$onProgress3=this.onProgress)===null||_this$onProgress3===void 0||_this$onProgress3.call(this,{loaded:evt.loaded,total:evt.lengthComputable?evt.total:this._contentLength});}},{key:"filename",get:function get(){return this._filename;}},{key:"isRangeSupported",get:function get(){return this._isRangeSupported;}},{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported;}},{key:"contentLength",get:function get(){return this._contentLength;}},{key:"headersReady",get:function get(){return this._headersCapability.promise;}},{key:"read",value:function(){var _read5=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee31(){var chunk,requestCapability;return _regenerator().w(function(_context31){while(1)switch(_context31.n){case 0:_context31.n=1;return this._headersCapability.promise;case 1:if(!this._storedError){_context31.n=2;break;}throw this._storedError;case 2:if(!(this._cachedChunks.length>0)){_context31.n=3;break;}chunk=this._cachedChunks.shift();return _context31.a(2,{value:chunk,done:false});case 3:if(!this._done){_context31.n=4;break;}return _context31.a(2,{value:undefined,done:true});case 4:requestCapability=Promise.withResolvers();this._requests.push(requestCapability);return _context31.a(2,requestCapability.promise);}},_callee31,this);}));function read(){return _read5.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){this._done=true;this._headersCapability.reject(reason);var _iterator87=_createForOfIteratorHelper(this._requests),_step87;try{for(_iterator87.s();!(_step87=_iterator87.n()).done;){var requestCapability=_step87.value;requestCapability.resolve({value:undefined,done:true});}}catch(err){_iterator87.e(err);}finally{_iterator87.f();}this._requests.length=0;if(this._manager.isPendingRequest(this._fullRequestId)){this._manager.abortRequest(this._fullRequestId);}this._fullRequestReader=null;}}]);}();var PDFNetworkStreamRangeRequestReader=/*#__PURE__*/function(){function PDFNetworkStreamRangeRequestReader(manager,begin,end){_classCallCheck(this,PDFNetworkStreamRangeRequestReader);this._manager=manager;this._url=manager.url;this._requestId=manager.request({begin:begin,end:end,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)});this._requests=[];this._queuedChunk=null;this._done=false;this._storedError=undefined;this.onProgress=null;this.onClosed=null;}return _createClass(PDFNetworkStreamRangeRequestReader,[{key:"_onHeadersReceived",value:function _onHeadersReceived(){var _this$_manager$getReq;var responseOrigin=getResponseOrigin((_this$_manager$getReq=this._manager.getRequestXhr(this._requestId))===null||_this$_manager$getReq===void 0?void 0:_this$_manager$getReq.responseURL);if(responseOrigin!==this._manager._responseOrigin){this._storedError=new Error("Expected range response-origin \"".concat(responseOrigin,"\" to match \"").concat(this._manager._responseOrigin,"\"."));this._onError(0);}}},{key:"_close",value:function _close(){var _this$onClosed;(_this$onClosed=this.onClosed)===null||_this$onClosed===void 0||_this$onClosed.call(this,this);}},{key:"_onDone",value:function _onDone(data){var chunk=data.chunk;if(this._requests.length>0){var requestCapability=this._requests.shift();requestCapability.resolve({value:chunk,done:false});}else{this._queuedChunk=chunk;}this._done=true;var _iterator88=_createForOfIteratorHelper(this._requests),_step88;try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var _requestCapability2=_step88.value;_requestCapability2.resolve({value:undefined,done:true});}}catch(err){_iterator88.e(err);}finally{_iterator88.f();}this._requests.length=0;this._close();}},{key:"_onError",value:function _onError(status){var _this$_storedError;(_this$_storedError=this._storedError)!==null&&_this$_storedError!==void 0?_this$_storedError:this._storedError=createResponseError(status,this._url);var _iterator89=_createForOfIteratorHelper(this._requests),_step89;try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var requestCapability=_step89.value;requestCapability.reject(this._storedError);}}catch(err){_iterator89.e(err);}finally{_iterator89.f();}this._requests.length=0;this._queuedChunk=null;}},{key:"_onProgress",value:function _onProgress(evt){if(!this.isStreamingSupported){var _this$onProgress4;(_this$onProgress4=this.onProgress)===null||_this$onProgress4===void 0||_this$onProgress4.call(this,{loaded:evt.loaded});}}},{key:"isStreamingSupported",get:function get(){return false;}},{key:"read",value:function(){var _read6=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee32(){var chunk,requestCapability;return _regenerator().w(function(_context32){while(1)switch(_context32.n){case 0:if(!this._storedError){_context32.n=1;break;}throw this._storedError;case 1:if(!(this._queuedChunk!==null)){_context32.n=2;break;}chunk=this._queuedChunk;this._queuedChunk=null;return _context32.a(2,{value:chunk,done:false});case 2:if(!this._done){_context32.n=3;break;}return _context32.a(2,{value:undefined,done:true});case 3:requestCapability=Promise.withResolvers();this._requests.push(requestCapability);return _context32.a(2,requestCapability.promise);}},_callee32,this);}));function read(){return _read6.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){this._done=true;var _iterator90=_createForOfIteratorHelper(this._requests),_step90;try{for(_iterator90.s();!(_step90=_iterator90.n()).done;){var requestCapability=_step90.value;requestCapability.resolve({value:undefined,done:true});}}catch(err){_iterator90.e(err);}finally{_iterator90.f();}this._requests.length=0;if(this._manager.isPendingRequest(this._requestId)){this._manager.abortRequest(this._requestId);}this._close();}}]);}();;// ./src/display/node_stream.js
var urlRegex=/^[a-z][a-z0-9\-+.]+:/i;function parseUrlOrPath(sourceUrl){if(urlRegex.test(sourceUrl)){return new URL(sourceUrl);}var url=process.getBuiltinModule("url");return new URL(url.pathToFileURL(sourceUrl));}var PDFNodeStream=/*#__PURE__*/function(){function PDFNodeStream(source){_classCallCheck(this,PDFNodeStream);this.source=source;this.url=parseUrlOrPath(source.url);assert(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs.");this._fullRequestReader=null;this._rangeRequestReaders=[];}return _createClass(PDFNodeStream,[{key:"_progressiveDataLength",get:function get(){var _this$_fullRequestRea1,_this$_fullRequestRea10;return(_this$_fullRequestRea1=(_this$_fullRequestRea10=this._fullRequestReader)===null||_this$_fullRequestRea10===void 0?void 0:_this$_fullRequestRea10._loaded)!==null&&_this$_fullRequestRea1!==void 0?_this$_fullRequestRea1:0;}},{key:"getFullReader",value:function getFullReader(){assert(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once.");this._fullRequestReader=new PDFNodeStreamFsFullReader(this);return this._fullRequestReader;}},{key:"getRangeReader",value:function getRangeReader(start,end){if(end<=this._progressiveDataLength){return null;}var rangeReader=new PDFNodeStreamFsRangeReader(this,start,end);this._rangeRequestReaders.push(rangeReader);return rangeReader;}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea11;(_this$_fullRequestRea11=this._fullRequestReader)===null||_this$_fullRequestRea11===void 0||_this$_fullRequestRea11.cancel(reason);var _iterator91=_createForOfIteratorHelper(this._rangeRequestReaders.slice(0)),_step91;try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var reader=_step91.value;reader.cancel(reason);}}catch(err){_iterator91.e(err);}finally{_iterator91.f();}}}]);}();var PDFNodeStreamFsFullReader=/*#__PURE__*/function(){function PDFNodeStreamFsFullReader(stream){var _this34=this;_classCallCheck(this,PDFNodeStreamFsFullReader);this._url=stream.url;this._done=false;this._storedError=null;this.onProgress=null;var source=stream.source;this._contentLength=source.length;this._loaded=0;this._filename=null;this._disableRange=source.disableRange||false;this._rangeChunkSize=source.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true;}this._isStreamingSupported=!source.disableStream;this._isRangeSupported=!source.disableRange;this._readableStream=null;this._readCapability=Promise.withResolvers();this._headersCapability=Promise.withResolvers();var fs=process.getBuiltinModule("fs");fs.promises.lstat(this._url).then(function(stat){_this34._contentLength=stat.size;_this34._setReadableStream(fs.createReadStream(_this34._url));_this34._headersCapability.resolve();},function(error){if(error.code==="ENOENT"){error=createResponseError(0,_this34._url.href);}_this34._storedError=error;_this34._headersCapability.reject(error);});}return _createClass(PDFNodeStreamFsFullReader,[{key:"headersReady",get:function get(){return this._headersCapability.promise;}},{key:"filename",get:function get(){return this._filename;}},{key:"contentLength",get:function get(){return this._contentLength;}},{key:"isRangeSupported",get:function get(){return this._isRangeSupported;}},{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported;}},{key:"read",value:function(){var _read7=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee33(){var _this$onProgress5;var chunk,buffer;return _regenerator().w(function(_context33){while(1)switch(_context33.n){case 0:_context33.n=1;return this._readCapability.promise;case 1:if(!this._done){_context33.n=2;break;}return _context33.a(2,{value:undefined,done:true});case 2:if(!this._storedError){_context33.n=3;break;}throw this._storedError;case 3:chunk=this._readableStream.read();if(!(chunk===null)){_context33.n=4;break;}this._readCapability=Promise.withResolvers();return _context33.a(2,this.read());case 4:this._loaded+=chunk.length;(_this$onProgress5=this.onProgress)===null||_this$onProgress5===void 0||_this$onProgress5.call(this,{loaded:this._loaded,total:this._contentLength});buffer=new Uint8Array(chunk).buffer;return _context33.a(2,{value:buffer,done:false});}},_callee33,this);}));function read(){return _read7.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){if(!this._readableStream){this._error(reason);return;}this._readableStream.destroy(reason);}},{key:"_error",value:function _error(reason){this._storedError=reason;this._readCapability.resolve();}},{key:"_setReadableStream",value:function _setReadableStream(readableStream){var _this35=this;this._readableStream=readableStream;readableStream.on("readable",function(){_this35._readCapability.resolve();});readableStream.on("end",function(){readableStream.destroy();_this35._done=true;_this35._readCapability.resolve();});readableStream.on("error",function(reason){_this35._error(reason);});if(!this._isStreamingSupported&&this._isRangeSupported){this._error(new _AbortException("streaming is disabled"));}if(this._storedError){this._readableStream.destroy(this._storedError);}}}]);}();var PDFNodeStreamFsRangeReader=/*#__PURE__*/function(){function PDFNodeStreamFsRangeReader(stream,start,end){_classCallCheck(this,PDFNodeStreamFsRangeReader);this._url=stream.url;this._done=false;this._storedError=null;this.onProgress=null;this._loaded=0;this._readableStream=null;this._readCapability=Promise.withResolvers();var source=stream.source;this._isStreamingSupported=!source.disableStream;var fs=process.getBuiltinModule("fs");this._setReadableStream(fs.createReadStream(this._url,{start:start,end:end-1}));}return _createClass(PDFNodeStreamFsRangeReader,[{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported;}},{key:"read",value:function(){var _read8=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee34(){var _this$onProgress6;var chunk,buffer;return _regenerator().w(function(_context34){while(1)switch(_context34.n){case 0:_context34.n=1;return this._readCapability.promise;case 1:if(!this._done){_context34.n=2;break;}return _context34.a(2,{value:undefined,done:true});case 2:if(!this._storedError){_context34.n=3;break;}throw this._storedError;case 3:chunk=this._readableStream.read();if(!(chunk===null)){_context34.n=4;break;}this._readCapability=Promise.withResolvers();return _context34.a(2,this.read());case 4:this._loaded+=chunk.length;(_this$onProgress6=this.onProgress)===null||_this$onProgress6===void 0||_this$onProgress6.call(this,{loaded:this._loaded});buffer=new Uint8Array(chunk).buffer;return _context34.a(2,{value:buffer,done:false});}},_callee34,this);}));function read(){return _read8.apply(this,arguments);}return read;}()},{key:"cancel",value:function cancel(reason){if(!this._readableStream){this._error(reason);return;}this._readableStream.destroy(reason);}},{key:"_error",value:function _error(reason){this._storedError=reason;this._readCapability.resolve();}},{key:"_setReadableStream",value:function _setReadableStream(readableStream){var _this36=this;this._readableStream=readableStream;readableStream.on("readable",function(){_this36._readCapability.resolve();});readableStream.on("end",function(){readableStream.destroy();_this36._done=true;_this36._readCapability.resolve();});readableStream.on("error",function(reason){_this36._error(reason);});if(this._storedError){this._readableStream.destroy(this._storedError);}}}]);}();;// ./src/display/text_layer.js
var MAX_TEXT_DIVS_TO_RENDER=100000;var DEFAULT_FONT_SIZE=30;var _capability=/*#__PURE__*/new WeakMap();var _container4=/*#__PURE__*/new WeakMap();var _disableProcessItems=/*#__PURE__*/new WeakMap();var _fontInspectorEnabled=/*#__PURE__*/new WeakMap();var _lang=/*#__PURE__*/new WeakMap();var _layoutTextParams=/*#__PURE__*/new WeakMap();var _pageHeight3=/*#__PURE__*/new WeakMap();var _pageWidth3=/*#__PURE__*/new WeakMap();var _reader=/*#__PURE__*/new WeakMap();var _rootContainer=/*#__PURE__*/new WeakMap();var _rotation3=/*#__PURE__*/new WeakMap();var _scale=/*#__PURE__*/new WeakMap();var _styleCache=/*#__PURE__*/new WeakMap();var _textContentItemsStr=/*#__PURE__*/new WeakMap();var _textContentSource=/*#__PURE__*/new WeakMap();var _textDivs=/*#__PURE__*/new WeakMap();var _textDivProperties=/*#__PURE__*/new WeakMap();var _transform=/*#__PURE__*/new WeakMap();var _TextLayer_brand=/*#__PURE__*/new WeakSet();var _TextLayer=/*#__PURE__*/function(){function _TextLayer(_ref41){var _globalThis$FontInspe,_this37=this;var textContentSource=_ref41.textContentSource,container=_ref41.container,viewport=_ref41.viewport;_classCallCheck(this,_TextLayer);_classPrivateMethodInitSpec(this,_TextLayer_brand);_classPrivateFieldInitSpec(this,_capability,Promise.withResolvers());_classPrivateFieldInitSpec(this,_container4,null);_classPrivateFieldInitSpec(this,_disableProcessItems,false);_classPrivateFieldInitSpec(this,_fontInspectorEnabled,!!((_globalThis$FontInspe=globalThis.FontInspector)!==null&&_globalThis$FontInspe!==void 0&&_globalThis$FontInspe.enabled));_classPrivateFieldInitSpec(this,_lang,null);_classPrivateFieldInitSpec(this,_layoutTextParams,null);_classPrivateFieldInitSpec(this,_pageHeight3,0);_classPrivateFieldInitSpec(this,_pageWidth3,0);_classPrivateFieldInitSpec(this,_reader,null);_classPrivateFieldInitSpec(this,_rootContainer,null);_classPrivateFieldInitSpec(this,_rotation3,0);_classPrivateFieldInitSpec(this,_scale,0);_classPrivateFieldInitSpec(this,_styleCache,Object.create(null));_classPrivateFieldInitSpec(this,_textContentItemsStr,[]);_classPrivateFieldInitSpec(this,_textContentSource,null);_classPrivateFieldInitSpec(this,_textDivs,[]);_classPrivateFieldInitSpec(this,_textDivProperties,new WeakMap());_classPrivateFieldInitSpec(this,_transform,null);if(textContentSource instanceof ReadableStream){_classPrivateFieldSet(_textContentSource,this,textContentSource);}else if(_typeof(textContentSource)==="object"){_classPrivateFieldSet(_textContentSource,this,new ReadableStream({start:function start(controller){controller.enqueue(textContentSource);controller.close();}}));}else{throw new Error('No "textContentSource" parameter specified.');}_classPrivateFieldSet(_container4,this,_classPrivateFieldSet(_rootContainer,this,container));_classPrivateFieldSet(_scale,this,viewport.scale*_OutputScale.pixelRatio);_classPrivateFieldSet(_rotation3,this,viewport.rotation);_classPrivateFieldSet(_layoutTextParams,this,{div:null,properties:null,ctx:null});var _viewport$rawDims2=viewport.rawDims,pageWidth=_viewport$rawDims2.pageWidth,pageHeight=_viewport$rawDims2.pageHeight,pageX=_viewport$rawDims2.pageX,pageY=_viewport$rawDims2.pageY;_classPrivateFieldSet(_transform,this,[1,0,0,-1,-pageX,pageY+pageHeight]);_classPrivateFieldSet(_pageWidth3,this,pageWidth);_classPrivateFieldSet(_pageHeight3,this,pageHeight);_ensureMinFontSizeComputed.call(_TextLayer);_setLayerDimensions(container,viewport);_classPrivateFieldGet(_capability,this).promise["finally"](function(){_pendingTextLayers._["delete"](_this37);_classPrivateFieldSet(_layoutTextParams,_this37,null);_classPrivateFieldSet(_styleCache,_this37,null);})["catch"](function(){});}return _createClass(_TextLayer,[{key:"render",value:function render(){var _this38=this;var _pump=function pump(){_classPrivateFieldGet(_reader,_this38).read().then(function(_ref42){var _classPrivateFieldGet57;var value=_ref42.value,done=_ref42.done;if(done){_classPrivateFieldGet(_capability,_this38).resolve();return;}(_classPrivateFieldGet57=_classPrivateFieldGet(_lang,_this38))!==null&&_classPrivateFieldGet57!==void 0?_classPrivateFieldGet57:_classPrivateFieldSet(_lang,_this38,value.lang);Object.assign(_classPrivateFieldGet(_styleCache,_this38),value.styles);_assertClassBrand(_TextLayer_brand,_this38,_processItems).call(_this38,value.items);_pump();},_classPrivateFieldGet(_capability,_this38).reject);};_classPrivateFieldSet(_reader,this,_classPrivateFieldGet(_textContentSource,this).getReader());_pendingTextLayers._.add(this);_pump();return _classPrivateFieldGet(_capability,this).promise;}},{key:"update",value:function update(_ref43){var viewport=_ref43.viewport,_ref43$onBefore=_ref43.onBefore,onBefore=_ref43$onBefore===void 0?null:_ref43$onBefore;var scale=viewport.scale*_OutputScale.pixelRatio;var rotation=viewport.rotation;if(rotation!==_classPrivateFieldGet(_rotation3,this)){onBefore===null||onBefore===void 0||onBefore();_classPrivateFieldSet(_rotation3,this,rotation);_setLayerDimensions(_classPrivateFieldGet(_rootContainer,this),{rotation:rotation});}if(scale!==_classPrivateFieldGet(_scale,this)){onBefore===null||onBefore===void 0||onBefore();_classPrivateFieldSet(_scale,this,scale);var params={div:null,properties:null,ctx:_getCtx.call(_TextLayer,_classPrivateFieldGet(_lang,this))};var _iterator92=_createForOfIteratorHelper(_classPrivateFieldGet(_textDivs,this)),_step92;try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var div=_step92.value;params.properties=_classPrivateFieldGet(_textDivProperties,this).get(div);params.div=div;_assertClassBrand(_TextLayer_brand,this,_layout).call(this,params);}}catch(err){_iterator92.e(err);}finally{_iterator92.f();}}}},{key:"cancel",value:function cancel(){var _classPrivateFieldGet58;var abortEx=new _AbortException("TextLayer task cancelled.");(_classPrivateFieldGet58=_classPrivateFieldGet(_reader,this))===null||_classPrivateFieldGet58===void 0||_classPrivateFieldGet58.cancel(abortEx)["catch"](function(){});_classPrivateFieldSet(_reader,this,null);_classPrivateFieldGet(_capability,this).reject(abortEx);}},{key:"textDivs",get:function get(){return _classPrivateFieldGet(_textDivs,this);}},{key:"textContentItemsStr",get:function get(){return _classPrivateFieldGet(_textContentItemsStr,this);}}],[{key:"fontFamilyMap",get:function get(){var _util_FeatureTest$pla=util_FeatureTest.platform,isWindows=_util_FeatureTest$pla.isWindows,isFirefox=_util_FeatureTest$pla.isFirefox;return _shadow(this,"fontFamilyMap",new Map([["sans-serif","".concat(isWindows&&isFirefox?"Calibri, ":"","sans-serif")],["monospace","".concat(isWindows&&isFirefox?"Lucida Console, ":"","monospace")]]));}},{key:"cleanup",value:function cleanup(){if(_assertClassBrand(_TextLayer,this,_pendingTextLayers)._.size>0){return;}_assertClassBrand(_TextLayer,this,_ascentCache)._.clear();var _iterator93=_createForOfIteratorHelper(_assertClassBrand(_TextLayer,this,_canvasContexts)._.values()),_step93;try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var canvas=_step93.value.canvas;canvas.remove();}}catch(err){_iterator93.e(err);}finally{_iterator93.f();}_assertClassBrand(_TextLayer,this,_canvasContexts)._.clear();}}]);}();_TextLayer2=_TextLayer;function _processItems(items){var _classPrivateFieldGet149,_classPrivateFieldGet150;if(_classPrivateFieldGet(_disableProcessItems,this)){return;}(_classPrivateFieldGet150=(_classPrivateFieldGet149=_classPrivateFieldGet(_layoutTextParams,this)).ctx)!==null&&_classPrivateFieldGet150!==void 0?_classPrivateFieldGet150:_classPrivateFieldGet149.ctx=_getCtx.call(_TextLayer2,_classPrivateFieldGet(_lang,this));var textDivs=_classPrivateFieldGet(_textDivs,this),textContentItemsStr=_classPrivateFieldGet(_textContentItemsStr,this);var _iterator179=_createForOfIteratorHelper(items),_step179;try{for(_iterator179.s();!(_step179=_iterator179.n()).done;){var item=_step179.value;if(textDivs.length>MAX_TEXT_DIVS_TO_RENDER){warn("Ignoring additional textDivs for performance reasons.");_classPrivateFieldSet(_disableProcessItems,this,true);return;}if(item.str===undefined){if(item.type==="beginMarkedContentProps"||item.type==="beginMarkedContent"){var parent=_classPrivateFieldGet(_container4,this);_classPrivateFieldSet(_container4,this,document.createElement("span"));_classPrivateFieldGet(_container4,this).classList.add("markedContent");if(item.id!==null){_classPrivateFieldGet(_container4,this).setAttribute("id","".concat(item.id));}parent.append(_classPrivateFieldGet(_container4,this));}else if(item.type==="endMarkedContent"){_classPrivateFieldSet(_container4,this,_classPrivateFieldGet(_container4,this).parentNode);}continue;}textContentItemsStr.push(item.str);_assertClassBrand(_TextLayer_brand,this,_appendText).call(this,item);}}catch(err){_iterator179.e(err);}finally{_iterator179.f();}}function _appendText(geom){var textDiv=document.createElement("span");var textDivProperties={angle:0,canvasWidth:0,hasText:geom.str!=="",hasEOL:geom.hasEOL,fontSize:0};_classPrivateFieldGet(_textDivs,this).push(textDiv);var tx=_Util.transform(_classPrivateFieldGet(_transform,this),geom.transform);var angle=Math.atan2(tx[1],tx[0]);var style=_classPrivateFieldGet(_styleCache,this)[geom.fontName];if(style.vertical){angle+=Math.PI/2;}var fontFamily=_classPrivateFieldGet(_fontInspectorEnabled,this)&&style.fontSubstitution||style.fontFamily;fontFamily=_TextLayer2.fontFamilyMap.get(fontFamily)||fontFamily;var fontHeight=Math.hypot(tx[2],tx[3]);var fontAscent=fontHeight*_getAscent.call(_TextLayer2,fontFamily,style,_classPrivateFieldGet(_lang,this));var left,top;if(angle===0){left=tx[4];top=tx[5]-fontAscent;}else{left=tx[4]+fontAscent*Math.sin(angle);top=tx[5]-fontAscent*Math.cos(angle);}var scaleFactorStr="calc(var(--total-scale-factor) *";var divStyle=textDiv.style;if(_classPrivateFieldGet(_container4,this)===_classPrivateFieldGet(_rootContainer,this)){divStyle.left="".concat((100*left/_classPrivateFieldGet(_pageWidth3,this)).toFixed(2),"%");divStyle.top="".concat((100*top/_classPrivateFieldGet(_pageHeight3,this)).toFixed(2),"%");}else{divStyle.left="".concat(scaleFactorStr).concat(left.toFixed(2),"px)");divStyle.top="".concat(scaleFactorStr).concat(top.toFixed(2),"px)");}divStyle.fontSize="".concat(scaleFactorStr).concat((_minFontSize._*fontHeight).toFixed(2),"px)");divStyle.fontFamily=fontFamily;textDivProperties.fontSize=fontHeight;textDiv.setAttribute("role","presentation");textDiv.textContent=geom.str;textDiv.dir=geom.dir;if(_classPrivateFieldGet(_fontInspectorEnabled,this)){textDiv.dataset.fontName=style.fontSubstitutionLoadedName||geom.fontName;}if(angle!==0){textDivProperties.angle=angle*(180/Math.PI);}var shouldScaleText=false;if(geom.str.length>1){shouldScaleText=true;}else if(geom.str!==" "&&geom.transform[0]!==geom.transform[3]){var absScaleX=Math.abs(geom.transform[0]),absScaleY=Math.abs(geom.transform[3]);if(absScaleX!==absScaleY&&Math.max(absScaleX,absScaleY)/Math.min(absScaleX,absScaleY)>1.5){shouldScaleText=true;}}if(shouldScaleText){textDivProperties.canvasWidth=style.vertical?geom.height:geom.width;}_classPrivateFieldGet(_textDivProperties,this).set(textDiv,textDivProperties);_classPrivateFieldGet(_layoutTextParams,this).div=textDiv;_classPrivateFieldGet(_layoutTextParams,this).properties=textDivProperties;_assertClassBrand(_TextLayer_brand,this,_layout).call(this,_classPrivateFieldGet(_layoutTextParams,this));if(textDivProperties.hasText){_classPrivateFieldGet(_container4,this).append(textDiv);}if(textDivProperties.hasEOL){var br=document.createElement("br");br.setAttribute("role","presentation");_classPrivateFieldGet(_container4,this).append(br);}}function _layout(params){var div=params.div,properties=params.properties,ctx=params.ctx;var style=div.style;var transform="";if(_minFontSize._>1){transform="scale(".concat(1/_minFontSize._,")");}if(properties.canvasWidth!==0&&properties.hasText){var fontFamily=style.fontFamily;var canvasWidth=properties.canvasWidth,fontSize=properties.fontSize;_ensureCtxFont.call(_TextLayer2,ctx,fontSize*_classPrivateFieldGet(_scale,this),fontFamily);var _ctx$measureText2=ctx.measureText(div.textContent),width=_ctx$measureText2.width;if(width>0){transform="scaleX(".concat(canvasWidth*_classPrivateFieldGet(_scale,this)/width,") ").concat(transform);}}if(properties.angle!==0){transform="rotate(".concat(properties.angle,"deg) ").concat(transform);}if(transform.length>0){style.transform=transform;}}function _getCtx(){var lang=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var ctx=_assertClassBrand(_TextLayer2,this,_canvasContexts)._.get(lang||(lang=""));if(!ctx){var canvas=document.createElement("canvas");canvas.className="hiddenCanvasElement";canvas.lang=lang;document.body.append(canvas);ctx=canvas.getContext("2d",{alpha:false,willReadFrequently:true});_assertClassBrand(_TextLayer2,this,_canvasContexts)._.set(lang,ctx);_assertClassBrand(_TextLayer2,this,_canvasCtxFonts)._.set(ctx,{size:0,family:""});}return ctx;}function _ensureCtxFont(ctx,size,family){var cached=_assertClassBrand(_TextLayer2,this,_canvasCtxFonts)._.get(ctx);if(size===cached.size&&family===cached.family){return;}ctx.font="".concat(size,"px ").concat(family);cached.size=size;cached.family=family;}function _ensureMinFontSizeComputed(){if(_assertClassBrand(_TextLayer2,this,_minFontSize)._!==null){return;}var div=document.createElement("div");div.style.opacity=0;div.style.lineHeight=1;div.style.fontSize="1px";div.style.position="absolute";div.textContent="X";document.body.append(div);_minFontSize._=_assertClassBrand(_TextLayer2,this,div.getBoundingClientRect().height);div.remove();}function _getAscent(fontFamily,style,lang){var cachedAscent=_assertClassBrand(_TextLayer2,this,_ascentCache)._.get(fontFamily);if(cachedAscent){return cachedAscent;}var ctx=_assertClassBrand(_TextLayer2,this,_getCtx).call(this,lang);ctx.canvas.width=ctx.canvas.height=DEFAULT_FONT_SIZE;_assertClassBrand(_TextLayer2,this,_ensureCtxFont).call(this,ctx,DEFAULT_FONT_SIZE,fontFamily);var metrics=ctx.measureText("");var ascent=metrics.fontBoundingBoxAscent;var descent=Math.abs(metrics.fontBoundingBoxDescent);ctx.canvas.width=ctx.canvas.height=0;var ratio=0.8;if(ascent){ratio=ascent/(ascent+descent);}else{if(util_FeatureTest.platform.isFirefox){warn("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference "+"in `about:config` to improve TextLayer rendering.");}if(style.ascent){ratio=style.ascent;}else if(style.descent){ratio=1+style.descent;}}_assertClassBrand(_TextLayer2,this,_ascentCache)._.set(fontFamily,ratio);return ratio;}var _ascentCache={_:new Map()};var _canvasContexts={_:new Map()};var _canvasCtxFonts={_:new WeakMap()};var _minFontSize={_:null};var _pendingTextLayers={_:new Set()};;// ./src/display/xfa_text.js
var XfaText=/*#__PURE__*/function(){function XfaText(){_classCallCheck(this,XfaText);}return _createClass(XfaText,null,[{key:"textContent",value:function textContent(xfa){var items=[];var output={items:items,styles:Object.create(null)};function walk(node){var _node$attributes;if(!node){return;}var str=null;var name=node.name;if(name==="#text"){str=node.value;}else if(!XfaText.shouldBuildText(name)){return;}else if(node!==null&&node!==void 0&&(_node$attributes=node.attributes)!==null&&_node$attributes!==void 0&&_node$attributes.textContent){str=node.attributes.textContent;}else if(node.value){str=node.value;}if(str!==null){items.push({str:str});}if(!node.children){return;}var _iterator94=_createForOfIteratorHelper(node.children),_step94;try{for(_iterator94.s();!(_step94=_iterator94.n()).done;){var child=_step94.value;walk(child);}}catch(err){_iterator94.e(err);}finally{_iterator94.f();}}walk(xfa);return output;}},{key:"shouldBuildText",value:function shouldBuildText(name){return!(name==="textarea"||name==="input"||name==="option"||name==="select");}}]);}();;// ./src/display/api.js
var DEFAULT_RANGE_CHUNK_SIZE=65536;var RENDERING_CANCELLED_TIMEOUT=100;function _getDocument(){var _src$password,_src$length;var src=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(typeof src==="string"||src instanceof URL){src={url:src};}else if(src instanceof ArrayBuffer||ArrayBuffer.isView(src)){src={data:src};}var task=new PDFDocumentLoadingTask();var docId=task.docId;var url=src.url?getUrlProp(src.url):null;var data=src.data?getDataProp(src.data):null;var httpHeaders=src.httpHeaders||null;var withCredentials=src.withCredentials===true;var password=(_src$password=src.password)!==null&&_src$password!==void 0?_src$password:null;var rangeTransport=src.range instanceof _PDFDataRangeTransport?src.range:null;var rangeChunkSize=Number.isInteger(src.rangeChunkSize)&&src.rangeChunkSize>0?src.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;var worker=src.worker instanceof _PDFWorker?src.worker:null;var verbosity=src.verbosity;var docBaseUrl=typeof src.docBaseUrl==="string"&&!_isDataScheme(src.docBaseUrl)?src.docBaseUrl:null;var cMapUrl=getFactoryUrlProp(src.cMapUrl);var cMapPacked=src.cMapPacked!==false;var CMapReaderFactory=src.CMapReaderFactory||(isNodeJS?NodeCMapReaderFactory:DOMCMapReaderFactory);var iccUrl=getFactoryUrlProp(src.iccUrl);var standardFontDataUrl=getFactoryUrlProp(src.standardFontDataUrl);var StandardFontDataFactory=src.StandardFontDataFactory||(isNodeJS?NodeStandardFontDataFactory:DOMStandardFontDataFactory);var wasmUrl=getFactoryUrlProp(src.wasmUrl);var WasmFactory=src.WasmFactory||(isNodeJS?NodeWasmFactory:DOMWasmFactory);var ignoreErrors=src.stopAtErrors!==true;var maxImageSize=Number.isInteger(src.maxImageSize)&&src.maxImageSize>-1?src.maxImageSize:-1;var isEvalSupported=src.isEvalSupported!==false;var isOffscreenCanvasSupported=typeof src.isOffscreenCanvasSupported==="boolean"?src.isOffscreenCanvasSupported:!isNodeJS;var isImageDecoderSupported=typeof src.isImageDecoderSupported==="boolean"?src.isImageDecoderSupported:!isNodeJS&&(util_FeatureTest.platform.isFirefox||!globalThis.chrome);var canvasMaxAreaInBytes=Number.isInteger(src.canvasMaxAreaInBytes)?src.canvasMaxAreaInBytes:-1;var disableFontFace=typeof src.disableFontFace==="boolean"?src.disableFontFace:isNodeJS;var fontExtraProperties=src.fontExtraProperties===true;var enableXfa=src.enableXfa===true;var ownerDocument=src.ownerDocument||globalThis.document;var disableRange=src.disableRange===true;var disableStream=src.disableStream===true;var disableAutoFetch=src.disableAutoFetch===true;var pdfBug=src.pdfBug===true;var CanvasFactory=src.CanvasFactory||(isNodeJS?NodeCanvasFactory:DOMCanvasFactory);var FilterFactory=src.FilterFactory||(isNodeJS?NodeFilterFactory:DOMFilterFactory);var enableHWA=src.enableHWA===true;var useWasm=src.useWasm!==false;var length=rangeTransport?rangeTransport.length:(_src$length=src.length)!==null&&_src$length!==void 0?_src$length:NaN;var useSystemFonts=typeof src.useSystemFonts==="boolean"?src.useSystemFonts:!isNodeJS&&!disableFontFace;var useWorkerFetch=typeof src.useWorkerFetch==="boolean"?src.useWorkerFetch:!!(CMapReaderFactory===DOMCMapReaderFactory&&StandardFontDataFactory===DOMStandardFontDataFactory&&WasmFactory===DOMWasmFactory&&cMapUrl&&standardFontDataUrl&&wasmUrl&&isValidFetchUrl(cMapUrl,document.baseURI)&&isValidFetchUrl(standardFontDataUrl,document.baseURI)&&isValidFetchUrl(wasmUrl,document.baseURI));var styleElement=null;setVerbosityLevel(verbosity);var transportFactory={canvasFactory:new CanvasFactory({ownerDocument:ownerDocument,enableHWA:enableHWA}),filterFactory:new FilterFactory({docId:docId,ownerDocument:ownerDocument}),cMapReaderFactory:useWorkerFetch?null:new CMapReaderFactory({baseUrl:cMapUrl,isCompressed:cMapPacked}),standardFontDataFactory:useWorkerFetch?null:new StandardFontDataFactory({baseUrl:standardFontDataUrl}),wasmFactory:useWorkerFetch?null:new WasmFactory({baseUrl:wasmUrl})};if(!worker){var workerParams={verbosity:verbosity,port:_GlobalWorkerOptions.workerPort};worker=workerParams.port?_PDFWorker.fromPort(workerParams):new _PDFWorker(workerParams);task._worker=worker;}var docParams={docId:docId,apiVersion:"5.1.91",data:data,password:password,disableAutoFetch:disableAutoFetch,rangeChunkSize:rangeChunkSize,length:length,docBaseUrl:docBaseUrl,enableXfa:enableXfa,evaluatorOptions:{maxImageSize:maxImageSize,disableFontFace:disableFontFace,ignoreErrors:ignoreErrors,isEvalSupported:isEvalSupported,isOffscreenCanvasSupported:isOffscreenCanvasSupported,isImageDecoderSupported:isImageDecoderSupported,canvasMaxAreaInBytes:canvasMaxAreaInBytes,fontExtraProperties:fontExtraProperties,useSystemFonts:useSystemFonts,useWasm:useWasm,useWorkerFetch:useWorkerFetch,cMapUrl:cMapUrl,iccUrl:iccUrl,standardFontDataUrl:standardFontDataUrl,wasmUrl:wasmUrl}};var transportParams={ownerDocument:ownerDocument,pdfBug:pdfBug,styleElement:styleElement,loadingParams:{disableAutoFetch:disableAutoFetch,enableXfa:enableXfa}};worker.promise.then(function(){if(task.destroyed){throw new Error("Loading aborted");}if(worker.destroyed){throw new Error("Worker was destroyed");}var workerIdPromise=worker.messageHandler.sendWithPromise("GetDocRequest",docParams,data?[data.buffer]:null);var networkStream;if(rangeTransport){networkStream=new PDFDataTransportStream(rangeTransport,{disableRange:disableRange,disableStream:disableStream});}else if(!data){if(!url){throw new Error("getDocument - no `url` parameter provided.");}var NetworkStream;if(isNodeJS){if(isValidFetchUrl(url)){if(typeof fetch==="undefined"||typeof Response==="undefined"||!("body"in Response.prototype)){throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");}NetworkStream=PDFFetchStream;}else{NetworkStream=PDFNodeStream;}}else{NetworkStream=isValidFetchUrl(url)?PDFFetchStream:PDFNetworkStream;}networkStream=new NetworkStream({url:url,length:length,httpHeaders:httpHeaders,withCredentials:withCredentials,rangeChunkSize:rangeChunkSize,disableRange:disableRange,disableStream:disableStream});}return workerIdPromise.then(function(workerId){if(task.destroyed){throw new Error("Loading aborted");}if(worker.destroyed){throw new Error("Worker was destroyed");}var messageHandler=new MessageHandler(docId,workerId,worker.port);var transport=new WorkerTransport(messageHandler,task,networkStream,transportParams,transportFactory);task._transport=transport;messageHandler.send("Ready",null);});})["catch"](task._capability.reject);return task;}function getUrlProp(val){if(val instanceof URL){return val.href;}if(typeof val==="string"){if(isNodeJS){return val;}var url=URL.parse(val,window.location);if(url){return url.href;}}throw new Error("Invalid PDF url data: "+"either string or URL-object is expected in the url property.");}function getDataProp(val){if(isNodeJS&&typeof Buffer!=="undefined"&&val instanceof Buffer){throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");}if(val instanceof Uint8Array&&val.byteLength===val.buffer.byteLength){return val;}if(typeof val==="string"){return stringToBytes(val);}if(val instanceof ArrayBuffer||ArrayBuffer.isView(val)||_typeof(val)==="object"&&!isNaN(val===null||val===void 0?void 0:val.length)){return new Uint8Array(val);}throw new Error("Invalid PDF binary data: either TypedArray, "+"string, or array-like object is expected in the data property.");}function getFactoryUrlProp(val){if(typeof val!=="string"){return null;}if(val.endsWith("/")){return val;}throw new Error("Invalid factory url: \"".concat(val,"\" must include trailing slash."));}var isRefProxy=function isRefProxy(v){return _typeof(v)==="object"&&Number.isInteger(v===null||v===void 0?void 0:v.num)&&v.num>=0&&Number.isInteger(v===null||v===void 0?void 0:v.gen)&&v.gen>=0;};var isNameProxy=function isNameProxy(v){return _typeof(v)==="object"&&typeof(v===null||v===void 0?void 0:v.name)==="string";};var _isValidExplicitDest2=_isValidExplicitDest.bind(null,isRefProxy,isNameProxy);var PDFDocumentLoadingTask=/*#__PURE__*/function(){function PDFDocumentLoadingTask(){_classCallCheck(this,PDFDocumentLoadingTask);_defineProperty(this,"_capability",Promise.withResolvers());_defineProperty(this,"_transport",null);_defineProperty(this,"_worker",null);_defineProperty(this,"docId","d".concat((_docId2._=(_PDFDocumentLoadingTa=_docId2._,_PDFDocumentLoadingTa2=_PDFDocumentLoadingTa++,_PDFDocumentLoadingTa),_PDFDocumentLoadingTa2)));_defineProperty(this,"destroyed",false);_defineProperty(this,"onPassword",null);_defineProperty(this,"onProgress",null);}return _createClass(PDFDocumentLoadingTask,[{key:"promise",get:function get(){return this._capability.promise;}},{key:"destroy",value:function(){var _destroy=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee35(){var _this$_worker3;var _this$_worker,_this$_transport,_this$_worker2,_t14;return _regenerator().w(function(_context35){while(1)switch(_context35.n){case 0:this.destroyed=true;_context35.p=1;if((_this$_worker=this._worker)!==null&&_this$_worker!==void 0&&_this$_worker.port){this._worker._pendingDestroy=true;}_context35.n=2;return(_this$_transport=this._transport)===null||_this$_transport===void 0?void 0:_this$_transport.destroy();case 2:_context35.n=4;break;case 3:_context35.p=3;_t14=_context35.v;if((_this$_worker2=this._worker)!==null&&_this$_worker2!==void 0&&_this$_worker2.port){delete this._worker._pendingDestroy;}throw _t14;case 4:this._transport=null;(_this$_worker3=this._worker)===null||_this$_worker3===void 0||_this$_worker3.destroy();this._worker=null;case 5:return _context35.a(2);}},_callee35,this,[[1,3]]);}));function destroy(){return _destroy.apply(this,arguments);}return destroy;}()},{key:"getData",value:function(){var _getData=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee36(){return _regenerator().w(function(_context36){while(1)switch(_context36.n){case 0:return _context36.a(2,this._transport.getData());}},_callee36,this);}));function getData(){return _getData.apply(this,arguments);}return getData;}()}]);}();var _docId2={_:0};var _PDFDataRangeTransport=/*#__PURE__*/function(){function _PDFDataRangeTransport(length,initialData){var progressiveDone=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var contentDispositionFilename=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck(this,_PDFDataRangeTransport);this.length=length;this.initialData=initialData;this.progressiveDone=progressiveDone;this.contentDispositionFilename=contentDispositionFilename;this._rangeListeners=[];this._progressListeners=[];this._progressiveReadListeners=[];this._progressiveDoneListeners=[];this._readyCapability=Promise.withResolvers();}return _createClass(_PDFDataRangeTransport,[{key:"addRangeListener",value:function addRangeListener(listener){this._rangeListeners.push(listener);}},{key:"addProgressListener",value:function addProgressListener(listener){this._progressListeners.push(listener);}},{key:"addProgressiveReadListener",value:function addProgressiveReadListener(listener){this._progressiveReadListeners.push(listener);}},{key:"addProgressiveDoneListener",value:function addProgressiveDoneListener(listener){this._progressiveDoneListeners.push(listener);}},{key:"onDataRange",value:function onDataRange(begin,chunk){var _iterator95=_createForOfIteratorHelper(this._rangeListeners),_step95;try{for(_iterator95.s();!(_step95=_iterator95.n()).done;){var listener=_step95.value;listener(begin,chunk);}}catch(err){_iterator95.e(err);}finally{_iterator95.f();}}},{key:"onDataProgress",value:function onDataProgress(loaded,total){var _this39=this;this._readyCapability.promise.then(function(){var _iterator96=_createForOfIteratorHelper(_this39._progressListeners),_step96;try{for(_iterator96.s();!(_step96=_iterator96.n()).done;){var listener=_step96.value;listener(loaded,total);}}catch(err){_iterator96.e(err);}finally{_iterator96.f();}});}},{key:"onDataProgressiveRead",value:function onDataProgressiveRead(chunk){var _this40=this;this._readyCapability.promise.then(function(){var _iterator97=_createForOfIteratorHelper(_this40._progressiveReadListeners),_step97;try{for(_iterator97.s();!(_step97=_iterator97.n()).done;){var listener=_step97.value;listener(chunk);}}catch(err){_iterator97.e(err);}finally{_iterator97.f();}});}},{key:"onDataProgressiveDone",value:function onDataProgressiveDone(){var _this41=this;this._readyCapability.promise.then(function(){var _iterator98=_createForOfIteratorHelper(_this41._progressiveDoneListeners),_step98;try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){var listener=_step98.value;listener();}}catch(err){_iterator98.e(err);}finally{_iterator98.f();}});}},{key:"transportReady",value:function transportReady(){this._readyCapability.resolve();}},{key:"requestDataRange",value:function requestDataRange(begin,end){unreachable("Abstract method PDFDataRangeTransport.requestDataRange");}},{key:"abort",value:function abort(){}}]);}();var PDFDocumentProxy=/*#__PURE__*/function(){function PDFDocumentProxy(pdfInfo,transport){_classCallCheck(this,PDFDocumentProxy);this._pdfInfo=pdfInfo;this._transport=transport;}return _createClass(PDFDocumentProxy,[{key:"annotationStorage",get:function get(){return this._transport.annotationStorage;}},{key:"canvasFactory",get:function get(){return this._transport.canvasFactory;}},{key:"filterFactory",get:function get(){return this._transport.filterFactory;}},{key:"numPages",get:function get(){return this._pdfInfo.numPages;}},{key:"fingerprints",get:function get(){return this._pdfInfo.fingerprints;}},{key:"isPureXfa",get:function get(){return _shadow(this,"isPureXfa",!!this._transport._htmlForXfa);}},{key:"allXfaHtml",get:function get(){return this._transport._htmlForXfa;}},{key:"getPage",value:function getPage(pageNumber){return this._transport.getPage(pageNumber);}},{key:"getPageIndex",value:function getPageIndex(ref){return this._transport.getPageIndex(ref);}},{key:"getDestinations",value:function getDestinations(){return this._transport.getDestinations();}},{key:"getDestination",value:function getDestination(id){return this._transport.getDestination(id);}},{key:"getPageLabels",value:function getPageLabels(){return this._transport.getPageLabels();}},{key:"getPageLayout",value:function getPageLayout(){return this._transport.getPageLayout();}},{key:"getPageMode",value:function getPageMode(){return this._transport.getPageMode();}},{key:"getViewerPreferences",value:function getViewerPreferences(){return this._transport.getViewerPreferences();}},{key:"getOpenAction",value:function getOpenAction(){return this._transport.getOpenAction();}},{key:"getAttachments",value:function getAttachments(){return this._transport.getAttachments();}},{key:"getJSActions",value:function getJSActions(){return this._transport.getDocJSActions();}},{key:"getOutline",value:function getOutline(){return this._transport.getOutline();}},{key:"getOptionalContentConfig",value:function getOptionalContentConfig(){var _ref44=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref44$intent=_ref44.intent,intent=_ref44$intent===void 0?"display":_ref44$intent;var _this$_transport$getR=this._transport.getRenderingIntent(intent),renderingIntent=_this$_transport$getR.renderingIntent;return this._transport.getOptionalContentConfig(renderingIntent);}},{key:"getPermissions",value:function getPermissions(){return this._transport.getPermissions();}},{key:"getMetadata",value:function getMetadata(){return this._transport.getMetadata();}},{key:"getMarkInfo",value:function getMarkInfo(){return this._transport.getMarkInfo();}},{key:"getData",value:function getData(){return this._transport.getData();}},{key:"saveDocument",value:function saveDocument(){return this._transport.saveDocument();}},{key:"getDownloadInfo",value:function getDownloadInfo(){return this._transport.downloadInfoCapability.promise;}},{key:"cleanup",value:function cleanup(){var keepLoadedFonts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return this._transport.startCleanup(keepLoadedFonts||this.isPureXfa);}},{key:"destroy",value:function destroy(){return this.loadingTask.destroy();}},{key:"cachedPageNumber",value:function cachedPageNumber(ref){return this._transport.cachedPageNumber(ref);}},{key:"loadingParams",get:function get(){return this._transport.loadingParams;}},{key:"loadingTask",get:function get(){return this._transport.loadingTask;}},{key:"getFieldObjects",value:function getFieldObjects(){return this._transport.getFieldObjects();}},{key:"hasJSActions",value:function hasJSActions(){return this._transport.hasJSActions();}},{key:"getCalculationOrderIds",value:function getCalculationOrderIds(){return this._transport.getCalculationOrderIds();}}]);}();var _pendingCleanup=/*#__PURE__*/new WeakMap();var _PDFPageProxy_brand=/*#__PURE__*/new WeakSet();var PDFPageProxy=/*#__PURE__*/function(){function PDFPageProxy(pageIndex,pageInfo,transport){var pdfBug=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,PDFPageProxy);_classPrivateMethodInitSpec(this,_PDFPageProxy_brand);_classPrivateFieldInitSpec(this,_pendingCleanup,false);this._pageIndex=pageIndex;this._pageInfo=pageInfo;this._transport=transport;this._stats=pdfBug?new StatTimer():null;this._pdfBug=pdfBug;this.commonObjs=transport.commonObjs;this.objs=new PDFObjects();this._intentStates=new Map();this.destroyed=false;}return _createClass(PDFPageProxy,[{key:"pageNumber",get:function get(){return this._pageIndex+1;}},{key:"rotate",get:function get(){return this._pageInfo.rotate;}},{key:"ref",get:function get(){return this._pageInfo.ref;}},{key:"userUnit",get:function get(){return this._pageInfo.userUnit;}},{key:"view",get:function get(){return this._pageInfo.view;}},{key:"getViewport",value:function getViewport(){var _ref45=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},scale=_ref45.scale,_ref45$rotation=_ref45.rotation,rotation=_ref45$rotation===void 0?this.rotate:_ref45$rotation,_ref45$offsetX=_ref45.offsetX,offsetX=_ref45$offsetX===void 0?0:_ref45$offsetX,_ref45$offsetY=_ref45.offsetY,offsetY=_ref45$offsetY===void 0?0:_ref45$offsetY,_ref45$dontFlip=_ref45.dontFlip,dontFlip=_ref45$dontFlip===void 0?false:_ref45$dontFlip;return new PageViewport({viewBox:this.view,userUnit:this.userUnit,scale:scale,rotation:rotation,offsetX:offsetX,offsetY:offsetY,dontFlip:dontFlip});}},{key:"getAnnotations",value:function getAnnotations(){var _ref46=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref46$intent=_ref46.intent,intent=_ref46$intent===void 0?"display":_ref46$intent;var _this$_transport$getR2=this._transport.getRenderingIntent(intent),renderingIntent=_this$_transport$getR2.renderingIntent;return this._transport.getAnnotations(this._pageIndex,renderingIntent);}},{key:"getJSActions",value:function getJSActions(){return this._transport.getPageJSActions(this._pageIndex);}},{key:"filterFactory",get:function get(){return this._transport.filterFactory;}},{key:"isPureXfa",get:function get(){return _shadow(this,"isPureXfa",!!this._transport._htmlForXfa);}},{key:"getXfa",value:function(){var _getXfa=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee37(){var _this$_transport$_htm;return _regenerator().w(function(_context37){while(1)switch(_context37.n){case 0:return _context37.a(2,((_this$_transport$_htm=this._transport._htmlForXfa)===null||_this$_transport$_htm===void 0?void 0:_this$_transport$_htm.children[this._pageIndex])||null);}},_callee37,this);}));function getXfa(){return _getXfa.apply(this,arguments);}return getXfa;}()},{key:"render",value:function render(_ref47){var _this$_stats,_this42=this,_intentState;var canvasContext=_ref47.canvasContext,viewport=_ref47.viewport,_ref47$intent=_ref47.intent,intent=_ref47$intent===void 0?"display":_ref47$intent,_ref47$annotationMode=_ref47.annotationMode,annotationMode=_ref47$annotationMode===void 0?_AnnotationMode.ENABLE:_ref47$annotationMode,_ref47$transform=_ref47.transform,transform=_ref47$transform===void 0?null:_ref47$transform,_ref47$background=_ref47.background,background=_ref47$background===void 0?null:_ref47$background,_ref47$optionalConten=_ref47.optionalContentConfigPromise,optionalContentConfigPromise=_ref47$optionalConten===void 0?null:_ref47$optionalConten,_ref47$annotationCanv=_ref47.annotationCanvasMap,annotationCanvasMap=_ref47$annotationCanv===void 0?null:_ref47$annotationCanv,_ref47$pageColors=_ref47.pageColors,pageColors=_ref47$pageColors===void 0?null:_ref47$pageColors,_ref47$printAnnotatio=_ref47.printAnnotationStorage,printAnnotationStorage=_ref47$printAnnotatio===void 0?null:_ref47$printAnnotatio,_ref47$isEditing=_ref47.isEditing,isEditing=_ref47$isEditing===void 0?false:_ref47$isEditing;(_this$_stats=this._stats)===null||_this$_stats===void 0||_this$_stats.time("Overall");var intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage,isEditing);var renderingIntent=intentArgs.renderingIntent,cacheKey=intentArgs.cacheKey;_classPrivateFieldSet(_pendingCleanup,this,false);optionalContentConfigPromise||(optionalContentConfigPromise=this._transport.getOptionalContentConfig(renderingIntent));var intentState=this._intentStates.get(cacheKey);if(!intentState){intentState=Object.create(null);this._intentStates.set(cacheKey,intentState);}if(intentState.streamReaderCancelTimeout){clearTimeout(intentState.streamReaderCancelTimeout);intentState.streamReaderCancelTimeout=null;}var intentPrint=!!(renderingIntent&RenderingIntentFlag.PRINT);if(!intentState.displayReadyCapability){var _this$_stats2;intentState.displayReadyCapability=Promise.withResolvers();intentState.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};(_this$_stats2=this._stats)===null||_this$_stats2===void 0||_this$_stats2.time("Page Request");this._pumpOperatorList(intentArgs);}var complete=function complete(error){intentState.renderTasks["delete"](internalRenderTask);if(intentPrint){_classPrivateFieldSet(_pendingCleanup,_this42,true);}_assertClassBrand(_PDFPageProxy_brand,_this42,_tryCleanup).call(_this42);if(error){internalRenderTask.capability.reject(error);_this42._abortOperatorList({intentState:intentState,reason:error instanceof Error?error:new Error(error)});}else{internalRenderTask.capability.resolve();}if(_this42._stats){var _globalThis$Stats;_this42._stats.timeEnd("Rendering");_this42._stats.timeEnd("Overall");if((_globalThis$Stats=globalThis.Stats)!==null&&_globalThis$Stats!==void 0&&_globalThis$Stats.enabled){globalThis.Stats.add(_this42.pageNumber,_this42._stats);}}};var internalRenderTask=new InternalRenderTask({callback:complete,params:{canvasContext:canvasContext,viewport:viewport,transform:transform,background:background},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:annotationCanvasMap,operatorList:intentState.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!intentPrint,pdfBug:this._pdfBug,pageColors:pageColors});((_intentState=intentState).renderTasks||(_intentState.renderTasks=new Set())).add(internalRenderTask);var renderTask=internalRenderTask.task;Promise.all([intentState.displayReadyCapability.promise,optionalContentConfigPromise]).then(function(_ref48){var _this42$_stats;var _ref49=_slicedToArray(_ref48,2),transparency=_ref49[0],optionalContentConfig=_ref49[1];if(_this42.destroyed){complete();return;}(_this42$_stats=_this42._stats)===null||_this42$_stats===void 0||_this42$_stats.time("Rendering");if(!(optionalContentConfig.renderingIntent&renderingIntent)){throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` "+"and `PDFDocumentProxy.getOptionalContentConfig` methods.");}internalRenderTask.initializeGraphics({transparency:transparency,optionalContentConfig:optionalContentConfig});internalRenderTask.operatorListChanged();})["catch"](complete);return renderTask;}},{key:"getOperatorList",value:function getOperatorList(){var _ref50=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref50$intent=_ref50.intent,intent=_ref50$intent===void 0?"display":_ref50$intent,_ref50$annotationMode=_ref50.annotationMode,annotationMode=_ref50$annotationMode===void 0?_AnnotationMode.ENABLE:_ref50$annotationMode,_ref50$printAnnotatio=_ref50.printAnnotationStorage,printAnnotationStorage=_ref50$printAnnotatio===void 0?null:_ref50$printAnnotatio,_ref50$isEditing=_ref50.isEditing,isEditing=_ref50$isEditing===void 0?false:_ref50$isEditing;function operatorListChanged(){if(intentState.operatorList.lastChunk){intentState.opListReadCapability.resolve(intentState.operatorList);intentState.renderTasks["delete"](opListTask);}}var intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage,isEditing,true);var intentState=this._intentStates.get(intentArgs.cacheKey);if(!intentState){intentState=Object.create(null);this._intentStates.set(intentArgs.cacheKey,intentState);}var opListTask;if(!intentState.opListReadCapability){var _intentState2,_this$_stats3;opListTask=Object.create(null);opListTask.operatorListChanged=operatorListChanged;intentState.opListReadCapability=Promise.withResolvers();((_intentState2=intentState).renderTasks||(_intentState2.renderTasks=new Set())).add(opListTask);intentState.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};(_this$_stats3=this._stats)===null||_this$_stats3===void 0||_this$_stats3.time("Page Request");this._pumpOperatorList(intentArgs);}return intentState.opListReadCapability.promise;}},{key:"streamTextContent",value:function streamTextContent(){var _ref51=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref51$includeMarkedC=_ref51.includeMarkedContent,includeMarkedContent=_ref51$includeMarkedC===void 0?false:_ref51$includeMarkedC,_ref51$disableNormali=_ref51.disableNormalization,disableNormalization=_ref51$disableNormali===void 0?false:_ref51$disableNormali;var TEXT_CONTENT_CHUNK_SIZE=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:includeMarkedContent===true,disableNormalization:disableNormalization===true},{highWaterMark:TEXT_CONTENT_CHUNK_SIZE,size:function size(textContent){return textContent.items.length;}});}},{key:"getTextContent",value:function getTextContent(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this._transport._htmlForXfa){return this.getXfa().then(function(xfa){return XfaText.textContent(xfa);});}var readableStream=this.streamTextContent(params);return new Promise(function(resolve,reject){function pump(){reader.read().then(function(_ref52){var _textContent$lang,_textContent$items;var value=_ref52.value,done=_ref52.done;if(done){resolve(textContent);return;}(_textContent$lang=textContent.lang)!==null&&_textContent$lang!==void 0?_textContent$lang:textContent.lang=value.lang;Object.assign(textContent.styles,value.styles);(_textContent$items=textContent.items).push.apply(_textContent$items,_toConsumableArray(value.items));pump();},reject);}var reader=readableStream.getReader();var textContent={items:[],styles:Object.create(null),lang:null};pump();});}},{key:"getStructTree",value:function getStructTree(){return this._transport.getStructTree(this._pageIndex);}},{key:"_destroy",value:function _destroy(){this.destroyed=true;var waitOn=[];var _iterator99=_createForOfIteratorHelper(this._intentStates.values()),_step99;try{for(_iterator99.s();!(_step99=_iterator99.n()).done;){var intentState=_step99.value;this._abortOperatorList({intentState:intentState,reason:new Error("Page was destroyed."),force:true});if(intentState.opListReadCapability){continue;}var _iterator100=_createForOfIteratorHelper(intentState.renderTasks),_step100;try{for(_iterator100.s();!(_step100=_iterator100.n()).done;){var internalRenderTask=_step100.value;waitOn.push(internalRenderTask.completed);internalRenderTask.cancel();}}catch(err){_iterator100.e(err);}finally{_iterator100.f();}}}catch(err){_iterator99.e(err);}finally{_iterator99.f();}this.objs.clear();_classPrivateFieldSet(_pendingCleanup,this,false);return Promise.all(waitOn);}},{key:"cleanup",value:function cleanup(){var resetStats=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classPrivateFieldSet(_pendingCleanup,this,true);var success=_assertClassBrand(_PDFPageProxy_brand,this,_tryCleanup).call(this);if(resetStats&&success){this._stats&&(this._stats=new StatTimer());}return success;}},{key:"_startRenderPage",value:function _startRenderPage(transparency,cacheKey){var _this$_stats4,_intentState$displayR;var intentState=this._intentStates.get(cacheKey);if(!intentState){return;}(_this$_stats4=this._stats)===null||_this$_stats4===void 0||_this$_stats4.timeEnd("Page Request");(_intentState$displayR=intentState.displayReadyCapability)===null||_intentState$displayR===void 0||_intentState$displayR.resolve(transparency);}},{key:"_renderPageChunk",value:function _renderPageChunk(operatorListChunk,intentState){for(var i=0,ii=operatorListChunk.length;i<ii;i++){intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]);intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);}intentState.operatorList.lastChunk=operatorListChunk.lastChunk;intentState.operatorList.separateAnnots=operatorListChunk.separateAnnots;var _iterator101=_createForOfIteratorHelper(intentState.renderTasks),_step101;try{for(_iterator101.s();!(_step101=_iterator101.n()).done;){var internalRenderTask=_step101.value;internalRenderTask.operatorListChanged();}}catch(err){_iterator101.e(err);}finally{_iterator101.f();}if(operatorListChunk.lastChunk){_assertClassBrand(_PDFPageProxy_brand,this,_tryCleanup).call(this);}}},{key:"_pumpOperatorList",value:function _pumpOperatorList(_ref53){var _this43=this;var renderingIntent=_ref53.renderingIntent,cacheKey=_ref53.cacheKey,annotationStorageSerializable=_ref53.annotationStorageSerializable,modifiedIds=_ref53.modifiedIds;var map=annotationStorageSerializable.map,transfer=annotationStorageSerializable.transfer;var readableStream=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:renderingIntent,cacheKey:cacheKey,annotationStorage:map,modifiedIds:modifiedIds},transfer);var reader=readableStream.getReader();var intentState=this._intentStates.get(cacheKey);intentState.streamReader=reader;var _pump2=function pump(){reader.read().then(function(_ref54){var value=_ref54.value,done=_ref54.done;if(done){intentState.streamReader=null;return;}if(_this43._transport.destroyed){return;}_this43._renderPageChunk(value,intentState);_pump2();},function(reason){intentState.streamReader=null;if(_this43._transport.destroyed){return;}if(intentState.operatorList){intentState.operatorList.lastChunk=true;var _iterator102=_createForOfIteratorHelper(intentState.renderTasks),_step102;try{for(_iterator102.s();!(_step102=_iterator102.n()).done;){var internalRenderTask=_step102.value;internalRenderTask.operatorListChanged();}}catch(err){_iterator102.e(err);}finally{_iterator102.f();}_assertClassBrand(_PDFPageProxy_brand,_this43,_tryCleanup).call(_this43);}if(intentState.displayReadyCapability){intentState.displayReadyCapability.reject(reason);}else if(intentState.opListReadCapability){intentState.opListReadCapability.reject(reason);}else{throw reason;}});};_pump2();}},{key:"_abortOperatorList",value:function _abortOperatorList(_ref55){var _this44=this;var intentState=_ref55.intentState,reason=_ref55.reason,_ref55$force=_ref55.force,force=_ref55$force===void 0?false:_ref55$force;if(!intentState.streamReader){return;}if(intentState.streamReaderCancelTimeout){clearTimeout(intentState.streamReaderCancelTimeout);intentState.streamReaderCancelTimeout=null;}if(!force){if(intentState.renderTasks.size>0){return;}if(reason instanceof _RenderingCancelledException){var delay=RENDERING_CANCELLED_TIMEOUT;if(reason.extraDelay>0&&reason.extraDelay<1000){delay+=reason.extraDelay;}intentState.streamReaderCancelTimeout=setTimeout(function(){intentState.streamReaderCancelTimeout=null;_this44._abortOperatorList({intentState:intentState,reason:reason,force:true});},delay);return;}}intentState.streamReader.cancel(new _AbortException(reason.message))["catch"](function(){});intentState.streamReader=null;if(this._transport.destroyed){return;}var _iterator103=_createForOfIteratorHelper(this._intentStates),_step103;try{for(_iterator103.s();!(_step103=_iterator103.n()).done;){var _step103$value=_slicedToArray(_step103.value,2),curCacheKey=_step103$value[0],curIntentState=_step103$value[1];if(curIntentState===intentState){this._intentStates["delete"](curCacheKey);break;}}}catch(err){_iterator103.e(err);}finally{_iterator103.f();}this.cleanup();}},{key:"stats",get:function get(){return this._stats;}}]);}();function _tryCleanup(){if(!_classPrivateFieldGet(_pendingCleanup,this)||this.destroyed){return false;}var _iterator180=_createForOfIteratorHelper(this._intentStates.values()),_step180;try{for(_iterator180.s();!(_step180=_iterator180.n()).done;){var _step180$value=_step180.value,renderTasks=_step180$value.renderTasks,operatorList=_step180$value.operatorList;if(renderTasks.size>0||!operatorList.lastChunk){return false;}}}catch(err){_iterator180.e(err);}finally{_iterator180.f();}this._intentStates.clear();this.objs.clear();_classPrivateFieldSet(_pendingCleanup,this,false);return true;}var _listeners=/*#__PURE__*/new WeakMap();var _deferred=/*#__PURE__*/new WeakMap();var LoopbackPort=/*#__PURE__*/function(){function LoopbackPort(){_classCallCheck(this,LoopbackPort);_classPrivateFieldInitSpec(this,_listeners,new Map());_classPrivateFieldInitSpec(this,_deferred,Promise.resolve());}return _createClass(LoopbackPort,[{key:"postMessage",value:function postMessage(obj,transfer){var _this45=this;var event={data:structuredClone(obj,transfer?{transfer:transfer}:null)};_classPrivateFieldGet(_deferred,this).then(function(){var _iterator104=_createForOfIteratorHelper(_classPrivateFieldGet(_listeners,_this45)),_step104;try{for(_iterator104.s();!(_step104=_iterator104.n()).done;){var _step104$value=_slicedToArray(_step104.value,1),listener=_step104$value[0];listener.call(_this45,event);}}catch(err){_iterator104.e(err);}finally{_iterator104.f();}});}},{key:"addEventListener",value:function addEventListener(name,listener){var _this46=this;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var rmAbort=null;if((options===null||options===void 0?void 0:options.signal)instanceof AbortSignal){var signal=options.signal;if(signal.aborted){warn("LoopbackPort - cannot use an `aborted` signal.");return;}var onAbort=function onAbort(){return _this46.removeEventListener(name,listener);};rmAbort=function rmAbort(){return signal.removeEventListener("abort",onAbort);};signal.addEventListener("abort",onAbort);}_classPrivateFieldGet(_listeners,this).set(listener,rmAbort);}},{key:"removeEventListener",value:function removeEventListener(name,listener){var rmAbort=_classPrivateFieldGet(_listeners,this).get(listener);rmAbort===null||rmAbort===void 0||rmAbort();_classPrivateFieldGet(_listeners,this)["delete"](listener);}},{key:"terminate",value:function terminate(){var _iterator105=_createForOfIteratorHelper(_classPrivateFieldGet(_listeners,this)),_step105;try{for(_iterator105.s();!(_step105=_iterator105.n()).done;){var _step105$value=_slicedToArray(_step105.value,2),rmAbort=_step105$value[1];rmAbort===null||rmAbort===void 0||rmAbort();}}catch(err){_iterator105.e(err);}finally{_iterator105.f();}_classPrivateFieldGet(_listeners,this).clear();}}]);}();var _PDFWorker_brand=/*#__PURE__*/new WeakSet();var _PDFWorker=/*#__PURE__*/function(){function _PDFWorker(){var _ref56=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref56$name=_ref56.name,name=_ref56$name===void 0?null:_ref56$name,_ref56$port=_ref56.port,port=_ref56$port===void 0?null:_ref56$port,_ref56$verbosity=_ref56.verbosity,verbosity=_ref56$verbosity===void 0?getVerbosityLevel():_ref56$verbosity;_classCallCheck(this,_PDFWorker);_classPrivateMethodInitSpec(this,_PDFWorker_brand);this.name=name;this.destroyed=false;this.verbosity=verbosity;this._readyCapability=Promise.withResolvers();this._port=null;this._webWorker=null;this._messageHandler=null;if(port){var _workerPorts$_;if((_workerPorts$_=_workerPorts._)!==null&&_workerPorts$_!==void 0&&_workerPorts$_.has(port)){throw new Error("Cannot use more than one PDFWorker per port.");}(_workerPorts._||(_workerPorts._=new WeakMap())).set(port,this);this._initializeFromPort(port);return;}this._initialize();}return _createClass(_PDFWorker,[{key:"promise",get:function get(){return this._readyCapability.promise;}},{key:"port",get:function get(){return this._port;}},{key:"messageHandler",get:function get(){return this._messageHandler;}},{key:"_initializeFromPort",value:function _initializeFromPort(port){this._port=port;this._messageHandler=new MessageHandler("main","worker",port);this._messageHandler.on("ready",function(){});_assertClassBrand(_PDFWorker_brand,this,_resolve).call(this);}},{key:"_initialize",value:function _initialize(){var _this48=this;if(_isWorkerDisabled._||_get_mainThreadWorkerMessageHandler(_PDFWorker)){this._setupFakeWorker();return;}var workerSrc=_PDFWorker.workerSrc;try{if(!_PDFWorker._isSameOrigin(window.location,workerSrc)){workerSrc=_PDFWorker._createCDNWrapper(new URL(workerSrc,window.location).href);}var worker=new Worker(workerSrc,{type:"module"});var messageHandler=new MessageHandler("main","worker",worker);var terminateEarly=function terminateEarly(){ac.abort();messageHandler.destroy();worker.terminate();if(_this48.destroyed){_this48._readyCapability.reject(new Error("Worker was destroyed"));}else{_this48._setupFakeWorker();}};var ac=new AbortController();worker.addEventListener("error",function(){if(!_this48._webWorker){terminateEarly();}},{signal:ac.signal});messageHandler.on("test",function(data){ac.abort();if(_this48.destroyed||!data){terminateEarly();return;}_this48._messageHandler=messageHandler;_this48._port=worker;_this48._webWorker=worker;_assertClassBrand(_PDFWorker_brand,_this48,_resolve).call(_this48);});messageHandler.on("ready",function(data){ac.abort();if(_this48.destroyed){terminateEarly();return;}try{sendTest();}catch(_unused8){_this48._setupFakeWorker();}});var sendTest=function sendTest(){var testObj=new Uint8Array();messageHandler.send("test",testObj,[testObj.buffer]);};sendTest();return;}catch(_unused9){info("The worker has been disabled.");}this._setupFakeWorker();}},{key:"_setupFakeWorker",value:function _setupFakeWorker(){var _this49=this;if(!_isWorkerDisabled._){warn("Setting up fake worker.");_isWorkerDisabled._=true;}_PDFWorker._setupFakeWorkerGlobal.then(function(WorkerMessageHandler){var _PDFWorker$fakeWorker,_PDFWorker$fakeWorker2;if(_this49.destroyed){_this49._readyCapability.reject(new Error("Worker was destroyed"));return;}var port=new LoopbackPort();_this49._port=port;var id="fake".concat((_fakeWorkerId._=(_PDFWorker$fakeWorker=_fakeWorkerId._,_PDFWorker$fakeWorker2=_PDFWorker$fakeWorker++,_PDFWorker$fakeWorker),_PDFWorker$fakeWorker2));var workerHandler=new MessageHandler(id+"_worker",id,port);WorkerMessageHandler.setup(workerHandler,port);_this49._messageHandler=new MessageHandler(id,id+"_worker",port);_assertClassBrand(_PDFWorker_brand,_this49,_resolve).call(_this49);})["catch"](function(reason){_this49._readyCapability.reject(new Error("Setting up fake worker failed: \"".concat(reason.message,"\".")));});}},{key:"destroy",value:function destroy(){var _this$_webWorker,_workerPorts$_2,_this$_messageHandler;this.destroyed=true;(_this$_webWorker=this._webWorker)===null||_this$_webWorker===void 0||_this$_webWorker.terminate();this._webWorker=null;(_workerPorts$_2=_workerPorts._)===null||_workerPorts$_2===void 0||_workerPorts$_2["delete"](this._port);this._port=null;(_this$_messageHandler=this._messageHandler)===null||_this$_messageHandler===void 0||_this$_messageHandler.destroy();this._messageHandler=null;}}],[{key:"fromPort",value:function fromPort(params){var _assertClassBrand$_;if(!(params!==null&&params!==void 0&&params.port)){throw new Error("PDFWorker.fromPort - invalid method signature.");}var cachedPort=(_assertClassBrand$_=_assertClassBrand(_PDFWorker,this,_workerPorts)._)===null||_assertClassBrand$_===void 0?void 0:_assertClassBrand$_.get(params.port);if(cachedPort){if(cachedPort._pendingDestroy){throw new Error("PDFWorker.fromPort - the worker is being destroyed.\n"+"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.");}return cachedPort;}return new _PDFWorker(params);}},{key:"workerSrc",get:function get(){if(_GlobalWorkerOptions.workerSrc){return _GlobalWorkerOptions.workerSrc;}throw new Error('No "GlobalWorkerOptions.workerSrc" specified.');}},{key:"_setupFakeWorkerGlobal",get:function get(){var _this50=this;var loader=/*#__PURE__*/function(){var _ref57=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee38(){var worker;return _regenerator().w(function(_context38){while(1)switch(_context38.n){case 0:if(!_classPrivateGetter(_PDFWorker,_this50,_get_mainThreadWorkerMessageHandler)){_context38.n=1;break;}return _context38.a(2,_classPrivateGetter(_PDFWorker,_this50,_get_mainThreadWorkerMessageHandler));case 1:_context38.n=2;return function(specifier){return new Promise(function(r){return r("".concat(specifier));}).then(function(s){return _interopRequireWildcard(require(s));});}(/*webpackIgnore: true*//*@vite-ignore*/_this50.workerSrc);case 2:worker=_context38.v;return _context38.a(2,worker.WorkerMessageHandler);}},_callee38);}));return function loader(){return _ref57.apply(this,arguments);};}();return _shadow(this,"_setupFakeWorkerGlobal",loader());}}]);}();_PDFWorker2=_PDFWorker;function _resolve(){this._readyCapability.resolve();this._messageHandler.send("configure",{verbosity:this.verbosity});}function _get_mainThreadWorkerMessageHandler(_this47){try{var _globalThis$pdfjsWork;return((_globalThis$pdfjsWork=globalThis.pdfjsWorker)===null||_globalThis$pdfjsWork===void 0?void 0:_globalThis$pdfjsWork.WorkerMessageHandler)||null;}catch(_unused0){return null;}}var _fakeWorkerId={_:0};var _isWorkerDisabled={_:false};var _workerPorts={_:void 0};(function(){if(isNodeJS){_isWorkerDisabled._=_assertClassBrand(_PDFWorker2,_PDFWorker2,true);_GlobalWorkerOptions.workerSrc||(_GlobalWorkerOptions.workerSrc="./pdf.worker.mjs");}_PDFWorker2._isSameOrigin=function(baseUrl,otherUrl){var base=URL.parse(baseUrl);if(!(base!==null&&base!==void 0&&base.origin)||base.origin==="null"){return false;}var other=new URL(otherUrl,base);return base.origin===other.origin;};_PDFWorker2._createCDNWrapper=function(url){var wrapper="await import(\"".concat(url,"\");");return URL.createObjectURL(new Blob([wrapper],{type:"text/javascript"}));};})();var _methodPromises=/*#__PURE__*/new WeakMap();var _pageCache=/*#__PURE__*/new WeakMap();var _pagePromises=/*#__PURE__*/new WeakMap();var _pageRefCache=/*#__PURE__*/new WeakMap();var _passwordCapability=/*#__PURE__*/new WeakMap();var _WorkerTransport_brand=/*#__PURE__*/new WeakSet();var WorkerTransport=/*#__PURE__*/function(){function WorkerTransport(messageHandler,loadingTask,networkStream,params,factory){_classCallCheck(this,WorkerTransport);_classPrivateMethodInitSpec(this,_WorkerTransport_brand);_classPrivateFieldInitSpec(this,_methodPromises,new Map());_classPrivateFieldInitSpec(this,_pageCache,new Map());_classPrivateFieldInitSpec(this,_pagePromises,new Map());_classPrivateFieldInitSpec(this,_pageRefCache,new Map());_classPrivateFieldInitSpec(this,_passwordCapability,null);this.messageHandler=messageHandler;this.loadingTask=loadingTask;this.commonObjs=new PDFObjects();this.fontLoader=new FontLoader({ownerDocument:params.ownerDocument,styleElement:params.styleElement});this.loadingParams=params.loadingParams;this._params=params;this.canvasFactory=factory.canvasFactory;this.filterFactory=factory.filterFactory;this.cMapReaderFactory=factory.cMapReaderFactory;this.standardFontDataFactory=factory.standardFontDataFactory;this.wasmFactory=factory.wasmFactory;this.destroyed=false;this.destroyCapability=null;this._networkStream=networkStream;this._fullReader=null;this._lastProgress=null;this.downloadInfoCapability=Promise.withResolvers();this.setupMessageHandler();}return _createClass(WorkerTransport,[{key:"annotationStorage",get:function get(){return _shadow(this,"annotationStorage",new AnnotationStorage());}},{key:"getRenderingIntent",value:function getRenderingIntent(intent){var annotationMode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_AnnotationMode.ENABLE;var printAnnotationStorage=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var isEditing=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var isOpList=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var renderingIntent=RenderingIntentFlag.DISPLAY;var annotationStorageSerializable=SerializableEmpty;switch(intent){case"any":renderingIntent=RenderingIntentFlag.ANY;break;case"display":break;case"print":renderingIntent=RenderingIntentFlag.PRINT;break;default:warn("getRenderingIntent - invalid intent: ".concat(intent));}var annotationStorage=renderingIntent&RenderingIntentFlag.PRINT&&printAnnotationStorage instanceof PrintAnnotationStorage?printAnnotationStorage:this.annotationStorage;switch(annotationMode){case _AnnotationMode.DISABLE:renderingIntent+=RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _AnnotationMode.ENABLE:break;case _AnnotationMode.ENABLE_FORMS:renderingIntent+=RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _AnnotationMode.ENABLE_STORAGE:renderingIntent+=RenderingIntentFlag.ANNOTATIONS_STORAGE;annotationStorageSerializable=annotationStorage.serializable;break;default:warn("getRenderingIntent - invalid annotationMode: ".concat(annotationMode));}if(isEditing){renderingIntent+=RenderingIntentFlag.IS_EDITING;}if(isOpList){renderingIntent+=RenderingIntentFlag.OPLIST;}var _annotationStorage$mo=annotationStorage.modifiedIds,modifiedIds=_annotationStorage$mo.ids,modifiedIdsHash=_annotationStorage$mo.hash;var cacheKeyBuf=[renderingIntent,annotationStorageSerializable.hash,modifiedIdsHash];return{renderingIntent:renderingIntent,cacheKey:cacheKeyBuf.join("_"),annotationStorageSerializable:annotationStorageSerializable,modifiedIds:modifiedIds};}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet59,_this51=this;if(this.destroyCapability){return this.destroyCapability.promise;}this.destroyed=true;this.destroyCapability=Promise.withResolvers();(_classPrivateFieldGet59=_classPrivateFieldGet(_passwordCapability,this))===null||_classPrivateFieldGet59===void 0||_classPrivateFieldGet59.reject(new Error("Worker was destroyed during onPassword callback"));var waitOn=[];var _iterator106=_createForOfIteratorHelper(_classPrivateFieldGet(_pageCache,this).values()),_step106;try{for(_iterator106.s();!(_step106=_iterator106.n()).done;){var page=_step106.value;waitOn.push(page._destroy());}}catch(err){_iterator106.e(err);}finally{_iterator106.f();}_classPrivateFieldGet(_pageCache,this).clear();_classPrivateFieldGet(_pagePromises,this).clear();_classPrivateFieldGet(_pageRefCache,this).clear();if(this.hasOwnProperty("annotationStorage")){this.annotationStorage.resetModified();}var terminated=this.messageHandler.sendWithPromise("Terminate",null);waitOn.push(terminated);Promise.all(waitOn).then(function(){var _this51$_networkStrea,_this51$messageHandle;_this51.commonObjs.clear();_this51.fontLoader.clear();_classPrivateFieldGet(_methodPromises,_this51).clear();_this51.filterFactory.destroy();_TextLayer.cleanup();(_this51$_networkStrea=_this51._networkStream)===null||_this51$_networkStrea===void 0||_this51$_networkStrea.cancelAllRequests(new _AbortException("Worker was terminated."));(_this51$messageHandle=_this51.messageHandler)===null||_this51$messageHandle===void 0||_this51$messageHandle.destroy();_this51.messageHandler=null;_this51.destroyCapability.resolve();},this.destroyCapability.reject);return this.destroyCapability.promise;}},{key:"setupMessageHandler",value:function setupMessageHandler(){var _this52=this;var messageHandler=this.messageHandler,loadingTask=this.loadingTask;messageHandler.on("GetReader",function(data,sink){assert(_this52._networkStream,"GetReader - no `IPDFStream` instance available.");_this52._fullReader=_this52._networkStream.getFullReader();_this52._fullReader.onProgress=function(evt){_this52._lastProgress={loaded:evt.loaded,total:evt.total};};sink.onPull=function(){_this52._fullReader.read().then(function(_ref58){var value=_ref58.value,done=_ref58.done;if(done){sink.close();return;}assert(value instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer.");sink.enqueue(new Uint8Array(value),1,[value]);})["catch"](function(reason){sink.error(reason);});};sink.onCancel=function(reason){_this52._fullReader.cancel(reason);sink.ready["catch"](function(readyReason){if(_this52.destroyed){return;}throw readyReason;});};});messageHandler.on("ReaderHeadersReady",/*#__PURE__*/function(){var _ref59=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee39(data){var _this52$_fullReader,isStreamingSupported,isRangeSupported,contentLength,_loadingTask$onProgre;return _regenerator().w(function(_context39){while(1)switch(_context39.n){case 0:_context39.n=1;return _this52._fullReader.headersReady;case 1:_this52$_fullReader=_this52._fullReader,isStreamingSupported=_this52$_fullReader.isStreamingSupported,isRangeSupported=_this52$_fullReader.isRangeSupported,contentLength=_this52$_fullReader.contentLength;if(!isStreamingSupported||!isRangeSupported){if(_this52._lastProgress){(_loadingTask$onProgre=loadingTask.onProgress)===null||_loadingTask$onProgre===void 0||_loadingTask$onProgre.call(loadingTask,_this52._lastProgress);}_this52._fullReader.onProgress=function(evt){var _loadingTask$onProgre2;(_loadingTask$onProgre2=loadingTask.onProgress)===null||_loadingTask$onProgre2===void 0||_loadingTask$onProgre2.call(loadingTask,{loaded:evt.loaded,total:evt.total});};}return _context39.a(2,{isStreamingSupported:isStreamingSupported,isRangeSupported:isRangeSupported,contentLength:contentLength});}},_callee39);}));return function(_x31){return _ref59.apply(this,arguments);};}());messageHandler.on("GetRangeReader",function(data,sink){assert(_this52._networkStream,"GetRangeReader - no `IPDFStream` instance available.");var rangeReader=_this52._networkStream.getRangeReader(data.begin,data.end);if(!rangeReader){sink.close();return;}sink.onPull=function(){rangeReader.read().then(function(_ref60){var value=_ref60.value,done=_ref60.done;if(done){sink.close();return;}assert(value instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer.");sink.enqueue(new Uint8Array(value),1,[value]);})["catch"](function(reason){sink.error(reason);});};sink.onCancel=function(reason){rangeReader.cancel(reason);sink.ready["catch"](function(readyReason){if(_this52.destroyed){return;}throw readyReason;});};});messageHandler.on("GetDoc",function(_ref61){var pdfInfo=_ref61.pdfInfo;_this52._numPages=pdfInfo.numPages;_this52._htmlForXfa=pdfInfo.htmlForXfa;delete pdfInfo.htmlForXfa;loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo,_this52));});messageHandler.on("DocException",function(ex){loadingTask._capability.reject(wrapReason(ex));});messageHandler.on("PasswordRequest",function(ex){_classPrivateFieldSet(_passwordCapability,_this52,Promise.withResolvers());try{if(!loadingTask.onPassword){throw wrapReason(ex);}var updatePassword=function updatePassword(password){if(password instanceof Error){_classPrivateFieldGet(_passwordCapability,_this52).reject(password);}else{_classPrivateFieldGet(_passwordCapability,_this52).resolve({password:password});}};loadingTask.onPassword(updatePassword,ex.code);}catch(err){_classPrivateFieldGet(_passwordCapability,_this52).reject(err);}return _classPrivateFieldGet(_passwordCapability,_this52).promise;});messageHandler.on("DataLoaded",function(data){var _loadingTask$onProgre3;(_loadingTask$onProgre3=loadingTask.onProgress)===null||_loadingTask$onProgre3===void 0||_loadingTask$onProgre3.call(loadingTask,{loaded:data.length,total:data.length});_this52.downloadInfoCapability.resolve(data);});messageHandler.on("StartRenderPage",function(data){if(_this52.destroyed){return;}var page=_classPrivateFieldGet(_pageCache,_this52).get(data.pageIndex);page._startRenderPage(data.transparency,data.cacheKey);});messageHandler.on("commonobj",function(_ref62){var _globalThis$FontInspe2;var _ref63=_slicedToArray(_ref62,3),id=_ref63[0],type=_ref63[1],exportedData=_ref63[2];if(_this52.destroyed){return null;}if(_this52.commonObjs.has(id)){return null;}switch(type){case"Font":if("error"in exportedData){var exportedError=exportedData.error;warn("Error during font loading: ".concat(exportedError));_this52.commonObjs.resolve(id,exportedError);break;}var inspectFont=_this52._params.pdfBug&&(_globalThis$FontInspe2=globalThis.FontInspector)!==null&&_globalThis$FontInspe2!==void 0&&_globalThis$FontInspe2.enabled?function(font,url){return globalThis.FontInspector.fontAdded(font,url);}:null;var font=new FontFaceObject(exportedData,inspectFont);_this52.fontLoader.bind(font)["catch"](function(){return messageHandler.sendWithPromise("FontFallback",{id:id});})["finally"](function(){if(!font.fontExtraProperties&&font.data){font.data=null;}_this52.commonObjs.resolve(id,font);});break;case"CopyLocalImage":var imageRef=exportedData.imageRef;assert(imageRef,"The imageRef must be defined.");var _iterator107=_createForOfIteratorHelper(_classPrivateFieldGet(_pageCache,_this52).values()),_step107;try{for(_iterator107.s();!(_step107=_iterator107.n()).done;){var pageProxy=_step107.value;var _iterator108=_createForOfIteratorHelper(pageProxy.objs),_step108;try{for(_iterator108.s();!(_step108=_iterator108.n()).done;){var _step108$value=_slicedToArray(_step108.value,2),data=_step108$value[1];if((data===null||data===void 0?void 0:data.ref)!==imageRef){continue;}if(!data.dataLen){return null;}_this52.commonObjs.resolve(id,structuredClone(data));return data.dataLen;}}catch(err){_iterator108.e(err);}finally{_iterator108.f();}}}catch(err){_iterator107.e(err);}finally{_iterator107.f();}break;case"FontPath":case"Image":case"Pattern":_this52.commonObjs.resolve(id,exportedData);break;default:throw new Error("Got unknown common object type ".concat(type));}return null;});messageHandler.on("obj",function(_ref64){var _ref65=_slicedToArray(_ref64,4),id=_ref65[0],pageIndex=_ref65[1],type=_ref65[2],imageData=_ref65[3];if(_this52.destroyed){return;}var pageProxy=_classPrivateFieldGet(_pageCache,_this52).get(pageIndex);if(pageProxy.objs.has(id)){return;}if(pageProxy._intentStates.size===0){var _imageData$bitmap;imageData===null||imageData===void 0||(_imageData$bitmap=imageData.bitmap)===null||_imageData$bitmap===void 0||_imageData$bitmap.close();return;}switch(type){case"Image":case"Pattern":pageProxy.objs.resolve(id,imageData);break;default:throw new Error("Got unknown object type ".concat(type));}});messageHandler.on("DocProgress",function(data){var _loadingTask$onProgre4;if(_this52.destroyed){return;}(_loadingTask$onProgre4=loadingTask.onProgress)===null||_loadingTask$onProgre4===void 0||_loadingTask$onProgre4.call(loadingTask,{loaded:data.loaded,total:data.total});});messageHandler.on("FetchBinaryData",/*#__PURE__*/function(){var _ref66=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee40(data){var factory;return _regenerator().w(function(_context40){while(1)switch(_context40.n){case 0:if(!_this52.destroyed){_context40.n=1;break;}throw new Error("Worker was destroyed.");case 1:factory=_this52[data.type];if(factory){_context40.n=2;break;}throw new Error("".concat(data.type," not initialized, see the `useWorkerFetch` parameter."));case 2:return _context40.a(2,factory.fetch(data));}},_callee40);}));return function(_x32){return _ref66.apply(this,arguments);};}());}},{key:"getData",value:function getData(){return this.messageHandler.sendWithPromise("GetData",null);}},{key:"saveDocument",value:function saveDocument(){var _this$_fullReader$fil,_this$_fullReader,_this53=this;if(this.annotationStorage.size<=0){warn("saveDocument called while `annotationStorage` is empty, "+"please use the getData-method instead.");}var _this$annotationStora=this.annotationStorage.serializable,map=_this$annotationStora.map,transfer=_this$annotationStora.transfer;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:map,filename:(_this$_fullReader$fil=(_this$_fullReader=this._fullReader)===null||_this$_fullReader===void 0?void 0:_this$_fullReader.filename)!==null&&_this$_fullReader$fil!==void 0?_this$_fullReader$fil:null},transfer)["finally"](function(){_this53.annotationStorage.resetModified();});}},{key:"getPage",value:function getPage(pageNumber){var _this54=this;if(!Number.isInteger(pageNumber)||pageNumber<=0||pageNumber>this._numPages){return Promise.reject(new Error("Invalid page request."));}var pageIndex=pageNumber-1,cachedPromise=_classPrivateFieldGet(_pagePromises,this).get(pageIndex);if(cachedPromise){return cachedPromise;}var promise=this.messageHandler.sendWithPromise("GetPage",{pageIndex:pageIndex}).then(function(pageInfo){if(_this54.destroyed){throw new Error("Transport destroyed");}if(pageInfo.refStr){_classPrivateFieldGet(_pageRefCache,_this54).set(pageInfo.refStr,pageNumber);}var page=new PDFPageProxy(pageIndex,pageInfo,_this54,_this54._params.pdfBug);_classPrivateFieldGet(_pageCache,_this54).set(pageIndex,page);return page;});_classPrivateFieldGet(_pagePromises,this).set(pageIndex,promise);return promise;}},{key:"getPageIndex",value:function getPageIndex(ref){if(!isRefProxy(ref)){return Promise.reject(new Error("Invalid pageIndex request."));}return this.messageHandler.sendWithPromise("GetPageIndex",{num:ref.num,gen:ref.gen});}},{key:"getAnnotations",value:function getAnnotations(pageIndex,intent){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:pageIndex,intent:intent});}},{key:"getFieldObjects",value:function getFieldObjects(){return _assertClassBrand(_WorkerTransport_brand,this,_cacheSimpleMethod).call(this,"GetFieldObjects");}},{key:"hasJSActions",value:function hasJSActions(){return _assertClassBrand(_WorkerTransport_brand,this,_cacheSimpleMethod).call(this,"HasJSActions");}},{key:"getCalculationOrderIds",value:function getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null);}},{key:"getDestinations",value:function getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null);}},{key:"getDestination",value:function getDestination(id){if(typeof id!=="string"){return Promise.reject(new Error("Invalid destination request."));}return this.messageHandler.sendWithPromise("GetDestination",{id:id});}},{key:"getPageLabels",value:function getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null);}},{key:"getPageLayout",value:function getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null);}},{key:"getPageMode",value:function getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null);}},{key:"getViewerPreferences",value:function getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null);}},{key:"getOpenAction",value:function getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null);}},{key:"getAttachments",value:function getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null);}},{key:"getDocJSActions",value:function getDocJSActions(){return _assertClassBrand(_WorkerTransport_brand,this,_cacheSimpleMethod).call(this,"GetDocJSActions");}},{key:"getPageJSActions",value:function getPageJSActions(pageIndex){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:pageIndex});}},{key:"getStructTree",value:function getStructTree(pageIndex){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:pageIndex});}},{key:"getOutline",value:function getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null);}},{key:"getOptionalContentConfig",value:function getOptionalContentConfig(renderingIntent){return _assertClassBrand(_WorkerTransport_brand,this,_cacheSimpleMethod).call(this,"GetOptionalContentConfig").then(function(data){return new OptionalContentConfig(data,renderingIntent);});}},{key:"getPermissions",value:function getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null);}},{key:"getMetadata",value:function getMetadata(){var _this55=this;var name="GetMetadata",cachedPromise=_classPrivateFieldGet(_methodPromises,this).get(name);if(cachedPromise){return cachedPromise;}var promise=this.messageHandler.sendWithPromise(name,null).then(function(results){var _this55$_fullReader$f,_this55$_fullReader,_this55$_fullReader$c,_this55$_fullReader2;return{info:results[0],metadata:results[1]?new Metadata(results[1]):null,contentDispositionFilename:(_this55$_fullReader$f=(_this55$_fullReader=_this55._fullReader)===null||_this55$_fullReader===void 0?void 0:_this55$_fullReader.filename)!==null&&_this55$_fullReader$f!==void 0?_this55$_fullReader$f:null,contentLength:(_this55$_fullReader$c=(_this55$_fullReader2=_this55._fullReader)===null||_this55$_fullReader2===void 0?void 0:_this55$_fullReader2.contentLength)!==null&&_this55$_fullReader$c!==void 0?_this55$_fullReader$c:null};});_classPrivateFieldGet(_methodPromises,this).set(name,promise);return promise;}},{key:"getMarkInfo",value:function getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null);}},{key:"startCleanup",value:function(){var _startCleanup=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee41(){var keepLoadedFonts,_iterator109,_step109,page,cleanupSuccessful,_args41=arguments,_t15;return _regenerator().w(function(_context41){while(1)switch(_context41.n){case 0:keepLoadedFonts=_args41.length>0&&_args41[0]!==undefined?_args41[0]:false;if(!this.destroyed){_context41.n=1;break;}return _context41.a(2);case 1:_context41.n=2;return this.messageHandler.sendWithPromise("Cleanup",null);case 2:_iterator109=_createForOfIteratorHelper(_classPrivateFieldGet(_pageCache,this).values());_context41.p=3;_iterator109.s();case 4:if((_step109=_iterator109.n()).done){_context41.n=6;break;}page=_step109.value;cleanupSuccessful=page.cleanup();if(cleanupSuccessful){_context41.n=5;break;}throw new Error("startCleanup: Page ".concat(page.pageNumber," is currently rendering."));case 5:_context41.n=4;break;case 6:_context41.n=8;break;case 7:_context41.p=7;_t15=_context41.v;_iterator109.e(_t15);case 8:_context41.p=8;_iterator109.f();return _context41.f(8);case 9:this.commonObjs.clear();if(!keepLoadedFonts){this.fontLoader.clear();}_classPrivateFieldGet(_methodPromises,this).clear();this.filterFactory.destroy(true);_TextLayer.cleanup();case 10:return _context41.a(2);}},_callee41,this,[[3,7,8,9]]);}));function startCleanup(){return _startCleanup.apply(this,arguments);}return startCleanup;}()},{key:"cachedPageNumber",value:function cachedPageNumber(ref){var _classPrivateFieldGet60;if(!isRefProxy(ref)){return null;}var refStr=ref.gen===0?"".concat(ref.num,"R"):"".concat(ref.num,"R").concat(ref.gen);return(_classPrivateFieldGet60=_classPrivateFieldGet(_pageRefCache,this).get(refStr))!==null&&_classPrivateFieldGet60!==void 0?_classPrivateFieldGet60:null;}}]);}();function _cacheSimpleMethod(name){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var cachedPromise=_classPrivateFieldGet(_methodPromises,this).get(name);if(cachedPromise){return cachedPromise;}var promise=this.messageHandler.sendWithPromise(name,data);_classPrivateFieldGet(_methodPromises,this).set(name,promise);return promise;}var INITIAL_DATA=Symbol("INITIAL_DATA");var _objs=/*#__PURE__*/new WeakMap();var _PDFObjects_brand=/*#__PURE__*/new WeakSet();var PDFObjects=/*#__PURE__*/function(){function PDFObjects(){_classCallCheck(this,PDFObjects);_classPrivateMethodInitSpec(this,_PDFObjects_brand);_classPrivateFieldInitSpec(this,_objs,Object.create(null));}return _createClass(PDFObjects,[{key:"get",value:function get(objId){var callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(callback){var _obj=_assertClassBrand(_PDFObjects_brand,this,_ensureObj).call(this,objId);_obj.promise.then(function(){return callback(_obj.data);});return null;}var obj=_classPrivateFieldGet(_objs,this)[objId];if(!obj||obj.data===INITIAL_DATA){throw new Error("Requesting object that isn't resolved yet ".concat(objId,"."));}return obj.data;}},{key:"has",value:function has(objId){var obj=_classPrivateFieldGet(_objs,this)[objId];return!!obj&&obj.data!==INITIAL_DATA;}},{key:"delete",value:function _delete(objId){var obj=_classPrivateFieldGet(_objs,this)[objId];if(!obj||obj.data===INITIAL_DATA){return false;}delete _classPrivateFieldGet(_objs,this)[objId];return true;}},{key:"resolve",value:function resolve(objId){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var obj=_assertClassBrand(_PDFObjects_brand,this,_ensureObj).call(this,objId);obj.data=data;obj.resolve();}},{key:"clear",value:function clear(){for(var objId in _classPrivateFieldGet(_objs,this)){var _data$bitmap;var data=_classPrivateFieldGet(_objs,this)[objId].data;data===null||data===void 0||(_data$bitmap=data.bitmap)===null||_data$bitmap===void 0||_data$bitmap.close();}_classPrivateFieldSet(_objs,this,Object.create(null));}},{key:Symbol.iterator,value:/*#__PURE__*/_regenerator().m(function value(){var objId,data,_t16,_t17;return _regenerator().w(function(_context42){while(1)switch(_context42.n){case 0:_t16=_regeneratorKeys(_classPrivateFieldGet(_objs,this));case 1:if((_t17=_t16()).done){_context42.n=4;break;}objId=_t17.value;data=_classPrivateFieldGet(_objs,this)[objId].data;if(!(data===INITIAL_DATA)){_context42.n=2;break;}return _context42.a(3,1);case 2:_context42.n=3;return[objId,data];case 3:_context42.n=1;break;case 4:return _context42.a(2);}},value,this);})}]);}();function _ensureObj(objId){var _classPrivateFieldGet151;return(_classPrivateFieldGet151=_classPrivateFieldGet(_objs,this))[objId]||(_classPrivateFieldGet151[objId]=_objectSpread(_objectSpread({},Promise.withResolvers()),{},{data:INITIAL_DATA}));}var _internalRenderTask=/*#__PURE__*/new WeakMap();var RenderTask=/*#__PURE__*/function(){function RenderTask(internalRenderTask){_classCallCheck(this,RenderTask);_classPrivateFieldInitSpec(this,_internalRenderTask,null);_defineProperty(this,"onContinue",null);_defineProperty(this,"onError",null);_classPrivateFieldSet(_internalRenderTask,this,internalRenderTask);}return _createClass(RenderTask,[{key:"promise",get:function get(){return _classPrivateFieldGet(_internalRenderTask,this).capability.promise;}},{key:"cancel",value:function cancel(){var extraDelay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;_classPrivateFieldGet(_internalRenderTask,this).cancel(null,extraDelay);}},{key:"separateAnnots",get:function get(){var separateAnnots=_classPrivateFieldGet(_internalRenderTask,this).operatorList.separateAnnots;if(!separateAnnots){return false;}var _classPrivateFieldGet61=_classPrivateFieldGet(_internalRenderTask,this),annotationCanvasMap=_classPrivateFieldGet61.annotationCanvasMap;return separateAnnots.form||separateAnnots.canvas&&(annotationCanvasMap===null||annotationCanvasMap===void 0?void 0:annotationCanvasMap.size)>0;}}]);}();var _rAF=/*#__PURE__*/new WeakMap();var InternalRenderTask=/*#__PURE__*/function(){function InternalRenderTask(_ref67){var callback=_ref67.callback,params=_ref67.params,objs=_ref67.objs,commonObjs=_ref67.commonObjs,annotationCanvasMap=_ref67.annotationCanvasMap,operatorList=_ref67.operatorList,pageIndex=_ref67.pageIndex,canvasFactory=_ref67.canvasFactory,filterFactory=_ref67.filterFactory,_ref67$useRequestAnim=_ref67.useRequestAnimationFrame,useRequestAnimationFrame=_ref67$useRequestAnim===void 0?false:_ref67$useRequestAnim,_ref67$pdfBug=_ref67.pdfBug,pdfBug=_ref67$pdfBug===void 0?false:_ref67$pdfBug,_ref67$pageColors=_ref67.pageColors,pageColors=_ref67$pageColors===void 0?null:_ref67$pageColors;_classCallCheck(this,InternalRenderTask);_classPrivateFieldInitSpec(this,_rAF,null);this.callback=callback;this.params=params;this.objs=objs;this.commonObjs=commonObjs;this.annotationCanvasMap=annotationCanvasMap;this.operatorListIdx=null;this.operatorList=operatorList;this._pageIndex=pageIndex;this.canvasFactory=canvasFactory;this.filterFactory=filterFactory;this._pdfBug=pdfBug;this.pageColors=pageColors;this.running=false;this.graphicsReadyCallback=null;this.graphicsReady=false;this._useRequestAnimationFrame=useRequestAnimationFrame===true&&typeof window!=="undefined";this.cancelled=false;this.capability=Promise.withResolvers();this.task=new RenderTask(this);this._cancelBound=this.cancel.bind(this);this._continueBound=this._continue.bind(this);this._scheduleNextBound=this._scheduleNext.bind(this);this._nextBound=this._next.bind(this);this._canvas=params.canvasContext.canvas;}return _createClass(InternalRenderTask,[{key:"completed",get:function get(){return this.capability.promise["catch"](function(){});}},{key:"initializeGraphics",value:function initializeGraphics(_ref68){var _globalThis$StepperMa,_this$graphicsReadyCa;var _ref68$transparency=_ref68.transparency,transparency=_ref68$transparency===void 0?false:_ref68$transparency,optionalContentConfig=_ref68.optionalContentConfig;if(this.cancelled){return;}if(this._canvas){if(_canvasInUse._.has(this._canvas)){throw new Error("Cannot use the same canvas during multiple render() operations. "+"Use different canvas or ensure previous operations were "+"cancelled or completed.");}_canvasInUse._.add(this._canvas);}if(this._pdfBug&&(_globalThis$StepperMa=globalThis.StepperManager)!==null&&_globalThis$StepperMa!==void 0&&_globalThis$StepperMa.enabled){this.stepper=globalThis.StepperManager.create(this._pageIndex);this.stepper.init(this.operatorList);this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint();}var _this$params=this.params,canvasContext=_this$params.canvasContext,viewport=_this$params.viewport,transform=_this$params.transform,background=_this$params.background;this.gfx=new CanvasGraphics(canvasContext,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:optionalContentConfig},this.annotationCanvasMap,this.pageColors);this.gfx.beginDrawing({transform:transform,viewport:viewport,transparency:transparency,background:background});this.operatorListIdx=0;this.graphicsReady=true;(_this$graphicsReadyCa=this.graphicsReadyCallback)===null||_this$graphicsReadyCa===void 0||_this$graphicsReadyCa.call(this);}},{key:"cancel",value:function cancel(){var _this$gfx,_this$task$onError,_this$task;var error=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var extraDelay=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.running=false;this.cancelled=true;(_this$gfx=this.gfx)===null||_this$gfx===void 0||_this$gfx.endDrawing();if(_classPrivateFieldGet(_rAF,this)){window.cancelAnimationFrame(_classPrivateFieldGet(_rAF,this));_classPrivateFieldSet(_rAF,this,null);}_canvasInUse._["delete"](this._canvas);error||(error=new _RenderingCancelledException("Rendering cancelled, page ".concat(this._pageIndex+1),extraDelay));this.callback(error);(_this$task$onError=(_this$task=this.task).onError)===null||_this$task$onError===void 0||_this$task$onError.call(_this$task,error);}},{key:"operatorListChanged",value:function operatorListChanged(){var _this$stepper;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return;}(_this$stepper=this.stepper)===null||_this$stepper===void 0||_this$stepper.updateOperatorList(this.operatorList);if(this.running){return;}this._continue();}},{key:"_continue",value:function _continue(){this.running=true;if(this.cancelled){return;}if(this.task.onContinue){this.task.onContinue(this._scheduleNextBound);}else{this._scheduleNext();}}},{key:"_scheduleNext",value:function _scheduleNext(){var _this56=this;if(this._useRequestAnimationFrame){_classPrivateFieldSet(_rAF,this,window.requestAnimationFrame(function(){_classPrivateFieldSet(_rAF,_this56,null);_this56._nextBound()["catch"](_this56._cancelBound);}));}else{Promise.resolve().then(this._nextBound)["catch"](this._cancelBound);}}},{key:"_next",value:function(){var _next2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee42(){return _regenerator().w(function(_context43){while(1)switch(_context43.n){case 0:if(!this.cancelled){_context43.n=1;break;}return _context43.a(2);case 1:this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper);if(this.operatorListIdx===this.operatorList.argsArray.length){this.running=false;if(this.operatorList.lastChunk){this.gfx.endDrawing();_canvasInUse._["delete"](this._canvas);this.callback();}}case 2:return _context43.a(2);}},_callee42,this);}));function _next(){return _next2.apply(this,arguments);}return _next;}()}]);}();var _canvasInUse={_:new WeakSet()};var _version="5.1.91";var _build="45cbe8bb0";;// ./src/shared/scripting_utils.js
function makeColorComp(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0");}function scaleAndClamp(x){return Math.max(0,Math.min(255,255*x));}var ColorConverters=/*#__PURE__*/function(){function ColorConverters(){_classCallCheck(this,ColorConverters);}return _createClass(ColorConverters,null,[{key:"CMYK_G",value:function CMYK_G(_ref69){var _ref70=_slicedToArray(_ref69,4),c=_ref70[0],y=_ref70[1],m=_ref70[2],k=_ref70[3];return["G",1-Math.min(1,0.3*c+0.59*m+0.11*y+k)];}},{key:"G_CMYK",value:function G_CMYK(_ref71){var _ref72=_slicedToArray(_ref71,1),g=_ref72[0];return["CMYK",0,0,0,1-g];}},{key:"G_RGB",value:function G_RGB(_ref73){var _ref74=_slicedToArray(_ref73,1),g=_ref74[0];return["RGB",g,g,g];}},{key:"G_rgb",value:function G_rgb(_ref75){var _ref76=_slicedToArray(_ref75,1),g=_ref76[0];g=scaleAndClamp(g);return[g,g,g];}},{key:"G_HTML",value:function G_HTML(_ref77){var _ref78=_slicedToArray(_ref77,1),g=_ref78[0];var G=makeColorComp(g);return"#".concat(G).concat(G).concat(G);}},{key:"RGB_G",value:function RGB_G(_ref79){var _ref80=_slicedToArray(_ref79,3),r=_ref80[0],g=_ref80[1],b=_ref80[2];return["G",0.3*r+0.59*g+0.11*b];}},{key:"RGB_rgb",value:function RGB_rgb(color){return color.map(scaleAndClamp);}},{key:"RGB_HTML",value:function RGB_HTML(color){return"#".concat(color.map(makeColorComp).join(""));}},{key:"T_HTML",value:function T_HTML(){return"#00000000";}},{key:"T_rgb",value:function T_rgb(){return[null];}},{key:"CMYK_RGB",value:function CMYK_RGB(_ref81){var _ref82=_slicedToArray(_ref81,4),c=_ref82[0],y=_ref82[1],m=_ref82[2],k=_ref82[3];return["RGB",1-Math.min(1,c+k),1-Math.min(1,m+k),1-Math.min(1,y+k)];}},{key:"CMYK_rgb",value:function CMYK_rgb(_ref83){var _ref84=_slicedToArray(_ref83,4),c=_ref84[0],y=_ref84[1],m=_ref84[2],k=_ref84[3];return[scaleAndClamp(1-Math.min(1,c+k)),scaleAndClamp(1-Math.min(1,m+k)),scaleAndClamp(1-Math.min(1,y+k))];}},{key:"CMYK_HTML",value:function CMYK_HTML(components){var rgb=this.CMYK_RGB(components).slice(1);return this.RGB_HTML(rgb);}},{key:"RGB_CMYK",value:function RGB_CMYK(_ref85){var _ref86=_slicedToArray(_ref85,3),r=_ref86[0],g=_ref86[1],b=_ref86[2];var c=1-r;var m=1-g;var y=1-b;var k=Math.min(c,m,y);return["CMYK",c,m,y,k];}}]);}();;// ./src/display/svg_factory.js
var BaseSVGFactory=/*#__PURE__*/function(){function BaseSVGFactory(){_classCallCheck(this,BaseSVGFactory);}return _createClass(BaseSVGFactory,[{key:"create",value:function create(width,height){var skipDimensions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(width<=0||height<=0){throw new Error("Invalid SVG dimensions");}var svg=this._createSVG("svg:svg");svg.setAttribute("version","1.1");if(!skipDimensions){svg.setAttribute("width","".concat(width,"px"));svg.setAttribute("height","".concat(height,"px"));}svg.setAttribute("preserveAspectRatio","none");svg.setAttribute("viewBox","0 0 ".concat(width," ").concat(height));return svg;}},{key:"createElement",value:function createElement(type){if(typeof type!=="string"){throw new Error("Invalid SVG element type");}return this._createSVG(type);}},{key:"_createSVG",value:function _createSVG(type){unreachable("Abstract method `_createSVG` called.");}}]);}();var _DOMSVGFactory=/*#__PURE__*/function(_BaseSVGFactory){function _DOMSVGFactory(){_classCallCheck(this,_DOMSVGFactory);return _callSuper(this,_DOMSVGFactory,arguments);}_inherits(_DOMSVGFactory,_BaseSVGFactory);return _createClass(_DOMSVGFactory,[{key:"_createSVG",value:function _createSVG(type){return document.createElementNS(SVG_NS,type);}}]);}(BaseSVGFactory);;// ./src/display/xfa_layer.js
var _XfaLayer=/*#__PURE__*/function(){function _XfaLayer(){_classCallCheck(this,_XfaLayer);}return _createClass(_XfaLayer,null,[{key:"setupStorage",value:function setupStorage(html,id,element,storage,intent){var storedData=storage.getValue(id,{value:null});switch(element.name){case"textarea":if(storedData.value!==null){html.textContent=storedData.value;}if(intent==="print"){break;}html.addEventListener("input",function(event){storage.setValue(id,{value:event.target.value});});break;case"input":if(element.attributes.type==="radio"||element.attributes.type==="checkbox"){if(storedData.value===element.attributes.xfaOn){html.setAttribute("checked",true);}else if(storedData.value===element.attributes.xfaOff){html.removeAttribute("checked");}if(intent==="print"){break;}html.addEventListener("change",function(event){storage.setValue(id,{value:event.target.checked?event.target.getAttribute("xfaOn"):event.target.getAttribute("xfaOff")});});}else{if(storedData.value!==null){html.setAttribute("value",storedData.value);}if(intent==="print"){break;}html.addEventListener("input",function(event){storage.setValue(id,{value:event.target.value});});}break;case"select":if(storedData.value!==null){html.setAttribute("value",storedData.value);var _iterator110=_createForOfIteratorHelper(element.children),_step110;try{for(_iterator110.s();!(_step110=_iterator110.n()).done;){var option=_step110.value;if(option.attributes.value===storedData.value){option.attributes.selected=true;}else if(option.attributes.hasOwnProperty("selected")){delete option.attributes.selected;}}}catch(err){_iterator110.e(err);}finally{_iterator110.f();}}html.addEventListener("input",function(event){var options=event.target.options;var value=options.selectedIndex===-1?"":options[options.selectedIndex].value;storage.setValue(id,{value:value});});break;}}},{key:"setAttributes",value:function setAttributes(_ref87){var html=_ref87.html,element=_ref87.element,_ref87$storage=_ref87.storage,storage=_ref87$storage===void 0?null:_ref87$storage,intent=_ref87.intent,linkService=_ref87.linkService;var attributes=element.attributes;var isHTMLAnchorElement=html instanceof HTMLAnchorElement;if(attributes.type==="radio"){attributes.name="".concat(attributes.name,"-").concat(intent);}for(var _i13=0,_Object$entries4=Object.entries(attributes);_i13<_Object$entries4.length;_i13++){var _Object$entries4$_i=_slicedToArray(_Object$entries4[_i13],2),key=_Object$entries4$_i[0],value=_Object$entries4$_i[1];if(value===null||value===undefined){continue;}switch(key){case"class":if(value.length){html.setAttribute(key,value.join(" "));}break;case"dataId":break;case"id":html.setAttribute("data-element-id",value);break;case"style":Object.assign(html.style,value);break;case"textContent":html.textContent=value;break;default:if(!isHTMLAnchorElement||key!=="href"&&key!=="newWindow"){html.setAttribute(key,value);}}}if(isHTMLAnchorElement){linkService.addLinkAttributes(html,attributes.href,attributes.newWindow);}if(storage&&attributes.dataId){this.setupStorage(html,attributes.dataId,element,storage);}}},{key:"render",value:function render(parameters){var storage=parameters.annotationStorage;var linkService=parameters.linkService;var root=parameters.xfaHtml;var intent=parameters.intent||"display";var rootHtml=document.createElement(root.name);if(root.attributes){this.setAttributes({html:rootHtml,element:root,intent:intent,linkService:linkService});}var isNotForRichText=intent!=="richText";var rootDiv=parameters.div;rootDiv.append(rootHtml);if(parameters.viewport){var transform="matrix(".concat(parameters.viewport.transform.join(","),")");rootDiv.style.transform=transform;}if(isNotForRichText){rootDiv.setAttribute("class","xfaLayer xfaFont");}var textDivs=[];if(root.children.length===0){if(root.value){var node=document.createTextNode(root.value);rootHtml.append(node);if(isNotForRichText&&XfaText.shouldBuildText(root.name)){textDivs.push(node);}}return{textDivs:textDivs};}var stack=[[root,-1,rootHtml]];while(stack.length>0){var _child$attributes,_child$children;var _stack$at=stack.at(-1),_stack$at2=_slicedToArray(_stack$at,3),parent=_stack$at2[0],i=_stack$at2[1],html=_stack$at2[2];if(i+1===parent.children.length){stack.pop();continue;}var child=parent.children[++stack.at(-1)[1]];if(child===null){continue;}var name=child.name;if(name==="#text"){var _node=document.createTextNode(child.value);textDivs.push(_node);html.append(_node);continue;}var childHtml=child!==null&&child!==void 0&&(_child$attributes=child.attributes)!==null&&_child$attributes!==void 0&&_child$attributes.xmlns?document.createElementNS(child.attributes.xmlns,name):document.createElement(name);html.append(childHtml);if(child.attributes){this.setAttributes({html:childHtml,element:child,storage:storage,intent:intent,linkService:linkService});}if(((_child$children=child.children)===null||_child$children===void 0?void 0:_child$children.length)>0){stack.push([child,-1,childHtml]);}else if(child.value){var _node2=document.createTextNode(child.value);if(isNotForRichText&&XfaText.shouldBuildText(name)){textDivs.push(_node2);}childHtml.append(_node2);}}var _iterator111=_createForOfIteratorHelper(rootDiv.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea")),_step111;try{for(_iterator111.s();!(_step111=_iterator111.n()).done;){var el=_step111.value;el.setAttribute("readOnly",true);}}catch(err){_iterator111.e(err);}finally{_iterator111.f();}return{textDivs:textDivs};}},{key:"update",value:function update(parameters){var transform="matrix(".concat(parameters.viewport.transform.join(","),")");parameters.div.style.transform=transform;parameters.div.hidden=false;}}]);}();;// ./src/display/annotation_layer.js
var DEFAULT_TAB_INDEX=1000;var annotation_layer_DEFAULT_FONT_SIZE=9;var GetElementsByNameSet=new WeakSet();var AnnotationElementFactory=/*#__PURE__*/function(){function AnnotationElementFactory(){_classCallCheck(this,AnnotationElementFactory);}return _createClass(AnnotationElementFactory,null,[{key:"create",value:function create(parameters){var subtype=parameters.data.annotationType;switch(subtype){case _AnnotationType.LINK:return new LinkAnnotationElement(parameters);case _AnnotationType.TEXT:return new TextAnnotationElement(parameters);case _AnnotationType.WIDGET:var fieldType=parameters.data.fieldType;switch(fieldType){case"Tx":return new TextWidgetAnnotationElement(parameters);case"Btn":if(parameters.data.radioButton){return new RadioButtonWidgetAnnotationElement(parameters);}else if(parameters.data.checkBox){return new CheckboxWidgetAnnotationElement(parameters);}return new PushButtonWidgetAnnotationElement(parameters);case"Ch":return new ChoiceWidgetAnnotationElement(parameters);case"Sig":return new SignatureWidgetAnnotationElement(parameters);}return new WidgetAnnotationElement(parameters);case _AnnotationType.POPUP:return new PopupAnnotationElement(parameters);case _AnnotationType.FREETEXT:return new FreeTextAnnotationElement(parameters);case _AnnotationType.LINE:return new LineAnnotationElement(parameters);case _AnnotationType.SQUARE:return new SquareAnnotationElement(parameters);case _AnnotationType.CIRCLE:return new CircleAnnotationElement(parameters);case _AnnotationType.POLYLINE:return new PolylineAnnotationElement(parameters);case _AnnotationType.CARET:return new CaretAnnotationElement(parameters);case _AnnotationType.INK:return new InkAnnotationElement(parameters);case _AnnotationType.POLYGON:return new PolygonAnnotationElement(parameters);case _AnnotationType.HIGHLIGHT:return new HighlightAnnotationElement(parameters);case _AnnotationType.UNDERLINE:return new UnderlineAnnotationElement(parameters);case _AnnotationType.SQUIGGLY:return new SquigglyAnnotationElement(parameters);case _AnnotationType.STRIKEOUT:return new StrikeOutAnnotationElement(parameters);case _AnnotationType.STAMP:return new StampAnnotationElement(parameters);case _AnnotationType.FILEATTACHMENT:return new FileAttachmentAnnotationElement(parameters);default:return new AnnotationElement(parameters);}}}]);}();var _updates=/*#__PURE__*/new WeakMap();var _hasBorder=/*#__PURE__*/new WeakMap();var _popupElement=/*#__PURE__*/new WeakMap();var _AnnotationElement_brand=/*#__PURE__*/new WeakSet();var AnnotationElement=/*#__PURE__*/function(){function AnnotationElement(parameters){var _ref88=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref88$isRenderable=_ref88.isRenderable,isRenderable=_ref88$isRenderable===void 0?false:_ref88$isRenderable,_ref88$ignoreBorder=_ref88.ignoreBorder,ignoreBorder=_ref88$ignoreBorder===void 0?false:_ref88$ignoreBorder,_ref88$createQuadrila=_ref88.createQuadrilaterals,createQuadrilaterals=_ref88$createQuadrila===void 0?false:_ref88$createQuadrila;_classCallCheck(this,AnnotationElement);_classPrivateMethodInitSpec(this,_AnnotationElement_brand);_classPrivateFieldInitSpec(this,_updates,null);_classPrivateFieldInitSpec(this,_hasBorder,false);_classPrivateFieldInitSpec(this,_popupElement,null);this.isRenderable=isRenderable;this.data=parameters.data;this.layer=parameters.layer;this.linkService=parameters.linkService;this.downloadManager=parameters.downloadManager;this.imageResourcesPath=parameters.imageResourcesPath;this.renderForms=parameters.renderForms;this.svgFactory=parameters.svgFactory;this.annotationStorage=parameters.annotationStorage;this.enableScripting=parameters.enableScripting;this.hasJSActions=parameters.hasJSActions;this._fieldObjects=parameters.fieldObjects;this.parent=parameters.parent;if(isRenderable){this.container=this._createContainer(ignoreBorder);}if(createQuadrilaterals){this._createQuadrilaterals();}}return _createClass(AnnotationElement,[{key:"_isEditable",get:function get(){return this.data.isEditable;}},{key:"hasPopupData",get:function get(){return AnnotationElement._hasPopupData(this.data);}},{key:"updateEdited",value:function updateEdited(params){var _classPrivateFieldGet62;if(!this.container){return;}_classPrivateFieldGet(_updates,this)||_classPrivateFieldSet(_updates,this,{rect:this.data.rect.slice(0)});var rect=params.rect;if(rect){_assertClassBrand(_AnnotationElement_brand,this,_setRectEdited).call(this,rect);}(_classPrivateFieldGet62=_classPrivateFieldGet(_popupElement,this))===null||_classPrivateFieldGet62===void 0||_classPrivateFieldGet62.popup.updateEdited(params);}},{key:"resetEdited",value:function resetEdited(){var _classPrivateFieldGet63;if(!_classPrivateFieldGet(_updates,this)){return;}_assertClassBrand(_AnnotationElement_brand,this,_setRectEdited).call(this,_classPrivateFieldGet(_updates,this).rect);(_classPrivateFieldGet63=_classPrivateFieldGet(_popupElement,this))===null||_classPrivateFieldGet63===void 0||_classPrivateFieldGet63.popup.resetEdited();_classPrivateFieldSet(_updates,this,null);}},{key:"_createContainer",value:function _createContainer(ignoreBorder){var data=this.data,_this$parent2=this.parent,page=_this$parent2.page,viewport=_this$parent2.viewport;var container=document.createElement("section");container.setAttribute("data-annotation-id",data.id);if(!(this instanceof WidgetAnnotationElement)){container.tabIndex=DEFAULT_TAB_INDEX;}var style=container.style;style.zIndex=this.parent.zIndex++;if(data.alternativeText){container.title=data.alternativeText;}if(data.noRotate){container.classList.add("norotate");}if(!data.rect||this instanceof PopupAnnotationElement){var _rotation4=data.rotation;if(!data.hasOwnCanvas&&_rotation4!==0){this.setRotation(_rotation4,container);}return container;}var width=this.width,height=this.height;if(!ignoreBorder&&data.borderStyle.width>0){style.borderWidth="".concat(data.borderStyle.width,"px");var horizontalRadius=data.borderStyle.horizontalCornerRadius;var verticalRadius=data.borderStyle.verticalCornerRadius;if(horizontalRadius>0||verticalRadius>0){var radius="calc(".concat(horizontalRadius,"px * var(--total-scale-factor)) / calc(").concat(verticalRadius,"px * var(--total-scale-factor))");style.borderRadius=radius;}else if(this instanceof RadioButtonWidgetAnnotationElement){var _radius="calc(".concat(width,"px * var(--total-scale-factor)) / calc(").concat(height,"px * var(--total-scale-factor))");style.borderRadius=_radius;}switch(data.borderStyle.style){case AnnotationBorderStyleType.SOLID:style.borderStyle="solid";break;case AnnotationBorderStyleType.DASHED:style.borderStyle="dashed";break;case AnnotationBorderStyleType.BEVELED:warn("Unimplemented border style: beveled");break;case AnnotationBorderStyleType.INSET:warn("Unimplemented border style: inset");break;case AnnotationBorderStyleType.UNDERLINE:style.borderBottomStyle="solid";break;default:break;}var borderColor=data.borderColor||null;if(borderColor){_classPrivateFieldSet(_hasBorder,this,true);style.borderColor=_Util.makeHexColor(borderColor[0]|0,borderColor[1]|0,borderColor[2]|0);}else{style.borderWidth=0;}}var rect=_Util.normalizeRect([data.rect[0],page.view[3]-data.rect[1]+page.view[1],data.rect[2],page.view[3]-data.rect[3]+page.view[1]]);var _viewport$rawDims3=viewport.rawDims,pageWidth=_viewport$rawDims3.pageWidth,pageHeight=_viewport$rawDims3.pageHeight,pageX=_viewport$rawDims3.pageX,pageY=_viewport$rawDims3.pageY;style.left="".concat(100*(rect[0]-pageX)/pageWidth,"%");style.top="".concat(100*(rect[1]-pageY)/pageHeight,"%");var rotation=data.rotation;if(data.hasOwnCanvas||rotation===0){style.width="".concat(100*width/pageWidth,"%");style.height="".concat(100*height/pageHeight,"%");}else{this.setRotation(rotation,container);}return container;}},{key:"setRotation",value:function setRotation(angle){var container=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.container;if(!this.data.rect){return;}var _this$parent$viewport3=this.parent.viewport.rawDims,pageWidth=_this$parent$viewport3.pageWidth,pageHeight=_this$parent$viewport3.pageHeight;var width=this.width,height=this.height;if(angle%180!==0){var _ref89=[height,width];width=_ref89[0];height=_ref89[1];}container.style.width="".concat(100*width/pageWidth,"%");container.style.height="".concat(100*height/pageHeight,"%");container.setAttribute("data-main-rotation",(360-angle)%360);}},{key:"_commonActions",get:function get(){var _this57=this;var setColor=function setColor(jsName,styleName,event){var color=event.detail[jsName];var colorType=color[0];var colorArray=color.slice(1);event.target.style[styleName]=ColorConverters["".concat(colorType,"_HTML")](colorArray);_this57.annotationStorage.setValue(_this57.data.id,_defineProperty({},styleName,ColorConverters["".concat(colorType,"_rgb")](colorArray)));};return _shadow(this,"_commonActions",{display:function display(event){var display=event.detail.display;var hidden=display%2===1;_this57.container.style.visibility=hidden?"hidden":"visible";_this57.annotationStorage.setValue(_this57.data.id,{noView:hidden,noPrint:display===1||display===2});},print:function print(event){_this57.annotationStorage.setValue(_this57.data.id,{noPrint:!event.detail.print});},hidden:function hidden(event){var hidden=event.detail.hidden;_this57.container.style.visibility=hidden?"hidden":"visible";_this57.annotationStorage.setValue(_this57.data.id,{noPrint:hidden,noView:hidden});},focus:function focus(event){setTimeout(function(){return event.target.focus({preventScroll:false});},0);},userName:function userName(event){event.target.title=event.detail.userName;},readonly:function readonly(event){event.target.disabled=event.detail.readonly;},required:function required(event){_this57._setRequired(event.target,event.detail.required);},bgColor:function bgColor(event){setColor("bgColor","backgroundColor",event);},fillColor:function fillColor(event){setColor("fillColor","backgroundColor",event);},fgColor:function fgColor(event){setColor("fgColor","color",event);},textColor:function textColor(event){setColor("textColor","color",event);},borderColor:function borderColor(event){setColor("borderColor","borderColor",event);},strokeColor:function strokeColor(event){setColor("strokeColor","borderColor",event);},rotation:function rotation(event){var angle=event.detail.rotation;_this57.setRotation(angle);_this57.annotationStorage.setValue(_this57.data.id,{rotation:angle});}});}},{key:"_dispatchEventFromSandbox",value:function _dispatchEventFromSandbox(actions,jsEvent){var commonActions=this._commonActions;for(var _i14=0,_Object$keys=Object.keys(jsEvent.detail);_i14<_Object$keys.length;_i14++){var name=_Object$keys[_i14];var action=actions[name]||commonActions[name];action===null||action===void 0||action(jsEvent);}}},{key:"_setDefaultPropertiesFromJS",value:function _setDefaultPropertiesFromJS(element){if(!this.enableScripting){return;}var storedData=this.annotationStorage.getRawValue(this.data.id);if(!storedData){return;}var commonActions=this._commonActions;for(var _i15=0,_Object$entries5=Object.entries(storedData);_i15<_Object$entries5.length;_i15++){var _Object$entries5$_i=_slicedToArray(_Object$entries5[_i15],2),actionName=_Object$entries5$_i[0],detail=_Object$entries5$_i[1];var action=commonActions[actionName];if(action){var eventProxy={detail:_defineProperty({},actionName,detail),target:element};action(eventProxy);delete storedData[actionName];}}}},{key:"_createQuadrilaterals",value:function _createQuadrilaterals(){if(!this.container){return;}var quadPoints=this.data.quadPoints;if(!quadPoints){return;}var _this$data$rect$map=this.data.rect.map(function(x){return Math.fround(x);}),_this$data$rect$map2=_slicedToArray(_this$data$rect$map,4),rectBlX=_this$data$rect$map2[0],rectBlY=_this$data$rect$map2[1],rectTrX=_this$data$rect$map2[2],rectTrY=_this$data$rect$map2[3];if(quadPoints.length===8){var _quadPoints$subarray=quadPoints.subarray(2,6),_quadPoints$subarray2=_slicedToArray(_quadPoints$subarray,4),trX=_quadPoints$subarray2[0],trY=_quadPoints$subarray2[1],blX=_quadPoints$subarray2[2],blY=_quadPoints$subarray2[3];if(rectTrX===trX&&rectTrY===trY&&rectBlX===blX&&rectBlY===blY){return;}}var style=this.container.style;var svgBuffer;if(_classPrivateFieldGet(_hasBorder,this)){var borderColor=style.borderColor,borderWidth=style.borderWidth;style.borderWidth=0;svgBuffer=["url('data:image/svg+xml;utf8,","<svg xmlns=\"http://www.w3.org/2000/svg\""," preserveAspectRatio=\"none\" viewBox=\"0 0 1 1\">","<g fill=\"transparent\" stroke=\"".concat(borderColor,"\" stroke-width=\"").concat(borderWidth,"\">")];this.container.classList.add("hasBorder");}var width=rectTrX-rectBlX;var height=rectTrY-rectBlY;var svgFactory=this.svgFactory;var svg=svgFactory.createElement("svg");svg.classList.add("quadrilateralsContainer");svg.setAttribute("width",0);svg.setAttribute("height",0);var defs=svgFactory.createElement("defs");svg.append(defs);var clipPath=svgFactory.createElement("clipPath");var id="clippath_".concat(this.data.id);clipPath.setAttribute("id",id);clipPath.setAttribute("clipPathUnits","objectBoundingBox");defs.append(clipPath);for(var i=2,ii=quadPoints.length;i<ii;i+=8){var _svgBuffer;var _trX=quadPoints[i];var _trY=quadPoints[i+1];var _blX=quadPoints[i+2];var _blY=quadPoints[i+3];var rect=svgFactory.createElement("rect");var x=(_blX-rectBlX)/width;var y=(rectTrY-_trY)/height;var rectWidth=(_trX-_blX)/width;var rectHeight=(_trY-_blY)/height;rect.setAttribute("x",x);rect.setAttribute("y",y);rect.setAttribute("width",rectWidth);rect.setAttribute("height",rectHeight);clipPath.append(rect);(_svgBuffer=svgBuffer)===null||_svgBuffer===void 0||_svgBuffer.push("<rect vector-effect=\"non-scaling-stroke\" x=\"".concat(x,"\" y=\"").concat(y,"\" width=\"").concat(rectWidth,"\" height=\"").concat(rectHeight,"\"/>"));}if(_classPrivateFieldGet(_hasBorder,this)){svgBuffer.push("</g></svg>')");style.backgroundImage=svgBuffer.join("");}this.container.append(svg);this.container.style.clipPath="url(#".concat(id,")");}},{key:"_createPopup",value:function _createPopup(){var data=this.data;var popup=_classPrivateFieldSet(_popupElement,this,new PopupAnnotationElement({data:{color:data.color,titleObj:data.titleObj,modificationDate:data.modificationDate,contentsObj:data.contentsObj,richText:data.richText,parentRect:data.rect,borderStyle:0,id:"popup_".concat(data.id),rotation:data.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(popup.render());}},{key:"render",value:function render(){unreachable("Abstract method `AnnotationElement.render` called");}},{key:"_getElementsByName",value:function _getElementsByName(name){var skipId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var fields=[];if(this._fieldObjects){var fieldObj=this._fieldObjects[name];if(fieldObj){var _iterator112=_createForOfIteratorHelper(fieldObj),_step112;try{for(_iterator112.s();!(_step112=_iterator112.n()).done;){var _step112$value=_step112.value,page=_step112$value.page,id=_step112$value.id,exportValues=_step112$value.exportValues;if(page===-1){continue;}if(id===skipId){continue;}var exportValue=typeof exportValues==="string"?exportValues:null;var domElement=document.querySelector("[data-element-id=\"".concat(id,"\"]"));if(domElement&&!GetElementsByNameSet.has(domElement)){warn("_getElementsByName - element not allowed: ".concat(id));continue;}fields.push({id:id,exportValue:exportValue,domElement:domElement});}}catch(err){_iterator112.e(err);}finally{_iterator112.f();}}return fields;}var _iterator113=_createForOfIteratorHelper(document.getElementsByName(name)),_step113;try{for(_iterator113.s();!(_step113=_iterator113.n()).done;){var _domElement=_step113.value;var _exportValue=_domElement.exportValue;var _id7=_domElement.getAttribute("data-element-id");if(_id7===skipId){continue;}if(!GetElementsByNameSet.has(_domElement)){continue;}fields.push({id:_id7,exportValue:_exportValue,domElement:_domElement});}}catch(err){_iterator113.e(err);}finally{_iterator113.f();}return fields;}},{key:"show",value:function show(){var _this$popup;if(this.container){this.container.hidden=false;}(_this$popup=this.popup)===null||_this$popup===void 0||_this$popup.maybeShow();}},{key:"hide",value:function hide(){var _this$popup2;if(this.container){this.container.hidden=true;}(_this$popup2=this.popup)===null||_this$popup2===void 0||_this$popup2.forceHide();}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return this.container;}},{key:"addHighlightArea",value:function addHighlightArea(){var triggers=this.getElementsToTriggerPopup();if(Array.isArray(triggers)){var _iterator114=_createForOfIteratorHelper(triggers),_step114;try{for(_iterator114.s();!(_step114=_iterator114.n()).done;){var element=_step114.value;element.classList.add("highlightArea");}}catch(err){_iterator114.e(err);}finally{_iterator114.f();}}else{triggers.classList.add("highlightArea");}}},{key:"_editOnDoubleClick",value:function _editOnDoubleClick(){var _this58=this;if(!this._isEditable){return;}var mode=this.annotationEditorType,editId=this.data.id;this.container.addEventListener("dblclick",function(){var _this58$linkService$e;(_this58$linkService$e=_this58.linkService.eventBus)===null||_this58$linkService$e===void 0||_this58$linkService$e.dispatch("switchannotationeditormode",{source:_this58,mode:mode,editId:editId});});}},{key:"width",get:function get(){return this.data.rect[2]-this.data.rect[0];}},{key:"height",get:function get(){return this.data.rect[3]-this.data.rect[1];}}],[{key:"_hasPopupData",value:function _hasPopupData(_ref90){var titleObj=_ref90.titleObj,contentsObj=_ref90.contentsObj,richText=_ref90.richText;return!!(titleObj!==null&&titleObj!==void 0&&titleObj.str||contentsObj!==null&&contentsObj!==void 0&&contentsObj.str||richText!==null&&richText!==void 0&&richText.str);}}]);}();function _setRectEdited(rect){var style=this.container.style,_this$data3=this.data,currentRect=_this$data3.rect,rotation=_this$data3.rotation,_this$parent$viewport10=this.parent.viewport.rawDims,pageWidth=_this$parent$viewport10.pageWidth,pageHeight=_this$parent$viewport10.pageHeight,pageX=_this$parent$viewport10.pageX,pageY=_this$parent$viewport10.pageY;currentRect===null||currentRect===void 0||currentRect.splice.apply(currentRect,[0,4].concat(_toConsumableArray(rect)));style.left="".concat(100*(rect[0]-pageX)/pageWidth,"%");style.top="".concat(100*(pageHeight-rect[3]+pageY)/pageHeight,"%");if(rotation===0){style.width="".concat(100*(rect[2]-rect[0])/pageWidth,"%");style.height="".concat(100*(rect[3]-rect[1])/pageHeight,"%");}else{this.setRotation(rotation);}}var _LinkAnnotationElement_brand=/*#__PURE__*/new WeakSet();var LinkAnnotationElement=/*#__PURE__*/function(_AnnotationElement2){function LinkAnnotationElement(parameters){var _this59;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,LinkAnnotationElement);_this59=_callSuper(this,LinkAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:!!(options!==null&&options!==void 0&&options.ignoreBorder),createQuadrilaterals:true}]);_classPrivateMethodInitSpec(_this59,_LinkAnnotationElement_brand);_this59.isTooltipOnly=parameters.data.isTooltipOnly;return _this59;}_inherits(LinkAnnotationElement,_AnnotationElement2);return _createClass(LinkAnnotationElement,[{key:"render",value:function render(){var data=this.data,linkService=this.linkService;var link=document.createElement("a");link.setAttribute("data-element-id",data.id);var isBound=false;if(data.url){linkService.addLinkAttributes(link,data.url,data.newWindow);isBound=true;}else if(data.action){this._bindNamedAction(link,data.action);isBound=true;}else if(data.attachment){_assertClassBrand(_LinkAnnotationElement_brand,this,_bindAttachment).call(this,link,data.attachment,data.attachmentDest);isBound=true;}else if(data.setOCGState){_assertClassBrand(_LinkAnnotationElement_brand,this,_bindSetOCGState).call(this,link,data.setOCGState);isBound=true;}else if(data.dest){this._bindLink(link,data.dest);isBound=true;}else{if(data.actions&&(data.actions.Action||data.actions["Mouse Up"]||data.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions){this._bindJSAction(link,data);isBound=true;}if(data.resetForm){this._bindResetFormAction(link,data.resetForm);isBound=true;}else if(this.isTooltipOnly&&!isBound){this._bindLink(link,"");isBound=true;}}this.container.classList.add("linkAnnotation");if(isBound){this.container.append(link);}return this.container;}},{key:"_bindLink",value:function _bindLink(link,destination){var _this60=this;link.href=this.linkService.getDestinationHash(destination);link.onclick=function(){if(destination){_this60.linkService.goToDestination(destination);}return false;};if(destination||destination===""){_assertClassBrand(_LinkAnnotationElement_brand,this,_setInternalLink).call(this);}}},{key:"_bindNamedAction",value:function _bindNamedAction(link,action){var _this61=this;link.href=this.linkService.getAnchorUrl("");link.onclick=function(){_this61.linkService.executeNamedAction(action);return false;};_assertClassBrand(_LinkAnnotationElement_brand,this,_setInternalLink).call(this);}},{key:"_bindJSAction",value:function _bindJSAction(link,data){var _this62=this;link.href=this.linkService.getAnchorUrl("");var map=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);var _loop=function _loop(){var name=_Object$keys2[_i16];var jsName=map.get(name);if(!jsName){return 1;// continue
}link[jsName]=function(){var _this62$linkService$e;(_this62$linkService$e=_this62.linkService.eventBus)===null||_this62$linkService$e===void 0||_this62$linkService$e.dispatch("dispatcheventinsandbox",{source:_this62,detail:{id:data.id,name:name}});return false;};};for(var _i16=0,_Object$keys2=Object.keys(data.actions);_i16<_Object$keys2.length;_i16++){if(_loop())continue;}if(!link.onclick){link.onclick=function(){return false;};}_assertClassBrand(_LinkAnnotationElement_brand,this,_setInternalLink).call(this);}},{key:"_bindResetFormAction",value:function _bindResetFormAction(link,resetForm){var _this63=this;var otherClickAction=link.onclick;if(!otherClickAction){link.href=this.linkService.getAnchorUrl("");}_assertClassBrand(_LinkAnnotationElement_brand,this,_setInternalLink).call(this);if(!this._fieldObjects){warn("_bindResetFormAction - \"resetForm\" action not supported, "+"ensure that the `fieldObjects` parameter is provided.");if(!otherClickAction){link.onclick=function(){return false;};}return;}link.onclick=function(){otherClickAction===null||otherClickAction===void 0||otherClickAction();var resetFormFields=resetForm.fields,resetFormRefs=resetForm.refs,include=resetForm.include;var allFields=[];if(resetFormFields.length!==0||resetFormRefs.length!==0){var fieldIds=new Set(resetFormRefs);var _iterator115=_createForOfIteratorHelper(resetFormFields),_step115;try{for(_iterator115.s();!(_step115=_iterator115.n()).done;){var fieldName=_step115.value;var _fields=_this63._fieldObjects[fieldName]||[];var _iterator117=_createForOfIteratorHelper(_fields),_step117;try{for(_iterator117.s();!(_step117=_iterator117.n()).done;){var id=_step117.value.id;fieldIds.add(id);}}catch(err){_iterator117.e(err);}finally{_iterator117.f();}}}catch(err){_iterator115.e(err);}finally{_iterator115.f();}for(var _i17=0,_Object$values=Object.values(_this63._fieldObjects);_i17<_Object$values.length;_i17++){var fields=_Object$values[_i17];var _iterator116=_createForOfIteratorHelper(fields),_step116;try{for(_iterator116.s();!(_step116=_iterator116.n()).done;){var field=_step116.value;if(fieldIds.has(field.id)===include){allFields.push(field);}}}catch(err){_iterator116.e(err);}finally{_iterator116.f();}}}else{for(var _i18=0,_Object$values2=Object.values(_this63._fieldObjects);_i18<_Object$values2.length;_i18++){var _fields2=_Object$values2[_i18];allFields.push.apply(allFields,_toConsumableArray(_fields2));}}var storage=_this63.annotationStorage;var allIds=[];for(var _i19=0,_allFields=allFields;_i19<_allFields.length;_i19++){var _field=_allFields[_i19];var _id8=_field.id;allIds.push(_id8);switch(_field.type){case"text":{var value=_field.defaultValue||"";storage.setValue(_id8,{value:value});break;}case"checkbox":case"radiobutton":{var _value2=_field.defaultValue===_field.exportValues;storage.setValue(_id8,{value:_value2});break;}case"combobox":case"listbox":{var _value3=_field.defaultValue||"";storage.setValue(_id8,{value:_value3});break;}default:continue;}var domElement=document.querySelector("[data-element-id=\"".concat(_id8,"\"]"));if(!domElement){continue;}else if(!GetElementsByNameSet.has(domElement)){warn("_bindResetFormAction - element not allowed: ".concat(_id8));continue;}domElement.dispatchEvent(new Event("resetform"));}if(_this63.enableScripting){var _this63$linkService$e;(_this63$linkService$e=_this63.linkService.eventBus)===null||_this63$linkService$e===void 0||_this63$linkService$e.dispatch("dispatcheventinsandbox",{source:_this63,detail:{id:"app",ids:allIds,name:"ResetForm"}});}return false;};}}]);}(AnnotationElement);function _setInternalLink(){this.container.setAttribute("data-internal-link","");}function _bindAttachment(link,attachment){var _this113=this;var dest=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;link.href=this.linkService.getAnchorUrl("");if(attachment.description){link.title=attachment.description;}link.onclick=function(){var _this113$downloadMana;(_this113$downloadMana=_this113.downloadManager)===null||_this113$downloadMana===void 0||_this113$downloadMana.openOrDownloadData(attachment.content,attachment.filename,dest);return false;};_assertClassBrand(_LinkAnnotationElement_brand,this,_setInternalLink).call(this);}function _bindSetOCGState(link,action){var _this114=this;link.href=this.linkService.getAnchorUrl("");link.onclick=function(){_this114.linkService.executeSetOCGState(action);return false;};_assertClassBrand(_LinkAnnotationElement_brand,this,_setInternalLink).call(this);}var TextAnnotationElement=/*#__PURE__*/function(_AnnotationElement3){function TextAnnotationElement(parameters){_classCallCheck(this,TextAnnotationElement);return _callSuper(this,TextAnnotationElement,[parameters,{isRenderable:true}]);}_inherits(TextAnnotationElement,_AnnotationElement3);return _createClass(TextAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("textAnnotation");var image=document.createElement("img");image.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg";image.setAttribute("data-l10n-id","pdfjs-text-annotation-type");image.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name}));if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}this.container.append(image);return this.container;}}]);}(AnnotationElement);var WidgetAnnotationElement=/*#__PURE__*/function(_AnnotationElement4){function WidgetAnnotationElement(){_classCallCheck(this,WidgetAnnotationElement);return _callSuper(this,WidgetAnnotationElement,arguments);}_inherits(WidgetAnnotationElement,_AnnotationElement4);return _createClass(WidgetAnnotationElement,[{key:"render",value:function render(){return this.container;}},{key:"showElementAndHideCanvas",value:function showElementAndHideCanvas(element){if(this.data.hasOwnCanvas){var _element$previousSibl;if(((_element$previousSibl=element.previousSibling)===null||_element$previousSibl===void 0?void 0:_element$previousSibl.nodeName)==="CANVAS"){element.previousSibling.hidden=true;}element.hidden=false;}}},{key:"_getKeyModifier",value:function _getKeyModifier(event){return util_FeatureTest.platform.isMac?event.metaKey:event.ctrlKey;}},{key:"_setEventListener",value:function _setEventListener(element,elementData,baseName,eventName,valueGetter){var _this64=this;if(baseName.includes("mouse")){element.addEventListener(baseName,function(event){var _this64$linkService$e;(_this64$linkService$e=_this64.linkService.eventBus)===null||_this64$linkService$e===void 0||_this64$linkService$e.dispatch("dispatcheventinsandbox",{source:_this64,detail:{id:_this64.data.id,name:eventName,value:valueGetter(event),shift:event.shiftKey,modifier:_this64._getKeyModifier(event)}});});}else{element.addEventListener(baseName,function(event){var _this64$linkService$e2;if(baseName==="blur"){if(!elementData.focused||!event.relatedTarget){return;}elementData.focused=false;}else if(baseName==="focus"){if(elementData.focused){return;}elementData.focused=true;}if(!valueGetter){return;}(_this64$linkService$e2=_this64.linkService.eventBus)===null||_this64$linkService$e2===void 0||_this64$linkService$e2.dispatch("dispatcheventinsandbox",{source:_this64,detail:{id:_this64.data.id,name:eventName,value:valueGetter(event)}});});}}},{key:"_setEventListeners",value:function _setEventListeners(element,elementData,names,getter){var _iterator118=_createForOfIteratorHelper(names),_step118;try{for(_iterator118.s();!(_step118=_iterator118.n()).done;){var _this$data$actions;var _step118$value=_slicedToArray(_step118.value,2),baseName=_step118$value[0],eventName=_step118$value[1];if(eventName==="Action"||(_this$data$actions=this.data.actions)!==null&&_this$data$actions!==void 0&&_this$data$actions[eventName]){var _this$data$actions2,_this$data$actions3;if(eventName==="Focus"||eventName==="Blur"){elementData||(elementData={focused:false});}this._setEventListener(element,elementData,baseName,eventName,getter);if(eventName==="Focus"&&!((_this$data$actions2=this.data.actions)!==null&&_this$data$actions2!==void 0&&_this$data$actions2.Blur)){this._setEventListener(element,elementData,"blur","Blur",null);}else if(eventName==="Blur"&&!((_this$data$actions3=this.data.actions)!==null&&_this$data$actions3!==void 0&&_this$data$actions3.Focus)){this._setEventListener(element,elementData,"focus","Focus",null);}}}}catch(err){_iterator118.e(err);}finally{_iterator118.f();}}},{key:"_setBackgroundColor",value:function _setBackgroundColor(element){var color=this.data.backgroundColor||null;element.style.backgroundColor=color===null?"transparent":_Util.makeHexColor(color[0],color[1],color[2]);}},{key:"_setTextStyle",value:function _setTextStyle(element){var TEXT_ALIGNMENT=["left","center","right"];var fontColor=this.data.defaultAppearanceData.fontColor;var fontSize=this.data.defaultAppearanceData.fontSize||annotation_layer_DEFAULT_FONT_SIZE;var style=element.style;var computedFontSize;var BORDER_SIZE=2;var roundToOneDecimal=function roundToOneDecimal(x){return Math.round(10*x)/10;};if(this.data.multiLine){var height=Math.abs(this.data.rect[3]-this.data.rect[1]-BORDER_SIZE);var numberOfLines=Math.round(height/(LINE_FACTOR*fontSize))||1;var lineHeight=height/numberOfLines;computedFontSize=Math.min(fontSize,roundToOneDecimal(lineHeight/LINE_FACTOR));}else{var _height2=Math.abs(this.data.rect[3]-this.data.rect[1]-BORDER_SIZE);computedFontSize=Math.min(fontSize,roundToOneDecimal(_height2/LINE_FACTOR));}style.fontSize="calc(".concat(computedFontSize,"px * var(--total-scale-factor))");style.color=_Util.makeHexColor(fontColor[0],fontColor[1],fontColor[2]);if(this.data.textAlignment!==null){style.textAlign=TEXT_ALIGNMENT[this.data.textAlignment];}}},{key:"_setRequired",value:function _setRequired(element,isRequired){if(isRequired){element.setAttribute("required",true);}else{element.removeAttribute("required");}element.setAttribute("aria-required",isRequired);}}]);}(AnnotationElement);var TextWidgetAnnotationElement=/*#__PURE__*/function(_WidgetAnnotationElem){function TextWidgetAnnotationElement(parameters){_classCallCheck(this,TextWidgetAnnotationElement);var isRenderable=parameters.renderForms||parameters.data.hasOwnCanvas||!parameters.data.hasAppearance&&!!parameters.data.fieldValue;return _callSuper(this,TextWidgetAnnotationElement,[parameters,{isRenderable:isRenderable}]);}_inherits(TextWidgetAnnotationElement,_WidgetAnnotationElem);return _createClass(TextWidgetAnnotationElement,[{key:"setPropertyOnSiblings",value:function setPropertyOnSiblings(base,key,value,keyInStorage){var storage=this.annotationStorage;var _iterator119=_createForOfIteratorHelper(this._getElementsByName(base.name,base.id)),_step119;try{for(_iterator119.s();!(_step119=_iterator119.n()).done;){var element=_step119.value;if(element.domElement){element.domElement[key]=value;}storage.setValue(element.id,_defineProperty({},keyInStorage,value));}}catch(err){_iterator119.e(err);}finally{_iterator119.f();}}},{key:"render",value:function render(){var _this65=this;var storage=this.annotationStorage;var id=this.data.id;this.container.classList.add("textWidgetAnnotation");var element=null;if(this.renderForms){var _this$data$textConten;var storedData=storage.getValue(id,{value:this.data.fieldValue});var textContent=storedData.value||"";var maxLen=storage.getValue(id,{charLimit:this.data.maxLen}).charLimit;if(maxLen&&textContent.length>maxLen){textContent=textContent.slice(0,maxLen);}var fieldFormattedValues=storedData.formattedValue||((_this$data$textConten=this.data.textContent)===null||_this$data$textConten===void 0?void 0:_this$data$textConten.join("\n"))||null;if(fieldFormattedValues&&this.data.comb){fieldFormattedValues=fieldFormattedValues.replaceAll(/\s+/g,"");}var elementData={userValue:textContent,formattedValue:fieldFormattedValues,lastCommittedValue:null,commitKey:1,focused:false};if(this.data.multiLine){element=document.createElement("textarea");element.textContent=fieldFormattedValues!==null&&fieldFormattedValues!==void 0?fieldFormattedValues:textContent;if(this.data.doNotScroll){element.style.overflowY="hidden";}}else{element=document.createElement("input");element.type=this.data.password?"password":"text";element.setAttribute("value",fieldFormattedValues!==null&&fieldFormattedValues!==void 0?fieldFormattedValues:textContent);if(this.data.doNotScroll){element.style.overflowX="hidden";}}if(this.data.hasOwnCanvas){element.hidden=true;}GetElementsByNameSet.add(element);element.setAttribute("data-element-id",id);element.disabled=this.data.readOnly;element.name=this.data.fieldName;element.tabIndex=DEFAULT_TAB_INDEX;this._setRequired(element,this.data.required);if(maxLen){element.maxLength=maxLen;}element.addEventListener("input",function(event){storage.setValue(id,{value:event.target.value});_this65.setPropertyOnSiblings(element,"value",event.target.value,"value");elementData.formattedValue=null;});element.addEventListener("resetform",function(event){var _this65$data$defaultF;var defaultValue=(_this65$data$defaultF=_this65.data.defaultFieldValue)!==null&&_this65$data$defaultF!==void 0?_this65$data$defaultF:"";element.value=elementData.userValue=defaultValue;elementData.formattedValue=null;});var blurListener=function blurListener(event){var formattedValue=elementData.formattedValue;if(formattedValue!==null&&formattedValue!==undefined){event.target.value=formattedValue;}event.target.scrollLeft=0;};if(this.enableScripting&&this.hasJSActions){var _this$data$actions4;element.addEventListener("focus",function(event){var _this65$data$actions;if(elementData.focused){return;}var target=event.target;if(elementData.userValue){target.value=elementData.userValue;}elementData.lastCommittedValue=target.value;elementData.commitKey=1;if(!((_this65$data$actions=_this65.data.actions)!==null&&_this65$data$actions!==void 0&&_this65$data$actions.Focus)){elementData.focused=true;}});element.addEventListener("updatefromsandbox",function(jsEvent){_this65.showElementAndHideCanvas(jsEvent.target);var actions={value:function value(event){var _event$detail$value;elementData.userValue=(_event$detail$value=event.detail.value)!==null&&_event$detail$value!==void 0?_event$detail$value:"";storage.setValue(id,{value:elementData.userValue.toString()});event.target.value=elementData.userValue;},formattedValue:function formattedValue(event){var formattedValue=event.detail.formattedValue;elementData.formattedValue=formattedValue;if(formattedValue!==null&&formattedValue!==undefined&&event.target!==document.activeElement){event.target.value=formattedValue;}storage.setValue(id,{formattedValue:formattedValue});},selRange:function selRange(event){var _event$target;(_event$target=event.target).setSelectionRange.apply(_event$target,_toConsumableArray(event.detail.selRange));},charLimit:function charLimit(event){var _this65$linkService$e;var charLimit=event.detail.charLimit;var target=event.target;if(charLimit===0){target.removeAttribute("maxLength");return;}target.setAttribute("maxLength",charLimit);var value=elementData.userValue;if(!value||value.length<=charLimit){return;}value=value.slice(0,charLimit);target.value=elementData.userValue=value;storage.setValue(id,{value:value});(_this65$linkService$e=_this65.linkService.eventBus)===null||_this65$linkService$e===void 0||_this65$linkService$e.dispatch("dispatcheventinsandbox",{source:_this65,detail:{id:id,name:"Keystroke",value:value,willCommit:true,commitKey:1,selStart:target.selectionStart,selEnd:target.selectionEnd}});}};_this65._dispatchEventFromSandbox(actions,jsEvent);});element.addEventListener("keydown",function(event){var _this65$linkService$e2;elementData.commitKey=1;var commitKey=-1;if(event.key==="Escape"){commitKey=0;}else if(event.key==="Enter"&&!_this65.data.multiLine){commitKey=2;}else if(event.key==="Tab"){elementData.commitKey=3;}if(commitKey===-1){return;}var value=event.target.value;if(elementData.lastCommittedValue===value){return;}elementData.lastCommittedValue=value;elementData.userValue=value;(_this65$linkService$e2=_this65.linkService.eventBus)===null||_this65$linkService$e2===void 0||_this65$linkService$e2.dispatch("dispatcheventinsandbox",{source:_this65,detail:{id:id,name:"Keystroke",value:value,willCommit:true,commitKey:commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}});});var _blurListener=blurListener;blurListener=null;element.addEventListener("blur",function(event){var _this65$data$actions2;if(!elementData.focused||!event.relatedTarget){return;}if(!((_this65$data$actions2=_this65.data.actions)!==null&&_this65$data$actions2!==void 0&&_this65$data$actions2.Blur)){elementData.focused=false;}var value=event.target.value;elementData.userValue=value;if(elementData.lastCommittedValue!==value){var _this65$linkService$e3;(_this65$linkService$e3=_this65.linkService.eventBus)===null||_this65$linkService$e3===void 0||_this65$linkService$e3.dispatch("dispatcheventinsandbox",{source:_this65,detail:{id:id,name:"Keystroke",value:value,willCommit:true,commitKey:elementData.commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}});}_blurListener(event);});if((_this$data$actions4=this.data.actions)!==null&&_this$data$actions4!==void 0&&_this$data$actions4.Keystroke){element.addEventListener("beforeinput",function(event){var _this65$linkService$e4;elementData.lastCommittedValue=null;var data=event.data,target=event.target;var value=target.value,selectionStart=target.selectionStart,selectionEnd=target.selectionEnd;var selStart=selectionStart,selEnd=selectionEnd;switch(event.inputType){case"deleteWordBackward":{var match=value.substring(0,selectionStart).match(/\w*[^\w]*$/);if(match){selStart-=match[0].length;}break;}case"deleteWordForward":{var _match3=value.substring(selectionStart).match(/^[^\w]*\w*/);if(_match3){selEnd+=_match3[0].length;}break;}case"deleteContentBackward":if(selectionStart===selectionEnd){selStart-=1;}break;case"deleteContentForward":if(selectionStart===selectionEnd){selEnd+=1;}break;}event.preventDefault();(_this65$linkService$e4=_this65.linkService.eventBus)===null||_this65$linkService$e4===void 0||_this65$linkService$e4.dispatch("dispatcheventinsandbox",{source:_this65,detail:{id:id,name:"Keystroke",value:value,change:data||"",willCommit:false,selStart:selStart,selEnd:selEnd}});});}this._setEventListeners(element,elementData,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],function(event){return event.target.value;});}if(blurListener){element.addEventListener("blur",blurListener);}if(this.data.comb){var fieldWidth=this.data.rect[2]-this.data.rect[0];var combWidth=fieldWidth/maxLen;element.classList.add("comb");element.style.letterSpacing="calc(".concat(combWidth,"px * var(--total-scale-factor) - 1ch)");}}else{element=document.createElement("div");element.textContent=this.data.fieldValue;element.style.verticalAlign="middle";element.style.display="table-cell";if(this.data.hasOwnCanvas){element.hidden=true;}}this._setTextStyle(element);this._setBackgroundColor(element);this._setDefaultPropertiesFromJS(element);this.container.append(element);return this.container;}}]);}(WidgetAnnotationElement);var SignatureWidgetAnnotationElement=/*#__PURE__*/function(_WidgetAnnotationElem2){function SignatureWidgetAnnotationElement(parameters){_classCallCheck(this,SignatureWidgetAnnotationElement);return _callSuper(this,SignatureWidgetAnnotationElement,[parameters,{isRenderable:!!parameters.data.hasOwnCanvas}]);}_inherits(SignatureWidgetAnnotationElement,_WidgetAnnotationElem2);return _createClass(SignatureWidgetAnnotationElement);}(WidgetAnnotationElement);var CheckboxWidgetAnnotationElement=/*#__PURE__*/function(_WidgetAnnotationElem3){function CheckboxWidgetAnnotationElement(parameters){_classCallCheck(this,CheckboxWidgetAnnotationElement);return _callSuper(this,CheckboxWidgetAnnotationElement,[parameters,{isRenderable:parameters.renderForms}]);}_inherits(CheckboxWidgetAnnotationElement,_WidgetAnnotationElem3);return _createClass(CheckboxWidgetAnnotationElement,[{key:"render",value:function render(){var _this66=this;var storage=this.annotationStorage;var data=this.data;var id=data.id;var value=storage.getValue(id,{value:data.exportValue===data.fieldValue}).value;if(typeof value==="string"){value=value!=="Off";storage.setValue(id,{value:value});}this.container.classList.add("buttonWidgetAnnotation","checkBox");var element=document.createElement("input");GetElementsByNameSet.add(element);element.setAttribute("data-element-id",id);element.disabled=data.readOnly;this._setRequired(element,this.data.required);element.type="checkbox";element.name=data.fieldName;if(value){element.setAttribute("checked",true);}element.setAttribute("exportValue",data.exportValue);element.tabIndex=DEFAULT_TAB_INDEX;element.addEventListener("change",function(event){var _event$target2=event.target,name=_event$target2.name,checked=_event$target2.checked;var _iterator120=_createForOfIteratorHelper(_this66._getElementsByName(name,id)),_step120;try{for(_iterator120.s();!(_step120=_iterator120.n()).done;){var checkbox=_step120.value;var curChecked=checked&&checkbox.exportValue===data.exportValue;if(checkbox.domElement){checkbox.domElement.checked=curChecked;}storage.setValue(checkbox.id,{value:curChecked});}}catch(err){_iterator120.e(err);}finally{_iterator120.f();}storage.setValue(id,{value:checked});});element.addEventListener("resetform",function(event){var defaultValue=data.defaultFieldValue||"Off";event.target.checked=defaultValue===data.exportValue;});if(this.enableScripting&&this.hasJSActions){element.addEventListener("updatefromsandbox",function(jsEvent){var actions={value:function value(event){event.target.checked=event.detail.value!=="Off";storage.setValue(id,{value:event.target.checked});}};_this66._dispatchEventFromSandbox(actions,jsEvent);});this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],function(event){return event.target.checked;});}this._setBackgroundColor(element);this._setDefaultPropertiesFromJS(element);this.container.append(element);return this.container;}}]);}(WidgetAnnotationElement);var RadioButtonWidgetAnnotationElement=/*#__PURE__*/function(_WidgetAnnotationElem4){function RadioButtonWidgetAnnotationElement(parameters){_classCallCheck(this,RadioButtonWidgetAnnotationElement);return _callSuper(this,RadioButtonWidgetAnnotationElement,[parameters,{isRenderable:parameters.renderForms}]);}_inherits(RadioButtonWidgetAnnotationElement,_WidgetAnnotationElem4);return _createClass(RadioButtonWidgetAnnotationElement,[{key:"render",value:function render(){var _this67=this;this.container.classList.add("buttonWidgetAnnotation","radioButton");var storage=this.annotationStorage;var data=this.data;var id=data.id;var value=storage.getValue(id,{value:data.fieldValue===data.buttonValue}).value;if(typeof value==="string"){value=value!==data.buttonValue;storage.setValue(id,{value:value});}if(value){var _iterator121=_createForOfIteratorHelper(this._getElementsByName(data.fieldName,id)),_step121;try{for(_iterator121.s();!(_step121=_iterator121.n()).done;){var radio=_step121.value;storage.setValue(radio.id,{value:false});}}catch(err){_iterator121.e(err);}finally{_iterator121.f();}}var element=document.createElement("input");GetElementsByNameSet.add(element);element.setAttribute("data-element-id",id);element.disabled=data.readOnly;this._setRequired(element,this.data.required);element.type="radio";element.name=data.fieldName;if(value){element.setAttribute("checked",true);}element.tabIndex=DEFAULT_TAB_INDEX;element.addEventListener("change",function(event){var _event$target3=event.target,name=_event$target3.name,checked=_event$target3.checked;var _iterator122=_createForOfIteratorHelper(_this67._getElementsByName(name,id)),_step122;try{for(_iterator122.s();!(_step122=_iterator122.n()).done;){var _radio=_step122.value;storage.setValue(_radio.id,{value:false});}}catch(err){_iterator122.e(err);}finally{_iterator122.f();}storage.setValue(id,{value:checked});});element.addEventListener("resetform",function(event){var defaultValue=data.defaultFieldValue;event.target.checked=defaultValue!==null&&defaultValue!==undefined&&defaultValue===data.buttonValue;});if(this.enableScripting&&this.hasJSActions){var pdfButtonValue=data.buttonValue;element.addEventListener("updatefromsandbox",function(jsEvent){var actions={value:function value(event){var checked=pdfButtonValue===event.detail.value;var _iterator123=_createForOfIteratorHelper(_this67._getElementsByName(event.target.name)),_step123;try{for(_iterator123.s();!(_step123=_iterator123.n()).done;){var _radio2=_step123.value;var curChecked=checked&&_radio2.id===id;if(_radio2.domElement){_radio2.domElement.checked=curChecked;}storage.setValue(_radio2.id,{value:curChecked});}}catch(err){_iterator123.e(err);}finally{_iterator123.f();}}};_this67._dispatchEventFromSandbox(actions,jsEvent);});this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],function(event){return event.target.checked;});}this._setBackgroundColor(element);this._setDefaultPropertiesFromJS(element);this.container.append(element);return this.container;}}]);}(WidgetAnnotationElement);var PushButtonWidgetAnnotationElement=/*#__PURE__*/function(_LinkAnnotationElemen){function PushButtonWidgetAnnotationElement(parameters){_classCallCheck(this,PushButtonWidgetAnnotationElement);return _callSuper(this,PushButtonWidgetAnnotationElement,[parameters,{ignoreBorder:parameters.data.hasAppearance}]);}_inherits(PushButtonWidgetAnnotationElement,_LinkAnnotationElemen);return _createClass(PushButtonWidgetAnnotationElement,[{key:"render",value:function render(){var _this68=this;var container=_superPropGet(PushButtonWidgetAnnotationElement,"render",this,3)([]);container.classList.add("buttonWidgetAnnotation","pushButton");var linkElement=container.lastChild;if(this.enableScripting&&this.hasJSActions&&linkElement){this._setDefaultPropertiesFromJS(linkElement);linkElement.addEventListener("updatefromsandbox",function(jsEvent){_this68._dispatchEventFromSandbox({},jsEvent);});}return container;}}]);}(LinkAnnotationElement);var ChoiceWidgetAnnotationElement=/*#__PURE__*/function(_WidgetAnnotationElem5){function ChoiceWidgetAnnotationElement(parameters){_classCallCheck(this,ChoiceWidgetAnnotationElement);return _callSuper(this,ChoiceWidgetAnnotationElement,[parameters,{isRenderable:parameters.renderForms}]);}_inherits(ChoiceWidgetAnnotationElement,_WidgetAnnotationElem5);return _createClass(ChoiceWidgetAnnotationElement,[{key:"render",value:function render(){var _this69=this;this.container.classList.add("choiceWidgetAnnotation");var storage=this.annotationStorage;var id=this.data.id;var storedData=storage.getValue(id,{value:this.data.fieldValue});var selectElement=document.createElement("select");GetElementsByNameSet.add(selectElement);selectElement.setAttribute("data-element-id",id);selectElement.disabled=this.data.readOnly;this._setRequired(selectElement,this.data.required);selectElement.name=this.data.fieldName;selectElement.tabIndex=DEFAULT_TAB_INDEX;var addAnEmptyEntry=this.data.combo&&this.data.options.length>0;if(!this.data.combo){selectElement.size=this.data.options.length;if(this.data.multiSelect){selectElement.multiple=true;}}selectElement.addEventListener("resetform",function(event){var defaultValue=_this69.data.defaultFieldValue;var _iterator124=_createForOfIteratorHelper(selectElement.options),_step124;try{for(_iterator124.s();!(_step124=_iterator124.n()).done;){var option=_step124.value;option.selected=option.value===defaultValue;}}catch(err){_iterator124.e(err);}finally{_iterator124.f();}});var _iterator125=_createForOfIteratorHelper(this.data.options),_step125;try{for(_iterator125.s();!(_step125=_iterator125.n()).done;){var option=_step125.value;var optionElement=document.createElement("option");optionElement.textContent=option.displayValue;optionElement.value=option.exportValue;if(storedData.value.includes(option.exportValue)){optionElement.setAttribute("selected",true);addAnEmptyEntry=false;}selectElement.append(optionElement);}}catch(err){_iterator125.e(err);}finally{_iterator125.f();}var _removeEmptyEntry=null;if(addAnEmptyEntry){var noneOptionElement=document.createElement("option");noneOptionElement.value=" ";noneOptionElement.setAttribute("hidden",true);noneOptionElement.setAttribute("selected",true);selectElement.prepend(noneOptionElement);_removeEmptyEntry=function removeEmptyEntry(){noneOptionElement.remove();selectElement.removeEventListener("input",_removeEmptyEntry);_removeEmptyEntry=null;};selectElement.addEventListener("input",_removeEmptyEntry);}var getValue=function getValue(isExport){var name=isExport?"value":"textContent";var options=selectElement.options,multiple=selectElement.multiple;if(!multiple){return options.selectedIndex===-1?null:options[options.selectedIndex][name];}return Array.prototype.filter.call(options,function(option){return option.selected;}).map(function(option){return option[name];});};var selectedValues=getValue(false);var getItems=function getItems(event){var options=event.target.options;return Array.prototype.map.call(options,function(option){return{displayValue:option.textContent,exportValue:option.value};});};if(this.enableScripting&&this.hasJSActions){selectElement.addEventListener("updatefromsandbox",function(jsEvent){var actions={value:function value(event){var _removeEmptyEntry2;(_removeEmptyEntry2=_removeEmptyEntry)===null||_removeEmptyEntry2===void 0||_removeEmptyEntry2();var value=event.detail.value;var values=new Set(Array.isArray(value)?value:[value]);var _iterator126=_createForOfIteratorHelper(selectElement.options),_step126;try{for(_iterator126.s();!(_step126=_iterator126.n()).done;){var option=_step126.value;option.selected=values.has(option.value);}}catch(err){_iterator126.e(err);}finally{_iterator126.f();}storage.setValue(id,{value:getValue(true)});selectedValues=getValue(false);},multipleSelection:function multipleSelection(event){selectElement.multiple=true;},remove:function remove(event){var options=selectElement.options;var index=event.detail.remove;options[index].selected=false;selectElement.remove(index);if(options.length>0){var i=Array.prototype.findIndex.call(options,function(option){return option.selected;});if(i===-1){options[0].selected=true;}}storage.setValue(id,{value:getValue(true),items:getItems(event)});selectedValues=getValue(false);},clear:function clear(event){while(selectElement.length!==0){selectElement.remove(0);}storage.setValue(id,{value:null,items:[]});selectedValues=getValue(false);},insert:function insert(event){var _event$detail$insert=event.detail.insert,index=_event$detail$insert.index,displayValue=_event$detail$insert.displayValue,exportValue=_event$detail$insert.exportValue;var selectChild=selectElement.children[index];var optionElement=document.createElement("option");optionElement.textContent=displayValue;optionElement.value=exportValue;if(selectChild){selectChild.before(optionElement);}else{selectElement.append(optionElement);}storage.setValue(id,{value:getValue(true),items:getItems(event)});selectedValues=getValue(false);},items:function items(event){var items=event.detail.items;while(selectElement.length!==0){selectElement.remove(0);}var _iterator127=_createForOfIteratorHelper(items),_step127;try{for(_iterator127.s();!(_step127=_iterator127.n()).done;){var item=_step127.value;var displayValue=item.displayValue,exportValue=item.exportValue;var optionElement=document.createElement("option");optionElement.textContent=displayValue;optionElement.value=exportValue;selectElement.append(optionElement);}}catch(err){_iterator127.e(err);}finally{_iterator127.f();}if(selectElement.options.length>0){selectElement.options[0].selected=true;}storage.setValue(id,{value:getValue(true),items:getItems(event)});selectedValues=getValue(false);},indices:function indices(event){var indices=new Set(event.detail.indices);var _iterator128=_createForOfIteratorHelper(event.target.options),_step128;try{for(_iterator128.s();!(_step128=_iterator128.n()).done;){var option=_step128.value;option.selected=indices.has(option.index);}}catch(err){_iterator128.e(err);}finally{_iterator128.f();}storage.setValue(id,{value:getValue(true)});selectedValues=getValue(false);},editable:function editable(event){event.target.disabled=!event.detail.editable;}};_this69._dispatchEventFromSandbox(actions,jsEvent);});selectElement.addEventListener("input",function(event){var _this69$linkService$e;var exportValue=getValue(true);var change=getValue(false);storage.setValue(id,{value:exportValue});event.preventDefault();(_this69$linkService$e=_this69.linkService.eventBus)===null||_this69$linkService$e===void 0||_this69$linkService$e.dispatch("dispatcheventinsandbox",{source:_this69,detail:{id:id,name:"Keystroke",value:selectedValues,change:change,changeEx:exportValue,willCommit:false,commitKey:1,keyDown:false}});});this._setEventListeners(selectElement,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],function(event){return event.target.value;});}else{selectElement.addEventListener("input",function(event){storage.setValue(id,{value:getValue(true)});});}if(this.data.combo){this._setTextStyle(selectElement);}else{}this._setBackgroundColor(selectElement);this._setDefaultPropertiesFromJS(selectElement);this.container.append(selectElement);return this.container;}}]);}(WidgetAnnotationElement);var PopupAnnotationElement=/*#__PURE__*/function(_AnnotationElement5){function PopupAnnotationElement(parameters){var _this70;_classCallCheck(this,PopupAnnotationElement);var data=parameters.data,elements=parameters.elements;_this70=_callSuper(this,PopupAnnotationElement,[parameters,{isRenderable:AnnotationElement._hasPopupData(data)}]);_this70.elements=elements;_this70.popup=null;return _this70;}_inherits(PopupAnnotationElement,_AnnotationElement5);return _createClass(PopupAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("popupAnnotation");var popup=this.popup=new PopupElement({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open});var elementIds=[];var _iterator129=_createForOfIteratorHelper(this.elements),_step129;try{for(_iterator129.s();!(_step129=_iterator129.n()).done;){var element=_step129.value;element.popup=popup;element.container.ariaHasPopup="dialog";elementIds.push(element.data.id);element.addHighlightArea();}}catch(err){_iterator129.e(err);}finally{_iterator129.f();}this.container.setAttribute("aria-controls",elementIds.map(function(id){return"".concat(AnnotationPrefix).concat(id);}).join(","));return this.container;}}]);}(AnnotationElement);var _boundKeyDown=/*#__PURE__*/new WeakMap();var _boundHide=/*#__PURE__*/new WeakMap();var _boundShow=/*#__PURE__*/new WeakMap();var _boundToggle=/*#__PURE__*/new WeakMap();var _color=/*#__PURE__*/new WeakMap();var _container5=/*#__PURE__*/new WeakMap();var _contentsObj=/*#__PURE__*/new WeakMap();var _dateObj=/*#__PURE__*/new WeakMap();var _elements=/*#__PURE__*/new WeakMap();var _parent=/*#__PURE__*/new WeakMap();var _parentRect=/*#__PURE__*/new WeakMap();var _pinned=/*#__PURE__*/new WeakMap();var _popup=/*#__PURE__*/new WeakMap();var _position2=/*#__PURE__*/new WeakMap();var _rect2=/*#__PURE__*/new WeakMap();var _richText=/*#__PURE__*/new WeakMap();var _titleObj=/*#__PURE__*/new WeakMap();var _updates2=/*#__PURE__*/new WeakMap();var _wasVisible=/*#__PURE__*/new WeakMap();var _PopupElement_brand=/*#__PURE__*/new WeakSet();var PopupElement=/*#__PURE__*/function(){function PopupElement(_ref91){var container=_ref91.container,color=_ref91.color,elements=_ref91.elements,titleObj=_ref91.titleObj,modificationDate=_ref91.modificationDate,_contentsObj2=_ref91.contentsObj,_richText2=_ref91.richText,parent=_ref91.parent,_rect3=_ref91.rect,parentRect=_ref91.parentRect,open=_ref91.open;_classCallCheck(this,PopupElement);_classPrivateMethodInitSpec(this,_PopupElement_brand);_classPrivateFieldInitSpec(this,_boundKeyDown,_assertClassBrand(_PopupElement_brand,this,_keyDown).bind(this));_classPrivateFieldInitSpec(this,_boundHide,_assertClassBrand(_PopupElement_brand,this,_hide).bind(this));_classPrivateFieldInitSpec(this,_boundShow,_assertClassBrand(_PopupElement_brand,this,_show).bind(this));_classPrivateFieldInitSpec(this,_boundToggle,_assertClassBrand(_PopupElement_brand,this,_toggle).bind(this));_classPrivateFieldInitSpec(this,_color,null);_classPrivateFieldInitSpec(this,_container5,null);_classPrivateFieldInitSpec(this,_contentsObj,null);_classPrivateFieldInitSpec(this,_dateObj,null);_classPrivateFieldInitSpec(this,_elements,null);_classPrivateFieldInitSpec(this,_parent,null);_classPrivateFieldInitSpec(this,_parentRect,null);_classPrivateFieldInitSpec(this,_pinned,false);_classPrivateFieldInitSpec(this,_popup,null);_classPrivateFieldInitSpec(this,_position2,null);_classPrivateFieldInitSpec(this,_rect2,null);_classPrivateFieldInitSpec(this,_richText,null);_classPrivateFieldInitSpec(this,_titleObj,null);_classPrivateFieldInitSpec(this,_updates2,null);_classPrivateFieldInitSpec(this,_wasVisible,false);_classPrivateFieldSet(_container5,this,container);_classPrivateFieldSet(_titleObj,this,titleObj);_classPrivateFieldSet(_contentsObj,this,_contentsObj2);_classPrivateFieldSet(_richText,this,_richText2);_classPrivateFieldSet(_parent,this,parent);_classPrivateFieldSet(_color,this,color);_classPrivateFieldSet(_rect2,this,_rect3);_classPrivateFieldSet(_parentRect,this,parentRect);_classPrivateFieldSet(_elements,this,elements);_classPrivateFieldSet(_dateObj,this,_PDFDateString.toDateObject(modificationDate));this.trigger=elements.flatMap(function(e){return e.getElementsToTriggerPopup();});var _iterator130=_createForOfIteratorHelper(this.trigger),_step130;try{for(_iterator130.s();!(_step130=_iterator130.n()).done;){var element=_step130.value;element.addEventListener("click",_classPrivateFieldGet(_boundToggle,this));element.addEventListener("mouseenter",_classPrivateFieldGet(_boundShow,this));element.addEventListener("mouseleave",_classPrivateFieldGet(_boundHide,this));element.classList.add("popupTriggerArea");}}catch(err){_iterator130.e(err);}finally{_iterator130.f();}var _iterator131=_createForOfIteratorHelper(elements),_step131;try{for(_iterator131.s();!(_step131=_iterator131.n()).done;){var _element$container;var _element=_step131.value;(_element$container=_element.container)===null||_element$container===void 0||_element$container.addEventListener("keydown",_classPrivateFieldGet(_boundKeyDown,this));}}catch(err){_iterator131.e(err);}finally{_iterator131.f();}_classPrivateFieldGet(_container5,this).hidden=true;if(open){_assertClassBrand(_PopupElement_brand,this,_toggle).call(this);}}return _createClass(PopupElement,[{key:"render",value:function render(){if(_classPrivateFieldGet(_popup,this)){return;}var popup=_classPrivateFieldSet(_popup,this,document.createElement("div"));popup.className="popup";if(_classPrivateFieldGet(_color,this)){var baseColor=popup.style.outlineColor=_Util.makeHexColor.apply(_Util,_toConsumableArray(_classPrivateFieldGet(_color,this)));popup.style.backgroundColor="color-mix(in srgb, ".concat(baseColor," 30%, white)");}var header=document.createElement("span");header.className="header";var title=document.createElement("h1");header.append(title);var _classPrivateFieldGet64=_classPrivateFieldGet(_titleObj,this);title.dir=_classPrivateFieldGet64.dir;title.textContent=_classPrivateFieldGet64.str;popup.append(header);if(_classPrivateFieldGet(_dateObj,this)){var modificationDate=document.createElement("span");modificationDate.classList.add("popupDate");modificationDate.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string");modificationDate.setAttribute("data-l10n-args",JSON.stringify({dateObj:_classPrivateFieldGet(_dateObj,this).valueOf()}));header.append(modificationDate);}var html=_classPrivateGetter(_PopupElement_brand,this,_get_html);if(html){_XfaLayer.render({xfaHtml:html,intent:"richText",div:popup});popup.lastChild.classList.add("richText","popupContent");}else{var contents=this._formatContents(_classPrivateFieldGet(_contentsObj,this));popup.append(contents);}_classPrivateFieldGet(_container5,this).append(popup);}},{key:"_formatContents",value:function _formatContents(_ref92){var str=_ref92.str,dir=_ref92.dir;var p=document.createElement("p");p.classList.add("popupContent");p.dir=dir;var lines=str.split(/(?:\r\n?|\n)/);for(var i=0,ii=lines.length;i<ii;++i){var line=lines[i];p.append(document.createTextNode(line));if(i<ii-1){p.append(document.createElement("br"));}}return p;}},{key:"updateEdited",value:function updateEdited(_ref93){var _classPrivateFieldGet65;var rect=_ref93.rect,popupContent=_ref93.popupContent;_classPrivateFieldGet(_updates2,this)||_classPrivateFieldSet(_updates2,this,{contentsObj:_classPrivateFieldGet(_contentsObj,this),richText:_classPrivateFieldGet(_richText,this)});if(rect){_classPrivateFieldSet(_position2,this,null);}if(popupContent){_classPrivateFieldSet(_richText,this,_assertClassBrand(_PopupElement_brand,this,_makePopupContent).call(this,popupContent));_classPrivateFieldSet(_contentsObj,this,null);}(_classPrivateFieldGet65=_classPrivateFieldGet(_popup,this))===null||_classPrivateFieldGet65===void 0||_classPrivateFieldGet65.remove();_classPrivateFieldSet(_popup,this,null);}},{key:"resetEdited",value:function resetEdited(){var _classPrivateFieldGet67;if(!_classPrivateFieldGet(_updates2,this)){return;}var _classPrivateFieldGet66=_classPrivateFieldGet(_updates2,this);_toSetter(_classPrivateFieldSet,[_contentsObj,this])._=_classPrivateFieldGet66.contentsObj;_toSetter(_classPrivateFieldSet,[_richText,this])._=_classPrivateFieldGet66.richText;_classPrivateFieldSet(_updates2,this,null);(_classPrivateFieldGet67=_classPrivateFieldGet(_popup,this))===null||_classPrivateFieldGet67===void 0||_classPrivateFieldGet67.remove();_classPrivateFieldSet(_popup,this,null);_classPrivateFieldSet(_position2,this,null);}},{key:"forceHide",value:function forceHide(){_classPrivateFieldSet(_wasVisible,this,this.isVisible);if(!_classPrivateFieldGet(_wasVisible,this)){return;}_classPrivateFieldGet(_container5,this).hidden=true;}},{key:"maybeShow",value:function maybeShow(){if(!_classPrivateFieldGet(_wasVisible,this)){return;}if(!_classPrivateFieldGet(_popup,this)){_assertClassBrand(_PopupElement_brand,this,_show).call(this);}_classPrivateFieldSet(_wasVisible,this,false);_classPrivateFieldGet(_container5,this).hidden=false;}},{key:"isVisible",get:function get(){return _classPrivateFieldGet(_container5,this).hidden===false;}}]);}();function _get_html(_this71){var richText=_classPrivateFieldGet(_richText,_this71);var contentsObj=_classPrivateFieldGet(_contentsObj,_this71);if(richText!==null&&richText!==void 0&&richText.str&&(!(contentsObj!==null&&contentsObj!==void 0&&contentsObj.str)||contentsObj.str===richText.str)){return _classPrivateFieldGet(_richText,_this71).html||null;}return null;}function _get_fontSize(_this72){var _classPrivateGetter5;return((_classPrivateGetter5=_classPrivateGetter(_PopupElement_brand,_this72,_get_html))===null||_classPrivateGetter5===void 0||(_classPrivateGetter5=_classPrivateGetter5.attributes)===null||_classPrivateGetter5===void 0||(_classPrivateGetter5=_classPrivateGetter5.style)===null||_classPrivateGetter5===void 0?void 0:_classPrivateGetter5.fontSize)||0;}function _get_fontColor(_this73){var _classPrivateGetter6;return((_classPrivateGetter6=_classPrivateGetter(_PopupElement_brand,_this73,_get_html))===null||_classPrivateGetter6===void 0||(_classPrivateGetter6=_classPrivateGetter6.attributes)===null||_classPrivateGetter6===void 0||(_classPrivateGetter6=_classPrivateGetter6.style)===null||_classPrivateGetter6===void 0?void 0:_classPrivateGetter6.color)||null;}function _makePopupContent(text){var popupLines=[];var popupContent={str:text,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:popupLines}]}};var lineAttributes={style:{color:_classPrivateGetter(_PopupElement_brand,this,_get_fontColor),fontSize:_classPrivateGetter(_PopupElement_brand,this,_get_fontSize)?"calc(".concat(_classPrivateGetter(_PopupElement_brand,this,_get_fontSize),"px * var(--total-scale-factor))"):""}};var _iterator181=_createForOfIteratorHelper(text.split("\n")),_step181;try{for(_iterator181.s();!(_step181=_iterator181.n()).done;){var line=_step181.value;popupLines.push({name:"span",value:line,attributes:lineAttributes});}}catch(err){_iterator181.e(err);}finally{_iterator181.f();}return popupContent;}function _keyDown(event){if(event.altKey||event.shiftKey||event.ctrlKey||event.metaKey){return;}if(event.key==="Enter"||event.key==="Escape"&&_classPrivateFieldGet(_pinned,this)){_assertClassBrand(_PopupElement_brand,this,_toggle).call(this);}}function _setPosition(){if(_classPrivateFieldGet(_position2,this)!==null){return;}var _classPrivateFieldGet152=_classPrivateFieldGet(_parent,this),view=_classPrivateFieldGet152.page.view,_classPrivateFieldGet153=_classPrivateFieldGet152.viewport.rawDims,pageWidth=_classPrivateFieldGet153.pageWidth,pageHeight=_classPrivateFieldGet153.pageHeight,pageX=_classPrivateFieldGet153.pageX,pageY=_classPrivateFieldGet153.pageY;var useParentRect=!!_classPrivateFieldGet(_parentRect,this);var rect=useParentRect?_classPrivateFieldGet(_parentRect,this):_classPrivateFieldGet(_rect2,this);var _iterator182=_createForOfIteratorHelper(_classPrivateFieldGet(_elements,this)),_step182;try{for(_iterator182.s();!(_step182=_iterator182.n()).done;){var element=_step182.value;if(!rect||_Util.intersect(element.data.rect,rect)!==null){rect=element.data.rect;useParentRect=true;break;}}}catch(err){_iterator182.e(err);}finally{_iterator182.f();}var normalizedRect=_Util.normalizeRect([rect[0],view[3]-rect[1]+view[1],rect[2],view[3]-rect[3]+view[1]]);var HORIZONTAL_SPACE_AFTER_ANNOTATION=5;var parentWidth=useParentRect?rect[2]-rect[0]+HORIZONTAL_SPACE_AFTER_ANNOTATION:0;var popupLeft=normalizedRect[0]+parentWidth;var popupTop=normalizedRect[1];_classPrivateFieldSet(_position2,this,[100*(popupLeft-pageX)/pageWidth,100*(popupTop-pageY)/pageHeight]);var _classPrivateFieldGet154=_classPrivateFieldGet(_container5,this),style=_classPrivateFieldGet154.style;style.left="".concat(_classPrivateFieldGet(_position2,this)[0],"%");style.top="".concat(_classPrivateFieldGet(_position2,this)[1],"%");}function _toggle(){_classPrivateFieldSet(_pinned,this,!_classPrivateFieldGet(_pinned,this));if(_classPrivateFieldGet(_pinned,this)){_assertClassBrand(_PopupElement_brand,this,_show).call(this);_classPrivateFieldGet(_container5,this).addEventListener("click",_classPrivateFieldGet(_boundToggle,this));_classPrivateFieldGet(_container5,this).addEventListener("keydown",_classPrivateFieldGet(_boundKeyDown,this));}else{_assertClassBrand(_PopupElement_brand,this,_hide).call(this);_classPrivateFieldGet(_container5,this).removeEventListener("click",_classPrivateFieldGet(_boundToggle,this));_classPrivateFieldGet(_container5,this).removeEventListener("keydown",_classPrivateFieldGet(_boundKeyDown,this));}}function _show(){if(!_classPrivateFieldGet(_popup,this)){this.render();}if(!this.isVisible){_assertClassBrand(_PopupElement_brand,this,_setPosition).call(this);_classPrivateFieldGet(_container5,this).hidden=false;_classPrivateFieldGet(_container5,this).style.zIndex=parseInt(_classPrivateFieldGet(_container5,this).style.zIndex)+1000;}else if(_classPrivateFieldGet(_pinned,this)){_classPrivateFieldGet(_container5,this).classList.add("focused");}}function _hide(){_classPrivateFieldGet(_container5,this).classList.remove("focused");if(_classPrivateFieldGet(_pinned,this)||!this.isVisible){return;}_classPrivateFieldGet(_container5,this).hidden=true;_classPrivateFieldGet(_container5,this).style.zIndex=parseInt(_classPrivateFieldGet(_container5,this).style.zIndex)-1000;}var FreeTextAnnotationElement=/*#__PURE__*/function(_AnnotationElement6){function FreeTextAnnotationElement(parameters){var _this74;_classCallCheck(this,FreeTextAnnotationElement);_this74=_callSuper(this,FreeTextAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);_this74.textContent=parameters.data.textContent;_this74.textPosition=parameters.data.textPosition;_this74.annotationEditorType=_AnnotationEditorType.FREETEXT;return _this74;}_inherits(FreeTextAnnotationElement,_AnnotationElement6);return _createClass(FreeTextAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("freeTextAnnotation");if(this.textContent){var content=document.createElement("div");content.classList.add("annotationTextContent");content.setAttribute("role","comment");var _iterator132=_createForOfIteratorHelper(this.textContent),_step132;try{for(_iterator132.s();!(_step132=_iterator132.n()).done;){var line=_step132.value;var lineSpan=document.createElement("span");lineSpan.textContent=line;content.append(lineSpan);}}catch(err){_iterator132.e(err);}finally{_iterator132.f();}this.container.append(content);}if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}this._editOnDoubleClick();return this.container;}}]);}(AnnotationElement);var _line=/*#__PURE__*/new WeakMap();var LineAnnotationElement=/*#__PURE__*/function(_AnnotationElement7){function LineAnnotationElement(parameters){var _this75;_classCallCheck(this,LineAnnotationElement);_this75=_callSuper(this,LineAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);_classPrivateFieldInitSpec(_this75,_line,null);return _this75;}_inherits(LineAnnotationElement,_AnnotationElement7);return _createClass(LineAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("lineAnnotation");var data=this.data,width=this.width,height=this.height;var svg=this.svgFactory.create(width,height,true);var line=_classPrivateFieldSet(_line,this,this.svgFactory.createElement("svg:line"));line.setAttribute("x1",data.rect[2]-data.lineCoordinates[0]);line.setAttribute("y1",data.rect[3]-data.lineCoordinates[1]);line.setAttribute("x2",data.rect[2]-data.lineCoordinates[2]);line.setAttribute("y2",data.rect[3]-data.lineCoordinates[3]);line.setAttribute("stroke-width",data.borderStyle.width||1);line.setAttribute("stroke","transparent");line.setAttribute("fill","transparent");svg.append(line);this.container.append(svg);if(!data.popupRef&&this.hasPopupData){this._createPopup();}return this.container;}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(_line,this);}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea");}}]);}(AnnotationElement);var _square=/*#__PURE__*/new WeakMap();var SquareAnnotationElement=/*#__PURE__*/function(_AnnotationElement8){function SquareAnnotationElement(parameters){var _this76;_classCallCheck(this,SquareAnnotationElement);_this76=_callSuper(this,SquareAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);_classPrivateFieldInitSpec(_this76,_square,null);return _this76;}_inherits(SquareAnnotationElement,_AnnotationElement8);return _createClass(SquareAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("squareAnnotation");var data=this.data,width=this.width,height=this.height;var svg=this.svgFactory.create(width,height,true);var borderWidth=data.borderStyle.width;var square=_classPrivateFieldSet(_square,this,this.svgFactory.createElement("svg:rect"));square.setAttribute("x",borderWidth/2);square.setAttribute("y",borderWidth/2);square.setAttribute("width",width-borderWidth);square.setAttribute("height",height-borderWidth);square.setAttribute("stroke-width",borderWidth||1);square.setAttribute("stroke","transparent");square.setAttribute("fill","transparent");svg.append(square);this.container.append(svg);if(!data.popupRef&&this.hasPopupData){this._createPopup();}return this.container;}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(_square,this);}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea");}}]);}(AnnotationElement);var _circle=/*#__PURE__*/new WeakMap();var CircleAnnotationElement=/*#__PURE__*/function(_AnnotationElement9){function CircleAnnotationElement(parameters){var _this77;_classCallCheck(this,CircleAnnotationElement);_this77=_callSuper(this,CircleAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);_classPrivateFieldInitSpec(_this77,_circle,null);return _this77;}_inherits(CircleAnnotationElement,_AnnotationElement9);return _createClass(CircleAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("circleAnnotation");var data=this.data,width=this.width,height=this.height;var svg=this.svgFactory.create(width,height,true);var borderWidth=data.borderStyle.width;var circle=_classPrivateFieldSet(_circle,this,this.svgFactory.createElement("svg:ellipse"));circle.setAttribute("cx",width/2);circle.setAttribute("cy",height/2);circle.setAttribute("rx",width/2-borderWidth/2);circle.setAttribute("ry",height/2-borderWidth/2);circle.setAttribute("stroke-width",borderWidth||1);circle.setAttribute("stroke","transparent");circle.setAttribute("fill","transparent");svg.append(circle);this.container.append(svg);if(!data.popupRef&&this.hasPopupData){this._createPopup();}return this.container;}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(_circle,this);}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea");}}]);}(AnnotationElement);var _polyline=/*#__PURE__*/new WeakMap();var PolylineAnnotationElement=/*#__PURE__*/function(_AnnotationElement0){function PolylineAnnotationElement(parameters){var _this78;_classCallCheck(this,PolylineAnnotationElement);_this78=_callSuper(this,PolylineAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);_classPrivateFieldInitSpec(_this78,_polyline,null);_this78.containerClassName="polylineAnnotation";_this78.svgElementName="svg:polyline";return _this78;}_inherits(PolylineAnnotationElement,_AnnotationElement0);return _createClass(PolylineAnnotationElement,[{key:"render",value:function render(){this.container.classList.add(this.containerClassName);var _this$data=this.data,rect=_this$data.rect,vertices=_this$data.vertices,borderStyle=_this$data.borderStyle,popupRef=_this$data.popupRef,width=this.width,height=this.height;if(!vertices){return this.container;}var svg=this.svgFactory.create(width,height,true);var points=[];for(var i=0,ii=vertices.length;i<ii;i+=2){var x=vertices[i]-rect[0];var y=rect[3]-vertices[i+1];points.push("".concat(x,",").concat(y));}points=points.join(" ");var polyline=_classPrivateFieldSet(_polyline,this,this.svgFactory.createElement(this.svgElementName));polyline.setAttribute("points",points);polyline.setAttribute("stroke-width",borderStyle.width||1);polyline.setAttribute("stroke","transparent");polyline.setAttribute("fill","transparent");svg.append(polyline);this.container.append(svg);if(!popupRef&&this.hasPopupData){this._createPopup();}return this.container;}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(_polyline,this);}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea");}}]);}(AnnotationElement);var PolygonAnnotationElement=/*#__PURE__*/function(_PolylineAnnotationEl){function PolygonAnnotationElement(parameters){var _this79;_classCallCheck(this,PolygonAnnotationElement);_this79=_callSuper(this,PolygonAnnotationElement,[parameters]);_this79.containerClassName="polygonAnnotation";_this79.svgElementName="svg:polygon";return _this79;}_inherits(PolygonAnnotationElement,_PolylineAnnotationEl);return _createClass(PolygonAnnotationElement);}(PolylineAnnotationElement);var CaretAnnotationElement=/*#__PURE__*/function(_AnnotationElement1){function CaretAnnotationElement(parameters){_classCallCheck(this,CaretAnnotationElement);return _callSuper(this,CaretAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);}_inherits(CaretAnnotationElement,_AnnotationElement1);return _createClass(CaretAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("caretAnnotation");if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}return this.container;}}]);}(AnnotationElement);var _polylinesGroupElement=/*#__PURE__*/new WeakMap();var _polylines=/*#__PURE__*/new WeakMap();var _InkAnnotationElement_brand=/*#__PURE__*/new WeakSet();var InkAnnotationElement=/*#__PURE__*/function(_AnnotationElement10){function InkAnnotationElement(parameters){var _this80;_classCallCheck(this,InkAnnotationElement);_this80=_callSuper(this,InkAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);_classPrivateMethodInitSpec(_this80,_InkAnnotationElement_brand);_classPrivateFieldInitSpec(_this80,_polylinesGroupElement,null);_classPrivateFieldInitSpec(_this80,_polylines,[]);_this80.containerClassName="inkAnnotation";_this80.svgElementName="svg:polyline";_this80.annotationEditorType=_this80.data.it==="InkHighlight"?_AnnotationEditorType.HIGHLIGHT:_AnnotationEditorType.INK;return _this80;}_inherits(InkAnnotationElement,_AnnotationElement10);return _createClass(InkAnnotationElement,[{key:"render",value:function render(){this.container.classList.add(this.containerClassName);var _this$data2=this.data,rect=_this$data2.rect,rotation=_this$data2.rotation,inkLists=_this$data2.inkLists,borderStyle=_this$data2.borderStyle,popupRef=_this$data2.popupRef;var _assertClassBrand$cal9=_assertClassBrand(_InkAnnotationElement_brand,this,_getTransform).call(this,rotation,rect),transform=_assertClassBrand$cal9.transform,width=_assertClassBrand$cal9.width,height=_assertClassBrand$cal9.height;var svg=this.svgFactory.create(width,height,true);var g=_classPrivateFieldSet(_polylinesGroupElement,this,this.svgFactory.createElement("svg:g"));svg.append(g);g.setAttribute("stroke-width",borderStyle.width||1);g.setAttribute("stroke-linecap","round");g.setAttribute("stroke-linejoin","round");g.setAttribute("stroke-miterlimit",10);g.setAttribute("stroke","transparent");g.setAttribute("fill","transparent");g.setAttribute("transform",transform);for(var i=0,ii=inkLists.length;i<ii;i++){var polyline=this.svgFactory.createElement(this.svgElementName);_classPrivateFieldGet(_polylines,this).push(polyline);polyline.setAttribute("points",inkLists[i].join(","));g.append(polyline);}if(!popupRef&&this.hasPopupData){this._createPopup();}this.container.append(svg);this._editOnDoubleClick();return this.container;}},{key:"updateEdited",value:function updateEdited(params){_superPropGet(InkAnnotationElement,"updateEdited",this,3)([params]);var thickness=params.thickness,points=params.points,rect=params.rect;var g=_classPrivateFieldGet(_polylinesGroupElement,this);if(thickness>=0){g.setAttribute("stroke-width",thickness||1);}if(points){for(var i=0,ii=_classPrivateFieldGet(_polylines,this).length;i<ii;i++){_classPrivateFieldGet(_polylines,this)[i].setAttribute("points",points[i].join(","));}}if(rect){var _assertClassBrand$cal0=_assertClassBrand(_InkAnnotationElement_brand,this,_getTransform).call(this,this.data.rotation,rect),transform=_assertClassBrand$cal0.transform,width=_assertClassBrand$cal0.width,height=_assertClassBrand$cal0.height;var root=g.parentElement;root.setAttribute("viewBox","0 0 ".concat(width," ").concat(height));g.setAttribute("transform",transform);}}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(_polylines,this);}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea");}}]);}(AnnotationElement);function _getTransform(rotation,rect){switch(rotation){case 90:return{transform:"rotate(90) translate(".concat(-rect[0],",").concat(rect[1],") scale(1,-1)"),width:rect[3]-rect[1],height:rect[2]-rect[0]};case 180:return{transform:"rotate(180) translate(".concat(-rect[2],",").concat(rect[1],") scale(1,-1)"),width:rect[2]-rect[0],height:rect[3]-rect[1]};case 270:return{transform:"rotate(270) translate(".concat(-rect[2],",").concat(rect[3],") scale(1,-1)"),width:rect[3]-rect[1],height:rect[2]-rect[0]};default:return{transform:"translate(".concat(-rect[0],",").concat(rect[3],") scale(1,-1)"),width:rect[2]-rect[0],height:rect[3]-rect[1]};}}var HighlightAnnotationElement=/*#__PURE__*/function(_AnnotationElement11){function HighlightAnnotationElement(parameters){var _this81;_classCallCheck(this,HighlightAnnotationElement);_this81=_callSuper(this,HighlightAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true}]);_this81.annotationEditorType=_AnnotationEditorType.HIGHLIGHT;return _this81;}_inherits(HighlightAnnotationElement,_AnnotationElement11);return _createClass(HighlightAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}this.container.classList.add("highlightAnnotation");this._editOnDoubleClick();return this.container;}}]);}(AnnotationElement);var UnderlineAnnotationElement=/*#__PURE__*/function(_AnnotationElement12){function UnderlineAnnotationElement(parameters){_classCallCheck(this,UnderlineAnnotationElement);return _callSuper(this,UnderlineAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true}]);}_inherits(UnderlineAnnotationElement,_AnnotationElement12);return _createClass(UnderlineAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}this.container.classList.add("underlineAnnotation");return this.container;}}]);}(AnnotationElement);var SquigglyAnnotationElement=/*#__PURE__*/function(_AnnotationElement13){function SquigglyAnnotationElement(parameters){_classCallCheck(this,SquigglyAnnotationElement);return _callSuper(this,SquigglyAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true}]);}_inherits(SquigglyAnnotationElement,_AnnotationElement13);return _createClass(SquigglyAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}this.container.classList.add("squigglyAnnotation");return this.container;}}]);}(AnnotationElement);var StrikeOutAnnotationElement=/*#__PURE__*/function(_AnnotationElement14){function StrikeOutAnnotationElement(parameters){_classCallCheck(this,StrikeOutAnnotationElement);return _callSuper(this,StrikeOutAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true}]);}_inherits(StrikeOutAnnotationElement,_AnnotationElement14);return _createClass(StrikeOutAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}this.container.classList.add("strikeoutAnnotation");return this.container;}}]);}(AnnotationElement);var StampAnnotationElement=/*#__PURE__*/function(_AnnotationElement15){function StampAnnotationElement(parameters){var _this82;_classCallCheck(this,StampAnnotationElement);_this82=_callSuper(this,StampAnnotationElement,[parameters,{isRenderable:true,ignoreBorder:true}]);_this82.annotationEditorType=_AnnotationEditorType.STAMP;return _this82;}_inherits(StampAnnotationElement,_AnnotationElement15);return _createClass(StampAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("stampAnnotation");this.container.setAttribute("role","img");if(!this.data.popupRef&&this.hasPopupData){this._createPopup();}this._editOnDoubleClick();return this.container;}}]);}(AnnotationElement);var _trigger=/*#__PURE__*/new WeakMap();var _FileAttachmentAnnotationElement_brand=/*#__PURE__*/new WeakSet();var FileAttachmentAnnotationElement=/*#__PURE__*/function(_AnnotationElement16){function FileAttachmentAnnotationElement(parameters){var _this83$linkService$e;var _this83;_classCallCheck(this,FileAttachmentAnnotationElement);_this83=_callSuper(this,FileAttachmentAnnotationElement,[parameters,{isRenderable:true}]);_classPrivateMethodInitSpec(_this83,_FileAttachmentAnnotationElement_brand);_classPrivateFieldInitSpec(_this83,_trigger,null);var file=_this83.data.file;_this83.filename=file.filename;_this83.content=file.content;(_this83$linkService$e=_this83.linkService.eventBus)===null||_this83$linkService$e===void 0||_this83$linkService$e.dispatch("fileattachmentannotation",_objectSpread({source:_this83},file));return _this83;}_inherits(FileAttachmentAnnotationElement,_AnnotationElement16);return _createClass(FileAttachmentAnnotationElement,[{key:"render",value:function render(){var _this84=this;this.container.classList.add("fileAttachmentAnnotation");var container=this.container,data=this.data;var trigger;if(data.hasAppearance||data.fillAlpha===0){trigger=document.createElement("div");}else{trigger=document.createElement("img");trigger.src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(data.name)?"paperclip":"pushpin",".svg");if(data.fillAlpha&&data.fillAlpha<1){trigger.style="filter: opacity(".concat(Math.round(data.fillAlpha*100),"%);");}}trigger.addEventListener("dblclick",_assertClassBrand(_FileAttachmentAnnotationElement_brand,this,_download).bind(this));_classPrivateFieldSet(_trigger,this,trigger);var isMac=util_FeatureTest.platform.isMac;container.addEventListener("keydown",function(evt){if(evt.key==="Enter"&&(isMac?evt.metaKey:evt.ctrlKey)){_assertClassBrand(_FileAttachmentAnnotationElement_brand,_this84,_download).call(_this84);}});if(!data.popupRef&&this.hasPopupData){this._createPopup();}else{trigger.classList.add("popupTriggerArea");}container.append(trigger);return container;}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(_trigger,this);}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea");}}]);}(AnnotationElement);function _download(){var _this$downloadManager;(_this$downloadManager=this.downloadManager)===null||_this$downloadManager===void 0||_this$downloadManager.openOrDownloadData(this.content,this.filename);}var _accessibilityManager=/*#__PURE__*/new WeakMap();var _annotationCanvasMap=/*#__PURE__*/new WeakMap();var _editableAnnotations=/*#__PURE__*/new WeakMap();var _structTreeLayer=/*#__PURE__*/new WeakMap();var _AnnotationLayer_brand=/*#__PURE__*/new WeakSet();var _AnnotationLayer=/*#__PURE__*/function(){function _AnnotationLayer(_ref94){var div=_ref94.div,accessibilityManager=_ref94.accessibilityManager,annotationCanvasMap=_ref94.annotationCanvasMap,annotationEditorUIManager=_ref94.annotationEditorUIManager,page=_ref94.page,viewport=_ref94.viewport,structTreeLayer=_ref94.structTreeLayer;_classCallCheck(this,_AnnotationLayer);_classPrivateMethodInitSpec(this,_AnnotationLayer_brand);_classPrivateFieldInitSpec(this,_accessibilityManager,null);_classPrivateFieldInitSpec(this,_annotationCanvasMap,null);_classPrivateFieldInitSpec(this,_editableAnnotations,new Map());_classPrivateFieldInitSpec(this,_structTreeLayer,null);this.div=div;_classPrivateFieldSet(_accessibilityManager,this,accessibilityManager);_classPrivateFieldSet(_annotationCanvasMap,this,annotationCanvasMap);_classPrivateFieldSet(_structTreeLayer,this,structTreeLayer||null);this.page=page;this.viewport=viewport;this.zIndex=0;this._annotationEditorUIManager=annotationEditorUIManager;}return _createClass(_AnnotationLayer,[{key:"hasEditableAnnotations",value:function hasEditableAnnotations(){return _classPrivateFieldGet(_editableAnnotations,this).size>0;}},{key:"render",value:function(){var _render3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee43(params){var annotations,layer,popupToElements,elementParams,_iterator133,_step133,data,isPopupAnnotation,elements,element,_elements2,rendered,_this$_annotationEdit,_t18;return _regenerator().w(function(_context44){while(1)switch(_context44.n){case 0:annotations=params.annotations;layer=this.div;_setLayerDimensions(layer,this.viewport);popupToElements=new Map();elementParams={data:null,layer:layer,linkService:params.linkService,downloadManager:params.downloadManager,imageResourcesPath:params.imageResourcesPath||"",renderForms:params.renderForms!==false,svgFactory:new _DOMSVGFactory(),annotationStorage:params.annotationStorage||new AnnotationStorage(),enableScripting:params.enableScripting===true,hasJSActions:params.hasJSActions,fieldObjects:params.fieldObjects,parent:this,elements:null};_iterator133=_createForOfIteratorHelper(annotations);_context44.p=1;_iterator133.s();case 2:if((_step133=_iterator133.n()).done){_context44.n=11;break;}data=_step133.value;if(!data.noHTML){_context44.n=3;break;}return _context44.a(3,10);case 3:isPopupAnnotation=data.annotationType===_AnnotationType.POPUP;if(isPopupAnnotation){_context44.n=5;break;}if(!(data.rect[2]===data.rect[0]||data.rect[3]===data.rect[1])){_context44.n=4;break;}return _context44.a(3,10);case 4:_context44.n=7;break;case 5:elements=popupToElements.get(data.id);if(elements){_context44.n=6;break;}return _context44.a(3,10);case 6:elementParams.elements=elements;case 7:elementParams.data=data;element=AnnotationElementFactory.create(elementParams);if(element.isRenderable){_context44.n=8;break;}return _context44.a(3,10);case 8:if(!isPopupAnnotation&&data.popupRef){_elements2=popupToElements.get(data.popupRef);if(!_elements2){popupToElements.set(data.popupRef,[element]);}else{_elements2.push(element);}}rendered=element.render();if(data.hidden){rendered.style.visibility="hidden";}_context44.n=9;return _assertClassBrand(_AnnotationLayer_brand,this,_appendElement).call(this,rendered,data.id);case 9:if(element._isEditable){_classPrivateFieldGet(_editableAnnotations,this).set(element.data.id,element);(_this$_annotationEdit=this._annotationEditorUIManager)===null||_this$_annotationEdit===void 0||_this$_annotationEdit.renderAnnotationElement(element);}case 10:_context44.n=2;break;case 11:_context44.n=13;break;case 12:_context44.p=12;_t18=_context44.v;_iterator133.e(_t18);case 13:_context44.p=13;_iterator133.f();return _context44.f(13);case 14:_assertClassBrand(_AnnotationLayer_brand,this,_setAnnotationCanvasMap).call(this);case 15:return _context44.a(2);}},_callee43,this,[[1,12,13,14]]);}));function render(_x33){return _render3.apply(this,arguments);}return render;}()},{key:"addLinkAnnotations",value:function(){var _addLinkAnnotations=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee44(annotations,linkService){var elementParams,_iterator134,_step134,data,element,rendered,_t19;return _regenerator().w(function(_context45){while(1)switch(_context45.n){case 0:elementParams={data:null,layer:this.div,linkService:linkService,svgFactory:new _DOMSVGFactory(),parent:this};_iterator134=_createForOfIteratorHelper(annotations);_context45.p=1;_iterator134.s();case 2:if((_step134=_iterator134.n()).done){_context45.n=5;break;}data=_step134.value;data.borderStyle||(data.borderStyle=_AnnotationLayer._defaultBorderStyle);elementParams.data=data;element=AnnotationElementFactory.create(elementParams);if(element.isRenderable){_context45.n=3;break;}return _context45.a(3,4);case 3:rendered=element.render();_context45.n=4;return _assertClassBrand(_AnnotationLayer_brand,this,_appendElement).call(this,rendered,data.id);case 4:_context45.n=2;break;case 5:_context45.n=7;break;case 6:_context45.p=6;_t19=_context45.v;_iterator134.e(_t19);case 7:_context45.p=7;_iterator134.f();return _context45.f(7);case 8:return _context45.a(2);}},_callee44,this,[[1,6,7,8]]);}));function addLinkAnnotations(_x34,_x35){return _addLinkAnnotations.apply(this,arguments);}return addLinkAnnotations;}()},{key:"update",value:function update(_ref95){var viewport=_ref95.viewport;var layer=this.div;this.viewport=viewport;_setLayerDimensions(layer,{rotation:viewport.rotation});_assertClassBrand(_AnnotationLayer_brand,this,_setAnnotationCanvasMap).call(this);layer.hidden=false;}},{key:"getEditableAnnotations",value:function getEditableAnnotations(){return Array.from(_classPrivateFieldGet(_editableAnnotations,this).values());}},{key:"getEditableAnnotation",value:function getEditableAnnotation(id){return _classPrivateFieldGet(_editableAnnotations,this).get(id);}}],[{key:"_defaultBorderStyle",get:function get(){return _shadow(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:AnnotationBorderStyleType.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}));}}]);}();function _appendElement(_x67,_x68){return _appendElement2.apply(this,arguments);}function _appendElement2(){_appendElement2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee68(element,id){var _classPrivateFieldGet182,_classPrivateFieldGet183;var contentElement,annotationId,ariaAttributes,_iterator195,_step195,_step195$value,key,value;return _regenerator().w(function(_context69){while(1)switch(_context69.n){case 0:contentElement=element.firstChild||element;annotationId=contentElement.id="".concat(AnnotationPrefix).concat(id);_context69.n=1;return(_classPrivateFieldGet182=_classPrivateFieldGet(_structTreeLayer,this))===null||_classPrivateFieldGet182===void 0?void 0:_classPrivateFieldGet182.getAriaAttributes(annotationId);case 1:ariaAttributes=_context69.v;if(ariaAttributes){_iterator195=_createForOfIteratorHelper(ariaAttributes);try{for(_iterator195.s();!(_step195=_iterator195.n()).done;){_step195$value=_slicedToArray(_step195.value,2),key=_step195$value[0],value=_step195$value[1];contentElement.setAttribute(key,value);}}catch(err){_iterator195.e(err);}finally{_iterator195.f();}}this.div.append(element);(_classPrivateFieldGet183=_classPrivateFieldGet(_accessibilityManager,this))===null||_classPrivateFieldGet183===void 0||_classPrivateFieldGet183.moveElementInDOM(this.div,element,contentElement,false);case 2:return _context69.a(2);}},_callee68,this);}));return _appendElement2.apply(this,arguments);}function _setAnnotationCanvasMap(){if(!_classPrivateFieldGet(_annotationCanvasMap,this)){return;}var layer=this.div;var _iterator183=_createForOfIteratorHelper(_classPrivateFieldGet(_annotationCanvasMap,this)),_step183;try{for(_iterator183.s();!(_step183=_iterator183.n()).done;){var _step183$value=_slicedToArray(_step183.value,2),id=_step183$value[0],canvas=_step183$value[1];var element=layer.querySelector("[data-annotation-id=\"".concat(id,"\"]"));if(!element){continue;}canvas.className="annotationContent";var firstChild=element.firstChild;if(!firstChild){element.append(canvas);}else if(firstChild.nodeName==="CANVAS"){firstChild.replaceWith(canvas);}else if(!firstChild.classList.contains("annotationContent")){firstChild.before(canvas);}else{firstChild.after(canvas);}var editableAnnotation=_classPrivateFieldGet(_editableAnnotations,this).get(id);if(!editableAnnotation){continue;}if(editableAnnotation._hasNoCanvas){var _this$_annotationEdit2;(_this$_annotationEdit2=this._annotationEditorUIManager)===null||_this$_annotationEdit2===void 0||_this$_annotationEdit2.setMissingCanvas(id,element.id,canvas);editableAnnotation._hasNoCanvas=false;}else{editableAnnotation.canvas=canvas;}}}catch(err){_iterator183.e(err);}finally{_iterator183.f();}_classPrivateFieldGet(_annotationCanvasMap,this).clear();};// ./src/display/editor/freetext.js
var EOL_PATTERN=/\r\n?|\n/g;var _color2=/*#__PURE__*/new WeakMap();var _content=/*#__PURE__*/new WeakMap();var _editorDivId=/*#__PURE__*/new WeakMap();var _editModeAC=/*#__PURE__*/new WeakMap();var _fontSize=/*#__PURE__*/new WeakMap();var _FreeTextEditor_brand=/*#__PURE__*/new WeakSet();var FreeTextEditor=/*#__PURE__*/function(_AnnotationEditor3){function FreeTextEditor(params){var _this85;_classCallCheck(this,FreeTextEditor);_this85=_callSuper(this,FreeTextEditor,[_objectSpread(_objectSpread({},params),{},{name:"freeTextEditor"})]);_classPrivateMethodInitSpec(_this85,_FreeTextEditor_brand);_classPrivateFieldInitSpec(_this85,_color2,void 0);_classPrivateFieldInitSpec(_this85,_content,"");_classPrivateFieldInitSpec(_this85,_editorDivId,"".concat(_this85.id,"-editor"));_classPrivateFieldInitSpec(_this85,_editModeAC,null);_classPrivateFieldInitSpec(_this85,_fontSize,void 0);_classPrivateFieldSet(_color2,_this85,params.color||FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor);_classPrivateFieldSet(_fontSize,_this85,params.fontSize||FreeTextEditor._defaultFontSize);return _this85;}_inherits(FreeTextEditor,_AnnotationEditor3);return _createClass(FreeTextEditor,[{key:"updateParams",value:function updateParams(type,value){switch(type){case _AnnotationEditorParamsType.FREETEXT_SIZE:_assertClassBrand(_FreeTextEditor_brand,this,_updateFontSize).call(this,value);break;case _AnnotationEditorParamsType.FREETEXT_COLOR:_assertClassBrand(_FreeTextEditor_brand,this,_updateColor).call(this,value);break;}}},{key:"propertiesToUpdate",get:function get(){return[[_AnnotationEditorParamsType.FREETEXT_SIZE,_classPrivateFieldGet(_fontSize,this)],[_AnnotationEditorParamsType.FREETEXT_COLOR,_classPrivateFieldGet(_color2,this)]];}},{key:"_translateEmpty",value:function _translateEmpty(x,y){this._uiManager.translateSelectedEditors(x,y,true);}},{key:"getInitialTranslation",value:function getInitialTranslation(){var scale=this.parentScale;return[-FreeTextEditor._internalPadding*scale,-(FreeTextEditor._internalPadding+_classPrivateFieldGet(_fontSize,this))*scale];}},{key:"rebuild",value:function rebuild(){if(!this.parent){return;}_superPropGet(FreeTextEditor,"rebuild",this,3)([]);if(this.div===null){return;}if(!this.isAttachedToDOM){this.parent.add(this);}}},{key:"enableEditMode",value:function enableEditMode(){if(this.isInEditMode()){return;}this.parent.setEditingState(false);this.parent.updateToolbar(_AnnotationEditorType.FREETEXT);_superPropGet(FreeTextEditor,"enableEditMode",this,3)([]);this.overlayDiv.classList.remove("enabled");this.editorDiv.contentEditable=true;this._isDraggable=false;this.div.removeAttribute("aria-activedescendant");_classPrivateFieldSet(_editModeAC,this,new AbortController());var signal=this._uiManager.combinedSignal(_classPrivateFieldGet(_editModeAC,this));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:signal});this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:signal});this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:signal});this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:signal});this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:signal});}},{key:"disableEditMode",value:function disableEditMode(){var _classPrivateFieldGet68;if(!this.isInEditMode()){return;}this.parent.setEditingState(true);_superPropGet(FreeTextEditor,"disableEditMode",this,3)([]);this.overlayDiv.classList.add("enabled");this.editorDiv.contentEditable=false;this.div.setAttribute("aria-activedescendant",_classPrivateFieldGet(_editorDivId,this));this._isDraggable=true;(_classPrivateFieldGet68=_classPrivateFieldGet(_editModeAC,this))===null||_classPrivateFieldGet68===void 0||_classPrivateFieldGet68.abort();_classPrivateFieldSet(_editModeAC,this,null);this.div.focus({preventScroll:true});this.isEditing=false;this.parent.div.classList.add("freetextEditing");}},{key:"focusin",value:function focusin(event){if(!this._focusEventsAllowed){return;}_superPropGet(FreeTextEditor,"focusin",this,3)([event]);if(event.target!==this.editorDiv){this.editorDiv.focus();}}},{key:"onceAdded",value:function onceAdded(focus){var _this$_initialOptions;if(this.width){return;}this.enableEditMode();if(focus){this.editorDiv.focus();}if((_this$_initialOptions=this._initialOptions)!==null&&_this$_initialOptions!==void 0&&_this$_initialOptions.isCentered){this.center();}this._initialOptions=null;}},{key:"isEmpty",value:function isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()==="";}},{key:"remove",value:function remove(){this.isEditing=false;if(this.parent){this.parent.setEditingState(true);this.parent.div.classList.add("freetextEditing");}_superPropGet(FreeTextEditor,"remove",this,3)([]);}},{key:"commit",value:function commit(){var _this86=this;if(!this.isInEditMode()){return;}_superPropGet(FreeTextEditor,"commit",this,3)([]);this.disableEditMode();var savedText=_classPrivateFieldGet(_content,this);var newText=_classPrivateFieldSet(_content,this,_assertClassBrand(_FreeTextEditor_brand,this,_extractText).call(this).trimEnd());if(savedText===newText){return;}var setText=function setText(text){_classPrivateFieldSet(_content,_this86,text);if(!text){_this86.remove();return;}_assertClassBrand(_FreeTextEditor_brand,_this86,_setContent).call(_this86);_this86._uiManager.rebuild(_this86);_assertClassBrand(_FreeTextEditor_brand,_this86,_setEditorDimensions).call(_this86);};this.addCommands({cmd:function cmd(){setText(newText);},undo:function undo(){setText(savedText);},mustExec:false});_assertClassBrand(_FreeTextEditor_brand,this,_setEditorDimensions).call(this);}},{key:"shouldGetKeyboardEvents",value:function shouldGetKeyboardEvents(){return this.isInEditMode();}},{key:"enterInEditMode",value:function enterInEditMode(){this.enableEditMode();this.editorDiv.focus();}},{key:"dblclick",value:function dblclick(event){this.enterInEditMode();}},{key:"keydown",value:function keydown(event){if(event.target===this.div&&event.key==="Enter"){this.enterInEditMode();event.preventDefault();}}},{key:"editorDivKeydown",value:function editorDivKeydown(event){FreeTextEditor._keyboardManager.exec(this,event);}},{key:"editorDivFocus",value:function editorDivFocus(event){this.isEditing=true;}},{key:"editorDivBlur",value:function editorDivBlur(event){this.isEditing=false;}},{key:"editorDivInput",value:function editorDivInput(event){this.parent.div.classList.toggle("freetextEditing",this.isEmpty());}},{key:"disableEditing",value:function disableEditing(){this.editorDiv.setAttribute("role","comment");this.editorDiv.removeAttribute("aria-multiline");}},{key:"enableEditing",value:function enableEditing(){this.editorDiv.setAttribute("role","textbox");this.editorDiv.setAttribute("aria-multiline",true);}},{key:"render",value:function render(){if(this.div){return this.div;}var baseX,baseY;if(this._isCopy||this.annotationElementId){baseX=this.x;baseY=this.y;}_superPropGet(FreeTextEditor,"render",this,3)([]);this.editorDiv=document.createElement("div");this.editorDiv.className="internal";this.editorDiv.setAttribute("id",_classPrivateFieldGet(_editorDivId,this));this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2");this.editorDiv.setAttribute("data-l10n-attrs","default-content");this.enableEditing();this.editorDiv.contentEditable=true;var style=this.editorDiv.style;style.fontSize="calc(".concat(_classPrivateFieldGet(_fontSize,this),"px * var(--total-scale-factor))");style.color=_classPrivateFieldGet(_color2,this);this.div.append(this.editorDiv);this.overlayDiv=document.createElement("div");this.overlayDiv.classList.add("overlay","enabled");this.div.append(this.overlayDiv);bindEvents(this,this.div,["dblclick","keydown"]);if(this._isCopy||this.annotationElementId){var _this$parentDimension9=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension9[0],parentHeight=_this$parentDimension9[1];if(this.annotationElementId){var position=this._initialData.position;var _this$getInitialTrans3=this.getInitialTranslation(),_this$getInitialTrans4=_slicedToArray(_this$getInitialTrans3,2),tx=_this$getInitialTrans4[0],ty=_this$getInitialTrans4[1];var _this$pageTranslation2=this.pageTranslationToScreen(tx,ty);var _this$pageTranslation3=_slicedToArray(_this$pageTranslation2,2);tx=_this$pageTranslation3[0];ty=_this$pageTranslation3[1];var _this$pageDimensions5=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions5[0],pageHeight=_this$pageDimensions5[1];var _this$pageTranslation4=_slicedToArray(this.pageTranslation,2),pageX=_this$pageTranslation4[0],pageY=_this$pageTranslation4[1];var posX,posY;switch(this.rotation){case 0:posX=baseX+(position[0]-pageX)/pageWidth;posY=baseY+this.height-(position[1]-pageY)/pageHeight;break;case 90:posX=baseX+(position[0]-pageX)/pageWidth;posY=baseY-(position[1]-pageY)/pageHeight;var _ref96=[ty,-tx];tx=_ref96[0];ty=_ref96[1];break;case 180:posX=baseX-this.width+(position[0]-pageX)/pageWidth;posY=baseY-(position[1]-pageY)/pageHeight;var _ref97=[-tx,-ty];tx=_ref97[0];ty=_ref97[1];break;case 270:posX=baseX+(position[0]-pageX-this.height*pageHeight)/pageWidth;posY=baseY+(position[1]-pageY-this.width*pageWidth)/pageHeight;var _ref98=[-ty,tx];tx=_ref98[0];ty=_ref98[1];break;}this.setAt(posX*parentWidth,posY*parentHeight,tx,ty);}else{this._moveAfterPaste(baseX,baseY);}_assertClassBrand(_FreeTextEditor_brand,this,_setContent).call(this);this._isDraggable=true;this.editorDiv.contentEditable=false;}else{this._isDraggable=false;this.editorDiv.contentEditable=true;}return this.div;}},{key:"editorDivPaste",value:function editorDivPaste(event){var clipboardData=event.clipboardData||window.clipboardData;var types=clipboardData.types;if(types.length===1&&types[0]==="text/plain"){return;}event.preventDefault();var paste=_deserializeContent.call(FreeTextEditor,clipboardData.getData("text")||"").replaceAll(EOL_PATTERN,"\n");if(!paste){return;}var selection=window.getSelection();if(!selection.rangeCount){return;}this.editorDiv.normalize();selection.deleteFromDocument();var range=selection.getRangeAt(0);if(!paste.includes("\n")){range.insertNode(document.createTextNode(paste));this.editorDiv.normalize();selection.collapseToStart();return;}var startContainer=range.startContainer,startOffset=range.startOffset;var bufferBefore=[];var bufferAfter=[];if(startContainer.nodeType===Node.TEXT_NODE){var parent=startContainer.parentElement;bufferAfter.push(startContainer.nodeValue.slice(startOffset).replaceAll(EOL_PATTERN,""));if(parent!==this.editorDiv){var buffer=bufferBefore;var _iterator135=_createForOfIteratorHelper(this.editorDiv.childNodes),_step135;try{for(_iterator135.s();!(_step135=_iterator135.n()).done;){var child=_step135.value;if(child===parent){buffer=bufferAfter;continue;}buffer.push(_getNodeContent.call(FreeTextEditor,child));}}catch(err){_iterator135.e(err);}finally{_iterator135.f();}}bufferBefore.push(startContainer.nodeValue.slice(0,startOffset).replaceAll(EOL_PATTERN,""));}else if(startContainer===this.editorDiv){var _buffer=bufferBefore;var i=0;var _iterator136=_createForOfIteratorHelper(this.editorDiv.childNodes),_step136;try{for(_iterator136.s();!(_step136=_iterator136.n()).done;){var _child=_step136.value;if(i++===startOffset){_buffer=bufferAfter;}_buffer.push(_getNodeContent.call(FreeTextEditor,_child));}}catch(err){_iterator136.e(err);}finally{_iterator136.f();}}_classPrivateFieldSet(_content,this,"".concat(bufferBefore.join("\n")).concat(paste).concat(bufferAfter.join("\n")));_assertClassBrand(_FreeTextEditor_brand,this,_setContent).call(this);var newRange=new Range();var beforeLength=Math.sumPrecise(bufferBefore.map(function(line){return line.length;}));var _iterator137=_createForOfIteratorHelper(this.editorDiv.childNodes),_step137;try{for(_iterator137.s();!(_step137=_iterator137.n()).done;){var firstChild=_step137.value.firstChild;if(firstChild.nodeType===Node.TEXT_NODE){var length=firstChild.nodeValue.length;if(beforeLength<=length){newRange.setStart(firstChild,beforeLength);newRange.setEnd(firstChild,beforeLength);break;}beforeLength-=length;}}}catch(err){_iterator137.e(err);}finally{_iterator137.f();}selection.removeAllRanges();selection.addRange(newRange);}},{key:"contentDiv",get:function get(){return this.editorDiv;}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isEmpty()){return null;}if(this.deleted){return this.serializeDeleted();}var padding=FreeTextEditor._internalPadding*this.parentScale;var rect=this.getRect(padding,padding);var color=AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:_classPrivateFieldGet(_color2,this));var serialized={annotationType:_AnnotationEditorType.FREETEXT,color:color,fontSize:_classPrivateFieldGet(_fontSize,this),value:_assertClassBrand(_FreeTextEditor_brand,this,_serializeContent).call(this),pageIndex:this.pageIndex,rect:rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(isForCopying){serialized.isCopy=true;return serialized;}if(this.annotationElementId&&!_assertClassBrand(_FreeTextEditor_brand,this,_hasElementChanged).call(this,serialized)){return null;}serialized.id=this.annotationElementId;return serialized;}},{key:"renderAnnotationElement",value:function renderAnnotationElement(annotation){var content=_superPropGet(FreeTextEditor,"renderAnnotationElement",this,3)([annotation]);if(this.deleted){return content;}var style=content.style;style.fontSize="calc(".concat(_classPrivateFieldGet(_fontSize,this),"px * var(--total-scale-factor))");style.color=_classPrivateFieldGet(_color2,this);content.replaceChildren();var _iterator138=_createForOfIteratorHelper(_classPrivateFieldGet(_content,this).split("\n")),_step138;try{for(_iterator138.s();!(_step138=_iterator138.n()).done;){var line=_step138.value;var div=document.createElement("div");div.append(line?document.createTextNode(line):document.createElement("br"));content.append(div);}}catch(err){_iterator138.e(err);}finally{_iterator138.f();}var padding=FreeTextEditor._internalPadding*this.parentScale;annotation.updateEdited({rect:this.getRect(padding,padding),popupContent:_classPrivateFieldGet(_content,this)});return content;}},{key:"resetAnnotationElement",value:function resetAnnotationElement(annotation){_superPropGet(FreeTextEditor,"resetAnnotationElement",this,3)([annotation]);annotation.resetEdited();}}],[{key:"_keyboardManager",get:function get(){var proto=FreeTextEditor.prototype;var arrowChecker=function arrowChecker(self){return self.isEmpty();};var small=_AnnotationEditorUIManager.TRANSLATE_SMALL;var big=_AnnotationEditorUIManager.TRANSLATE_BIG;return _shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],proto.commitOrRemove,{bubbles:true}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],proto.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],proto._translateEmpty,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto._translateEmpty,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto._translateEmpty,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto._translateEmpty,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto._translateEmpty,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto._translateEmpty,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto._translateEmpty,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto._translateEmpty,{args:[0,big],checker:arrowChecker}]]));}},{key:"initialize",value:function initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager);var style=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(style.getPropertyValue("--freetext-padding"));}},{key:"updateDefaultParams",value:function updateDefaultParams(type,value){switch(type){case _AnnotationEditorParamsType.FREETEXT_SIZE:FreeTextEditor._defaultFontSize=value;break;case _AnnotationEditorParamsType.FREETEXT_COLOR:FreeTextEditor._defaultColor=value;break;}}},{key:"defaultPropertiesToUpdate",get:function get(){return[[_AnnotationEditorParamsType.FREETEXT_SIZE,FreeTextEditor._defaultFontSize],[_AnnotationEditorParamsType.FREETEXT_COLOR,FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor]];}},{key:"deserialize",value:function(){var _deserialize2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee45(data,parent,uiManager){var initialData,_data5,_data5$data,_data5$data$defaultAp,fontSize,fontColor,rect,rotation,id,popupRef,textContent,textPosition,pageNumber,editor;return _regenerator().w(function(_context46){while(1)switch(_context46.n){case 0:initialData=null;if(!(data instanceof FreeTextAnnotationElement)){_context46.n=2;break;}_data5=data,_data5$data=_data5.data,_data5$data$defaultAp=_data5$data.defaultAppearanceData,fontSize=_data5$data$defaultAp.fontSize,fontColor=_data5$data$defaultAp.fontColor,rect=_data5$data.rect,rotation=_data5$data.rotation,id=_data5$data.id,popupRef=_data5$data.popupRef,textContent=_data5.textContent,textPosition=_data5.textPosition,pageNumber=_data5.parent.page.pageNumber;if(!(!textContent||textContent.length===0)){_context46.n=1;break;}return _context46.a(2,null);case 1:initialData=data={annotationType:_AnnotationEditorType.FREETEXT,color:Array.from(fontColor),fontSize:fontSize,value:textContent.join("\n"),position:textPosition,pageIndex:pageNumber-1,rect:rect.slice(0),rotation:rotation,id:id,deleted:false,popupRef:popupRef};case 2:_context46.n=3;return _superPropGet(FreeTextEditor,"deserialize",this,2)([data,parent,uiManager]);case 3:editor=_context46.v;_classPrivateFieldSet(_fontSize,editor,data.fontSize);_classPrivateFieldSet(_color2,editor,_Util.makeHexColor.apply(_Util,_toConsumableArray(data.color)));_classPrivateFieldSet(_content,editor,_deserializeContent.call(FreeTextEditor,data.value));editor.annotationElementId=data.id||null;editor._initialData=initialData;return _context46.a(2,editor);}},_callee45,this);}));function deserialize(_x36,_x37,_x38){return _deserialize2.apply(this,arguments);}return deserialize;}()}]);}(AnnotationEditor);_FreeTextEditor=FreeTextEditor;function _updateFontSize(fontSize){var _this115=this;var setFontsize=function setFontsize(size){_this115.editorDiv.style.fontSize="calc(".concat(size,"px * var(--total-scale-factor))");_this115.translate(0,-(size-_classPrivateFieldGet(_fontSize,_this115))*_this115.parentScale);_classPrivateFieldSet(_fontSize,_this115,size);_assertClassBrand(_FreeTextEditor_brand,_this115,_setEditorDimensions).call(_this115);};var savedFontsize=_classPrivateFieldGet(_fontSize,this);this.addCommands({cmd:setFontsize.bind(this,fontSize),undo:setFontsize.bind(this,savedFontsize),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:_AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:true,keepUndo:true});}function _updateColor(color){var _this116=this;var setColor=function setColor(col){_classPrivateFieldSet(_color2,_this116,_this116.editorDiv.style.color=col);};var savedColor=_classPrivateFieldGet(_color2,this);this.addCommands({cmd:setColor.bind(this,color),undo:setColor.bind(this,savedColor),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:_AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:true,keepUndo:true});}function _extractText(){var buffer=[];this.editorDiv.normalize();var prevChild=null;var _iterator184=_createForOfIteratorHelper(this.editorDiv.childNodes),_step184;try{for(_iterator184.s();!(_step184=_iterator184.n()).done;){var _prevChild;var child=_step184.value;if(((_prevChild=prevChild)===null||_prevChild===void 0?void 0:_prevChild.nodeType)===Node.TEXT_NODE&&child.nodeName==="BR"){continue;}buffer.push(_getNodeContent.call(_FreeTextEditor,child));prevChild=child;}}catch(err){_iterator184.e(err);}finally{_iterator184.f();}return buffer.join("\n");}function _setEditorDimensions(){var _this$parentDimension14=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension14[0],parentHeight=_this$parentDimension14[1];var rect;if(this.isAttachedToDOM){rect=this.div.getBoundingClientRect();}else{var currentLayer=this.currentLayer,div=this.div;var savedDisplay=div.style.display;var savedVisibility=div.classList.contains("hidden");div.classList.remove("hidden");div.style.display="hidden";currentLayer.div.append(this.div);rect=div.getBoundingClientRect();div.remove();div.style.display=savedDisplay;div.classList.toggle("hidden",savedVisibility);}if(this.rotation%180===this.parentRotation%180){this.width=rect.width/parentWidth;this.height=rect.height/parentHeight;}else{this.width=rect.height/parentWidth;this.height=rect.width/parentHeight;}this.fixAndSetPosition();}function _getNodeContent(node){return(node.nodeType===Node.TEXT_NODE?node.nodeValue:node.innerText).replaceAll(EOL_PATTERN,"");}function _setContent(){this.editorDiv.replaceChildren();if(!_classPrivateFieldGet(_content,this)){return;}var _iterator185=_createForOfIteratorHelper(_classPrivateFieldGet(_content,this).split("\n")),_step185;try{for(_iterator185.s();!(_step185=_iterator185.n()).done;){var line=_step185.value;var div=document.createElement("div");div.append(line?document.createTextNode(line):document.createElement("br"));this.editorDiv.append(div);}}catch(err){_iterator185.e(err);}finally{_iterator185.f();}}function _serializeContent(){return _classPrivateFieldGet(_content,this).replaceAll("\xa0"," ");}function _deserializeContent(content){return content.replaceAll(" ","\xa0");}function _hasElementChanged(serialized){var _this$_initialData2=this._initialData,value=_this$_initialData2.value,fontSize=_this$_initialData2.fontSize,color=_this$_initialData2.color,pageIndex=_this$_initialData2.pageIndex;return this._hasBeenMoved||serialized.value!==value||serialized.fontSize!==fontSize||serialized.color.some(function(c,i){return c!==color[i];})||serialized.pageIndex!==pageIndex;}_defineProperty(FreeTextEditor,"_freeTextDefaultContent","");_defineProperty(FreeTextEditor,"_internalPadding",0);_defineProperty(FreeTextEditor,"_defaultColor",null);_defineProperty(FreeTextEditor,"_defaultFontSize",10);_defineProperty(FreeTextEditor,"_type","freetext");_defineProperty(FreeTextEditor,"_editorType",_AnnotationEditorType.FREETEXT);;// ./src/display/editor/drawers/outline.js
var Outline=/*#__PURE__*/function(){function Outline(){_classCallCheck(this,Outline);}return _createClass(Outline,[{key:"toSVGPath",value:function toSVGPath(){unreachable("Abstract method `toSVGPath` must be implemented.");}},{key:"box",get:function get(){unreachable("Abstract getter `box` must be implemented.");}},{key:"serialize",value:function serialize(_bbox,_rotation){unreachable("Abstract method `serialize` must be implemented.");}}],[{key:"_rescale",value:function _rescale(src,tx,ty,sx,sy,dest){dest||(dest=new Float32Array(src.length));for(var i=0,ii=src.length;i<ii;i+=2){dest[i]=tx+src[i]*sx;dest[i+1]=ty+src[i+1]*sy;}return dest;}},{key:"_rescaleAndSwap",value:function _rescaleAndSwap(src,tx,ty,sx,sy,dest){dest||(dest=new Float32Array(src.length));for(var i=0,ii=src.length;i<ii;i+=2){dest[i]=tx+src[i+1]*sx;dest[i+1]=ty+src[i]*sy;}return dest;}},{key:"_translate",value:function _translate(src,tx,ty,dest){dest||(dest=new Float32Array(src.length));for(var i=0,ii=src.length;i<ii;i+=2){dest[i]=tx+src[i];dest[i+1]=ty+src[i+1];}return dest;}},{key:"svgRound",value:function svgRound(x){return Math.round(x*10000);}},{key:"_normalizePoint",value:function _normalizePoint(x,y,parentWidth,parentHeight,rotation){switch(rotation){case 90:return[1-y/parentWidth,x/parentHeight];case 180:return[1-x/parentWidth,1-y/parentHeight];case 270:return[y/parentWidth,1-x/parentHeight];default:return[x/parentWidth,y/parentHeight];}}},{key:"_normalizePagePoint",value:function _normalizePagePoint(x,y,rotation){switch(rotation){case 90:return[1-y,x];case 180:return[1-x,1-y];case 270:return[y,1-x];default:return[x,y];}}},{key:"createBezierPoints",value:function createBezierPoints(x1,y1,x2,y2,x3,y3){return[(x1+5*x2)/6,(y1+5*y2)/6,(5*x2+x3)/6,(5*y2+y3)/6,(x2+x3)/2,(y2+y3)/2];}}]);}();_defineProperty(Outline,"PRECISION",1e-4);;// ./src/display/editor/drawers/freedraw.js
var _box=/*#__PURE__*/new WeakMap();var _bottom=/*#__PURE__*/new WeakMap();var _innerMargin=/*#__PURE__*/new WeakMap();var _isLTR2=/*#__PURE__*/new WeakMap();var _top=/*#__PURE__*/new WeakMap();var _last=/*#__PURE__*/new WeakMap();var _lastX=/*#__PURE__*/new WeakMap();var _lastY=/*#__PURE__*/new WeakMap();var _min=/*#__PURE__*/new WeakMap();var _min_dist=/*#__PURE__*/new WeakMap();var _scaleFactor=/*#__PURE__*/new WeakMap();var _thickness=/*#__PURE__*/new WeakMap();var _points=/*#__PURE__*/new WeakMap();var _FreeDrawOutliner_brand=/*#__PURE__*/new WeakSet();var FreeDrawOutliner=/*#__PURE__*/function(){function FreeDrawOutliner(_ref99,box,scaleFactor,thickness,isLTR){var _x39=_ref99.x,_y3=_ref99.y;var innerMargin=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;_classCallCheck(this,FreeDrawOutliner);_classPrivateMethodInitSpec(this,_FreeDrawOutliner_brand);_classPrivateFieldInitSpec(this,_box,void 0);_classPrivateFieldInitSpec(this,_bottom,[]);_classPrivateFieldInitSpec(this,_innerMargin,void 0);_classPrivateFieldInitSpec(this,_isLTR2,void 0);_classPrivateFieldInitSpec(this,_top,[]);_classPrivateFieldInitSpec(this,_last,new Float32Array(18));_classPrivateFieldInitSpec(this,_lastX,void 0);_classPrivateFieldInitSpec(this,_lastY,void 0);_classPrivateFieldInitSpec(this,_min,void 0);_classPrivateFieldInitSpec(this,_min_dist,void 0);_classPrivateFieldInitSpec(this,_scaleFactor,void 0);_classPrivateFieldInitSpec(this,_thickness,void 0);_classPrivateFieldInitSpec(this,_points,[]);_classPrivateFieldSet(_box,this,box);_classPrivateFieldSet(_thickness,this,thickness*scaleFactor);_classPrivateFieldSet(_isLTR2,this,isLTR);_classPrivateFieldGet(_last,this).set([NaN,NaN,NaN,NaN,_x39,_y3],6);_classPrivateFieldSet(_innerMargin,this,innerMargin);_classPrivateFieldSet(_min_dist,this,_MIN_DIST._*scaleFactor);_classPrivateFieldSet(_min,this,_MIN._*scaleFactor);_classPrivateFieldSet(_scaleFactor,this,scaleFactor);_classPrivateFieldGet(_points,this).push(_x39,_y3);}return _createClass(FreeDrawOutliner,[{key:"isEmpty",value:function isEmpty(){return isNaN(_classPrivateFieldGet(_last,this)[8]);}},{key:"add",value:function add(_ref100){var _classPrivateFieldGet73;var x=_ref100.x,y=_ref100.y;_classPrivateFieldSet(_lastX,this,x);_classPrivateFieldSet(_lastY,this,y);var _classPrivateFieldGet69=_classPrivateFieldGet(_box,this),_classPrivateFieldGet70=_slicedToArray(_classPrivateFieldGet69,4),layerX=_classPrivateFieldGet70[0],layerY=_classPrivateFieldGet70[1],layerWidth=_classPrivateFieldGet70[2],layerHeight=_classPrivateFieldGet70[3];var _classPrivateFieldGet71=_classPrivateFieldGet(_last,this).subarray(8,12),_classPrivateFieldGet72=_slicedToArray(_classPrivateFieldGet71,4),x1=_classPrivateFieldGet72[0],y1=_classPrivateFieldGet72[1],x2=_classPrivateFieldGet72[2],y2=_classPrivateFieldGet72[3];var diffX=x-x2;var diffY=y-y2;var d=Math.hypot(diffX,diffY);if(d<_classPrivateFieldGet(_min,this)){return false;}var diffD=d-_classPrivateFieldGet(_min_dist,this);var K=diffD/d;var shiftX=K*diffX;var shiftY=K*diffY;var x0=x1;var y0=y1;x1=x2;y1=y2;x2+=shiftX;y2+=shiftY;(_classPrivateFieldGet73=_classPrivateFieldGet(_points,this))===null||_classPrivateFieldGet73===void 0||_classPrivateFieldGet73.push(x,y);var nX=-shiftY/diffD;var nY=shiftX/diffD;var thX=nX*_classPrivateFieldGet(_thickness,this);var thY=nY*_classPrivateFieldGet(_thickness,this);_classPrivateFieldGet(_last,this).set(_classPrivateFieldGet(_last,this).subarray(2,8),0);_classPrivateFieldGet(_last,this).set([x2+thX,y2+thY],4);_classPrivateFieldGet(_last,this).set(_classPrivateFieldGet(_last,this).subarray(14,18),12);_classPrivateFieldGet(_last,this).set([x2-thX,y2-thY],16);if(isNaN(_classPrivateFieldGet(_last,this)[6])){if(_classPrivateFieldGet(_top,this).length===0){_classPrivateFieldGet(_last,this).set([x1+thX,y1+thY],2);_classPrivateFieldGet(_top,this).push(NaN,NaN,NaN,NaN,(x1+thX-layerX)/layerWidth,(y1+thY-layerY)/layerHeight);_classPrivateFieldGet(_last,this).set([x1-thX,y1-thY],14);_classPrivateFieldGet(_bottom,this).push(NaN,NaN,NaN,NaN,(x1-thX-layerX)/layerWidth,(y1-thY-layerY)/layerHeight);}_classPrivateFieldGet(_last,this).set([x0,y0,x1,y1,x2,y2],6);return!this.isEmpty();}_classPrivateFieldGet(_last,this).set([x0,y0,x1,y1,x2,y2],6);var angle=Math.abs(Math.atan2(y0-y1,x0-x1)-Math.atan2(shiftY,shiftX));if(angle<Math.PI/2){var _classPrivateFieldGet74=_classPrivateFieldGet(_last,this).subarray(2,6);var _classPrivateFieldGet75=_slicedToArray(_classPrivateFieldGet74,4);x1=_classPrivateFieldGet75[0];y1=_classPrivateFieldGet75[1];x2=_classPrivateFieldGet75[2];y2=_classPrivateFieldGet75[3];_classPrivateFieldGet(_top,this).push(NaN,NaN,NaN,NaN,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight);var _classPrivateFieldGet76=_classPrivateFieldGet(_last,this).subarray(14,18);var _classPrivateFieldGet77=_slicedToArray(_classPrivateFieldGet76,4);x1=_classPrivateFieldGet77[0];y1=_classPrivateFieldGet77[1];x0=_classPrivateFieldGet77[2];y0=_classPrivateFieldGet77[3];_classPrivateFieldGet(_bottom,this).push(NaN,NaN,NaN,NaN,((x0+x1)/2-layerX)/layerWidth,((y0+y1)/2-layerY)/layerHeight);return true;}var _classPrivateFieldGet78=_classPrivateFieldGet(_last,this).subarray(0,6);var _classPrivateFieldGet79=_slicedToArray(_classPrivateFieldGet78,6);x0=_classPrivateFieldGet79[0];y0=_classPrivateFieldGet79[1];x1=_classPrivateFieldGet79[2];y1=_classPrivateFieldGet79[3];x2=_classPrivateFieldGet79[4];y2=_classPrivateFieldGet79[5];_classPrivateFieldGet(_top,this).push(((x0+5*x1)/6-layerX)/layerWidth,((y0+5*y1)/6-layerY)/layerHeight,((5*x1+x2)/6-layerX)/layerWidth,((5*y1+y2)/6-layerY)/layerHeight,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight);var _classPrivateFieldGet80=_classPrivateFieldGet(_last,this).subarray(12,18);var _classPrivateFieldGet81=_slicedToArray(_classPrivateFieldGet80,6);x2=_classPrivateFieldGet81[0];y2=_classPrivateFieldGet81[1];x1=_classPrivateFieldGet81[2];y1=_classPrivateFieldGet81[3];x0=_classPrivateFieldGet81[4];y0=_classPrivateFieldGet81[5];_classPrivateFieldGet(_bottom,this).push(((x0+5*x1)/6-layerX)/layerWidth,((y0+5*y1)/6-layerY)/layerHeight,((5*x1+x2)/6-layerX)/layerWidth,((5*y1+y2)/6-layerY)/layerHeight,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight);return true;}},{key:"toSVGPath",value:function toSVGPath(){if(this.isEmpty()){return"";}var top=_classPrivateFieldGet(_top,this);var bottom=_classPrivateFieldGet(_bottom,this);if(isNaN(_classPrivateFieldGet(_last,this)[6])&&!this.isEmpty()){return _assertClassBrand(_FreeDrawOutliner_brand,this,_toSVGPathTwoPoints).call(this);}var buffer=[];buffer.push("M".concat(top[4]," ").concat(top[5]));for(var i=6;i<top.length;i+=6){if(isNaN(top[i])){buffer.push("L".concat(top[i+4]," ").concat(top[i+5]));}else{buffer.push("C".concat(top[i]," ").concat(top[i+1]," ").concat(top[i+2]," ").concat(top[i+3]," ").concat(top[i+4]," ").concat(top[i+5]));}}_assertClassBrand(_FreeDrawOutliner_brand,this,_toSVGPathEnd).call(this,buffer);for(var _i20=bottom.length-6;_i20>=6;_i20-=6){if(isNaN(bottom[_i20])){buffer.push("L".concat(bottom[_i20+4]," ").concat(bottom[_i20+5]));}else{buffer.push("C".concat(bottom[_i20]," ").concat(bottom[_i20+1]," ").concat(bottom[_i20+2]," ").concat(bottom[_i20+3]," ").concat(bottom[_i20+4]," ").concat(bottom[_i20+5]));}}_assertClassBrand(_FreeDrawOutliner_brand,this,_toSVGPathStart).call(this,buffer);return buffer.join(" ");}},{key:"newFreeDrawOutline",value:function newFreeDrawOutline(outline,points,box,scaleFactor,innerMargin,isLTR){return new FreeDrawOutline(outline,points,box,scaleFactor,innerMargin,isLTR);}},{key:"getOutlines",value:function getOutlines(){var _classPrivateFieldGet84,_classPrivateFieldGet85;var top=_classPrivateFieldGet(_top,this);var bottom=_classPrivateFieldGet(_bottom,this);var last=_classPrivateFieldGet(_last,this);var _classPrivateFieldGet82=_classPrivateFieldGet(_box,this),_classPrivateFieldGet83=_slicedToArray(_classPrivateFieldGet82,4),layerX=_classPrivateFieldGet83[0],layerY=_classPrivateFieldGet83[1],layerWidth=_classPrivateFieldGet83[2],layerHeight=_classPrivateFieldGet83[3];var points=new Float32Array(((_classPrivateFieldGet84=(_classPrivateFieldGet85=_classPrivateFieldGet(_points,this))===null||_classPrivateFieldGet85===void 0?void 0:_classPrivateFieldGet85.length)!==null&&_classPrivateFieldGet84!==void 0?_classPrivateFieldGet84:0)+2);for(var i=0,ii=points.length-2;i<ii;i+=2){points[i]=(_classPrivateFieldGet(_points,this)[i]-layerX)/layerWidth;points[i+1]=(_classPrivateFieldGet(_points,this)[i+1]-layerY)/layerHeight;}points[points.length-2]=(_classPrivateFieldGet(_lastX,this)-layerX)/layerWidth;points[points.length-1]=(_classPrivateFieldGet(_lastY,this)-layerY)/layerHeight;if(isNaN(last[6])&&!this.isEmpty()){return _assertClassBrand(_FreeDrawOutliner_brand,this,_getOutlineTwoPoints).call(this,points);}var outline=new Float32Array(_classPrivateFieldGet(_top,this).length+24+_classPrivateFieldGet(_bottom,this).length);var N=top.length;for(var _i21=0;_i21<N;_i21+=2){if(isNaN(top[_i21])){outline[_i21]=outline[_i21+1]=NaN;continue;}outline[_i21]=top[_i21];outline[_i21+1]=top[_i21+1];}N=_assertClassBrand(_FreeDrawOutliner_brand,this,_getOutlineEnd).call(this,outline,N);for(var _i22=bottom.length-6;_i22>=6;_i22-=6){for(var j=0;j<6;j+=2){if(isNaN(bottom[_i22+j])){outline[N]=outline[N+1]=NaN;N+=2;continue;}outline[N]=bottom[_i22+j];outline[N+1]=bottom[_i22+j+1];N+=2;}}_assertClassBrand(_FreeDrawOutliner_brand,this,_getOutlineStart).call(this,outline,N);return this.newFreeDrawOutline(outline,points,_classPrivateFieldGet(_box,this),_classPrivateFieldGet(_scaleFactor,this),_classPrivateFieldGet(_innerMargin,this),_classPrivateFieldGet(_isLTR2,this));}}]);}();function _getLastCoords(){var lastTop=_classPrivateFieldGet(_last,this).subarray(4,6);var lastBottom=_classPrivateFieldGet(_last,this).subarray(16,18);var _classPrivateFieldGet155=_classPrivateFieldGet(_box,this),_classPrivateFieldGet156=_slicedToArray(_classPrivateFieldGet155,4),x=_classPrivateFieldGet156[0],y=_classPrivateFieldGet156[1],width=_classPrivateFieldGet156[2],height=_classPrivateFieldGet156[3];return[(_classPrivateFieldGet(_lastX,this)+(lastTop[0]-lastBottom[0])/2-x)/width,(_classPrivateFieldGet(_lastY,this)+(lastTop[1]-lastBottom[1])/2-y)/height,(_classPrivateFieldGet(_lastX,this)+(lastBottom[0]-lastTop[0])/2-x)/width,(_classPrivateFieldGet(_lastY,this)+(lastBottom[1]-lastTop[1])/2-y)/height];}function _toSVGPathTwoPoints(){var _classPrivateFieldGet157=_classPrivateFieldGet(_box,this),_classPrivateFieldGet158=_slicedToArray(_classPrivateFieldGet157,4),x=_classPrivateFieldGet158[0],y=_classPrivateFieldGet158[1],width=_classPrivateFieldGet158[2],height=_classPrivateFieldGet158[3];var _assertClassBrand$cal30=_assertClassBrand(_FreeDrawOutliner_brand,this,_getLastCoords).call(this),_assertClassBrand$cal31=_slicedToArray(_assertClassBrand$cal30,4),lastTopX=_assertClassBrand$cal31[0],lastTopY=_assertClassBrand$cal31[1],lastBottomX=_assertClassBrand$cal31[2],lastBottomY=_assertClassBrand$cal31[3];return"M".concat((_classPrivateFieldGet(_last,this)[2]-x)/width," ").concat((_classPrivateFieldGet(_last,this)[3]-y)/height," L").concat((_classPrivateFieldGet(_last,this)[4]-x)/width," ").concat((_classPrivateFieldGet(_last,this)[5]-y)/height," L").concat(lastTopX," ").concat(lastTopY," L").concat(lastBottomX," ").concat(lastBottomY," L").concat((_classPrivateFieldGet(_last,this)[16]-x)/width," ").concat((_classPrivateFieldGet(_last,this)[17]-y)/height," L").concat((_classPrivateFieldGet(_last,this)[14]-x)/width," ").concat((_classPrivateFieldGet(_last,this)[15]-y)/height," Z");}function _toSVGPathStart(buffer){var bottom=_classPrivateFieldGet(_bottom,this);buffer.push("L".concat(bottom[4]," ").concat(bottom[5]," Z"));}function _toSVGPathEnd(buffer){var _classPrivateFieldGet159=_classPrivateFieldGet(_box,this),_classPrivateFieldGet160=_slicedToArray(_classPrivateFieldGet159,4),x=_classPrivateFieldGet160[0],y=_classPrivateFieldGet160[1],width=_classPrivateFieldGet160[2],height=_classPrivateFieldGet160[3];var lastTop=_classPrivateFieldGet(_last,this).subarray(4,6);var lastBottom=_classPrivateFieldGet(_last,this).subarray(16,18);var _assertClassBrand$cal32=_assertClassBrand(_FreeDrawOutliner_brand,this,_getLastCoords).call(this),_assertClassBrand$cal33=_slicedToArray(_assertClassBrand$cal32,4),lastTopX=_assertClassBrand$cal33[0],lastTopY=_assertClassBrand$cal33[1],lastBottomX=_assertClassBrand$cal33[2],lastBottomY=_assertClassBrand$cal33[3];buffer.push("L".concat((lastTop[0]-x)/width," ").concat((lastTop[1]-y)/height," L").concat(lastTopX," ").concat(lastTopY," L").concat(lastBottomX," ").concat(lastBottomY," L").concat((lastBottom[0]-x)/width," ").concat((lastBottom[1]-y)/height));}function _getOutlineTwoPoints(points){var last=_classPrivateFieldGet(_last,this);var _classPrivateFieldGet161=_classPrivateFieldGet(_box,this),_classPrivateFieldGet162=_slicedToArray(_classPrivateFieldGet161,4),layerX=_classPrivateFieldGet162[0],layerY=_classPrivateFieldGet162[1],layerWidth=_classPrivateFieldGet162[2],layerHeight=_classPrivateFieldGet162[3];var _assertClassBrand$cal34=_assertClassBrand(_FreeDrawOutliner_brand,this,_getLastCoords).call(this),_assertClassBrand$cal35=_slicedToArray(_assertClassBrand$cal34,4),lastTopX=_assertClassBrand$cal35[0],lastTopY=_assertClassBrand$cal35[1],lastBottomX=_assertClassBrand$cal35[2],lastBottomY=_assertClassBrand$cal35[3];var outline=new Float32Array(36);outline.set([NaN,NaN,NaN,NaN,(last[2]-layerX)/layerWidth,(last[3]-layerY)/layerHeight,NaN,NaN,NaN,NaN,(last[4]-layerX)/layerWidth,(last[5]-layerY)/layerHeight,NaN,NaN,NaN,NaN,lastTopX,lastTopY,NaN,NaN,NaN,NaN,lastBottomX,lastBottomY,NaN,NaN,NaN,NaN,(last[16]-layerX)/layerWidth,(last[17]-layerY)/layerHeight,NaN,NaN,NaN,NaN,(last[14]-layerX)/layerWidth,(last[15]-layerY)/layerHeight],0);return this.newFreeDrawOutline(outline,points,_classPrivateFieldGet(_box,this),_classPrivateFieldGet(_scaleFactor,this),_classPrivateFieldGet(_innerMargin,this),_classPrivateFieldGet(_isLTR2,this));}function _getOutlineStart(outline,pos){var bottom=_classPrivateFieldGet(_bottom,this);outline.set([NaN,NaN,NaN,NaN,bottom[4],bottom[5]],pos);return pos+=6;}function _getOutlineEnd(outline,pos){var lastTop=_classPrivateFieldGet(_last,this).subarray(4,6);var lastBottom=_classPrivateFieldGet(_last,this).subarray(16,18);var _classPrivateFieldGet163=_classPrivateFieldGet(_box,this),_classPrivateFieldGet164=_slicedToArray(_classPrivateFieldGet163,4),layerX=_classPrivateFieldGet164[0],layerY=_classPrivateFieldGet164[1],layerWidth=_classPrivateFieldGet164[2],layerHeight=_classPrivateFieldGet164[3];var _assertClassBrand$cal36=_assertClassBrand(_FreeDrawOutliner_brand,this,_getLastCoords).call(this),_assertClassBrand$cal37=_slicedToArray(_assertClassBrand$cal36,4),lastTopX=_assertClassBrand$cal37[0],lastTopY=_assertClassBrand$cal37[1],lastBottomX=_assertClassBrand$cal37[2],lastBottomY=_assertClassBrand$cal37[3];outline.set([NaN,NaN,NaN,NaN,(lastTop[0]-layerX)/layerWidth,(lastTop[1]-layerY)/layerHeight,NaN,NaN,NaN,NaN,lastTopX,lastTopY,NaN,NaN,NaN,NaN,lastBottomX,lastBottomY,NaN,NaN,NaN,NaN,(lastBottom[0]-layerX)/layerWidth,(lastBottom[1]-layerY)/layerHeight],pos);return pos+=24;}var _MIN_DIST={_:8};var _MIN_DIFF={_:2};var _MIN={_:_MIN_DIST._+_MIN_DIFF._};var _box2=/*#__PURE__*/new WeakMap();var _bbox2=/*#__PURE__*/new WeakMap();var _innerMargin2=/*#__PURE__*/new WeakMap();var _isLTR3=/*#__PURE__*/new WeakMap();var _points2=/*#__PURE__*/new WeakMap();var _scaleFactor2=/*#__PURE__*/new WeakMap();var _outline=/*#__PURE__*/new WeakMap();var _FreeDrawOutline_brand=/*#__PURE__*/new WeakSet();var FreeDrawOutline=/*#__PURE__*/function(_Outline2){function FreeDrawOutline(_outline2,points,box,scaleFactor,innerMargin,_isLTR4){var _this87;_classCallCheck(this,FreeDrawOutline);_this87=_callSuper(this,FreeDrawOutline);_classPrivateMethodInitSpec(_this87,_FreeDrawOutline_brand);_classPrivateFieldInitSpec(_this87,_box2,void 0);_classPrivateFieldInitSpec(_this87,_bbox2,new Float32Array(4));_classPrivateFieldInitSpec(_this87,_innerMargin2,void 0);_classPrivateFieldInitSpec(_this87,_isLTR3,void 0);_classPrivateFieldInitSpec(_this87,_points2,void 0);_classPrivateFieldInitSpec(_this87,_scaleFactor2,void 0);_classPrivateFieldInitSpec(_this87,_outline,void 0);_classPrivateFieldSet(_outline,_this87,_outline2);_classPrivateFieldSet(_points2,_this87,points);_classPrivateFieldSet(_box2,_this87,box);_classPrivateFieldSet(_scaleFactor2,_this87,scaleFactor);_classPrivateFieldSet(_innerMargin2,_this87,innerMargin);_classPrivateFieldSet(_isLTR3,_this87,_isLTR4);_this87.lastPoint=[NaN,NaN];_assertClassBrand(_FreeDrawOutline_brand,_this87,_computeMinMax).call(_this87,_isLTR4);var _classPrivateFieldGet86=_classPrivateFieldGet(_bbox2,_this87),_classPrivateFieldGet87=_slicedToArray(_classPrivateFieldGet86,4),_x40=_classPrivateFieldGet87[0],_y4=_classPrivateFieldGet87[1],width=_classPrivateFieldGet87[2],height=_classPrivateFieldGet87[3];for(var i=0,ii=_outline2.length;i<ii;i+=2){_outline2[i]=(_outline2[i]-_x40)/width;_outline2[i+1]=(_outline2[i+1]-_y4)/height;}for(var _i23=0,_ii3=points.length;_i23<_ii3;_i23+=2){points[_i23]=(points[_i23]-_x40)/width;points[_i23+1]=(points[_i23+1]-_y4)/height;}return _this87;}_inherits(FreeDrawOutline,_Outline2);return _createClass(FreeDrawOutline,[{key:"toSVGPath",value:function toSVGPath(){var buffer=["M".concat(_classPrivateFieldGet(_outline,this)[4]," ").concat(_classPrivateFieldGet(_outline,this)[5])];for(var i=6,ii=_classPrivateFieldGet(_outline,this).length;i<ii;i+=6){if(isNaN(_classPrivateFieldGet(_outline,this)[i])){buffer.push("L".concat(_classPrivateFieldGet(_outline,this)[i+4]," ").concat(_classPrivateFieldGet(_outline,this)[i+5]));continue;}buffer.push("C".concat(_classPrivateFieldGet(_outline,this)[i]," ").concat(_classPrivateFieldGet(_outline,this)[i+1]," ").concat(_classPrivateFieldGet(_outline,this)[i+2]," ").concat(_classPrivateFieldGet(_outline,this)[i+3]," ").concat(_classPrivateFieldGet(_outline,this)[i+4]," ").concat(_classPrivateFieldGet(_outline,this)[i+5]));}buffer.push("Z");return buffer.join(" ");}},{key:"serialize",value:function serialize(_ref101,rotation){var _ref102=_slicedToArray(_ref101,4),blX=_ref102[0],blY=_ref102[1],trX=_ref102[2],trY=_ref102[3];var width=trX-blX;var height=trY-blY;var outline;var points;switch(rotation){case 0:outline=Outline._rescale(_classPrivateFieldGet(_outline,this),blX,trY,width,-height);points=Outline._rescale(_classPrivateFieldGet(_points2,this),blX,trY,width,-height);break;case 90:outline=Outline._rescaleAndSwap(_classPrivateFieldGet(_outline,this),blX,blY,width,height);points=Outline._rescaleAndSwap(_classPrivateFieldGet(_points2,this),blX,blY,width,height);break;case 180:outline=Outline._rescale(_classPrivateFieldGet(_outline,this),trX,blY,-width,height);points=Outline._rescale(_classPrivateFieldGet(_points2,this),trX,blY,-width,height);break;case 270:outline=Outline._rescaleAndSwap(_classPrivateFieldGet(_outline,this),trX,trY,-width,-height);points=Outline._rescaleAndSwap(_classPrivateFieldGet(_points2,this),trX,trY,-width,-height);break;}return{outline:Array.from(outline),points:[Array.from(points)]};}},{key:"box",get:function get(){return _classPrivateFieldGet(_bbox2,this);}},{key:"newOutliner",value:function newOutliner(point,box,scaleFactor,thickness,isLTR){var innerMargin=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;return new FreeDrawOutliner(point,box,scaleFactor,thickness,isLTR,innerMargin);}},{key:"getNewOutline",value:function getNewOutline(thickness,innerMargin){var _classPrivateFieldGet88=_classPrivateFieldGet(_bbox2,this),_classPrivateFieldGet89=_slicedToArray(_classPrivateFieldGet88,4),x=_classPrivateFieldGet89[0],y=_classPrivateFieldGet89[1],width=_classPrivateFieldGet89[2],height=_classPrivateFieldGet89[3];var _classPrivateFieldGet90=_classPrivateFieldGet(_box2,this),_classPrivateFieldGet91=_slicedToArray(_classPrivateFieldGet90,4),layerX=_classPrivateFieldGet91[0],layerY=_classPrivateFieldGet91[1],layerWidth=_classPrivateFieldGet91[2],layerHeight=_classPrivateFieldGet91[3];var sx=width*layerWidth;var sy=height*layerHeight;var tx=x*layerWidth+layerX;var ty=y*layerHeight+layerY;var outliner=this.newOutliner({x:_classPrivateFieldGet(_points2,this)[0]*sx+tx,y:_classPrivateFieldGet(_points2,this)[1]*sy+ty},_classPrivateFieldGet(_box2,this),_classPrivateFieldGet(_scaleFactor2,this),thickness,_classPrivateFieldGet(_isLTR3,this),innerMargin!==null&&innerMargin!==void 0?innerMargin:_classPrivateFieldGet(_innerMargin2,this));for(var i=2;i<_classPrivateFieldGet(_points2,this).length;i+=2){outliner.add({x:_classPrivateFieldGet(_points2,this)[i]*sx+tx,y:_classPrivateFieldGet(_points2,this)[i+1]*sy+ty});}return outliner.getOutlines();}}]);}(Outline);function _computeMinMax(isLTR){var outline=_classPrivateFieldGet(_outline,this);var lastX=outline[4];var lastY=outline[5];var minMax=[lastX,lastY,lastX,lastY];var lastPointX=lastX;var lastPointY=lastY;var ltrCallback=isLTR?Math.max:Math.min;for(var i=6,ii=outline.length;i<ii;i+=6){var x=outline[i+4],y=outline[i+5];if(isNaN(outline[i])){_Util.pointBoundingBox(x,y,minMax);if(lastPointY<y){lastPointX=x;lastPointY=y;}else if(lastPointY===y){lastPointX=ltrCallback(lastPointX,x);}}else{var _bbox5=[Infinity,Infinity,-Infinity,-Infinity];_Util.bezierBoundingBox.apply(_Util,[lastX,lastY].concat(_toConsumableArray(outline.slice(i,i+6)),[_bbox5]));_Util.rectBoundingBox.apply(_Util,_bbox5.concat([minMax]));if(lastPointY<_bbox5[3]){lastPointX=_bbox5[2];lastPointY=_bbox5[3];}else if(lastPointY===_bbox5[3]){lastPointX=ltrCallback(lastPointX,_bbox5[2]);}}lastX=x;lastY=y;}var bbox=_classPrivateFieldGet(_bbox2,this);bbox[0]=minMax[0]-_classPrivateFieldGet(_innerMargin2,this);bbox[1]=minMax[1]-_classPrivateFieldGet(_innerMargin2,this);bbox[2]=minMax[2]-minMax[0]+2*_classPrivateFieldGet(_innerMargin2,this);bbox[3]=minMax[3]-minMax[1]+2*_classPrivateFieldGet(_innerMargin2,this);this.lastPoint=[lastPointX,lastPointY];};// ./src/display/editor/drawers/highlight.js
var _box3=/*#__PURE__*/new WeakMap();var _lastPoint=/*#__PURE__*/new WeakMap();var _verticalEdges=/*#__PURE__*/new WeakMap();var _intervals=/*#__PURE__*/new WeakMap();var _HighlightOutliner_brand=/*#__PURE__*/new WeakSet();var HighlightOutliner=/*#__PURE__*/function(){function HighlightOutliner(boxes){var borderWidth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var innerMargin=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var isLTR=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;_classCallCheck(this,HighlightOutliner);_classPrivateMethodInitSpec(this,_HighlightOutliner_brand);_classPrivateFieldInitSpec(this,_box3,void 0);_classPrivateFieldInitSpec(this,_lastPoint,void 0);_classPrivateFieldInitSpec(this,_verticalEdges,[]);_classPrivateFieldInitSpec(this,_intervals,[]);var minMax=[Infinity,Infinity,-Infinity,-Infinity];var NUMBER_OF_DIGITS=4;var EPSILON=Math.pow(10,-NUMBER_OF_DIGITS);var _iterator139=_createForOfIteratorHelper(boxes),_step139;try{for(_iterator139.s();!(_step139=_iterator139.n()).done;){var _step139$value=_step139.value,x=_step139$value.x,y=_step139$value.y,width=_step139$value.width,height=_step139$value.height;var x1=Math.floor((x-borderWidth)/EPSILON)*EPSILON;var x2=Math.ceil((x+width+borderWidth)/EPSILON)*EPSILON;var y1=Math.floor((y-borderWidth)/EPSILON)*EPSILON;var y2=Math.ceil((y+height+borderWidth)/EPSILON)*EPSILON;var left=[x1,y1,y2,true];var right=[x2,y1,y2,false];_classPrivateFieldGet(_verticalEdges,this).push(left,right);_Util.rectBoundingBox(x1,y1,x2,y2,minMax);}}catch(err){_iterator139.e(err);}finally{_iterator139.f();}var bboxWidth=minMax[2]-minMax[0]+2*innerMargin;var bboxHeight=minMax[3]-minMax[1]+2*innerMargin;var shiftedMinX=minMax[0]-innerMargin;var shiftedMinY=minMax[1]-innerMargin;var lastEdge=_classPrivateFieldGet(_verticalEdges,this).at(isLTR?-1:-2);var lastPoint=[lastEdge[0],lastEdge[2]];var _iterator140=_createForOfIteratorHelper(_classPrivateFieldGet(_verticalEdges,this)),_step140;try{for(_iterator140.s();!(_step140=_iterator140.n()).done;){var edge=_step140.value;var _edge=_slicedToArray(edge,3),_x41=_edge[0],_y5=_edge[1],_y6=_edge[2];edge[0]=(_x41-shiftedMinX)/bboxWidth;edge[1]=(_y5-shiftedMinY)/bboxHeight;edge[2]=(_y6-shiftedMinY)/bboxHeight;}}catch(err){_iterator140.e(err);}finally{_iterator140.f();}_classPrivateFieldSet(_box3,this,new Float32Array([shiftedMinX,shiftedMinY,bboxWidth,bboxHeight]));_classPrivateFieldSet(_lastPoint,this,lastPoint);}return _createClass(HighlightOutliner,[{key:"getOutlines",value:function getOutlines(){_classPrivateFieldGet(_verticalEdges,this).sort(function(a,b){return a[0]-b[0]||a[1]-b[1]||a[2]-b[2];});var outlineVerticalEdges=[];var _iterator141=_createForOfIteratorHelper(_classPrivateFieldGet(_verticalEdges,this)),_step141;try{for(_iterator141.s();!(_step141=_iterator141.n()).done;){var edge=_step141.value;if(edge[3]){outlineVerticalEdges.push.apply(outlineVerticalEdges,_toConsumableArray(_assertClassBrand(_HighlightOutliner_brand,this,_breakEdge).call(this,edge)));_assertClassBrand(_HighlightOutliner_brand,this,_insert).call(this,edge);}else{_assertClassBrand(_HighlightOutliner_brand,this,_remove).call(this,edge);outlineVerticalEdges.push.apply(outlineVerticalEdges,_toConsumableArray(_assertClassBrand(_HighlightOutliner_brand,this,_breakEdge).call(this,edge)));}}}catch(err){_iterator141.e(err);}finally{_iterator141.f();}return _assertClassBrand(_HighlightOutliner_brand,this,_getOutlines).call(this,outlineVerticalEdges);}}]);}();function _getOutlines(outlineVerticalEdges){var edges=[];var allEdges=new Set();var _iterator186=_createForOfIteratorHelper(outlineVerticalEdges),_step186;try{for(_iterator186.s();!(_step186=_iterator186.n()).done;){var _edge5=_step186.value;var _edge6=_slicedToArray(_edge5,3),_x69=_edge6[0],_y8=_edge6[1],_y9=_edge6[2];edges.push([_x69,_y8,_edge5],[_x69,_y9,_edge5]);}}catch(err){_iterator186.e(err);}finally{_iterator186.f();}edges.sort(function(a,b){return a[1]-b[1]||a[0]-b[0];});for(var i=0,ii=edges.length;i<ii;i+=2){var edge1=edges[i][2];var edge2=edges[i+1][2];edge1.push(edge2);edge2.push(edge1);allEdges.add(edge1);allEdges.add(edge2);}var outlines=[];var outline;while(allEdges.size>0){var edge=allEdges.values().next().value;var _edge2=_slicedToArray(edge,5),x=_edge2[0],y1=_edge2[1],y2=_edge2[2],_edge3=_edge2[3],_edge4=_edge2[4];allEdges["delete"](edge);var lastPointX=x;var lastPointY=y1;outline=[x,y2];outlines.push(outline);while(true){var e=void 0;if(allEdges.has(_edge3)){e=_edge3;}else if(allEdges.has(_edge4)){e=_edge4;}else{break;}allEdges["delete"](e);var _e=e;var _e2=_slicedToArray(_e,5);x=_e2[0];y1=_e2[1];y2=_e2[2];_edge3=_e2[3];_edge4=_e2[4];if(lastPointX!==x){outline.push(lastPointX,lastPointY,x,lastPointY===y1?y1:y2);lastPointX=x;}lastPointY=lastPointY===y1?y2:y1;}outline.push(lastPointX,lastPointY);}return new HighlightOutline(outlines,_classPrivateFieldGet(_box3,this),_classPrivateFieldGet(_lastPoint,this));}function _binarySearch(y){var array=_classPrivateFieldGet(_intervals,this);var start=0;var end=array.length-1;while(start<=end){var middle=start+end>>1;var y1=array[middle][0];if(y1===y){return middle;}if(y1<y){start=middle+1;}else{end=middle-1;}}return end+1;}function _insert(_ref141){var _ref142=_slicedToArray(_ref141,3),y1=_ref142[1],y2=_ref142[2];var index=_assertClassBrand(_HighlightOutliner_brand,this,_binarySearch).call(this,y1);_classPrivateFieldGet(_intervals,this).splice(index,0,[y1,y2]);}function _remove(_ref143){var _ref144=_slicedToArray(_ref143,3),y1=_ref144[1],y2=_ref144[2];var index=_assertClassBrand(_HighlightOutliner_brand,this,_binarySearch).call(this,y1);for(var i=index;i<_classPrivateFieldGet(_intervals,this).length;i++){var _classPrivateFieldGet165=_slicedToArray(_classPrivateFieldGet(_intervals,this)[i],2),start=_classPrivateFieldGet165[0],end=_classPrivateFieldGet165[1];if(start!==y1){break;}if(start===y1&&end===y2){_classPrivateFieldGet(_intervals,this).splice(i,1);return;}}for(var _i33=index-1;_i33>=0;_i33--){var _classPrivateFieldGet166=_slicedToArray(_classPrivateFieldGet(_intervals,this)[_i33],2),_start=_classPrivateFieldGet166[0],_end=_classPrivateFieldGet166[1];if(_start!==y1){break;}if(_start===y1&&_end===y2){_classPrivateFieldGet(_intervals,this).splice(_i33,1);return;}}}function _breakEdge(edge){var _edge7=_slicedToArray(edge,3),x=_edge7[0],y1=_edge7[1],y2=_edge7[2];var results=[[x,y1,y2]];var index=_assertClassBrand(_HighlightOutliner_brand,this,_binarySearch).call(this,y2);for(var i=0;i<index;i++){var _classPrivateFieldGet167=_slicedToArray(_classPrivateFieldGet(_intervals,this)[i],2),start=_classPrivateFieldGet167[0],end=_classPrivateFieldGet167[1];for(var j=0,jj=results.length;j<jj;j++){var _results$j=_slicedToArray(results[j],3),y3=_results$j[1],y4=_results$j[2];if(end<=y3||y4<=start){continue;}if(y3>=start){if(y4>end){results[j][1]=end;}else{if(jj===1){return[];}results.splice(j,1);j--;jj--;}continue;}results[j][2]=start;if(y4>end){results.push([x,end,y4]);}}}return results;}var _box4=/*#__PURE__*/new WeakMap();var _outlines=/*#__PURE__*/new WeakMap();var HighlightOutline=/*#__PURE__*/function(_Outline3){function HighlightOutline(outlines,box,lastPoint){var _this88;_classCallCheck(this,HighlightOutline);_this88=_callSuper(this,HighlightOutline);_classPrivateFieldInitSpec(_this88,_box4,void 0);_classPrivateFieldInitSpec(_this88,_outlines,void 0);_classPrivateFieldSet(_outlines,_this88,outlines);_classPrivateFieldSet(_box4,_this88,box);_this88.lastPoint=lastPoint;return _this88;}_inherits(HighlightOutline,_Outline3);return _createClass(HighlightOutline,[{key:"toSVGPath",value:function toSVGPath(){var buffer=[];var _iterator142=_createForOfIteratorHelper(_classPrivateFieldGet(_outlines,this)),_step142;try{for(_iterator142.s();!(_step142=_iterator142.n()).done;){var polygon=_step142.value;var _polygon=_slicedToArray(polygon,2),prevX=_polygon[0],prevY=_polygon[1];buffer.push("M".concat(prevX," ").concat(prevY));for(var i=2;i<polygon.length;i+=2){var x=polygon[i];var y=polygon[i+1];if(x===prevX){buffer.push("V".concat(y));prevY=y;}else if(y===prevY){buffer.push("H".concat(x));prevX=x;}}buffer.push("Z");}}catch(err){_iterator142.e(err);}finally{_iterator142.f();}return buffer.join(" ");}},{key:"serialize",value:function serialize(_ref103,_rotation){var _ref104=_slicedToArray(_ref103,4),blX=_ref104[0],blY=_ref104[1],trX=_ref104[2],trY=_ref104[3];var outlines=[];var width=trX-blX;var height=trY-blY;var _iterator143=_createForOfIteratorHelper(_classPrivateFieldGet(_outlines,this)),_step143;try{for(_iterator143.s();!(_step143=_iterator143.n()).done;){var outline=_step143.value;var points=new Array(outline.length);for(var i=0;i<outline.length;i+=2){points[i]=blX+outline[i]*width;points[i+1]=trY-outline[i+1]*height;}outlines.push(points);}}catch(err){_iterator143.e(err);}finally{_iterator143.f();}return outlines;}},{key:"box",get:function get(){return _classPrivateFieldGet(_box4,this);}},{key:"classNamesForOutlining",get:function get(){return["highlightOutline"];}}]);}(Outline);var FreeHighlightOutliner=/*#__PURE__*/function(_FreeDrawOutliner2){function FreeHighlightOutliner(){_classCallCheck(this,FreeHighlightOutliner);return _callSuper(this,FreeHighlightOutliner,arguments);}_inherits(FreeHighlightOutliner,_FreeDrawOutliner2);return _createClass(FreeHighlightOutliner,[{key:"newFreeDrawOutline",value:function newFreeDrawOutline(outline,points,box,scaleFactor,innerMargin,isLTR){return new FreeHighlightOutline(outline,points,box,scaleFactor,innerMargin,isLTR);}}]);}(FreeDrawOutliner);var FreeHighlightOutline=/*#__PURE__*/function(_FreeDrawOutline2){function FreeHighlightOutline(){_classCallCheck(this,FreeHighlightOutline);return _callSuper(this,FreeHighlightOutline,arguments);}_inherits(FreeHighlightOutline,_FreeDrawOutline2);return _createClass(FreeHighlightOutline,[{key:"newOutliner",value:function newOutliner(point,box,scaleFactor,thickness,isLTR){var innerMargin=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;return new FreeHighlightOutliner(point,box,scaleFactor,thickness,isLTR,innerMargin);}}]);}(FreeDrawOutline);;// ./src/display/editor/color_picker.js
var _button=/*#__PURE__*/new WeakMap();var _buttonSwatch=/*#__PURE__*/new WeakMap();var _defaultColor=/*#__PURE__*/new WeakMap();var _dropdown=/*#__PURE__*/new WeakMap();var _dropdownWasFromKeyboard=/*#__PURE__*/new WeakMap();var _isMainColorPicker=/*#__PURE__*/new WeakMap();var _editor3=/*#__PURE__*/new WeakMap();var _eventBus=/*#__PURE__*/new WeakMap();var _openDropdownAC=/*#__PURE__*/new WeakMap();var _uiManager3=/*#__PURE__*/new WeakMap();var _type3=/*#__PURE__*/new WeakMap();var _ColorPicker_brand=/*#__PURE__*/new WeakSet();var _ColorPicker=/*#__PURE__*/function(){function _ColorPicker(_ref105){var _classPrivateFieldGet92;var _ref105$editor=_ref105.editor,editor=_ref105$editor===void 0?null:_ref105$editor,_ref105$uiManager=_ref105.uiManager,uiManager=_ref105$uiManager===void 0?null:_ref105$uiManager;_classCallCheck(this,_ColorPicker);_classPrivateMethodInitSpec(this,_ColorPicker_brand);_classPrivateFieldInitSpec(this,_button,null);_classPrivateFieldInitSpec(this,_buttonSwatch,null);_classPrivateFieldInitSpec(this,_defaultColor,void 0);_classPrivateFieldInitSpec(this,_dropdown,null);_classPrivateFieldInitSpec(this,_dropdownWasFromKeyboard,false);_classPrivateFieldInitSpec(this,_isMainColorPicker,false);_classPrivateFieldInitSpec(this,_editor3,null);_classPrivateFieldInitSpec(this,_eventBus,void 0);_classPrivateFieldInitSpec(this,_openDropdownAC,null);_classPrivateFieldInitSpec(this,_uiManager3,null);_classPrivateFieldInitSpec(this,_type3,void 0);if(editor){_classPrivateFieldSet(_isMainColorPicker,this,false);_classPrivateFieldSet(_type3,this,_AnnotationEditorParamsType.HIGHLIGHT_COLOR);_classPrivateFieldSet(_editor3,this,editor);}else{_classPrivateFieldSet(_isMainColorPicker,this,true);_classPrivateFieldSet(_type3,this,_AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR);}_classPrivateFieldSet(_uiManager3,this,(editor===null||editor===void 0?void 0:editor._uiManager)||uiManager);_classPrivateFieldSet(_eventBus,this,_classPrivateFieldGet(_uiManager3,this)._eventBus);_classPrivateFieldSet(_defaultColor,this,(editor===null||editor===void 0?void 0:editor.color)||((_classPrivateFieldGet92=_classPrivateFieldGet(_uiManager3,this))===null||_classPrivateFieldGet92===void 0?void 0:_classPrivateFieldGet92.highlightColors.values().next().value)||"#FFFF98");_l10nColor._||(_l10nColor._=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}));}return _createClass(_ColorPicker,[{key:"renderButton",value:function renderButton(){var button=_classPrivateFieldSet(_button,this,document.createElement("button"));button.className="colorPicker";button.tabIndex="0";button.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button");button.setAttribute("aria-haspopup",true);var signal=_classPrivateFieldGet(_uiManager3,this)._signal;button.addEventListener("click",_assertClassBrand(_ColorPicker_brand,this,_openDropdown).bind(this),{signal:signal});button.addEventListener("keydown",_assertClassBrand(_ColorPicker_brand,this,_keyDown2).bind(this),{signal:signal});var swatch=_classPrivateFieldSet(_buttonSwatch,this,document.createElement("span"));swatch.className="swatch";swatch.setAttribute("aria-hidden",true);swatch.style.backgroundColor=_classPrivateFieldGet(_defaultColor,this);button.append(swatch);return button;}},{key:"renderMainDropdown",value:function renderMainDropdown(){var dropdown=_classPrivateFieldSet(_dropdown,this,_assertClassBrand(_ColorPicker_brand,this,_getDropdownRoot).call(this));dropdown.setAttribute("aria-orientation","horizontal");dropdown.setAttribute("aria-labelledby","highlightColorPickerLabel");return dropdown;}},{key:"_colorSelectFromKeyboard",value:function _colorSelectFromKeyboard(event){if(event.target===_classPrivateFieldGet(_button,this)){_assertClassBrand(_ColorPicker_brand,this,_openDropdown).call(this,event);return;}var color=event.target.getAttribute("data-color");if(!color){return;}_assertClassBrand(_ColorPicker_brand,this,_colorSelect).call(this,color,event);}},{key:"_moveToNext",value:function _moveToNext(event){var _event$target$nextSib;if(!_classPrivateGetter(_ColorPicker_brand,this,_get_isDropdownVisible)){_assertClassBrand(_ColorPicker_brand,this,_openDropdown).call(this,event);return;}if(event.target===_classPrivateFieldGet(_button,this)){var _classPrivateFieldGet93;(_classPrivateFieldGet93=_classPrivateFieldGet(_dropdown,this).firstChild)===null||_classPrivateFieldGet93===void 0||_classPrivateFieldGet93.focus();return;}(_event$target$nextSib=event.target.nextSibling)===null||_event$target$nextSib===void 0||_event$target$nextSib.focus();}},{key:"_moveToPrevious",value:function _moveToPrevious(event){var _classPrivateFieldGet94,_event$target$previou;if(event.target===((_classPrivateFieldGet94=_classPrivateFieldGet(_dropdown,this))===null||_classPrivateFieldGet94===void 0?void 0:_classPrivateFieldGet94.firstChild)||event.target===_classPrivateFieldGet(_button,this)){if(_classPrivateGetter(_ColorPicker_brand,this,_get_isDropdownVisible)){this._hideDropdownFromKeyboard();}return;}if(!_classPrivateGetter(_ColorPicker_brand,this,_get_isDropdownVisible)){_assertClassBrand(_ColorPicker_brand,this,_openDropdown).call(this,event);}(_event$target$previou=event.target.previousSibling)===null||_event$target$previou===void 0||_event$target$previou.focus();}},{key:"_moveToBeginning",value:function _moveToBeginning(event){var _classPrivateFieldGet95;if(!_classPrivateGetter(_ColorPicker_brand,this,_get_isDropdownVisible)){_assertClassBrand(_ColorPicker_brand,this,_openDropdown).call(this,event);return;}(_classPrivateFieldGet95=_classPrivateFieldGet(_dropdown,this).firstChild)===null||_classPrivateFieldGet95===void 0||_classPrivateFieldGet95.focus();}},{key:"_moveToEnd",value:function _moveToEnd(event){var _classPrivateFieldGet96;if(!_classPrivateGetter(_ColorPicker_brand,this,_get_isDropdownVisible)){_assertClassBrand(_ColorPicker_brand,this,_openDropdown).call(this,event);return;}(_classPrivateFieldGet96=_classPrivateFieldGet(_dropdown,this).lastChild)===null||_classPrivateFieldGet96===void 0||_classPrivateFieldGet96.focus();}},{key:"hideDropdown",value:function hideDropdown(){var _classPrivateFieldGet97,_classPrivateFieldGet98;(_classPrivateFieldGet97=_classPrivateFieldGet(_dropdown,this))===null||_classPrivateFieldGet97===void 0||_classPrivateFieldGet97.classList.add("hidden");(_classPrivateFieldGet98=_classPrivateFieldGet(_openDropdownAC,this))===null||_classPrivateFieldGet98===void 0||_classPrivateFieldGet98.abort();_classPrivateFieldSet(_openDropdownAC,this,null);}},{key:"_hideDropdownFromKeyboard",value:function _hideDropdownFromKeyboard(){if(_classPrivateFieldGet(_isMainColorPicker,this)){return;}if(!_classPrivateGetter(_ColorPicker_brand,this,_get_isDropdownVisible)){var _classPrivateFieldGet99;(_classPrivateFieldGet99=_classPrivateFieldGet(_editor3,this))===null||_classPrivateFieldGet99===void 0||_classPrivateFieldGet99.unselect();return;}this.hideDropdown();_classPrivateFieldGet(_button,this).focus({preventScroll:true,focusVisible:_classPrivateFieldGet(_dropdownWasFromKeyboard,this)});}},{key:"updateColor",value:function updateColor(color){if(_classPrivateFieldGet(_buttonSwatch,this)){_classPrivateFieldGet(_buttonSwatch,this).style.backgroundColor=color;}if(!_classPrivateFieldGet(_dropdown,this)){return;}var i=_classPrivateFieldGet(_uiManager3,this).highlightColors.values();var _iterator144=_createForOfIteratorHelper(_classPrivateFieldGet(_dropdown,this).children),_step144;try{for(_iterator144.s();!(_step144=_iterator144.n()).done;){var child=_step144.value;child.setAttribute("aria-selected",i.next().value===color);}}catch(err){_iterator144.e(err);}finally{_iterator144.f();}}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet100,_classPrivateFieldGet101;(_classPrivateFieldGet100=_classPrivateFieldGet(_button,this))===null||_classPrivateFieldGet100===void 0||_classPrivateFieldGet100.remove();_classPrivateFieldSet(_button,this,null);_classPrivateFieldSet(_buttonSwatch,this,null);(_classPrivateFieldGet101=_classPrivateFieldGet(_dropdown,this))===null||_classPrivateFieldGet101===void 0||_classPrivateFieldGet101.remove();_classPrivateFieldSet(_dropdown,this,null);}}],[{key:"_keyboardManager",get:function get(){return _shadow(this,"_keyboardManager",new KeyboardManager([[["Escape","mac+Escape"],_ColorPicker.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],_ColorPicker.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],_ColorPicker.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],_ColorPicker.prototype._moveToPrevious],[["Home","mac+Home"],_ColorPicker.prototype._moveToBeginning],[["End","mac+End"],_ColorPicker.prototype._moveToEnd]]));}}]);}();_ColorPicker2=_ColorPicker;function _getDropdownRoot(){var div=document.createElement("div");var signal=_classPrivateFieldGet(_uiManager3,this)._signal;div.addEventListener("contextmenu",_noContextMenu,{signal:signal});div.className="dropdown";div.role="listbox";div.setAttribute("aria-multiselectable",false);div.setAttribute("aria-orientation","vertical");div.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");var _iterator187=_createForOfIteratorHelper(_classPrivateFieldGet(_uiManager3,this).highlightColors),_step187;try{for(_iterator187.s();!(_step187=_iterator187.n()).done;){var _step187$value=_slicedToArray(_step187.value,2),name=_step187$value[0],color=_step187$value[1];var button=document.createElement("button");button.tabIndex="0";button.role="option";button.setAttribute("data-color",color);button.title=name;button.setAttribute("data-l10n-id",_l10nColor._[name]);var swatch=document.createElement("span");button.append(swatch);swatch.className="swatch";swatch.style.backgroundColor=color;button.setAttribute("aria-selected",color===_classPrivateFieldGet(_defaultColor,this));button.addEventListener("click",_assertClassBrand(_ColorPicker_brand,this,_colorSelect).bind(this,color),{signal:signal});div.append(button);}}catch(err){_iterator187.e(err);}finally{_iterator187.f();}div.addEventListener("keydown",_assertClassBrand(_ColorPicker_brand,this,_keyDown2).bind(this),{signal:signal});return div;}function _colorSelect(color,event){event.stopPropagation();_classPrivateFieldGet(_eventBus,this).dispatch("switchannotationeditorparams",{source:this,type:_classPrivateFieldGet(_type3,this),value:color});}function _keyDown2(event){_ColorPicker2._keyboardManager.exec(this,event);}function _openDropdown(event){if(_classPrivateGetter(_ColorPicker_brand,this,_get_isDropdownVisible)){this.hideDropdown();return;}_classPrivateFieldSet(_dropdownWasFromKeyboard,this,event.detail===0);if(!_classPrivateFieldGet(_openDropdownAC,this)){_classPrivateFieldSet(_openDropdownAC,this,new AbortController());window.addEventListener("pointerdown",_assertClassBrand(_ColorPicker_brand,this,_pointerDown3).bind(this),{signal:_classPrivateFieldGet(_uiManager3,this).combinedSignal(_classPrivateFieldGet(_openDropdownAC,this))});}if(_classPrivateFieldGet(_dropdown,this)){_classPrivateFieldGet(_dropdown,this).classList.remove("hidden");return;}var root=_classPrivateFieldSet(_dropdown,this,_assertClassBrand(_ColorPicker_brand,this,_getDropdownRoot).call(this));_classPrivateFieldGet(_button,this).append(root);}function _pointerDown3(event){var _classPrivateFieldGet168;if((_classPrivateFieldGet168=_classPrivateFieldGet(_dropdown,this))!==null&&_classPrivateFieldGet168!==void 0&&_classPrivateFieldGet168.contains(event.target)){return;}this.hideDropdown();}function _get_isDropdownVisible(_this89){return _classPrivateFieldGet(_dropdown,_this89)&&!_classPrivateFieldGet(_dropdown,_this89).classList.contains("hidden");}var _l10nColor={_:null};;// ./src/display/editor/highlight.js
var _anchorNode=/*#__PURE__*/new WeakMap();var _anchorOffset=/*#__PURE__*/new WeakMap();var _boxes=/*#__PURE__*/new WeakMap();var _clipPathId=/*#__PURE__*/new WeakMap();var _colorPicker2=/*#__PURE__*/new WeakMap();var _focusOutlines=/*#__PURE__*/new WeakMap();var _focusNode=/*#__PURE__*/new WeakMap();var _focusOffset=/*#__PURE__*/new WeakMap();var _highlightDiv=/*#__PURE__*/new WeakMap();var _highlightOutlines=/*#__PURE__*/new WeakMap();var _id9=/*#__PURE__*/new WeakMap();var _isFreeHighlight=/*#__PURE__*/new WeakMap();var _lastPoint2=/*#__PURE__*/new WeakMap();var _opacity=/*#__PURE__*/new WeakMap();var _outlineId=/*#__PURE__*/new WeakMap();var _text=/*#__PURE__*/new WeakMap();var _thickness2=/*#__PURE__*/new WeakMap();var _methodOfCreation=/*#__PURE__*/new WeakMap();var _HighlightEditor_brand=/*#__PURE__*/new WeakSet();var HighlightEditor=/*#__PURE__*/function(_AnnotationEditor4){function HighlightEditor(params){var _this90;_classCallCheck(this,HighlightEditor);_this90=_callSuper(this,HighlightEditor,[_objectSpread(_objectSpread({},params),{},{name:"highlightEditor"})]);_classPrivateMethodInitSpec(_this90,_HighlightEditor_brand);_classPrivateFieldInitSpec(_this90,_anchorNode,null);_classPrivateFieldInitSpec(_this90,_anchorOffset,0);_classPrivateFieldInitSpec(_this90,_boxes,void 0);_classPrivateFieldInitSpec(_this90,_clipPathId,null);_classPrivateFieldInitSpec(_this90,_colorPicker2,null);_classPrivateFieldInitSpec(_this90,_focusOutlines,null);_classPrivateFieldInitSpec(_this90,_focusNode,null);_classPrivateFieldInitSpec(_this90,_focusOffset,0);_classPrivateFieldInitSpec(_this90,_highlightDiv,null);_classPrivateFieldInitSpec(_this90,_highlightOutlines,null);_classPrivateFieldInitSpec(_this90,_id9,null);_classPrivateFieldInitSpec(_this90,_isFreeHighlight,false);_classPrivateFieldInitSpec(_this90,_lastPoint2,null);_classPrivateFieldInitSpec(_this90,_opacity,void 0);_classPrivateFieldInitSpec(_this90,_outlineId,null);_classPrivateFieldInitSpec(_this90,_text,"");_classPrivateFieldInitSpec(_this90,_thickness2,void 0);_classPrivateFieldInitSpec(_this90,_methodOfCreation,"");_this90.color=params.color||HighlightEditor._defaultColor;_classPrivateFieldSet(_thickness2,_this90,params.thickness||HighlightEditor._defaultThickness);_classPrivateFieldSet(_opacity,_this90,params.opacity||HighlightEditor._defaultOpacity);_classPrivateFieldSet(_boxes,_this90,params.boxes||null);_classPrivateFieldSet(_methodOfCreation,_this90,params.methodOfCreation||"");_classPrivateFieldSet(_text,_this90,params.text||"");_this90._isDraggable=false;_this90.defaultL10nId="pdfjs-editor-highlight-editor";if(params.highlightId>-1){_classPrivateFieldSet(_isFreeHighlight,_this90,true);_assertClassBrand(_HighlightEditor_brand,_this90,_createFreeOutlines).call(_this90,params);_assertClassBrand(_HighlightEditor_brand,_this90,_addToDrawLayer).call(_this90);}else if(_classPrivateFieldGet(_boxes,_this90)){_classPrivateFieldSet(_anchorNode,_this90,params.anchorNode);_classPrivateFieldSet(_anchorOffset,_this90,params.anchorOffset);_classPrivateFieldSet(_focusNode,_this90,params.focusNode);_classPrivateFieldSet(_focusOffset,_this90,params.focusOffset);_assertClassBrand(_HighlightEditor_brand,_this90,_createOutlines).call(_this90);_assertClassBrand(_HighlightEditor_brand,_this90,_addToDrawLayer).call(_this90);_this90.rotate(_this90.rotation);}return _this90;}_inherits(HighlightEditor,_AnnotationEditor4);return _createClass(HighlightEditor,[{key:"telemetryInitialData",get:function get(){return{action:"added",type:_classPrivateFieldGet(_isFreeHighlight,this)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:_classPrivateFieldGet(_thickness2,this),methodOfCreation:_classPrivateFieldGet(_methodOfCreation,this)};}},{key:"telemetryFinalData",get:function get(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)};}},{key:"translateInPage",value:function translateInPage(x,y){}},{key:"toolbarPosition",get:function get(){return _classPrivateFieldGet(_lastPoint2,this);}},{key:"updateParams",value:function updateParams(type,value){switch(type){case _AnnotationEditorParamsType.HIGHLIGHT_COLOR:_assertClassBrand(_HighlightEditor_brand,this,_updateColor2).call(this,value);break;case _AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:_assertClassBrand(_HighlightEditor_brand,this,_updateThickness).call(this,value);break;}}},{key:"propertiesToUpdate",get:function get(){return[[_AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||HighlightEditor._defaultColor],[_AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,_classPrivateFieldGet(_thickness2,this)||HighlightEditor._defaultThickness],[_AnnotationEditorParamsType.HIGHLIGHT_FREE,_classPrivateFieldGet(_isFreeHighlight,this)]];}},{key:"addEditToolbar",value:function(){var _addEditToolbar2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee46(){var toolbar;return _regenerator().w(function(_context47){while(1)switch(_context47.n){case 0:_context47.n=1;return _superPropGet(HighlightEditor,"addEditToolbar",this,3)([]);case 1:toolbar=_context47.v;if(toolbar){_context47.n=2;break;}return _context47.a(2,null);case 2:if(this._uiManager.highlightColors){_classPrivateFieldSet(_colorPicker2,this,new _ColorPicker({editor:this}));toolbar.addColorPicker(_classPrivateFieldGet(_colorPicker2,this));}return _context47.a(2,toolbar);}},_callee46,this);}));function addEditToolbar(){return _addEditToolbar2.apply(this,arguments);}return addEditToolbar;}()},{key:"disableEditing",value:function disableEditing(){_superPropGet(HighlightEditor,"disableEditing",this,3)([]);this.div.classList.toggle("disabled",true);}},{key:"enableEditing",value:function enableEditing(){_superPropGet(HighlightEditor,"enableEditing",this,3)([]);this.div.classList.toggle("disabled",false);}},{key:"fixAndSetPosition",value:function fixAndSetPosition(){return _superPropGet(HighlightEditor,"fixAndSetPosition",this,3)([_assertClassBrand(_HighlightEditor_brand,this,_getRotation).call(this)]);}},{key:"getBaseTranslation",value:function getBaseTranslation(){return[0,0];}},{key:"getRect",value:function getRect(tx,ty){return _superPropGet(HighlightEditor,"getRect",this,3)([tx,ty,_assertClassBrand(_HighlightEditor_brand,this,_getRotation).call(this)]);}},{key:"onceAdded",value:function onceAdded(focus){if(!this.annotationElementId){this.parent.addUndoableEditor(this);}if(focus){this.div.focus();}}},{key:"remove",value:function remove(){_assertClassBrand(_HighlightEditor_brand,this,_cleanDrawLayer).call(this);this._reportTelemetry({action:"deleted"});_superPropGet(HighlightEditor,"remove",this,3)([]);}},{key:"rebuild",value:function rebuild(){if(!this.parent){return;}_superPropGet(HighlightEditor,"rebuild",this,3)([]);if(this.div===null){return;}_assertClassBrand(_HighlightEditor_brand,this,_addToDrawLayer).call(this);if(!this.isAttachedToDOM){this.parent.add(this);}}},{key:"setParent",value:function setParent(parent){var mustBeSelected=false;if(this.parent&&!parent){_assertClassBrand(_HighlightEditor_brand,this,_cleanDrawLayer).call(this);}else if(parent){var _this$div5;_assertClassBrand(_HighlightEditor_brand,this,_addToDrawLayer).call(this,parent);mustBeSelected=!this.parent&&((_this$div5=this.div)===null||_this$div5===void 0?void 0:_this$div5.classList.contains("selectedEditor"));}_superPropGet(HighlightEditor,"setParent",this,3)([parent]);this.show(this._isVisible);if(mustBeSelected){this.select();}}},{key:"rotate",value:function rotate(angle){var drawLayer=this.parent.drawLayer;var box;if(_classPrivateFieldGet(_isFreeHighlight,this)){angle=(angle-this.rotation+360)%360;box=_rotateBbox.call(HighlightEditor,_classPrivateFieldGet(_highlightOutlines,this).box,angle);}else{box=_rotateBbox.call(HighlightEditor,[this.x,this.y,this.width,this.height],angle);}drawLayer.updateProperties(_classPrivateFieldGet(_id9,this),{bbox:box,root:{"data-main-rotation":angle}});drawLayer.updateProperties(_classPrivateFieldGet(_outlineId,this),{bbox:_rotateBbox.call(HighlightEditor,_classPrivateFieldGet(_focusOutlines,this).box,angle),root:{"data-main-rotation":angle}});}},{key:"render",value:function render(){if(this.div){return this.div;}var div=_superPropGet(HighlightEditor,"render",this,3)([]);if(_classPrivateFieldGet(_text,this)){div.setAttribute("aria-label",_classPrivateFieldGet(_text,this));div.setAttribute("role","mark");}if(_classPrivateFieldGet(_isFreeHighlight,this)){div.classList.add("free");}else{this.div.addEventListener("keydown",_assertClassBrand(_HighlightEditor_brand,this,_keydown).bind(this),{signal:this._uiManager._signal});}var highlightDiv=_classPrivateFieldSet(_highlightDiv,this,document.createElement("div"));div.append(highlightDiv);highlightDiv.setAttribute("aria-hidden","true");highlightDiv.className="internal";highlightDiv.style.clipPath=_classPrivateFieldGet(_clipPathId,this);var _this$parentDimension0=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension0[0],parentHeight=_this$parentDimension0[1];this.setDims(this.width*parentWidth,this.height*parentHeight);bindEvents(this,_classPrivateFieldGet(_highlightDiv,this),["pointerover","pointerleave"]);this.enableEditing();return div;}},{key:"pointerover",value:function pointerover(){if(!this.isSelected){var _this$parent3;(_this$parent3=this.parent)===null||_this$parent3===void 0||_this$parent3.drawLayer.updateProperties(_classPrivateFieldGet(_outlineId,this),{rootClass:{hovered:true}});}}},{key:"pointerleave",value:function pointerleave(){if(!this.isSelected){var _this$parent4;(_this$parent4=this.parent)===null||_this$parent4===void 0||_this$parent4.drawLayer.updateProperties(_classPrivateFieldGet(_outlineId,this),{rootClass:{hovered:false}});}}},{key:"_moveCaret",value:function _moveCaret(direction){this.parent.unselect(this);switch(direction){case 0:case 2:_assertClassBrand(_HighlightEditor_brand,this,_setCaret).call(this,true);break;case 1:case 3:_assertClassBrand(_HighlightEditor_brand,this,_setCaret).call(this,false);break;}}},{key:"select",value:function select(){var _this$parent5;_superPropGet(HighlightEditor,"select",this,3)([]);if(!_classPrivateFieldGet(_outlineId,this)){return;}(_this$parent5=this.parent)===null||_this$parent5===void 0||_this$parent5.drawLayer.updateProperties(_classPrivateFieldGet(_outlineId,this),{rootClass:{hovered:false,selected:true}});}},{key:"unselect",value:function unselect(){var _this$parent6;_superPropGet(HighlightEditor,"unselect",this,3)([]);if(!_classPrivateFieldGet(_outlineId,this)){return;}(_this$parent6=this.parent)===null||_this$parent6===void 0||_this$parent6.drawLayer.updateProperties(_classPrivateFieldGet(_outlineId,this),{rootClass:{selected:false}});if(!_classPrivateFieldGet(_isFreeHighlight,this)){_assertClassBrand(_HighlightEditor_brand,this,_setCaret).call(this,false);}}},{key:"_mustFixPosition",get:function get(){return!_classPrivateFieldGet(_isFreeHighlight,this);}},{key:"show",value:function show(){var visible=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._isVisible;_superPropGet(HighlightEditor,"show",this,3)([visible]);if(this.parent){this.parent.drawLayer.updateProperties(_classPrivateFieldGet(_id9,this),{rootClass:{hidden:!visible}});this.parent.drawLayer.updateProperties(_classPrivateFieldGet(_outlineId,this),{rootClass:{hidden:!visible}});}}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isEmpty()||isForCopying){return null;}if(this.deleted){return this.serializeDeleted();}var rect=this.getRect(0,0);var color=AnnotationEditor._colorManager.convert(this.color);var serialized={annotationType:_AnnotationEditorType.HIGHLIGHT,color:color,opacity:_classPrivateFieldGet(_opacity,this),thickness:_classPrivateFieldGet(_thickness2,this),quadPoints:_assertClassBrand(_HighlightEditor_brand,this,_serializeBoxes).call(this),outlines:_assertClassBrand(_HighlightEditor_brand,this,_serializeOutlines).call(this,rect),pageIndex:this.pageIndex,rect:rect,rotation:_assertClassBrand(_HighlightEditor_brand,this,_getRotation).call(this),structTreeParentId:this._structTreeParentId};if(this.annotationElementId&&!_assertClassBrand(_HighlightEditor_brand,this,_hasElementChanged2).call(this,serialized)){return null;}serialized.id=this.annotationElementId;return serialized;}},{key:"renderAnnotationElement",value:function renderAnnotationElement(annotation){annotation.updateEdited({rect:this.getRect(0,0)});return null;}}],[{key:"_keyboardManager",get:function get(){var proto=HighlightEditor.prototype;return _shadow(this,"_keyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],proto._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],proto._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],proto._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],proto._moveCaret,{args:[3]}]]));}},{key:"computeTelemetryFinalData",value:function computeTelemetryFinalData(data){return{numberOfColors:data.get("color").size};}},{key:"initialize",value:function initialize(l10n,uiManager){var _uiManager$highlightC;AnnotationEditor.initialize(l10n,uiManager);HighlightEditor._defaultColor||(HighlightEditor._defaultColor=((_uiManager$highlightC=uiManager.highlightColors)===null||_uiManager$highlightC===void 0?void 0:_uiManager$highlightC.values().next().value)||"#fff066");}},{key:"updateDefaultParams",value:function updateDefaultParams(type,value){switch(type){case _AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:HighlightEditor._defaultColor=value;break;case _AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:HighlightEditor._defaultThickness=value;break;}}},{key:"defaultPropertiesToUpdate",get:function get(){return[[_AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,HighlightEditor._defaultColor],[_AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,HighlightEditor._defaultThickness]];}},{key:"startHighlighting",value:function startHighlighting(parent,isLTR,_ref106){var _this91=this;var textLayer=_ref106.target,x=_ref106.x,y=_ref106.y;var _textLayer$getBoundin2=textLayer.getBoundingClientRect(),layerX=_textLayer$getBoundin2.x,layerY=_textLayer$getBoundin2.y,parentWidth=_textLayer$getBoundin2.width,parentHeight=_textLayer$getBoundin2.height;var ac=new AbortController();var signal=parent.combinedSignal(ac);var pointerUpCallback=function pointerUpCallback(e){ac.abort();_assertClassBrand(HighlightEditor,_this91,_endHighlight).call(_this91,parent,e);};window.addEventListener("blur",pointerUpCallback,{signal:signal});window.addEventListener("pointerup",pointerUpCallback,{signal:signal});window.addEventListener("pointerdown",_stopEvent,{capture:true,passive:false,signal:signal});window.addEventListener("contextmenu",_noContextMenu,{signal:signal});textLayer.addEventListener("pointermove",_assertClassBrand(HighlightEditor,this,_highlightMove).bind(this,parent),{signal:signal});this._freeHighlight=new FreeHighlightOutliner({x:x,y:y},[layerX,layerY,parentWidth,parentHeight],parent.scale,this._defaultThickness/2,isLTR,0.001);var _parent$drawLayer$dra=parent.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:true,free:true},path:{d:this._freeHighlight.toSVGPath()}},true,true);this._freeHighlightId=_parent$drawLayer$dra.id;this._freeHighlightClipId=_parent$drawLayer$dra.clipPathId;}},{key:"deserialize",value:function(){var _deserialize3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee47(data,parent,uiManager){var initialData,_data6,_data6$data,_quadPoints,rect,rotation,id,_color3,_opacity2,popupRef,pageNumber,_data7,_data7$data,_inkLists,_rect4,_rotation5,_id0,_color4,thickness,_popupRef,_pageNumber,_data8,color,quadPoints,inkLists,opacity,editor,_editor$pageDimension2,pageWidth,pageHeight,_editor$pageTranslati,pageX,pageY,boxes,i,points,point,outliner,_i24,ii,_parent$drawLayer$dra2,_id1,clipPathId;return _regenerator().w(function(_context48){while(1)switch(_context48.n){case 0:initialData=null;if(data instanceof HighlightAnnotationElement){_data6=data,_data6$data=_data6.data,_quadPoints=_data6$data.quadPoints,rect=_data6$data.rect,rotation=_data6$data.rotation,id=_data6$data.id,_color3=_data6$data.color,_opacity2=_data6$data.opacity,popupRef=_data6$data.popupRef,pageNumber=_data6.parent.page.pageNumber;initialData=data={annotationType:_AnnotationEditorType.HIGHLIGHT,color:Array.from(_color3),opacity:_opacity2,quadPoints:_quadPoints,boxes:null,pageIndex:pageNumber-1,rect:rect.slice(0),rotation:rotation,id:id,deleted:false,popupRef:popupRef};}else if(data instanceof InkAnnotationElement){_data7=data,_data7$data=_data7.data,_inkLists=_data7$data.inkLists,_rect4=_data7$data.rect,_rotation5=_data7$data.rotation,_id0=_data7$data.id,_color4=_data7$data.color,thickness=_data7$data.borderStyle.rawWidth,_popupRef=_data7$data.popupRef,_pageNumber=_data7.parent.page.pageNumber;initialData=data={annotationType:_AnnotationEditorType.HIGHLIGHT,color:Array.from(_color4),thickness:thickness,inkLists:_inkLists,boxes:null,pageIndex:_pageNumber-1,rect:_rect4.slice(0),rotation:_rotation5,id:_id0,deleted:false,popupRef:_popupRef};}_data8=data,color=_data8.color,quadPoints=_data8.quadPoints,inkLists=_data8.inkLists,opacity=_data8.opacity;_context48.n=1;return _superPropGet(HighlightEditor,"deserialize",this,2)([data,parent,uiManager]);case 1:editor=_context48.v;editor.color=_Util.makeHexColor.apply(_Util,_toConsumableArray(color));_classPrivateFieldSet(_opacity,editor,opacity||1);if(inkLists){_classPrivateFieldSet(_thickness2,editor,data.thickness);}editor.annotationElementId=data.id||null;editor._initialData=initialData;_editor$pageDimension2=_slicedToArray(editor.pageDimensions,2),pageWidth=_editor$pageDimension2[0],pageHeight=_editor$pageDimension2[1];_editor$pageTranslati=_slicedToArray(editor.pageTranslation,2),pageX=_editor$pageTranslati[0],pageY=_editor$pageTranslati[1];if(quadPoints){boxes=_classPrivateFieldSet(_boxes,editor,[]);for(i=0;i<quadPoints.length;i+=8){boxes.push({x:(quadPoints[i]-pageX)/pageWidth,y:1-(quadPoints[i+1]-pageY)/pageHeight,width:(quadPoints[i+2]-quadPoints[i])/pageWidth,height:(quadPoints[i+1]-quadPoints[i+5])/pageHeight});}_assertClassBrand(_HighlightEditor_brand,editor,_createOutlines).call(editor);_assertClassBrand(_HighlightEditor_brand,editor,_addToDrawLayer).call(editor);editor.rotate(editor.rotation);}else if(inkLists){_classPrivateFieldSet(_isFreeHighlight,editor,true);points=inkLists[0];point={x:points[0]-pageX,y:pageHeight-(points[1]-pageY)};outliner=new FreeHighlightOutliner(point,[0,0,pageWidth,pageHeight],1,_classPrivateFieldGet(_thickness2,editor)/2,true,0.001);for(_i24=0,ii=points.length;_i24<ii;_i24+=2){point.x=points[_i24]-pageX;point.y=pageHeight-(points[_i24+1]-pageY);outliner.add(point);}_parent$drawLayer$dra2=parent.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:editor.color,"fill-opacity":editor._defaultOpacity},rootClass:{highlight:true,free:true},path:{d:outliner.toSVGPath()}},true,true),_id1=_parent$drawLayer$dra2.id,clipPathId=_parent$drawLayer$dra2.clipPathId;_assertClassBrand(_HighlightEditor_brand,editor,_createFreeOutlines).call(editor,{highlightOutlines:outliner.getOutlines(),highlightId:_id1,clipPathId:clipPathId});_assertClassBrand(_HighlightEditor_brand,editor,_addToDrawLayer).call(editor);editor.rotate(editor.parentRotation);}return _context48.a(2,editor);}},_callee47,this);}));function deserialize(_x42,_x43,_x44){return _deserialize3.apply(this,arguments);}return deserialize;}()},{key:"canCreateNewEmptyEditor",value:function canCreateNewEmptyEditor(){return false;}}]);}(AnnotationEditor);_HighlightEditor=HighlightEditor;function _createOutlines(){var outliner=new HighlightOutliner(_classPrivateFieldGet(_boxes,this),0.001);_classPrivateFieldSet(_highlightOutlines,this,outliner.getOutlines());var _classPrivateFieldGet169=_slicedToArray(_classPrivateFieldGet(_highlightOutlines,this).box,4);this.x=_classPrivateFieldGet169[0];this.y=_classPrivateFieldGet169[1];this.width=_classPrivateFieldGet169[2];this.height=_classPrivateFieldGet169[3];var outlinerForOutline=new HighlightOutliner(_classPrivateFieldGet(_boxes,this),0.0025,0.001,this._uiManager.direction==="ltr");_classPrivateFieldSet(_focusOutlines,this,outlinerForOutline.getOutlines());var _classPrivateFieldGet170=_classPrivateFieldGet(_focusOutlines,this),lastPoint=_classPrivateFieldGet170.lastPoint;_classPrivateFieldSet(_lastPoint2,this,[(lastPoint[0]-this.x)/this.width,(lastPoint[1]-this.y)/this.height]);}function _createFreeOutlines(_ref145){var highlightOutlines=_ref145.highlightOutlines,highlightId=_ref145.highlightId,clipPathId=_ref145.clipPathId;_classPrivateFieldSet(_highlightOutlines,this,highlightOutlines);var extraThickness=1.5;_classPrivateFieldSet(_focusOutlines,this,highlightOutlines.getNewOutline(_classPrivateFieldGet(_thickness2,this)/2+extraThickness,0.0025));if(highlightId>=0){_classPrivateFieldSet(_id9,this,highlightId);_classPrivateFieldSet(_clipPathId,this,clipPathId);this.parent.drawLayer.finalizeDraw(highlightId,{bbox:highlightOutlines.box,path:{d:highlightOutlines.toSVGPath()}});_classPrivateFieldSet(_outlineId,this,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:true,free:true},bbox:_classPrivateFieldGet(_focusOutlines,this).box,path:{d:_classPrivateFieldGet(_focusOutlines,this).toSVGPath()}},true));}else if(this.parent){var angle=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(_classPrivateFieldGet(_id9,this),{bbox:_rotateBbox.call(_HighlightEditor,_classPrivateFieldGet(_highlightOutlines,this).box,(angle-this.rotation+360)%360),path:{d:highlightOutlines.toSVGPath()}});this.parent.drawLayer.updateProperties(_classPrivateFieldGet(_outlineId,this),{bbox:_rotateBbox.call(_HighlightEditor,_classPrivateFieldGet(_focusOutlines,this).box,angle),path:{d:_classPrivateFieldGet(_focusOutlines,this).toSVGPath()}});}var _highlightOutlines$bo=_slicedToArray(highlightOutlines.box,4),x=_highlightOutlines$bo[0],y=_highlightOutlines$bo[1],width=_highlightOutlines$bo[2],height=_highlightOutlines$bo[3];switch(this.rotation){case 0:this.x=x;this.y=y;this.width=width;this.height=height;break;case 90:{var _this$parentDimension15=_slicedToArray(this.parentDimensions,2),pageWidth=_this$parentDimension15[0],pageHeight=_this$parentDimension15[1];this.x=y;this.y=1-x;this.width=width*pageHeight/pageWidth;this.height=height*pageWidth/pageHeight;break;}case 180:this.x=1-x;this.y=1-y;this.width=width;this.height=height;break;case 270:{var _this$parentDimension16=_slicedToArray(this.parentDimensions,2),_pageWidth5=_this$parentDimension16[0],_pageHeight5=_this$parentDimension16[1];this.x=1-y;this.y=x;this.width=width*_pageHeight5/_pageWidth5;this.height=height*_pageWidth5/_pageHeight5;break;}}var _classPrivateFieldGet171=_classPrivateFieldGet(_focusOutlines,this),lastPoint=_classPrivateFieldGet171.lastPoint;_classPrivateFieldSet(_lastPoint2,this,[(lastPoint[0]-x)/width,(lastPoint[1]-y)/height]);}function _updateColor2(color){var _this117=this;var setColorAndOpacity=function setColorAndOpacity(col,opa){var _this117$parent,_classPrivateFieldGet172;_this117.color=col;_classPrivateFieldSet(_opacity,_this117,opa);(_this117$parent=_this117.parent)===null||_this117$parent===void 0||_this117$parent.drawLayer.updateProperties(_classPrivateFieldGet(_id9,_this117),{root:{fill:col,"fill-opacity":opa}});(_classPrivateFieldGet172=_classPrivateFieldGet(_colorPicker2,_this117))===null||_classPrivateFieldGet172===void 0||_classPrivateFieldGet172.updateColor(col);};var savedColor=this.color;var savedOpacity=_classPrivateFieldGet(_opacity,this);this.addCommands({cmd:setColorAndOpacity.bind(this,color,_HighlightEditor._defaultOpacity),undo:setColorAndOpacity.bind(this,savedColor,savedOpacity),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:_AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:true,keepUndo:true});this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(color)},true);}function _updateThickness(thickness){var _this118=this;var savedThickness=_classPrivateFieldGet(_thickness2,this);var setThickness=function setThickness(th){_classPrivateFieldSet(_thickness2,_this118,th);_assertClassBrand(_HighlightEditor_brand,_this118,_changeThickness).call(_this118,th);};this.addCommands({cmd:setThickness.bind(this,thickness),undo:setThickness.bind(this,savedThickness),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:_AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:true,keepUndo:true});this._reportTelemetry({action:"thickness_changed",thickness:thickness},true);}function _changeThickness(thickness){if(!_classPrivateFieldGet(_isFreeHighlight,this)){return;}_assertClassBrand(_HighlightEditor_brand,this,_createFreeOutlines).call(this,{highlightOutlines:_classPrivateFieldGet(_highlightOutlines,this).getNewOutline(thickness/2)});this.fixAndSetPosition();var _this$parentDimension17=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension17[0],parentHeight=_this$parentDimension17[1];this.setDims(this.width*parentWidth,this.height*parentHeight);}function _cleanDrawLayer(){if(_classPrivateFieldGet(_id9,this)===null||!this.parent){return;}this.parent.drawLayer.remove(_classPrivateFieldGet(_id9,this));_classPrivateFieldSet(_id9,this,null);this.parent.drawLayer.remove(_classPrivateFieldGet(_outlineId,this));_classPrivateFieldSet(_outlineId,this,null);}function _addToDrawLayer(){var parent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.parent;if(_classPrivateFieldGet(_id9,this)!==null){return;}var _parent$drawLayer$dra4=parent.drawLayer.draw({bbox:_classPrivateFieldGet(_highlightOutlines,this).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":_classPrivateFieldGet(_opacity,this)},rootClass:{highlight:true,free:_classPrivateFieldGet(_isFreeHighlight,this)},path:{d:_classPrivateFieldGet(_highlightOutlines,this).toSVGPath()}},false,true);_toSetter(_classPrivateFieldSet,[_id9,this])._=_parent$drawLayer$dra4.id;_toSetter(_classPrivateFieldSet,[_clipPathId,this])._=_parent$drawLayer$dra4.clipPathId;_classPrivateFieldSet(_outlineId,this,parent.drawLayer.drawOutline({rootClass:{highlightOutline:true,free:_classPrivateFieldGet(_isFreeHighlight,this)},bbox:_classPrivateFieldGet(_focusOutlines,this).box,path:{d:_classPrivateFieldGet(_focusOutlines,this).toSVGPath()}},_classPrivateFieldGet(_isFreeHighlight,this)));if(_classPrivateFieldGet(_highlightDiv,this)){_classPrivateFieldGet(_highlightDiv,this).style.clipPath=_classPrivateFieldGet(_clipPathId,this);}}function _rotateBbox(_ref146,angle){var _ref147=_slicedToArray(_ref146,4),x=_ref147[0],y=_ref147[1],width=_ref147[2],height=_ref147[3];switch(angle){case 90:return[1-y-height,x,height,width];case 180:return[1-x-width,1-y-height,width,height];case 270:return[y,1-x-width,height,width];}return[x,y,width,height];}function _keydown(event){_HighlightEditor._keyboardManager.exec(this,event);}function _setCaret(start){if(!_classPrivateFieldGet(_anchorNode,this)){return;}var selection=window.getSelection();if(start){selection.setPosition(_classPrivateFieldGet(_anchorNode,this),_classPrivateFieldGet(_anchorOffset,this));}else{selection.setPosition(_classPrivateFieldGet(_focusNode,this),_classPrivateFieldGet(_focusOffset,this));}}function _getRotation(){return _classPrivateFieldGet(_isFreeHighlight,this)?this.rotation:0;}function _serializeBoxes(){if(_classPrivateFieldGet(_isFreeHighlight,this)){return null;}var _this$pageDimensions0=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions0[0],pageHeight=_this$pageDimensions0[1];var _this$pageTranslation6=_slicedToArray(this.pageTranslation,2),pageX=_this$pageTranslation6[0],pageY=_this$pageTranslation6[1];var boxes=_classPrivateFieldGet(_boxes,this);var quadPoints=new Float32Array(boxes.length*8);var i=0;var _iterator188=_createForOfIteratorHelper(boxes),_step188;try{for(_iterator188.s();!(_step188=_iterator188.n()).done;){var _step188$value=_step188.value,x=_step188$value.x,y=_step188$value.y,width=_step188$value.width,height=_step188$value.height;var sx=x*pageWidth+pageX;var sy=(1-y)*pageHeight+pageY;quadPoints[i]=quadPoints[i+4]=sx;quadPoints[i+1]=quadPoints[i+3]=sy;quadPoints[i+2]=quadPoints[i+6]=sx+width*pageWidth;quadPoints[i+5]=quadPoints[i+7]=sy-height*pageHeight;i+=8;}}catch(err){_iterator188.e(err);}finally{_iterator188.f();}return quadPoints;}function _serializeOutlines(rect){return _classPrivateFieldGet(_highlightOutlines,this).serialize(rect,_assertClassBrand(_HighlightEditor_brand,this,_getRotation).call(this));}function _highlightMove(parent,event){if(this._freeHighlight.add(event)){parent.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}});}}function _endHighlight(parent,event){if(!this._freeHighlight.isEmpty()){parent.createAndAddNewEditor(event,false,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"});}else{parent.drawLayer.remove(this._freeHighlightId);}this._freeHighlightId=-1;this._freeHighlight=null;this._freeHighlightClipId="";}function _hasElementChanged2(serialized){var color=this._initialData.color;return serialized.color.some(function(c,i){return c!==color[i];});}_defineProperty(HighlightEditor,"_defaultColor",null);_defineProperty(HighlightEditor,"_defaultOpacity",1);_defineProperty(HighlightEditor,"_defaultThickness",12);_defineProperty(HighlightEditor,"_type","highlight");_defineProperty(HighlightEditor,"_editorType",_AnnotationEditorType.HIGHLIGHT);_defineProperty(HighlightEditor,"_freeHighlightId",-1);_defineProperty(HighlightEditor,"_freeHighlight",null);_defineProperty(HighlightEditor,"_freeHighlightClipId","");;// ./src/display/editor/draw.js
var _svgProperties=/*#__PURE__*/new WeakMap();var DrawingOptions=/*#__PURE__*/function(){function DrawingOptions(){_classCallCheck(this,DrawingOptions);_classPrivateFieldInitSpec(this,_svgProperties,Object.create(null));}return _createClass(DrawingOptions,[{key:"updateProperty",value:function updateProperty(name,value){this[name]=value;this.updateSVGProperty(name,value);}},{key:"updateProperties",value:function updateProperties(properties){if(!properties){return;}for(var _i25=0,_Object$entries6=Object.entries(properties);_i25<_Object$entries6.length;_i25++){var _Object$entries6$_i=_slicedToArray(_Object$entries6[_i25],2),name=_Object$entries6$_i[0],value=_Object$entries6$_i[1];if(!name.startsWith("_")){this.updateProperty(name,value);}}}},{key:"updateSVGProperty",value:function updateSVGProperty(name,value){_classPrivateFieldGet(_svgProperties,this)[name]=value;}},{key:"toSVGProperties",value:function toSVGProperties(){var root=_classPrivateFieldGet(_svgProperties,this);_classPrivateFieldSet(_svgProperties,this,Object.create(null));return{root:root};}},{key:"reset",value:function reset(){_classPrivateFieldSet(_svgProperties,this,Object.create(null));}},{key:"updateAll",value:function updateAll(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this;this.updateProperties(options);}},{key:"clone",value:function clone(){unreachable("Not implemented");}}]);}();var _drawOutlines=/*#__PURE__*/new WeakMap();var _mustBeCommitted=/*#__PURE__*/new WeakMap();var _DrawingEditor_brand=/*#__PURE__*/new WeakSet();var DrawingEditor=/*#__PURE__*/function(_AnnotationEditor5){function DrawingEditor(params){var _this92;_classCallCheck(this,DrawingEditor);_this92=_callSuper(this,DrawingEditor,[params]);_classPrivateMethodInitSpec(_this92,_DrawingEditor_brand);_classPrivateFieldInitSpec(_this92,_drawOutlines,null);_classPrivateFieldInitSpec(_this92,_mustBeCommitted,void 0);_defineProperty(_this92,"_drawId",null);_classPrivateFieldSet(_mustBeCommitted,_this92,params.mustBeCommitted||false);_this92._addOutlines(params);return _this92;}_inherits(DrawingEditor,_AnnotationEditor5);return _createClass(DrawingEditor,[{key:"_addOutlines",value:function _addOutlines(params){if(params.drawOutlines){_assertClassBrand(_DrawingEditor_brand,this,_createDrawOutlines).call(this,params);_assertClassBrand(_DrawingEditor_brand,this,_addToDrawLayer2).call(this);}}},{key:"updateParams",value:function updateParams(type,value){var propertyName=this.constructor.typesMap.get(type);if(propertyName){this._updateProperty(type,propertyName,value);}}},{key:"propertiesToUpdate",get:function get(){var properties=[];var _drawingOptions=this._drawingOptions;var _iterator145=_createForOfIteratorHelper(this.constructor.typesMap),_step145;try{for(_iterator145.s();!(_step145=_iterator145.n()).done;){var _step145$value=_slicedToArray(_step145.value,2),type=_step145$value[0],name=_step145$value[1];properties.push([type,_drawingOptions[name]]);}}catch(err){_iterator145.e(err);}finally{_iterator145.f();}return properties;}},{key:"_updateProperty",value:function _updateProperty(type,name,value){var _this93=this;var options=this._drawingOptions;var savedValue=options[name];var setter=function setter(val){var _this93$parent;options.updateProperty(name,val);var bbox=_classPrivateFieldGet(_drawOutlines,_this93).updateProperty(name,val);if(bbox){_assertClassBrand(_DrawingEditor_brand,_this93,_updateBbox).call(_this93,bbox);}(_this93$parent=_this93.parent)===null||_this93$parent===void 0||_this93$parent.drawLayer.updateProperties(_this93._drawId,options.toSVGProperties());};this.addCommands({cmd:setter.bind(this,value),undo:setter.bind(this,savedValue),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:type,overwriteIfSameType:true,keepUndo:true});}},{key:"_onResizing",value:function _onResizing(){var _this$parent7;(_this$parent7=this.parent)===null||_this$parent7===void 0||_this$parent7.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties(_classPrivateFieldGet(_drawOutlines,this).getPathResizingSVGProperties(_assertClassBrand(_DrawingEditor_brand,this,_convertToDrawSpace).call(this)),{bbox:_assertClassBrand(_DrawingEditor_brand,this,_rotateBox).call(this)}));}},{key:"_onResized",value:function _onResized(){var _this$parent8;(_this$parent8=this.parent)===null||_this$parent8===void 0||_this$parent8.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties(_classPrivateFieldGet(_drawOutlines,this).getPathResizedSVGProperties(_assertClassBrand(_DrawingEditor_brand,this,_convertToDrawSpace).call(this)),{bbox:_assertClassBrand(_DrawingEditor_brand,this,_rotateBox).call(this)}));}},{key:"_onTranslating",value:function _onTranslating(_x,_y){var _this$parent9;(_this$parent9=this.parent)===null||_this$parent9===void 0||_this$parent9.drawLayer.updateProperties(this._drawId,{bbox:_assertClassBrand(_DrawingEditor_brand,this,_rotateBox).call(this)});}},{key:"_onTranslated",value:function _onTranslated(){var _this$parent0;(_this$parent0=this.parent)===null||_this$parent0===void 0||_this$parent0.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties(_classPrivateFieldGet(_drawOutlines,this).getPathTranslatedSVGProperties(_assertClassBrand(_DrawingEditor_brand,this,_convertToDrawSpace).call(this),this.parentDimensions),{bbox:_assertClassBrand(_DrawingEditor_brand,this,_rotateBox).call(this)}));}},{key:"_onStartDragging",value:function _onStartDragging(){var _this$parent1;(_this$parent1=this.parent)===null||_this$parent1===void 0||_this$parent1.drawLayer.updateProperties(this._drawId,{rootClass:{moving:true}});}},{key:"_onStopDragging",value:function _onStopDragging(){var _this$parent10;(_this$parent10=this.parent)===null||_this$parent10===void 0||_this$parent10.drawLayer.updateProperties(this._drawId,{rootClass:{moving:false}});}},{key:"commit",value:function commit(){_superPropGet(DrawingEditor,"commit",this,3)([]);this.disableEditMode();this.disableEditing();}},{key:"disableEditing",value:function disableEditing(){_superPropGet(DrawingEditor,"disableEditing",this,3)([]);this.div.classList.toggle("disabled",true);}},{key:"enableEditing",value:function enableEditing(){_superPropGet(DrawingEditor,"enableEditing",this,3)([]);this.div.classList.toggle("disabled",false);}},{key:"getBaseTranslation",value:function getBaseTranslation(){return[0,0];}},{key:"isResizable",get:function get(){return true;}},{key:"onceAdded",value:function onceAdded(focus){if(!this.annotationElementId){this.parent.addUndoableEditor(this);}this._isDraggable=true;if(_classPrivateFieldGet(_mustBeCommitted,this)){_classPrivateFieldSet(_mustBeCommitted,this,false);this.commit();this.parent.setSelected(this);if(focus&&this.isOnScreen){this.div.focus();}}}},{key:"remove",value:function remove(){_assertClassBrand(_DrawingEditor_brand,this,_cleanDrawLayer2).call(this);_superPropGet(DrawingEditor,"remove",this,3)([]);}},{key:"rebuild",value:function rebuild(){if(!this.parent){return;}_superPropGet(DrawingEditor,"rebuild",this,3)([]);if(this.div===null){return;}_assertClassBrand(_DrawingEditor_brand,this,_addToDrawLayer2).call(this);_assertClassBrand(_DrawingEditor_brand,this,_updateBbox).call(this,_classPrivateFieldGet(_drawOutlines,this).box);if(!this.isAttachedToDOM){this.parent.add(this);}}},{key:"setParent",value:function setParent(parent){var mustBeSelected=false;if(this.parent&&!parent){this._uiManager.removeShouldRescale(this);_assertClassBrand(_DrawingEditor_brand,this,_cleanDrawLayer2).call(this);}else if(parent){var _this$div6;this._uiManager.addShouldRescale(this);_assertClassBrand(_DrawingEditor_brand,this,_addToDrawLayer2).call(this,parent);mustBeSelected=!this.parent&&((_this$div6=this.div)===null||_this$div6===void 0?void 0:_this$div6.classList.contains("selectedEditor"));}_superPropGet(DrawingEditor,"setParent",this,3)([parent]);if(mustBeSelected){this.select();}}},{key:"rotate",value:function rotate(){if(!this.parent){return;}this.parent.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties({bbox:_assertClassBrand(_DrawingEditor_brand,this,_rotateBox).call(this)},_classPrivateFieldGet(_drawOutlines,this).updateRotation((this.parentRotation-this.rotation+360)%360)));}},{key:"onScaleChanging",value:function onScaleChanging(){if(!this.parent){return;}_assertClassBrand(_DrawingEditor_brand,this,_updateBbox).call(this,_classPrivateFieldGet(_drawOutlines,this).updateParentDimensions(this.parentDimensions,this.parent.scale));}},{key:"render",value:function render(){if(this.div){return this.div;}var baseX,baseY;if(this._isCopy){baseX=this.x;baseY=this.y;}var div=_superPropGet(DrawingEditor,"render",this,3)([]);div.classList.add("draw");var drawDiv=document.createElement("div");div.append(drawDiv);drawDiv.setAttribute("aria-hidden","true");drawDiv.className="internal";var _this$parentDimension1=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension1[0],parentHeight=_this$parentDimension1[1];this.setDims(this.width*parentWidth,this.height*parentHeight);this._uiManager.addShouldRescale(this);this.disableEditing();if(this._isCopy){this._moveAfterPaste(baseX,baseY);}return div;}},{key:"createDrawingOptions",value:function createDrawingOptions(_data){}},{key:"serializeDraw",value:function serializeDraw(isForCopying){var _this$pageTranslation5=_slicedToArray(this.pageTranslation,2),pageX=_this$pageTranslation5[0],pageY=_this$pageTranslation5[1];var _this$pageDimensions6=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions6[0],pageHeight=_this$pageDimensions6[1];return _classPrivateFieldGet(_drawOutlines,this).serialize([pageX,pageY,pageWidth,pageHeight],isForCopying);}},{key:"renderAnnotationElement",value:function renderAnnotationElement(annotation){annotation.updateEdited({rect:this.getRect(0,0)});return null;}}],[{key:"_mergeSVGProperties",value:function _mergeSVGProperties(p1,p2){var p1Keys=new Set(Object.keys(p1));for(var _i26=0,_Object$entries7=Object.entries(p2);_i26<_Object$entries7.length;_i26++){var _Object$entries7$_i=_slicedToArray(_Object$entries7[_i26],2),key=_Object$entries7$_i[0],value=_Object$entries7$_i[1];if(p1Keys.has(key)){Object.assign(p1[key],value);}else{p1[key]=value;}}return p1;}},{key:"getDefaultDrawingOptions",value:function getDefaultDrawingOptions(_options){unreachable("Not implemented");}},{key:"typesMap",get:function get(){unreachable("Not implemented");}},{key:"isDrawer",get:function get(){return true;}},{key:"supportMultipleDrawings",get:function get(){return false;}},{key:"updateDefaultParams",value:function updateDefaultParams(type,value){var propertyName=this.typesMap.get(type);if(propertyName){this._defaultDrawingOptions.updateProperty(propertyName,value);}if(this._currentParent){_currentDraw._.updateProperty(propertyName,value);this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties());}}},{key:"defaultPropertiesToUpdate",get:function get(){var properties=[];var options=this._defaultDrawingOptions;var _iterator146=_createForOfIteratorHelper(this.typesMap),_step146;try{for(_iterator146.s();!(_step146=_iterator146.n()).done;){var _step146$value=_slicedToArray(_step146.value,2),type=_step146$value[0],name=_step146$value[1];properties.push([type,options[name]]);}}catch(err){_iterator146.e(err);}finally{_iterator146.f();}return properties;}},{key:"onScaleChangingWhenDrawing",value:function onScaleChangingWhenDrawing(){}},{key:"createDrawerInstance",value:function createDrawerInstance(_x,_y,_parentWidth,_parentHeight,_rotation){unreachable("Not implemented");}},{key:"startDrawing",value:function startDrawing(parent,uiManager,_isLTR,event){var _currentPointerType$_,_this94=this,_uiManager$_editorUnd;var target=event.target,x=event.offsetX,y=event.offsetY,pointerId=event.pointerId,pointerType=event.pointerType;if(_currentPointerType._&&_currentPointerType._!==pointerType){return;}var rotation=parent.viewport.rotation;var _target$getBoundingCl=target.getBoundingClientRect(),parentWidth=_target$getBoundingCl.width,parentHeight=_target$getBoundingCl.height;var ac=_currentDrawingAC._=new AbortController();var signal=parent.combinedSignal(ac);_currentPointerId._||(_currentPointerId._=pointerId);(_currentPointerType$_=_currentPointerType._)!==null&&_currentPointerType$_!==void 0?_currentPointerType$_:_currentPointerType._=pointerType;window.addEventListener("pointerup",function(e){if(_currentPointerId._===e.pointerId){_this94._endDraw(e);}else{var _currentPointerIds$_;(_currentPointerIds$_=_currentPointerIds._)===null||_currentPointerIds$_===void 0||_currentPointerIds$_["delete"](e.pointerId);}},{signal:signal});window.addEventListener("pointercancel",function(e){if(_currentPointerId._===e.pointerId){_this94._currentParent.endDrawingSession();}else{var _currentPointerIds$_2;(_currentPointerIds$_2=_currentPointerIds._)===null||_currentPointerIds$_2===void 0||_currentPointerIds$_2["delete"](e.pointerId);}},{signal:signal});window.addEventListener("pointerdown",function(e){if(_currentPointerType._!==e.pointerType){return;}(_currentPointerIds._||(_currentPointerIds._=new Set())).add(e.pointerId);if(_currentDraw._.isCancellable()){_currentDraw._.removeLastElement();if(_currentDraw._.isEmpty()){_this94._currentParent.endDrawingSession(true);}else{_this94._endDraw(null);}}},{capture:true,passive:false,signal:signal});window.addEventListener("contextmenu",_noContextMenu,{signal:signal});target.addEventListener("pointermove",this._drawMove.bind(this),{signal:signal});target.addEventListener("touchmove",function(e){if(e.timeStamp===_currentMoveTimestamp._){_stopEvent(e);}},{signal:signal});parent.toggleDrawing();(_uiManager$_editorUnd=uiManager._editorUndoBar)===null||_uiManager$_editorUnd===void 0||_uiManager$_editorUnd.hide();if(_currentDraw._){parent.drawLayer.updateProperties(this._currentDrawId,_currentDraw._.startNew(x,y,parentWidth,parentHeight,rotation));return;}uiManager.updateUIForDefaultProperties(this);_currentDraw._=this.createDrawerInstance(x,y,parentWidth,parentHeight,rotation);_currentDrawingOptions._=this.getDefaultDrawingOptions();this._currentParent=parent;var _parent$drawLayer$dra3=parent.drawLayer.draw(this._mergeSVGProperties(_currentDrawingOptions._.toSVGProperties(),_currentDraw._.defaultSVGProperties),true,false);this._currentDrawId=_parent$drawLayer$dra3.id;}},{key:"_drawMove",value:function _drawMove(event){var _currentPointerIds$_3;_currentMoveTimestamp._=-1;if(!_currentDraw._){return;}var offsetX=event.offsetX,offsetY=event.offsetY,pointerId=event.pointerId;if(_currentPointerId._!==pointerId){return;}if(((_currentPointerIds$_3=_currentPointerIds._)===null||_currentPointerIds$_3===void 0?void 0:_currentPointerIds$_3.size)>=1){this._endDraw(event);return;}this._currentParent.drawLayer.updateProperties(this._currentDrawId,_currentDraw._.add(offsetX,offsetY));_currentMoveTimestamp._=event.timeStamp;_stopEvent(event);}},{key:"_cleanup",value:function _cleanup(all){if(all){this._currentDrawId=-1;this._currentParent=null;_currentDraw._=null;_currentDrawingOptions._=null;_currentPointerType._=null;_currentMoveTimestamp._=NaN;}if(_currentDrawingAC._){_currentDrawingAC._.abort();_currentDrawingAC._=null;_currentPointerId._=NaN;_currentPointerIds._=null;}}},{key:"_endDraw",value:function _endDraw(event){var parent=this._currentParent;if(!parent){return;}parent.toggleDrawing(true);this._cleanup(false);if((event===null||event===void 0?void 0:event.target)===parent.div){parent.drawLayer.updateProperties(this._currentDrawId,_currentDraw._.end(event.offsetX,event.offsetY));}if(this.supportMultipleDrawings){var draw=_currentDraw._;var drawId=this._currentDrawId;var lastElement=draw.getLastElement();parent.addCommands({cmd:function cmd(){parent.drawLayer.updateProperties(drawId,draw.setLastElement(lastElement));},undo:function undo(){parent.drawLayer.updateProperties(drawId,draw.removeLastElement());},mustExec:false,type:_AnnotationEditorParamsType.DRAW_STEP});return;}this.endDrawing(false);}},{key:"endDrawing",value:function endDrawing(isAborted){var parent=this._currentParent;if(!parent){return null;}parent.toggleDrawing(true);parent.cleanUndoStack(_AnnotationEditorParamsType.DRAW_STEP);if(!_currentDraw._.isEmpty()){var _parent$pageDimension=_slicedToArray(parent.pageDimensions,2),pageWidth=_parent$pageDimension[0],pageHeight=_parent$pageDimension[1],scale=parent.scale;var editor=parent.createAndAddNewEditor({offsetX:0,offsetY:0},false,{drawId:this._currentDrawId,drawOutlines:_currentDraw._.getOutlines(pageWidth*scale,pageHeight*scale,scale,this._INNER_MARGIN),drawingOptions:_currentDrawingOptions._,mustBeCommitted:!isAborted});this._cleanup(true);return editor;}parent.drawLayer.remove(this._currentDrawId);this._cleanup(true);return null;}},{key:"deserializeDraw",value:function deserializeDraw(_pageX,_pageY,_pageWidth,_pageHeight,_innerWidth,_data){unreachable("Not implemented");}},{key:"deserialize",value:function(){var _deserialize4=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee48(data,parent,uiManager){var _parent$viewport$rawD,pageWidth,pageHeight,pageX,pageY,drawOutlines,editor;return _regenerator().w(function(_context49){while(1)switch(_context49.n){case 0:_parent$viewport$rawD=parent.viewport.rawDims,pageWidth=_parent$viewport$rawD.pageWidth,pageHeight=_parent$viewport$rawD.pageHeight,pageX=_parent$viewport$rawD.pageX,pageY=_parent$viewport$rawD.pageY;drawOutlines=this.deserializeDraw(pageX,pageY,pageWidth,pageHeight,this._INNER_MARGIN,data);_context49.n=1;return _superPropGet(DrawingEditor,"deserialize",this,2)([data,parent,uiManager]);case 1:editor=_context49.v;editor.createDrawingOptions(data);_assertClassBrand(_DrawingEditor_brand,editor,_createDrawOutlines).call(editor,{drawOutlines:drawOutlines});_assertClassBrand(_DrawingEditor_brand,editor,_addToDrawLayer2).call(editor);editor.onScaleChanging();editor.rotate();return _context49.a(2,editor);}},_callee48,this);}));function deserialize(_x45,_x46,_x47){return _deserialize4.apply(this,arguments);}return deserialize;}()},{key:"canCreateNewEmptyEditor",value:function canCreateNewEmptyEditor(){return false;}}]);}(AnnotationEditor);_DrawingEditor=DrawingEditor;function _createDrawOutlines(_ref148){var drawOutlines=_ref148.drawOutlines,drawId=_ref148.drawId,drawingOptions=_ref148.drawingOptions;_classPrivateFieldSet(_drawOutlines,this,drawOutlines);this._drawingOptions||(this._drawingOptions=drawingOptions);if(drawId>=0){this._drawId=drawId;this.parent.drawLayer.finalizeDraw(drawId,drawOutlines.defaultProperties);}else{this._drawId=_assertClassBrand(_DrawingEditor_brand,this,_createDrawing).call(this,drawOutlines,this.parent);}_assertClassBrand(_DrawingEditor_brand,this,_updateBbox).call(this,drawOutlines.box);}function _createDrawing(drawOutlines,parent){var _parent$drawLayer$dra5=parent.drawLayer.draw(_DrawingEditor._mergeSVGProperties(this._drawingOptions.toSVGProperties(),drawOutlines.defaultSVGProperties),false,false),id=_parent$drawLayer$dra5.id;return id;}function _cleanDrawLayer2(){if(this._drawId===null||!this.parent){return;}this.parent.drawLayer.remove(this._drawId);this._drawId=null;this._drawingOptions.reset();}function _addToDrawLayer2(){var parent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.parent;if(this._drawId!==null&&this.parent===parent){return;}if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,parent.drawLayer);return;}this._drawingOptions.updateAll();this._drawId=_assertClassBrand(_DrawingEditor_brand,this,_createDrawing).call(this,_classPrivateFieldGet(_drawOutlines,this),parent);}function _convertToParentSpace(_ref149){var _ref150=_slicedToArray(_ref149,4),x=_ref150[0],y=_ref150[1],width=_ref150[2],height=_ref150[3];var _this$parentDimension18=_slicedToArray(this.parentDimensions,2),pW=_this$parentDimension18[0],pH=_this$parentDimension18[1],rotation=this.rotation;switch(rotation){case 90:return[y,1-x,width*(pH/pW),height*(pW/pH)];case 180:return[1-x,1-y,width,height];case 270:return[1-y,x,width*(pH/pW),height*(pW/pH)];default:return[x,y,width,height];}}function _convertToDrawSpace(){var x=this.x,y=this.y,width=this.width,height=this.height,_this$parentDimension19=_slicedToArray(this.parentDimensions,2),pW=_this$parentDimension19[0],pH=_this$parentDimension19[1],rotation=this.rotation;switch(rotation){case 90:return[1-y,x,width*(pW/pH),height*(pH/pW)];case 180:return[1-x,1-y,width,height];case 270:return[y,1-x,width*(pW/pH),height*(pH/pW)];default:return[x,y,width,height];}}function _updateBbox(bbox){var _assertClassBrand$cal38=_assertClassBrand(_DrawingEditor_brand,this,_convertToParentSpace).call(this,bbox);var _assertClassBrand$cal39=_slicedToArray(_assertClassBrand$cal38,4);this.x=_assertClassBrand$cal39[0];this.y=_assertClassBrand$cal39[1];this.width=_assertClassBrand$cal39[2];this.height=_assertClassBrand$cal39[3];if(this.div){this.fixAndSetPosition();var _this$parentDimension20=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension20[0],parentHeight=_this$parentDimension20[1];this.setDims(this.width*parentWidth,this.height*parentHeight);}this._onResized();}function _rotateBox(){var x=this.x,y=this.y,width=this.width,height=this.height,rotation=this.rotation,parentRotation=this.parentRotation,_this$parentDimension21=_slicedToArray(this.parentDimensions,2),pW=_this$parentDimension21[0],pH=_this$parentDimension21[1];switch((rotation*4+parentRotation)/90){case 1:return[1-y-height,x,height,width];case 2:return[1-x-width,1-y-height,width,height];case 3:return[y,1-x-width,height,width];case 4:return[x,y-width*(pW/pH),height*(pH/pW),width*(pW/pH)];case 5:return[1-y,x,width*(pW/pH),height*(pH/pW)];case 6:return[1-x-height*(pH/pW),1-y,height*(pH/pW),width*(pW/pH)];case 7:return[y-width*(pW/pH),1-x-height*(pH/pW),width*(pW/pH),height*(pH/pW)];case 8:return[x-width,y-height,width,height];case 9:return[1-y,x-width,height,width];case 10:return[1-x,1-y,width,height];case 11:return[y-height,1-x,height,width];case 12:return[x-height*(pH/pW),y,height*(pH/pW),width*(pW/pH)];case 13:return[1-y-width*(pW/pH),x-height*(pH/pW),width*(pW/pH),height*(pH/pW)];case 14:return[1-x,1-y-width*(pW/pH),height*(pH/pW),width*(pW/pH)];case 15:return[y,1-x,width*(pW/pH),height*(pH/pW)];default:return[x,y,width,height];}}_defineProperty(DrawingEditor,"_currentDrawId",-1);_defineProperty(DrawingEditor,"_currentParent",null);var _currentDraw={_:null};var _currentDrawingAC={_:null};var _currentDrawingOptions={_:null};var _currentPointerId={_:NaN};var _currentPointerType={_:null};var _currentPointerIds={_:null};var _currentMoveTimestamp={_:NaN};_defineProperty(DrawingEditor,"_INNER_MARGIN",3);;// ./src/display/editor/drawers/inkdraw.js
var _last2=/*#__PURE__*/new WeakMap();var _line2=/*#__PURE__*/new WeakMap();var _lines=/*#__PURE__*/new WeakMap();var _rotation6=/*#__PURE__*/new WeakMap();var _thickness3=/*#__PURE__*/new WeakMap();var _points3=/*#__PURE__*/new WeakMap();var _lastSVGPath=/*#__PURE__*/new WeakMap();var _lastIndex=/*#__PURE__*/new WeakMap();var _outlines2=/*#__PURE__*/new WeakMap();var _parentWidth2=/*#__PURE__*/new WeakMap();var _parentHeight2=/*#__PURE__*/new WeakMap();var _InkDrawOutliner_brand=/*#__PURE__*/new WeakSet();var InkDrawOutliner=/*#__PURE__*/function(){function InkDrawOutliner(_x48,_y7,parentWidth,parentHeight,rotation,thickness){_classCallCheck(this,InkDrawOutliner);_classPrivateMethodInitSpec(this,_InkDrawOutliner_brand);_classPrivateFieldInitSpec(this,_last2,new Float64Array(6));_classPrivateFieldInitSpec(this,_line2,void 0);_classPrivateFieldInitSpec(this,_lines,void 0);_classPrivateFieldInitSpec(this,_rotation6,void 0);_classPrivateFieldInitSpec(this,_thickness3,void 0);_classPrivateFieldInitSpec(this,_points3,void 0);_classPrivateFieldInitSpec(this,_lastSVGPath,"");_classPrivateFieldInitSpec(this,_lastIndex,0);_classPrivateFieldInitSpec(this,_outlines2,new InkDrawOutline());_classPrivateFieldInitSpec(this,_parentWidth2,void 0);_classPrivateFieldInitSpec(this,_parentHeight2,void 0);_classPrivateFieldSet(_parentWidth2,this,parentWidth);_classPrivateFieldSet(_parentHeight2,this,parentHeight);_classPrivateFieldSet(_rotation6,this,rotation);_classPrivateFieldSet(_thickness3,this,thickness);var _assertClassBrand$cal1=_assertClassBrand(_InkDrawOutliner_brand,this,_normalizePoint2).call(this,_x48,_y7);var _assertClassBrand$cal10=_slicedToArray(_assertClassBrand$cal1,2);_x48=_assertClassBrand$cal10[0];_y7=_assertClassBrand$cal10[1];var line=_classPrivateFieldSet(_line2,this,[NaN,NaN,NaN,NaN,_x48,_y7]);_classPrivateFieldSet(_points3,this,[_x48,_y7]);_classPrivateFieldSet(_lines,this,[{line:line,points:_classPrivateFieldGet(_points3,this)}]);_classPrivateFieldGet(_last2,this).set(line,0);}return _createClass(InkDrawOutliner,[{key:"updateProperty",value:function updateProperty(name,value){if(name==="stroke-width"){_classPrivateFieldSet(_thickness3,this,value);}}},{key:"isEmpty",value:function isEmpty(){return!_classPrivateFieldGet(_lines,this)||_classPrivateFieldGet(_lines,this).length===0;}},{key:"isCancellable",value:function isCancellable(){return _classPrivateFieldGet(_points3,this).length<=10;}},{key:"add",value:function add(x,y){var _classPrivateFieldGet104;var _assertClassBrand$cal11=_assertClassBrand(_InkDrawOutliner_brand,this,_normalizePoint2).call(this,x,y);var _assertClassBrand$cal12=_slicedToArray(_assertClassBrand$cal11,2);x=_assertClassBrand$cal12[0];y=_assertClassBrand$cal12[1];var _classPrivateFieldGet102=_classPrivateFieldGet(_last2,this).subarray(2,6),_classPrivateFieldGet103=_slicedToArray(_classPrivateFieldGet102,4),x1=_classPrivateFieldGet103[0],y1=_classPrivateFieldGet103[1],x2=_classPrivateFieldGet103[2],y2=_classPrivateFieldGet103[3];var diffX=x-x2;var diffY=y-y2;var d=Math.hypot(_classPrivateFieldGet(_parentWidth2,this)*diffX,_classPrivateFieldGet(_parentHeight2,this)*diffY);if(d<=2){return null;}_classPrivateFieldGet(_points3,this).push(x,y);if(isNaN(x1)){_classPrivateFieldGet(_last2,this).set([x2,y2,x,y],2);_classPrivateFieldGet(_line2,this).push(NaN,NaN,NaN,NaN,x,y);return{path:{d:this.toSVGPath()}};}if(isNaN(_classPrivateFieldGet(_last2,this)[0])){_classPrivateFieldGet(_line2,this).splice(6,6);}_classPrivateFieldGet(_last2,this).set([x1,y1,x2,y2,x,y],0);(_classPrivateFieldGet104=_classPrivateFieldGet(_line2,this)).push.apply(_classPrivateFieldGet104,_toConsumableArray(Outline.createBezierPoints(x1,y1,x2,y2,x,y)));return{path:{d:this.toSVGPath()}};}},{key:"end",value:function end(x,y){var change=this.add(x,y);if(change){return change;}if(_classPrivateFieldGet(_points3,this).length===2){return{path:{d:this.toSVGPath()}};}return null;}},{key:"startNew",value:function startNew(x,y,parentWidth,parentHeight,rotation){_classPrivateFieldSet(_parentWidth2,this,parentWidth);_classPrivateFieldSet(_parentHeight2,this,parentHeight);_classPrivateFieldSet(_rotation6,this,rotation);var _assertClassBrand$cal13=_assertClassBrand(_InkDrawOutliner_brand,this,_normalizePoint2).call(this,x,y);var _assertClassBrand$cal14=_slicedToArray(_assertClassBrand$cal13,2);x=_assertClassBrand$cal14[0];y=_assertClassBrand$cal14[1];var line=_classPrivateFieldSet(_line2,this,[NaN,NaN,NaN,NaN,x,y]);_classPrivateFieldSet(_points3,this,[x,y]);var last=_classPrivateFieldGet(_lines,this).at(-1);if(last){last.line=new Float32Array(last.line);last.points=new Float32Array(last.points);}_classPrivateFieldGet(_lines,this).push({line:line,points:_classPrivateFieldGet(_points3,this)});_classPrivateFieldGet(_last2,this).set(line,0);_classPrivateFieldSet(_lastIndex,this,0);this.toSVGPath();return null;}},{key:"getLastElement",value:function getLastElement(){return _classPrivateFieldGet(_lines,this).at(-1);}},{key:"setLastElement",value:function setLastElement(element){if(!_classPrivateFieldGet(_lines,this)){return _classPrivateFieldGet(_outlines2,this).setLastElement(element);}_classPrivateFieldGet(_lines,this).push(element);_classPrivateFieldSet(_line2,this,element.line);_classPrivateFieldSet(_points3,this,element.points);_classPrivateFieldSet(_lastIndex,this,0);return{path:{d:this.toSVGPath()}};}},{key:"removeLastElement",value:function removeLastElement(){if(!_classPrivateFieldGet(_lines,this)){return _classPrivateFieldGet(_outlines2,this).removeLastElement();}_classPrivateFieldGet(_lines,this).pop();_classPrivateFieldSet(_lastSVGPath,this,"");for(var i=0,ii=_classPrivateFieldGet(_lines,this).length;i<ii;i++){var _classPrivateFieldGet105=_classPrivateFieldGet(_lines,this)[i],line=_classPrivateFieldGet105.line,points=_classPrivateFieldGet105.points;_classPrivateFieldSet(_line2,this,line);_classPrivateFieldSet(_points3,this,points);_classPrivateFieldSet(_lastIndex,this,0);this.toSVGPath();}return{path:{d:_classPrivateFieldGet(_lastSVGPath,this)}};}},{key:"toSVGPath",value:function toSVGPath(){var firstX=Outline.svgRound(_classPrivateFieldGet(_line2,this)[4]);var firstY=Outline.svgRound(_classPrivateFieldGet(_line2,this)[5]);if(_classPrivateFieldGet(_points3,this).length===2){_classPrivateFieldSet(_lastSVGPath,this,"".concat(_classPrivateFieldGet(_lastSVGPath,this)," M ").concat(firstX," ").concat(firstY," Z"));return _classPrivateFieldGet(_lastSVGPath,this);}if(_classPrivateFieldGet(_points3,this).length<=6){var i=_classPrivateFieldGet(_lastSVGPath,this).lastIndexOf("M");_classPrivateFieldSet(_lastSVGPath,this,"".concat(_classPrivateFieldGet(_lastSVGPath,this).slice(0,i)," M ").concat(firstX," ").concat(firstY));_classPrivateFieldSet(_lastIndex,this,6);}if(_classPrivateFieldGet(_points3,this).length===4){var secondX=Outline.svgRound(_classPrivateFieldGet(_line2,this)[10]);var secondY=Outline.svgRound(_classPrivateFieldGet(_line2,this)[11]);_classPrivateFieldSet(_lastSVGPath,this,"".concat(_classPrivateFieldGet(_lastSVGPath,this)," L ").concat(secondX," ").concat(secondY));_classPrivateFieldSet(_lastIndex,this,12);return _classPrivateFieldGet(_lastSVGPath,this);}var buffer=[];if(_classPrivateFieldGet(_lastIndex,this)===0){buffer.push("M ".concat(firstX," ").concat(firstY));_classPrivateFieldSet(_lastIndex,this,6);}for(var _i27=_classPrivateFieldGet(_lastIndex,this),ii=_classPrivateFieldGet(_line2,this).length;_i27<ii;_i27+=6){var _classPrivateFieldGet106=_classPrivateFieldGet(_line2,this).slice(_i27,_i27+6).map(Outline.svgRound),_classPrivateFieldGet107=_slicedToArray(_classPrivateFieldGet106,6),c1x=_classPrivateFieldGet107[0],c1y=_classPrivateFieldGet107[1],c2x=_classPrivateFieldGet107[2],c2y=_classPrivateFieldGet107[3],x=_classPrivateFieldGet107[4],y=_classPrivateFieldGet107[5];buffer.push("C".concat(c1x," ").concat(c1y," ").concat(c2x," ").concat(c2y," ").concat(x," ").concat(y));}_classPrivateFieldSet(_lastSVGPath,this,_classPrivateFieldGet(_lastSVGPath,this)+buffer.join(" "));_classPrivateFieldSet(_lastIndex,this,_classPrivateFieldGet(_line2,this).length);return _classPrivateFieldGet(_lastSVGPath,this);}},{key:"getOutlines",value:function getOutlines(parentWidth,parentHeight,scale,innerMargin){var last=_classPrivateFieldGet(_lines,this).at(-1);last.line=new Float32Array(last.line);last.points=new Float32Array(last.points);_classPrivateFieldGet(_outlines2,this).build(_classPrivateFieldGet(_lines,this),parentWidth,parentHeight,scale,_classPrivateFieldGet(_rotation6,this),_classPrivateFieldGet(_thickness3,this),innerMargin);_classPrivateFieldSet(_last2,this,null);_classPrivateFieldSet(_line2,this,null);_classPrivateFieldSet(_lines,this,null);_classPrivateFieldSet(_lastSVGPath,this,null);return _classPrivateFieldGet(_outlines2,this);}},{key:"defaultSVGProperties",get:function get(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:true},bbox:[0,0,1,1]};}}]);}();function _normalizePoint2(x,y){return Outline._normalizePoint(x,y,_classPrivateFieldGet(_parentWidth2,this),_classPrivateFieldGet(_parentHeight2,this),_classPrivateFieldGet(_rotation6,this));}var _bbox3=/*#__PURE__*/new WeakMap();var _currentRotation=/*#__PURE__*/new WeakMap();var _innerMargin3=/*#__PURE__*/new WeakMap();var _lines2=/*#__PURE__*/new WeakMap();var _parentWidth3=/*#__PURE__*/new WeakMap();var _parentHeight3=/*#__PURE__*/new WeakMap();var _parentScale=/*#__PURE__*/new WeakMap();var _rotation7=/*#__PURE__*/new WeakMap();var _thickness4=/*#__PURE__*/new WeakMap();var _InkDrawOutline_brand=/*#__PURE__*/new WeakSet();var InkDrawOutline=/*#__PURE__*/function(_Outline4){function InkDrawOutline(){var _this95;_classCallCheck(this,InkDrawOutline);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this95=_callSuper(this,InkDrawOutline,[].concat(args));_classPrivateMethodInitSpec(_this95,_InkDrawOutline_brand);_classPrivateFieldInitSpec(_this95,_bbox3,void 0);_classPrivateFieldInitSpec(_this95,_currentRotation,0);_classPrivateFieldInitSpec(_this95,_innerMargin3,void 0);_classPrivateFieldInitSpec(_this95,_lines2,void 0);_classPrivateFieldInitSpec(_this95,_parentWidth3,void 0);_classPrivateFieldInitSpec(_this95,_parentHeight3,void 0);_classPrivateFieldInitSpec(_this95,_parentScale,void 0);_classPrivateFieldInitSpec(_this95,_rotation7,void 0);_classPrivateFieldInitSpec(_this95,_thickness4,void 0);return _this95;}_inherits(InkDrawOutline,_Outline4);return _createClass(InkDrawOutline,[{key:"build",value:function build(lines,parentWidth,parentHeight,parentScale,rotation,thickness,innerMargin){_classPrivateFieldSet(_parentWidth3,this,parentWidth);_classPrivateFieldSet(_parentHeight3,this,parentHeight);_classPrivateFieldSet(_parentScale,this,parentScale);_classPrivateFieldSet(_rotation7,this,rotation);_classPrivateFieldSet(_thickness4,this,thickness);_classPrivateFieldSet(_innerMargin3,this,innerMargin!==null&&innerMargin!==void 0?innerMargin:0);_classPrivateFieldSet(_lines2,this,lines);_assertClassBrand(_InkDrawOutline_brand,this,_computeBbox).call(this);}},{key:"thickness",get:function get(){return _classPrivateFieldGet(_thickness4,this);}},{key:"setLastElement",value:function setLastElement(element){_classPrivateFieldGet(_lines2,this).push(element);return{path:{d:this.toSVGPath()}};}},{key:"removeLastElement",value:function removeLastElement(){_classPrivateFieldGet(_lines2,this).pop();return{path:{d:this.toSVGPath()}};}},{key:"toSVGPath",value:function toSVGPath(){var buffer=[];var _iterator147=_createForOfIteratorHelper(_classPrivateFieldGet(_lines2,this)),_step147;try{for(_iterator147.s();!(_step147=_iterator147.n()).done;){var line=_step147.value.line;buffer.push("M".concat(Outline.svgRound(line[4])," ").concat(Outline.svgRound(line[5])));if(line.length===6){buffer.push("Z");continue;}if(line.length===12&&isNaN(line[6])){buffer.push("L".concat(Outline.svgRound(line[10])," ").concat(Outline.svgRound(line[11])));continue;}for(var i=6,ii=line.length;i<ii;i+=6){var _line$subarray$map=line.subarray(i,i+6).map(Outline.svgRound),_line$subarray$map2=_slicedToArray(_line$subarray$map,6),c1x=_line$subarray$map2[0],c1y=_line$subarray$map2[1],c2x=_line$subarray$map2[2],c2y=_line$subarray$map2[3],x=_line$subarray$map2[4],y=_line$subarray$map2[5];buffer.push("C".concat(c1x," ").concat(c1y," ").concat(c2x," ").concat(c2y," ").concat(x," ").concat(y));}}}catch(err){_iterator147.e(err);}finally{_iterator147.f();}return buffer.join("");}},{key:"serialize",value:function serialize(_ref107,isForCopying){var _ref108=_slicedToArray(_ref107,4),pageX=_ref108[0],pageY=_ref108[1],pageWidth=_ref108[2],pageHeight=_ref108[3];var serializedLines=[];var serializedPoints=[];var _assertClassBrand$cal15=_assertClassBrand(_InkDrawOutline_brand,this,_getBBoxWithNoMargin).call(this),_assertClassBrand$cal16=_slicedToArray(_assertClassBrand$cal15,4),x=_assertClassBrand$cal16[0],y=_assertClassBrand$cal16[1],width=_assertClassBrand$cal16[2],height=_assertClassBrand$cal16[3];var tx,ty,sx,sy,x1,y1,x2,y2,rescaleFn;switch(_classPrivateFieldGet(_rotation7,this)){case 0:rescaleFn=Outline._rescale;tx=pageX;ty=pageY+pageHeight;sx=pageWidth;sy=-pageHeight;x1=pageX+x*pageWidth;y1=pageY+(1-y-height)*pageHeight;x2=pageX+(x+width)*pageWidth;y2=pageY+(1-y)*pageHeight;break;case 90:rescaleFn=Outline._rescaleAndSwap;tx=pageX;ty=pageY;sx=pageWidth;sy=pageHeight;x1=pageX+y*pageWidth;y1=pageY+x*pageHeight;x2=pageX+(y+height)*pageWidth;y2=pageY+(x+width)*pageHeight;break;case 180:rescaleFn=Outline._rescale;tx=pageX+pageWidth;ty=pageY;sx=-pageWidth;sy=pageHeight;x1=pageX+(1-x-width)*pageWidth;y1=pageY+y*pageHeight;x2=pageX+(1-x)*pageWidth;y2=pageY+(y+height)*pageHeight;break;case 270:rescaleFn=Outline._rescaleAndSwap;tx=pageX+pageWidth;ty=pageY+pageHeight;sx=-pageWidth;sy=-pageHeight;x1=pageX+(1-y-height)*pageWidth;y1=pageY+(1-x-width)*pageHeight;x2=pageX+(1-y)*pageWidth;y2=pageY+(1-x)*pageHeight;break;}var _iterator148=_createForOfIteratorHelper(_classPrivateFieldGet(_lines2,this)),_step148;try{for(_iterator148.s();!(_step148=_iterator148.n()).done;){var _step148$value=_step148.value,line=_step148$value.line,points=_step148$value.points;serializedLines.push(rescaleFn(line,tx,ty,sx,sy,isForCopying?new Array(line.length):null));serializedPoints.push(rescaleFn(points,tx,ty,sx,sy,isForCopying?new Array(points.length):null));}}catch(err){_iterator148.e(err);}finally{_iterator148.f();}return{lines:serializedLines,points:serializedPoints,rect:[x1,y1,x2,y2]};}},{key:"box",get:function get(){return _classPrivateFieldGet(_bbox3,this);}},{key:"updateProperty",value:function updateProperty(name,value){if(name==="stroke-width"){return _assertClassBrand(_InkDrawOutline_brand,this,_updateThickness2).call(this,value);}return null;}},{key:"updateParentDimensions",value:function updateParentDimensions(_ref109,scale){var _ref110=_slicedToArray(_ref109,2),width=_ref110[0],height=_ref110[1];var _assertClassBrand$cal17=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this),_assertClassBrand$cal18=_slicedToArray(_assertClassBrand$cal17,2),oldMarginX=_assertClassBrand$cal18[0],oldMarginY=_assertClassBrand$cal18[1];_classPrivateFieldSet(_parentWidth3,this,width);_classPrivateFieldSet(_parentHeight3,this,height);_classPrivateFieldSet(_parentScale,this,scale);var _assertClassBrand$cal19=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this),_assertClassBrand$cal20=_slicedToArray(_assertClassBrand$cal19,2),newMarginX=_assertClassBrand$cal20[0],newMarginY=_assertClassBrand$cal20[1];var diffMarginX=newMarginX-oldMarginX;var diffMarginY=newMarginY-oldMarginY;var bbox=_classPrivateFieldGet(_bbox3,this);bbox[0]-=diffMarginX;bbox[1]-=diffMarginY;bbox[2]+=2*diffMarginX;bbox[3]+=2*diffMarginY;return bbox;}},{key:"updateRotation",value:function updateRotation(rotation){_classPrivateFieldSet(_currentRotation,this,rotation);return{path:{transform:this.rotationTransform}};}},{key:"viewBox",get:function get(){return _classPrivateFieldGet(_bbox3,this).map(Outline.svgRound).join(" ");}},{key:"defaultProperties",get:function get(){var _classPrivateFieldGet108=_classPrivateFieldGet(_bbox3,this),_classPrivateFieldGet109=_slicedToArray(_classPrivateFieldGet108,2),x=_classPrivateFieldGet109[0],y=_classPrivateFieldGet109[1];return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(Outline.svgRound(x)," ").concat(Outline.svgRound(y))}};}},{key:"rotationTransform",get:function get(){var _classPrivateFieldGet110=_classPrivateFieldGet(_bbox3,this),_classPrivateFieldGet111=_slicedToArray(_classPrivateFieldGet110,4),width=_classPrivateFieldGet111[2],height=_classPrivateFieldGet111[3];var a=0,b=0,c=0,d=0,e=0,f=0;switch(_classPrivateFieldGet(_currentRotation,this)){case 90:b=height/width;c=-width/height;e=width;break;case 180:a=-1;d=-1;e=width;f=height;break;case 270:b=-height/width;c=width/height;f=height;break;default:return"";}return"matrix(".concat(a," ").concat(b," ").concat(c," ").concat(d," ").concat(Outline.svgRound(e)," ").concat(Outline.svgRound(f),")");}},{key:"getPathResizingSVGProperties",value:function getPathResizingSVGProperties(_ref111){var _ref112=_slicedToArray(_ref111,4),newX=_ref112[0],newY=_ref112[1],newWidth=_ref112[2],newHeight=_ref112[3];var _assertClassBrand$cal21=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this),_assertClassBrand$cal22=_slicedToArray(_assertClassBrand$cal21,2),marginX=_assertClassBrand$cal22[0],marginY=_assertClassBrand$cal22[1];var _classPrivateFieldGet112=_classPrivateFieldGet(_bbox3,this),_classPrivateFieldGet113=_slicedToArray(_classPrivateFieldGet112,4),x=_classPrivateFieldGet113[0],y=_classPrivateFieldGet113[1],width=_classPrivateFieldGet113[2],height=_classPrivateFieldGet113[3];if(Math.abs(width-marginX)<=Outline.PRECISION||Math.abs(height-marginY)<=Outline.PRECISION){var tx=newX+newWidth/2-(x+width/2);var ty=newY+newHeight/2-(y+height/2);return{path:{"transform-origin":"".concat(Outline.svgRound(newX)," ").concat(Outline.svgRound(newY)),transform:"".concat(this.rotationTransform," translate(").concat(tx," ").concat(ty,")")}};}var s1x=(newWidth-2*marginX)/(width-2*marginX);var s1y=(newHeight-2*marginY)/(height-2*marginY);var s2x=width/newWidth;var s2y=height/newHeight;return{path:{"transform-origin":"".concat(Outline.svgRound(x)," ").concat(Outline.svgRound(y)),transform:"".concat(this.rotationTransform," scale(").concat(s2x," ").concat(s2y,") ")+"translate(".concat(Outline.svgRound(marginX)," ").concat(Outline.svgRound(marginY),") scale(").concat(s1x," ").concat(s1y,") ")+"translate(".concat(Outline.svgRound(-marginX)," ").concat(Outline.svgRound(-marginY),")")}};}},{key:"getPathResizedSVGProperties",value:function getPathResizedSVGProperties(_ref113){var _ref114=_slicedToArray(_ref113,4),newX=_ref114[0],newY=_ref114[1],newWidth=_ref114[2],newHeight=_ref114[3];var _assertClassBrand$cal23=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this),_assertClassBrand$cal24=_slicedToArray(_assertClassBrand$cal23,2),marginX=_assertClassBrand$cal24[0],marginY=_assertClassBrand$cal24[1];var bbox=_classPrivateFieldGet(_bbox3,this);var _bbox4=_slicedToArray(bbox,4),x=_bbox4[0],y=_bbox4[1],width=_bbox4[2],height=_bbox4[3];bbox[0]=newX;bbox[1]=newY;bbox[2]=newWidth;bbox[3]=newHeight;if(Math.abs(width-marginX)<=Outline.PRECISION||Math.abs(height-marginY)<=Outline.PRECISION){var _tx=newX+newWidth/2-(x+width/2);var _ty=newY+newHeight/2-(y+height/2);var _iterator149=_createForOfIteratorHelper(_classPrivateFieldGet(_lines2,this)),_step149;try{for(_iterator149.s();!(_step149=_iterator149.n()).done;){var _step149$value=_step149.value,line=_step149$value.line,points=_step149$value.points;Outline._translate(line,_tx,_ty,line);Outline._translate(points,_tx,_ty,points);}}catch(err){_iterator149.e(err);}finally{_iterator149.f();}return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(Outline.svgRound(newX)," ").concat(Outline.svgRound(newY)),transform:this.rotationTransform||null,d:this.toSVGPath()}};}var s1x=(newWidth-2*marginX)/(width-2*marginX);var s1y=(newHeight-2*marginY)/(height-2*marginY);var tx=-s1x*(x+marginX)+newX+marginX;var ty=-s1y*(y+marginY)+newY+marginY;if(s1x!==1||s1y!==1||tx!==0||ty!==0){var _iterator150=_createForOfIteratorHelper(_classPrivateFieldGet(_lines2,this)),_step150;try{for(_iterator150.s();!(_step150=_iterator150.n()).done;){var _step150$value=_step150.value,_line3=_step150$value.line,_points4=_step150$value.points;Outline._rescale(_line3,tx,ty,s1x,s1y,_line3);Outline._rescale(_points4,tx,ty,s1x,s1y,_points4);}}catch(err){_iterator150.e(err);}finally{_iterator150.f();}}return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(Outline.svgRound(newX)," ").concat(Outline.svgRound(newY)),transform:this.rotationTransform||null,d:this.toSVGPath()}};}},{key:"getPathTranslatedSVGProperties",value:function getPathTranslatedSVGProperties(_ref115,parentDimensions){var _ref116=_slicedToArray(_ref115,2),newX=_ref116[0],newY=_ref116[1];var _parentDimensions=_slicedToArray(parentDimensions,2),newParentWidth=_parentDimensions[0],newParentHeight=_parentDimensions[1];var bbox=_classPrivateFieldGet(_bbox3,this);var tx=newX-bbox[0];var ty=newY-bbox[1];if(_classPrivateFieldGet(_parentWidth3,this)===newParentWidth&&_classPrivateFieldGet(_parentHeight3,this)===newParentHeight){var _iterator151=_createForOfIteratorHelper(_classPrivateFieldGet(_lines2,this)),_step151;try{for(_iterator151.s();!(_step151=_iterator151.n()).done;){var _step151$value=_step151.value,line=_step151$value.line,points=_step151$value.points;Outline._translate(line,tx,ty,line);Outline._translate(points,tx,ty,points);}}catch(err){_iterator151.e(err);}finally{_iterator151.f();}}else{var sx=_classPrivateFieldGet(_parentWidth3,this)/newParentWidth;var sy=_classPrivateFieldGet(_parentHeight3,this)/newParentHeight;_classPrivateFieldSet(_parentWidth3,this,newParentWidth);_classPrivateFieldSet(_parentHeight3,this,newParentHeight);var _iterator152=_createForOfIteratorHelper(_classPrivateFieldGet(_lines2,this)),_step152;try{for(_iterator152.s();!(_step152=_iterator152.n()).done;){var _step152$value=_step152.value,_line4=_step152$value.line,_points5=_step152$value.points;Outline._rescale(_line4,tx,ty,sx,sy,_line4);Outline._rescale(_points5,tx,ty,sx,sy,_points5);}}catch(err){_iterator152.e(err);}finally{_iterator152.f();}bbox[2]*=sx;bbox[3]*=sy;}bbox[0]=newX;bbox[1]=newY;return{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":"".concat(Outline.svgRound(newX)," ").concat(Outline.svgRound(newY))}};}},{key:"defaultSVGProperties",get:function get(){var bbox=_classPrivateFieldGet(_bbox3,this);return{root:{viewBox:this.viewBox},rootClass:{draw:true},path:{d:this.toSVGPath(),"transform-origin":"".concat(Outline.svgRound(bbox[0])," ").concat(Outline.svgRound(bbox[1])),transform:this.rotationTransform||null},bbox:bbox};}}],[{key:"deserialize",value:function deserialize(pageX,pageY,pageWidth,pageHeight,innerMargin,_ref117){var _ref117$paths=_ref117.paths,lines=_ref117$paths.lines,points=_ref117$paths.points,rotation=_ref117.rotation,thickness=_ref117.thickness;var newLines=[];var tx,ty,sx,sy,rescaleFn;switch(rotation){case 0:rescaleFn=Outline._rescale;tx=-pageX/pageWidth;ty=pageY/pageHeight+1;sx=1/pageWidth;sy=-1/pageHeight;break;case 90:rescaleFn=Outline._rescaleAndSwap;tx=-pageY/pageHeight;ty=-pageX/pageWidth;sx=1/pageHeight;sy=1/pageWidth;break;case 180:rescaleFn=Outline._rescale;tx=pageX/pageWidth+1;ty=-pageY/pageHeight;sx=-1/pageWidth;sy=1/pageHeight;break;case 270:rescaleFn=Outline._rescaleAndSwap;tx=pageY/pageHeight+1;ty=pageX/pageWidth+1;sx=-1/pageHeight;sy=-1/pageWidth;break;}if(!lines){lines=[];var _iterator153=_createForOfIteratorHelper(points),_step153;try{for(_iterator153.s();!(_step153=_iterator153.n()).done;){var point=_step153.value;var len=point.length;if(len===2){lines.push(new Float32Array([NaN,NaN,NaN,NaN,point[0],point[1]]));continue;}if(len===4){lines.push(new Float32Array([NaN,NaN,NaN,NaN,point[0],point[1],NaN,NaN,NaN,NaN,point[2],point[3]]));continue;}var line=new Float32Array(3*(len-2));lines.push(line);var _point$subarray=point.subarray(0,4),_point$subarray2=_slicedToArray(_point$subarray,4),x1=_point$subarray2[0],y1=_point$subarray2[1],x2=_point$subarray2[2],y2=_point$subarray2[3];line.set([NaN,NaN,NaN,NaN,x1,y1],0);for(var i=4;i<len;i+=2){var x=point[i];var y=point[i+1];line.set(Outline.createBezierPoints(x1,y1,x2,y2,x,y),(i-2)*3);var _ref118=[x2,y2,x,y];x1=_ref118[0];y1=_ref118[1];x2=_ref118[2];y2=_ref118[3];}}}catch(err){_iterator153.e(err);}finally{_iterator153.f();}}for(var _i28=0,ii=lines.length;_i28<ii;_i28++){newLines.push({line:rescaleFn(lines[_i28].map(function(x){return x!==null&&x!==void 0?x:NaN;}),tx,ty,sx,sy),points:rescaleFn(points[_i28].map(function(x){return x!==null&&x!==void 0?x:NaN;}),tx,ty,sx,sy)});}var outlines=new this.prototype.constructor();outlines.build(newLines,pageWidth,pageHeight,1,rotation,thickness,innerMargin);return outlines;}}]);}(Outline);function _getMarginComponents(){var thickness=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_classPrivateFieldGet(_thickness4,this);var margin=_classPrivateFieldGet(_innerMargin3,this)+thickness/2*_classPrivateFieldGet(_parentScale,this);return _classPrivateFieldGet(_rotation7,this)%180===0?[margin/_classPrivateFieldGet(_parentWidth3,this),margin/_classPrivateFieldGet(_parentHeight3,this)]:[margin/_classPrivateFieldGet(_parentHeight3,this),margin/_classPrivateFieldGet(_parentWidth3,this)];}function _getBBoxWithNoMargin(){var _classPrivateFieldGet173=_classPrivateFieldGet(_bbox3,this),_classPrivateFieldGet174=_slicedToArray(_classPrivateFieldGet173,4),x=_classPrivateFieldGet174[0],y=_classPrivateFieldGet174[1],width=_classPrivateFieldGet174[2],height=_classPrivateFieldGet174[3];var _assertClassBrand$cal40=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this,0),_assertClassBrand$cal41=_slicedToArray(_assertClassBrand$cal40,2),marginX=_assertClassBrand$cal41[0],marginY=_assertClassBrand$cal41[1];return[x+marginX,y+marginY,width-2*marginX,height-2*marginY];}function _computeBbox(){var bbox=_classPrivateFieldSet(_bbox3,this,new Float32Array([Infinity,Infinity,-Infinity,-Infinity]));var _iterator189=_createForOfIteratorHelper(_classPrivateFieldGet(_lines2,this)),_step189;try{for(_iterator189.s();!(_step189=_iterator189.n()).done;){var line=_step189.value.line;if(line.length<=12){for(var i=4,ii=line.length;i<ii;i+=6){_Util.pointBoundingBox(line[i],line[i+1],bbox);}continue;}var lastX=line[4],lastY=line[5];for(var _i34=6,_ii5=line.length;_i34<_ii5;_i34+=6){var _line$subarray=line.subarray(_i34,_i34+6),_line$subarray2=_slicedToArray(_line$subarray,6),c1x=_line$subarray2[0],c1y=_line$subarray2[1],c2x=_line$subarray2[2],c2y=_line$subarray2[3],x=_line$subarray2[4],y=_line$subarray2[5];_Util.bezierBoundingBox(lastX,lastY,c1x,c1y,c2x,c2y,x,y,bbox);lastX=x;lastY=y;}}}catch(err){_iterator189.e(err);}finally{_iterator189.f();}var _assertClassBrand$cal42=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this),_assertClassBrand$cal43=_slicedToArray(_assertClassBrand$cal42,2),marginX=_assertClassBrand$cal43[0],marginY=_assertClassBrand$cal43[1];bbox[0]=_MathClamp(bbox[0]-marginX,0,1);bbox[1]=_MathClamp(bbox[1]-marginY,0,1);bbox[2]=_MathClamp(bbox[2]+marginX,0,1);bbox[3]=_MathClamp(bbox[3]+marginY,0,1);bbox[2]-=bbox[0];bbox[3]-=bbox[1];}function _updateThickness2(thickness){var _assertClassBrand$cal44=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this),_assertClassBrand$cal45=_slicedToArray(_assertClassBrand$cal44,2),oldMarginX=_assertClassBrand$cal45[0],oldMarginY=_assertClassBrand$cal45[1];_classPrivateFieldSet(_thickness4,this,thickness);var _assertClassBrand$cal46=_assertClassBrand(_InkDrawOutline_brand,this,_getMarginComponents).call(this),_assertClassBrand$cal47=_slicedToArray(_assertClassBrand$cal46,2),newMarginX=_assertClassBrand$cal47[0],newMarginY=_assertClassBrand$cal47[1];var diffMarginX=newMarginX-oldMarginX,diffMarginY=newMarginY-oldMarginY;var bbox=_classPrivateFieldGet(_bbox3,this);bbox[0]-=diffMarginX;bbox[1]-=diffMarginY;bbox[2]+=2*diffMarginX;bbox[3]+=2*diffMarginY;return bbox;};// ./src/display/editor/ink.js
var InkDrawingOptions=/*#__PURE__*/function(_DrawingOptions2){function InkDrawingOptions(viewerParameters){var _this96;_classCallCheck(this,InkDrawingOptions);_this96=_callSuper(this,InkDrawingOptions);_this96._viewParameters=viewerParameters;_superPropGet((_this96,InkDrawingOptions),"updateProperties",_this96,3)([{fill:"none",stroke:AnnotationEditor._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10}]);return _this96;}_inherits(InkDrawingOptions,_DrawingOptions2);return _createClass(InkDrawingOptions,[{key:"updateSVGProperty",value:function updateSVGProperty(name,value){if(name==="stroke-width"){value!==null&&value!==void 0?value:value=this["stroke-width"];value*=this._viewParameters.realScale;}_superPropGet(InkDrawingOptions,"updateSVGProperty",this,3)([name,value]);}},{key:"clone",value:function clone(){var clone=new InkDrawingOptions(this._viewParameters);clone.updateAll(this);return clone;}}]);}(DrawingOptions);var _InkEditor_brand=/*#__PURE__*/new WeakSet();var InkEditor=/*#__PURE__*/function(_DrawingEditor2){function InkEditor(params){var _this97;_classCallCheck(this,InkEditor);_this97=_callSuper(this,InkEditor,[_objectSpread(_objectSpread({},params),{},{name:"inkEditor"})]);_classPrivateMethodInitSpec(_this97,_InkEditor_brand);_this97._willKeepAspectRatio=true;_this97.defaultL10nId="pdfjs-editor-ink-editor";return _this97;}_inherits(InkEditor,_DrawingEditor2);return _createClass(InkEditor,[{key:"onScaleChanging",value:function onScaleChanging(){if(!this.parent){return;}_superPropGet(InkEditor,"onScaleChanging",this,3)([]);var _drawId=this._drawId,_drawingOptions=this._drawingOptions,parent=this.parent;_drawingOptions.updateSVGProperty("stroke-width");parent.drawLayer.updateProperties(_drawId,_drawingOptions.toSVGProperties());}},{key:"createDrawingOptions",value:function createDrawingOptions(_ref119){var color=_ref119.color,thickness=_ref119.thickness,opacity=_ref119.opacity;this._drawingOptions=InkEditor.getDefaultDrawingOptions({stroke:_Util.makeHexColor.apply(_Util,_toConsumableArray(color)),"stroke-width":thickness,"stroke-opacity":opacity});}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isEmpty()){return null;}if(this.deleted){return this.serializeDeleted();}var _this$serializeDraw=this.serializeDraw(isForCopying),lines=_this$serializeDraw.lines,points=_this$serializeDraw.points,rect=_this$serializeDraw.rect;var _this$_drawingOptions=this._drawingOptions,stroke=_this$_drawingOptions.stroke,opacity=_this$_drawingOptions["stroke-opacity"],thickness=_this$_drawingOptions["stroke-width"];var serialized={annotationType:_AnnotationEditorType.INK,color:AnnotationEditor._colorManager.convert(stroke),opacity:opacity,thickness:thickness,paths:{lines:lines,points:points},pageIndex:this.pageIndex,rect:rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(isForCopying){serialized.isCopy=true;return serialized;}if(this.annotationElementId&&!_assertClassBrand(_InkEditor_brand,this,_hasElementChanged3).call(this,serialized)){return null;}serialized.id=this.annotationElementId;return serialized;}},{key:"renderAnnotationElement",value:function renderAnnotationElement(annotation){var _this$serializeDraw2=this.serializeDraw(false),points=_this$serializeDraw2.points,rect=_this$serializeDraw2.rect;annotation.updateEdited({rect:rect,thickness:this._drawingOptions["stroke-width"],points:points});return null;}}],[{key:"initialize",value:function initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager);this._defaultDrawingOptions=new InkDrawingOptions(uiManager.viewParameters);}},{key:"getDefaultDrawingOptions",value:function getDefaultDrawingOptions(options){var clone=this._defaultDrawingOptions.clone();clone.updateProperties(options);return clone;}},{key:"supportMultipleDrawings",get:function get(){return true;}},{key:"typesMap",get:function get(){return _shadow(this,"typesMap",new Map([[_AnnotationEditorParamsType.INK_THICKNESS,"stroke-width"],[_AnnotationEditorParamsType.INK_COLOR,"stroke"],[_AnnotationEditorParamsType.INK_OPACITY,"stroke-opacity"]]));}},{key:"createDrawerInstance",value:function createDrawerInstance(x,y,parentWidth,parentHeight,rotation){return new InkDrawOutliner(x,y,parentWidth,parentHeight,rotation,this._defaultDrawingOptions["stroke-width"]);}},{key:"deserializeDraw",value:function deserializeDraw(pageX,pageY,pageWidth,pageHeight,innerMargin,data){return InkDrawOutline.deserialize(pageX,pageY,pageWidth,pageHeight,innerMargin,data);}},{key:"deserialize",value:function(){var _deserialize5=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee49(data,parent,uiManager){var initialData,_data9,_data9$data,inkLists,rect,rotation,id,color,opacity,thickness,popupRef,pageNumber,editor;return _regenerator().w(function(_context50){while(1)switch(_context50.n){case 0:initialData=null;if(data instanceof InkAnnotationElement){_data9=data,_data9$data=_data9.data,inkLists=_data9$data.inkLists,rect=_data9$data.rect,rotation=_data9$data.rotation,id=_data9$data.id,color=_data9$data.color,opacity=_data9$data.opacity,thickness=_data9$data.borderStyle.rawWidth,popupRef=_data9$data.popupRef,pageNumber=_data9.parent.page.pageNumber;initialData=data={annotationType:_AnnotationEditorType.INK,color:Array.from(color),thickness:thickness,opacity:opacity,paths:{points:inkLists},boxes:null,pageIndex:pageNumber-1,rect:rect.slice(0),rotation:rotation,id:id,deleted:false,popupRef:popupRef};}_context50.n=1;return _superPropGet(InkEditor,"deserialize",this,2)([data,parent,uiManager]);case 1:editor=_context50.v;editor.annotationElementId=data.id||null;editor._initialData=initialData;return _context50.a(2,editor);}},_callee49,this);}));function deserialize(_x49,_x50,_x51){return _deserialize5.apply(this,arguments);}return deserialize;}()},{key:"onScaleChangingWhenDrawing",value:function onScaleChangingWhenDrawing(){var parent=this._currentParent;if(!parent){return;}_superPropGet(InkEditor,"onScaleChangingWhenDrawing",this,2)([]);this._defaultDrawingOptions.updateSVGProperty("stroke-width");parent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties());}}]);}(DrawingEditor);function _hasElementChanged3(serialized){var _this$_initialData3=this._initialData,color=_this$_initialData3.color,thickness=_this$_initialData3.thickness,opacity=_this$_initialData3.opacity,pageIndex=_this$_initialData3.pageIndex;return this._hasBeenMoved||this._hasBeenResized||serialized.color.some(function(c,i){return c!==color[i];})||serialized.thickness!==thickness||serialized.opacity!==opacity||serialized.pageIndex!==pageIndex;}_defineProperty(InkEditor,"_type","ink");_defineProperty(InkEditor,"_editorType",_AnnotationEditorType.INK);_defineProperty(InkEditor,"_defaultDrawingOptions",null);;// ./src/display/editor/drawers/contour.js
var ContourDrawOutline=/*#__PURE__*/function(_InkDrawOutline2){function ContourDrawOutline(){_classCallCheck(this,ContourDrawOutline);return _callSuper(this,ContourDrawOutline,arguments);}_inherits(ContourDrawOutline,_InkDrawOutline2);return _createClass(ContourDrawOutline,[{key:"toSVGPath",value:function toSVGPath(){var path=_superPropGet(ContourDrawOutline,"toSVGPath",this,3)([]);if(!path.endsWith("Z")){path+="Z";}return path;}}]);}(InkDrawOutline);;// ./src/display/editor/drawers/signaturedraw.js
var BASE_HEADER_LENGTH=8;var POINTS_PROPERTIES_NUMBER=3;var _SignatureExtractor=/*#__PURE__*/function(){function _SignatureExtractor(){_classCallCheck(this,_SignatureExtractor);}return _createClass(_SignatureExtractor,null,[{key:"extractContoursFromText",value:function extractContoursFromText(text,_ref120,pageWidth,pageHeight,rotation,innerMargin){var fontFamily=_ref120.fontFamily,fontStyle=_ref120.fontStyle,fontWeight=_ref120.fontWeight;var canvas=new OffscreenCanvas(1,1);var ctx=canvas.getContext("2d",{alpha:false});var fontSize=200;var font=ctx.font="".concat(fontStyle," ").concat(fontWeight," ").concat(fontSize,"px ").concat(fontFamily);var _ctx$measureText=ctx.measureText(text),actualBoundingBoxLeft=_ctx$measureText.actualBoundingBoxLeft,actualBoundingBoxRight=_ctx$measureText.actualBoundingBoxRight,actualBoundingBoxAscent=_ctx$measureText.actualBoundingBoxAscent,actualBoundingBoxDescent=_ctx$measureText.actualBoundingBoxDescent,fontBoundingBoxAscent=_ctx$measureText.fontBoundingBoxAscent,fontBoundingBoxDescent=_ctx$measureText.fontBoundingBoxDescent,width=_ctx$measureText.width;var SCALE=1.5;var canvasWidth=Math.ceil(Math.max(Math.abs(actualBoundingBoxLeft)+Math.abs(actualBoundingBoxRight)||0,width)*SCALE);var canvasHeight=Math.ceil(Math.max(Math.abs(actualBoundingBoxAscent)+Math.abs(actualBoundingBoxDescent)||fontSize,Math.abs(fontBoundingBoxAscent)+Math.abs(fontBoundingBoxDescent)||fontSize)*SCALE);canvas=new OffscreenCanvas(canvasWidth,canvasHeight);ctx=canvas.getContext("2d",{alpha:true,willReadFrequently:true});ctx.font=font;ctx.filter="grayscale(1)";ctx.fillStyle="white";ctx.fillRect(0,0,canvasWidth,canvasHeight);ctx.fillStyle="black";ctx.fillText(text,canvasWidth*(SCALE-1)/2,canvasHeight*(3-SCALE)/2);var uint8Buf=_assertClassBrand(_SignatureExtractor,this,_toUint).call(this,ctx.getImageData(0,0,canvasWidth,canvasHeight).data);var histogram=_assertClassBrand(_SignatureExtractor,this,_getHistogram).call(this,uint8Buf);var threshold=_assertClassBrand(_SignatureExtractor,this,_guessThreshold).call(this,histogram);var contourList=_assertClassBrand(_SignatureExtractor,this,_findContours).call(this,uint8Buf,canvasWidth,canvasHeight,threshold);return this.processDrawnLines({lines:{curves:contourList,width:canvasWidth,height:canvasHeight},pageWidth:pageWidth,pageHeight:pageHeight,rotation:rotation,innerMargin:innerMargin,mustSmooth:true,areContours:true});}},{key:"process",value:function process(bitmap,pageWidth,pageHeight,rotation,innerMargin){var _assertClassBrand$cal25=_assertClassBrand(_SignatureExtractor,this,_getGrayPixels).call(this,bitmap),_assertClassBrand$cal26=_slicedToArray(_assertClassBrand$cal25,3),uint8Buf=_assertClassBrand$cal26[0],width=_assertClassBrand$cal26[1],height=_assertClassBrand$cal26[2];var _assertClassBrand$cal27=_assertClassBrand(_SignatureExtractor,this,_bilateralFilter).call(this,uint8Buf,width,height,Math.hypot(width,height)*_assertClassBrand(_SignatureExtractor,this,_PARAMETERS)._.sigmaSFactor,_assertClassBrand(_SignatureExtractor,this,_PARAMETERS)._.sigmaR,_assertClassBrand(_SignatureExtractor,this,_PARAMETERS)._.kernelSize),_assertClassBrand$cal28=_slicedToArray(_assertClassBrand$cal27,2),buffer=_assertClassBrand$cal28[0],histogram=_assertClassBrand$cal28[1];var threshold=_assertClassBrand(_SignatureExtractor,this,_guessThreshold).call(this,histogram);var contourList=_assertClassBrand(_SignatureExtractor,this,_findContours).call(this,buffer,width,height,threshold);return this.processDrawnLines({lines:{curves:contourList,width:width,height:height},pageWidth:pageWidth,pageHeight:pageHeight,rotation:rotation,innerMargin:innerMargin,mustSmooth:true,areContours:true});}},{key:"processDrawnLines",value:function processDrawnLines(_ref121){var _lines$thickness;var lines=_ref121.lines,pageWidth=_ref121.pageWidth,pageHeight=_ref121.pageHeight,rotation=_ref121.rotation,innerMargin=_ref121.innerMargin,mustSmooth=_ref121.mustSmooth,areContours=_ref121.areContours;if(rotation%180!==0){var _ref122=[pageHeight,pageWidth];pageWidth=_ref122[0];pageHeight=_ref122[1];}var curves=lines.curves,width=lines.width,height=lines.height;var thickness=(_lines$thickness=lines.thickness)!==null&&_lines$thickness!==void 0?_lines$thickness:0;var linesAndPoints=[];var ratio=Math.min(pageWidth/width,pageHeight/height);var xScale=ratio/pageWidth;var yScale=ratio/pageHeight;var newCurves=[];var _iterator154=_createForOfIteratorHelper(curves),_step154;try{for(_iterator154.s();!(_step154=_iterator154.n()).done;){var points=_step154.value.points;var reducedPoints=mustSmooth?_assertClassBrand(_SignatureExtractor,this,_douglasPeucker).call(this,points):points;if(!reducedPoints){continue;}newCurves.push(reducedPoints);var len=reducedPoints.length;var newPoints=new Float32Array(len);var line=new Float32Array(3*(len===2?2:len-2));linesAndPoints.push({line:line,points:newPoints});if(len===2){newPoints[0]=reducedPoints[0]*xScale;newPoints[1]=reducedPoints[1]*yScale;line.set([NaN,NaN,NaN,NaN,newPoints[0],newPoints[1]],0);continue;}var _reducedPoints=_slicedToArray(reducedPoints,4),x1=_reducedPoints[0],y1=_reducedPoints[1],x2=_reducedPoints[2],y2=_reducedPoints[3];x1*=xScale;y1*=yScale;x2*=xScale;y2*=yScale;newPoints.set([x1,y1,x2,y2],0);line.set([NaN,NaN,NaN,NaN,x1,y1],0);for(var i=4;i<len;i+=2){var x=newPoints[i]=reducedPoints[i]*xScale;var y=newPoints[i+1]=reducedPoints[i+1]*yScale;line.set(Outline.createBezierPoints(x1,y1,x2,y2,x,y),(i-2)*3);var _ref123=[x2,y2,x,y];x1=_ref123[0];y1=_ref123[1];x2=_ref123[2];y2=_ref123[3];}}}catch(err){_iterator154.e(err);}finally{_iterator154.f();}if(linesAndPoints.length===0){return null;}var outline=areContours?new ContourDrawOutline():new InkDrawOutline();outline.build(linesAndPoints,pageWidth,pageHeight,1,rotation,areContours?0:thickness,innerMargin);return{outline:outline,newCurves:newCurves,areContours:areContours,thickness:thickness,width:width,height:height};}},{key:"compressSignature",value:function(){var _compressSignature=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee50(_ref124){var outlines,areContours,thickness,width,height,minDiff,maxDiff,outlinesLength,_iterator155,_step155,points,i,ii,dx,bufferType,len,headerLength,header,offset,_iterator156,_step156,_points6,cs,writer,BufferCtor,_iterator157,_step157,_points7,diffs,_i29,_ii4,buf,bytes;return _regenerator().w(function(_context51){while(1)switch(_context51.n){case 0:outlines=_ref124.outlines,areContours=_ref124.areContours,thickness=_ref124.thickness,width=_ref124.width,height=_ref124.height;minDiff=Infinity;maxDiff=-Infinity;outlinesLength=0;_iterator155=_createForOfIteratorHelper(outlines);try{for(_iterator155.s();!(_step155=_iterator155.n()).done;){points=_step155.value;outlinesLength+=points.length;for(i=2,ii=points.length;i<ii;i++){dx=points[i]-points[i-2];minDiff=Math.min(minDiff,dx);maxDiff=Math.max(maxDiff,dx);}}}catch(err){_iterator155.e(err);}finally{_iterator155.f();}if(minDiff>=-128&&maxDiff<=127){bufferType=Int8Array;}else if(minDiff>=-32768&&maxDiff<=32767){bufferType=Int16Array;}else{bufferType=Int32Array;}len=outlines.length;headerLength=BASE_HEADER_LENGTH+POINTS_PROPERTIES_NUMBER*len;header=new Uint32Array(headerLength);offset=0;header[offset++]=headerLength*Uint32Array.BYTES_PER_ELEMENT+(outlinesLength-2*len)*bufferType.BYTES_PER_ELEMENT;header[offset++]=0;header[offset++]=width;header[offset++]=height;header[offset++]=areContours?0:1;header[offset++]=Math.max(0,Math.floor(thickness!==null&&thickness!==void 0?thickness:0));header[offset++]=len;header[offset++]=bufferType.BYTES_PER_ELEMENT;_iterator156=_createForOfIteratorHelper(outlines);try{for(_iterator156.s();!(_step156=_iterator156.n()).done;){_points6=_step156.value;header[offset++]=_points6.length-2;header[offset++]=_points6[0];header[offset++]=_points6[1];}}catch(err){_iterator156.e(err);}finally{_iterator156.f();}cs=new CompressionStream("deflate-raw");writer=cs.writable.getWriter();_context51.n=1;return writer.ready;case 1:writer.write(header);BufferCtor=bufferType.prototype.constructor;_iterator157=_createForOfIteratorHelper(outlines);try{for(_iterator157.s();!(_step157=_iterator157.n()).done;){_points7=_step157.value;diffs=new BufferCtor(_points7.length-2);for(_i29=2,_ii4=_points7.length;_i29<_ii4;_i29++){diffs[_i29-2]=_points7[_i29]-_points7[_i29-2];}writer.write(diffs);}}catch(err){_iterator157.e(err);}finally{_iterator157.f();}writer.close();_context51.n=2;return new Response(cs.readable).arrayBuffer();case 2:buf=_context51.v;bytes=new Uint8Array(buf);return _context51.a(2,toBase64Util(bytes));}},_callee50);}));function compressSignature(_x52){return _compressSignature.apply(this,arguments);}return compressSignature;}()},{key:"decompressSignature",value:function(){var _decompressSignature=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee52(signatureData){var bytes,_DecompressionStream,readable,writable,writer,data,offset,_iteratorAbruptCompletion,_didIteratorError,_iteratorError,_iterator,_step,chunk,header,version,width,height,areContours,thickness,numberOfDrawings,bufferType,outlines,diffsOffset,diffs,i,len,points,j,_j2,_t20,_t21,_t22;return _regenerator().w(function(_context53){while(1)switch(_context53.n){case 0:_context53.p=0;bytes=fromBase64Util(signatureData);_DecompressionStream=new DecompressionStream("deflate-raw"),readable=_DecompressionStream.readable,writable=_DecompressionStream.writable;writer=writable.getWriter();_context53.n=1;return writer.ready;case 1:writer.write(bytes).then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee51(){return _regenerator().w(function(_context52){while(1)switch(_context52.n){case 0:_context52.n=1;return writer.ready;case 1:_context52.n=2;return writer.close();case 2:return _context52.a(2);}},_callee51);})))["catch"](function(){});data=null;offset=0;_iteratorAbruptCompletion=false;_didIteratorError=false;_context53.p=2;_iterator=_asyncIterator(readable);case 3:_context53.n=4;return _iterator.next();case 4:if(!(_iteratorAbruptCompletion=!(_step=_context53.v).done)){_context53.n=6;break;}chunk=_step.value;data||(data=new Uint8Array(new Uint32Array(chunk.buffer,0,4)[0]));data.set(chunk,offset);offset+=chunk.length;case 5:_iteratorAbruptCompletion=false;_context53.n=3;break;case 6:_context53.n=8;break;case 7:_context53.p=7;_t20=_context53.v;_didIteratorError=true;_iteratorError=_t20;case 8:_context53.p=8;_context53.p=9;if(!(_iteratorAbruptCompletion&&_iterator["return"]!=null)){_context53.n=10;break;}_context53.n=10;return _iterator["return"]();case 10:_context53.p=10;if(!_didIteratorError){_context53.n=11;break;}throw _iteratorError;case 11:return _context53.f(10);case 12:return _context53.f(8);case 13:header=new Uint32Array(data.buffer,0,data.length>>2);version=header[1];if(!(version!==0)){_context53.n=14;break;}throw new Error("Invalid version: ".concat(version));case 14:width=header[2];height=header[3];areContours=header[4]===0;thickness=header[5];numberOfDrawings=header[6];bufferType=header[7];outlines=[];diffsOffset=(BASE_HEADER_LENGTH+POINTS_PROPERTIES_NUMBER*numberOfDrawings)*Uint32Array.BYTES_PER_ELEMENT;_t21=bufferType;_context53.n=_t21===Int8Array.BYTES_PER_ELEMENT?15:_t21===Int16Array.BYTES_PER_ELEMENT?16:_t21===Int32Array.BYTES_PER_ELEMENT?17:18;break;case 15:diffs=new Int8Array(data.buffer,diffsOffset);return _context53.a(3,18);case 16:diffs=new Int16Array(data.buffer,diffsOffset);return _context53.a(3,18);case 17:diffs=new Int32Array(data.buffer,diffsOffset);return _context53.a(3,18);case 18:offset=0;for(i=0;i<numberOfDrawings;i++){len=header[POINTS_PROPERTIES_NUMBER*i+BASE_HEADER_LENGTH];points=new Float32Array(len+2);outlines.push(points);for(j=0;j<POINTS_PROPERTIES_NUMBER-1;j++){points[j]=header[POINTS_PROPERTIES_NUMBER*i+BASE_HEADER_LENGTH+j+1];}for(_j2=0;_j2<len;_j2++){points[_j2+2]=points[_j2]+diffs[offset++];}}return _context53.a(2,{areContours:areContours,thickness:thickness,outlines:outlines,width:width,height:height});case 19:_context53.p=19;_t22=_context53.v;warn("decompressSignature: ".concat(_t22));return _context53.a(2,null);}},_callee52,null,[[9,,10,12],[2,7,8,13],[0,19]]);}));function decompressSignature(_x53){return _decompressSignature.apply(this,arguments);}return decompressSignature;}()}]);}();_SignatureExtractor2=_SignatureExtractor;function _neighborIndexToId(i0,j0,i,j){i-=i0;j-=j0;if(i===0){return j>0?0:4;}if(i===1){return j+6;}return 2-j;}function _clockwiseNonZero(buf,width,i0,j0,i,j,offset){var id=_assertClassBrand(_SignatureExtractor2,this,_neighborIndexToId).call(this,i0,j0,i,j);for(var k=0;k<8;k++){var kk=(-k+id-offset+16)%8;var shiftI=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*kk];var shiftJ=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*kk+1];if(buf[(i0+shiftI)*width+(j0+shiftJ)]!==0){return kk;}}return-1;}function _counterClockwiseNonZero(buf,width,i0,j0,i,j,offset){var id=_assertClassBrand(_SignatureExtractor2,this,_neighborIndexToId).call(this,i0,j0,i,j);for(var k=0;k<8;k++){var kk=(k+id+offset+16)%8;var shiftI=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*kk];var shiftJ=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*kk+1];if(buf[(i0+shiftI)*width+(j0+shiftJ)]!==0){return kk;}}return-1;}function _findContours(buf,width,height,threshold){var N=buf.length;var types=new Int32Array(N);for(var i=0;i<N;i++){types[i]=buf[i]<=threshold?1:0;}for(var _i35=1;_i35<height-1;_i35++){types[_i35*width]=types[_i35*width+width-1]=0;}for(var _i36=0;_i36<width;_i36++){types[_i36]=types[width*height-1-_i36]=0;}var nbd=1;var lnbd;var contours=[];for(var _i37=1;_i37<height-1;_i37++){lnbd=1;for(var j=1;j<width-1;j++){var ij=_i37*width+j;var pix=types[ij];if(pix===0){continue;}var i2=_i37;var j2=j;if(pix===1&&types[ij-1]===0){nbd+=1;j2-=1;}else if(pix>=1&&types[ij+1]===0){nbd+=1;j2+=1;if(pix>1){lnbd=pix;}}else{if(pix!==1){lnbd=Math.abs(pix);}continue;}var points=[j,_i37];var isHole=j2===j+1;var contour={isHole:isHole,points:points,id:nbd,parent:0};contours.push(contour);var contour0=void 0;var _iterator190=_createForOfIteratorHelper(contours),_step190;try{for(_iterator190.s();!(_step190=_iterator190.n()).done;){var c=_step190.value;if(c.id===lnbd){contour0=c;break;}}}catch(err){_iterator190.e(err);}finally{_iterator190.f();}if(!contour0){contour.parent=isHole?lnbd:0;}else if(contour0.isHole){contour.parent=isHole?contour0.parent:lnbd;}else{contour.parent=isHole?lnbd:contour0.parent;}var k=_assertClassBrand(_SignatureExtractor2,this,_clockwiseNonZero).call(this,types,width,_i37,j,i2,j2,0);if(k===-1){types[ij]=-nbd;if(types[ij]!==1){lnbd=Math.abs(types[ij]);}continue;}var shiftI=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*k];var shiftJ=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*k+1];var i1=_i37+shiftI;var j1=j+shiftJ;i2=i1;j2=j1;var i3=_i37;var j3=j;while(true){var kk=_assertClassBrand(_SignatureExtractor2,this,_counterClockwiseNonZero).call(this,types,width,i3,j3,i2,j2,1);shiftI=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*kk];shiftJ=_assertClassBrand(_SignatureExtractor2,this,_neighborIdToIndex)._[2*kk+1];var i4=i3+shiftI;var j4=j3+shiftJ;points.push(j4,i4);var ij3=i3*width+j3;if(types[ij3+1]===0){types[ij3]=-nbd;}else if(types[ij3]===1){types[ij3]=nbd;}if(i4===_i37&&j4===j&&i3===i1&&j3===j1){if(types[ij]!==1){lnbd=Math.abs(types[ij]);}break;}else{i2=i3;j2=j3;i3=i4;j3=j4;}}}}return contours;}function _douglasPeuckerHelper(points,start,end,output){if(end-start<=4){for(var i=start;i<end-2;i+=2){output.push(points[i],points[i+1]);}return;}var ax=points[start];var ay=points[start+1];var abx=points[end-4]-ax;var aby=points[end-3]-ay;var dist=Math.hypot(abx,aby);var nabx=abx/dist;var naby=aby/dist;var aa=nabx*ay-naby*ax;var m=aby/abx;var invS=1/dist;var phi=Math.atan(m);var cosPhi=Math.cos(phi);var sinPhi=Math.sin(phi);var tmax=invS*(Math.abs(cosPhi)+Math.abs(sinPhi));var poly=invS*(1-tmax+Math.pow(tmax,2));var partialPhi=Math.max(Math.atan(Math.abs(sinPhi+cosPhi)*poly),Math.atan(Math.abs(sinPhi-cosPhi)*poly));var dmax=0;var index=start;for(var _i38=start+2;_i38<end-2;_i38+=2){var d=Math.abs(aa-nabx*points[_i38+1]+naby*points[_i38]);if(d>dmax){index=_i38;dmax=d;}}if(dmax>Math.pow(dist*partialPhi,2)){_assertClassBrand(_SignatureExtractor2,this,_douglasPeuckerHelper).call(this,points,start,index+2,output);_assertClassBrand(_SignatureExtractor2,this,_douglasPeuckerHelper).call(this,points,index,end,output);}else{output.push(ax,ay);}}function _douglasPeucker(points){var output=[];var len=points.length;_assertClassBrand(_SignatureExtractor2,this,_douglasPeuckerHelper).call(this,points,0,len,output);output.push(points[len-2],points[len-1]);return output.length<=4?null:output;}function _bilateralFilter(buf,width,height,sigmaS,sigmaR,kernelSize){var kernel=new Float32Array(Math.pow(kernelSize,2));var sigmaS2=-2*Math.pow(sigmaS,2);var halfSize=kernelSize>>1;for(var i=0;i<kernelSize;i++){var x=Math.pow(i-halfSize,2);for(var j=0;j<kernelSize;j++){kernel[i*kernelSize+j]=Math.exp((x+Math.pow(j-halfSize,2))/sigmaS2);}}var rangeValues=new Float32Array(256);var sigmaR2=-2*Math.pow(sigmaR,2);for(var _i39=0;_i39<256;_i39++){rangeValues[_i39]=Math.exp(Math.pow(_i39,2)/sigmaR2);}var N=buf.length;var out=new Uint8Array(N);var histogram=new Uint32Array(256);for(var _i40=0;_i40<height;_i40++){for(var _j3=0;_j3<width;_j3++){var ij=_i40*width+_j3;var center=buf[ij];var sum=0;var norm=0;for(var k=0;k<kernelSize;k++){var y=_i40+k-halfSize;if(y<0||y>=height){continue;}for(var l=0;l<kernelSize;l++){var _x70=_j3+l-halfSize;if(_x70<0||_x70>=width){continue;}var neighbour=buf[y*width+_x70];var w=kernel[k*kernelSize+l]*rangeValues[Math.abs(neighbour-center)];sum+=neighbour*w;norm+=w;}}var pix=out[ij]=Math.round(sum/norm);histogram[pix]++;}}return[out,histogram];}function _getHistogram(buf){var histogram=new Uint32Array(256);var _iterator191=_createForOfIteratorHelper(buf),_step191;try{for(_iterator191.s();!(_step191=_iterator191.n()).done;){var g=_step191.value;histogram[g]++;}}catch(err){_iterator191.e(err);}finally{_iterator191.f();}return histogram;}function _toUint(buf){var N=buf.length;var out=new Uint8ClampedArray(N>>2);var max=-Infinity;var min=Infinity;for(var i=0,ii=out.length;i<ii;i++){var A=buf[(i<<2)+3];if(A===0){max=out[i]=0xff;continue;}var pix=out[i]=buf[i<<2];if(pix>max){max=pix;}if(pix<min){min=pix;}}var ratio=255/(max-min);for(var _i41=0;_i41<N;_i41++){out[_i41]=(out[_i41]-min)*ratio;}return out;}function _guessThreshold(histogram){var i;var M=-Infinity;var L=-Infinity;var min=histogram.findIndex(function(v){return v!==0;});var pos=min;var spos=min;for(i=min;i<256;i++){var v=histogram[i];if(v>M){if(i-pos>L){L=i-pos;spos=i-1;}M=v;pos=i;}}for(i=spos-1;i>=0;i--){if(histogram[i]>histogram[i+1]){break;}}return i;}function _getGrayPixels(bitmap){var originalBitmap=bitmap;var _bitmap3=bitmap,width=_bitmap3.width,height=_bitmap3.height;var maxDim=_assertClassBrand(_SignatureExtractor2,this,_PARAMETERS)._.maxDim;var newWidth=width;var newHeight=height;if(width>maxDim||height>maxDim){var prevWidth=width;var prevHeight=height;var steps=Math.log2(Math.max(width,height)/maxDim);var isteps=Math.floor(steps);steps=steps===isteps?isteps-1:isteps;for(var i=0;i<steps;i++){newWidth=prevWidth;newHeight=prevHeight;if(newWidth>maxDim){newWidth=Math.ceil(newWidth/2);}if(newHeight>maxDim){newHeight=Math.ceil(newHeight/2);}var _offscreen=new OffscreenCanvas(newWidth,newHeight);var _ctx=_offscreen.getContext("2d");_ctx.drawImage(bitmap,0,0,prevWidth,prevHeight,0,0,newWidth,newHeight);prevWidth=newWidth;prevHeight=newHeight;if(bitmap!==originalBitmap){bitmap.close();}bitmap=_offscreen.transferToImageBitmap();}var ratio=Math.min(maxDim/newWidth,maxDim/newHeight);newWidth=Math.round(newWidth*ratio);newHeight=Math.round(newHeight*ratio);}var offscreen=new OffscreenCanvas(newWidth,newHeight);var ctx=offscreen.getContext("2d",{willReadFrequently:true});ctx.filter="grayscale(1)";ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,newWidth,newHeight);var grayImage=ctx.getImageData(0,0,newWidth,newHeight).data;var uint8Buf=_assertClassBrand(_SignatureExtractor2,this,_toUint).call(this,grayImage);return[uint8Buf,newWidth,newHeight];}var _PARAMETERS={_:{maxDim:512,sigmaSFactor:0.02,sigmaR:25,kernelSize:16}};var _neighborIdToIndex={_:new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1])};;// ./src/display/editor/signature.js
var SignatureOptions=/*#__PURE__*/function(_DrawingOptions3){function SignatureOptions(){var _this98;_classCallCheck(this,SignatureOptions);_this98=_callSuper(this,SignatureOptions);_superPropGet((_this98,SignatureOptions),"updateProperties",_this98,3)([{fill:"CanvasText","stroke-width":0}]);return _this98;}_inherits(SignatureOptions,_DrawingOptions3);return _createClass(SignatureOptions,[{key:"clone",value:function clone(){var clone=new SignatureOptions();clone.updateAll(this);return clone;}}]);}(DrawingOptions);var DrawnSignatureOptions=/*#__PURE__*/function(_InkDrawingOptions){function DrawnSignatureOptions(viewerParameters){var _this99;_classCallCheck(this,DrawnSignatureOptions);_this99=_callSuper(this,DrawnSignatureOptions,[viewerParameters]);_superPropGet((_this99,DrawnSignatureOptions),"updateProperties",_this99,3)([{stroke:"CanvasText","stroke-width":1}]);return _this99;}_inherits(DrawnSignatureOptions,_InkDrawingOptions);return _createClass(DrawnSignatureOptions,[{key:"clone",value:function clone(){var clone=new DrawnSignatureOptions(this._viewParameters);clone.updateAll(this);return clone;}}]);}(InkDrawingOptions);var _isExtracted=/*#__PURE__*/new WeakMap();var _description=/*#__PURE__*/new WeakMap();var _signatureData=/*#__PURE__*/new WeakMap();var _signatureUUID=/*#__PURE__*/new WeakMap();var SignatureEditor=/*#__PURE__*/function(_DrawingEditor3){function SignatureEditor(params){var _this100;_classCallCheck(this,SignatureEditor);_this100=_callSuper(this,SignatureEditor,[_objectSpread(_objectSpread({},params),{},{mustBeCommitted:true,name:"signatureEditor"})]);_classPrivateFieldInitSpec(_this100,_isExtracted,false);_classPrivateFieldInitSpec(_this100,_description,null);_classPrivateFieldInitSpec(_this100,_signatureData,null);_classPrivateFieldInitSpec(_this100,_signatureUUID,null);_this100._willKeepAspectRatio=true;_classPrivateFieldSet(_signatureData,_this100,params.signatureData||null);_classPrivateFieldSet(_description,_this100,null);_this100.defaultL10nId="pdfjs-editor-signature-editor1";return _this100;}_inherits(SignatureEditor,_DrawingEditor3);return _createClass(SignatureEditor,[{key:"telemetryFinalData",get:function get(){return{type:"signature",hasDescription:!!_classPrivateFieldGet(_description,this)};}},{key:"isResizable",get:function get(){return true;}},{key:"onScaleChanging",value:function onScaleChanging(){if(this._drawId===null){return;}_superPropGet(SignatureEditor,"onScaleChanging",this,3)([]);}},{key:"render",value:function render(){if(this.div){return this.div;}var baseX,baseY;var _isCopy=this._isCopy;if(_isCopy){this._isCopy=false;baseX=this.x;baseY=this.y;}_superPropGet(SignatureEditor,"render",this,3)([]);if(this._drawId===null){if(_classPrivateFieldGet(_signatureData,this)){var _classPrivateFieldGet114=_classPrivateFieldGet(_signatureData,this),lines=_classPrivateFieldGet114.lines,mustSmooth=_classPrivateFieldGet114.mustSmooth,areContours=_classPrivateFieldGet114.areContours,description=_classPrivateFieldGet114.description,uuid=_classPrivateFieldGet114.uuid,heightInPage=_classPrivateFieldGet114.heightInPage;var _this$parent$viewport4=this.parent.viewport,_this$parent$viewport5=_this$parent$viewport4.rawDims,pageWidth=_this$parent$viewport5.pageWidth,pageHeight=_this$parent$viewport5.pageHeight,rotation=_this$parent$viewport4.rotation;var outline=_SignatureExtractor.processDrawnLines({lines:lines,pageWidth:pageWidth,pageHeight:pageHeight,rotation:rotation,innerMargin:SignatureEditor._INNER_MARGIN,mustSmooth:mustSmooth,areContours:areContours});this.addSignature(outline,heightInPage,description,uuid);}else{this.div.setAttribute("data-l10n-args",JSON.stringify({description:""}));this.div.hidden=true;this._uiManager.getSignature(this);}}if(_isCopy){this._isCopy=true;this._moveAfterPaste(baseX,baseY);}return this.div;}},{key:"setUuid",value:function setUuid(uuid){_classPrivateFieldSet(_signatureUUID,this,uuid);this.addEditToolbar();}},{key:"getUuid",value:function getUuid(){return _classPrivateFieldGet(_signatureUUID,this);}},{key:"description",get:function get(){return _classPrivateFieldGet(_description,this);},set:function set(description){_classPrivateFieldSet(_description,this,description);_superPropGet(SignatureEditor,"addEditToolbar",this,3)([]).then(function(toolbar){toolbar===null||toolbar===void 0||toolbar.updateEditSignatureButton(description);});}},{key:"getSignaturePreview",value:function getSignaturePreview(){var _classPrivateFieldGet115=_classPrivateFieldGet(_signatureData,this),newCurves=_classPrivateFieldGet115.newCurves,areContours=_classPrivateFieldGet115.areContours,thickness=_classPrivateFieldGet115.thickness,width=_classPrivateFieldGet115.width,height=_classPrivateFieldGet115.height;var maxDim=Math.max(width,height);var outlineData=_SignatureExtractor.processDrawnLines({lines:{curves:newCurves.map(function(points){return{points:points};}),thickness:thickness,width:width,height:height},pageWidth:maxDim,pageHeight:maxDim,rotation:0,innerMargin:0,mustSmooth:false,areContours:areContours});return{areContours:areContours,outline:outlineData.outline};}},{key:"addEditToolbar",value:function(){var _addEditToolbar3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee53(){var toolbar;return _regenerator().w(function(_context54){while(1)switch(_context54.n){case 0:_context54.n=1;return _superPropGet(SignatureEditor,"addEditToolbar",this,3)([]);case 1:toolbar=_context54.v;if(toolbar){_context54.n=2;break;}return _context54.a(2,null);case 2:if(!(this._uiManager.signatureManager&&_classPrivateFieldGet(_description,this)!==null)){_context54.n=4;break;}_context54.n=3;return toolbar.addEditSignatureButton(this._uiManager.signatureManager,_classPrivateFieldGet(_signatureUUID,this),_classPrivateFieldGet(_description,this));case 3:toolbar.show();case 4:return _context54.a(2,toolbar);}},_callee53,this);}));function addEditToolbar(){return _addEditToolbar3.apply(this,arguments);}return addEditToolbar;}()},{key:"addSignature",value:function addSignature(data,heightInPage,description,uuid){var savedX=this.x,savedY=this.y;var _classPrivateFieldSet2=_classPrivateFieldSet(_signatureData,this,data),outline=_classPrivateFieldSet2.outline;_classPrivateFieldSet(_isExtracted,this,outline instanceof ContourDrawOutline);_classPrivateFieldSet(_description,this,description);this.div.setAttribute("data-l10n-args",JSON.stringify({description:description}));var drawingOptions;if(_classPrivateFieldGet(_isExtracted,this)){drawingOptions=SignatureEditor.getDefaultDrawingOptions();}else{drawingOptions=SignatureEditor._defaultDrawnSignatureOptions.clone();drawingOptions.updateProperties({"stroke-width":outline.thickness});}this._addOutlines({drawOutlines:outline,drawingOptions:drawingOptions});var _this$parentDimension10=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension10[0],parentHeight=_this$parentDimension10[1];var _this$pageDimensions7=_slicedToArray(this.pageDimensions,2),pageHeight=_this$pageDimensions7[1];var newHeight=heightInPage/pageHeight;newHeight=newHeight>=1?0.5:newHeight;this.width*=newHeight/this.height;if(this.width>=1){newHeight*=0.9/this.width;this.width=0.9;}this.height=newHeight;this.setDims(parentWidth*this.width,parentHeight*this.height);this.x=savedX;this.y=savedY;this.center();this._onResized();this.onScaleChanging();this.rotate();this._uiManager.addToAnnotationStorage(this);this.setUuid(uuid);this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!uuid,hasDescription:!!description}});this.div.hidden=false;}},{key:"getFromImage",value:function getFromImage(bitmap){var _this$parent$viewport6=this.parent.viewport,_this$parent$viewport7=_this$parent$viewport6.rawDims,pageWidth=_this$parent$viewport7.pageWidth,pageHeight=_this$parent$viewport7.pageHeight,rotation=_this$parent$viewport6.rotation;return _SignatureExtractor.process(bitmap,pageWidth,pageHeight,rotation,SignatureEditor._INNER_MARGIN);}},{key:"getFromText",value:function getFromText(text,fontInfo){var _this$parent$viewport8=this.parent.viewport,_this$parent$viewport9=_this$parent$viewport8.rawDims,pageWidth=_this$parent$viewport9.pageWidth,pageHeight=_this$parent$viewport9.pageHeight,rotation=_this$parent$viewport8.rotation;return _SignatureExtractor.extractContoursFromText(text,fontInfo,pageWidth,pageHeight,rotation,SignatureEditor._INNER_MARGIN);}},{key:"getDrawnSignature",value:function getDrawnSignature(curves){var _this$parent$viewport0=this.parent.viewport,_this$parent$viewport1=_this$parent$viewport0.rawDims,pageWidth=_this$parent$viewport1.pageWidth,pageHeight=_this$parent$viewport1.pageHeight,rotation=_this$parent$viewport0.rotation;return _SignatureExtractor.processDrawnLines({lines:curves,pageWidth:pageWidth,pageHeight:pageHeight,rotation:rotation,innerMargin:SignatureEditor._INNER_MARGIN,mustSmooth:false,areContours:false});}},{key:"createDrawingOptions",value:function createDrawingOptions(_ref126){var areContours=_ref126.areContours,thickness=_ref126.thickness;if(areContours){this._drawingOptions=SignatureEditor.getDefaultDrawingOptions();}else{this._drawingOptions=SignatureEditor._defaultDrawnSignatureOptions.clone();this._drawingOptions.updateProperties({"stroke-width":thickness});}}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isEmpty()){return null;}var _this$serializeDraw3=this.serializeDraw(isForCopying),lines=_this$serializeDraw3.lines,points=_this$serializeDraw3.points,rect=_this$serializeDraw3.rect;var thickness=this._drawingOptions["stroke-width"];var serialized={annotationType:_AnnotationEditorType.SIGNATURE,isSignature:true,areContours:_classPrivateFieldGet(_isExtracted,this),color:[0,0,0],thickness:_classPrivateFieldGet(_isExtracted,this)?0:thickness,pageIndex:this.pageIndex,rect:rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(isForCopying){serialized.paths={lines:lines,points:points};serialized.uuid=_classPrivateFieldGet(_signatureUUID,this);serialized.isCopy=true;}else{serialized.lines=lines;}if(_classPrivateFieldGet(_description,this)){serialized.accessibilityData={type:"Figure",alt:_classPrivateFieldGet(_description,this)};}return serialized;}}],[{key:"initialize",value:function initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager);this._defaultDrawingOptions=new SignatureOptions();this._defaultDrawnSignatureOptions=new DrawnSignatureOptions(uiManager.viewParameters);}},{key:"getDefaultDrawingOptions",value:function getDefaultDrawingOptions(options){var clone=this._defaultDrawingOptions.clone();clone.updateProperties(options);return clone;}},{key:"supportMultipleDrawings",get:function get(){return false;}},{key:"typesMap",get:function get(){return _shadow(this,"typesMap",new Map());}},{key:"isDrawer",get:function get(){return false;}},{key:"computeTelemetryFinalData",value:function computeTelemetryFinalData(data){var _hasDescriptionStats$,_hasDescriptionStats$2;var hasDescriptionStats=data.get("hasDescription");return{hasAltText:(_hasDescriptionStats$=hasDescriptionStats.get(true))!==null&&_hasDescriptionStats$!==void 0?_hasDescriptionStats$:0,hasNoAltText:(_hasDescriptionStats$2=hasDescriptionStats.get(false))!==null&&_hasDescriptionStats$2!==void 0?_hasDescriptionStats$2:0};}},{key:"deserializeDraw",value:function deserializeDraw(pageX,pageY,pageWidth,pageHeight,innerMargin,data){if(data.areContours){return ContourDrawOutline.deserialize(pageX,pageY,pageWidth,pageHeight,innerMargin,data);}return InkDrawOutline.deserialize(pageX,pageY,pageWidth,pageHeight,innerMargin,data);}},{key:"deserialize",value:function(){var _deserialize6=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee54(data,parent,uiManager){var _data$accessibilityDa;var editor;return _regenerator().w(function(_context55){while(1)switch(_context55.n){case 0:_context55.n=1;return _superPropGet(SignatureEditor,"deserialize",this,2)([data,parent,uiManager]);case 1:editor=_context55.v;_classPrivateFieldSet(_isExtracted,editor,data.areContours);_classPrivateFieldSet(_description,editor,((_data$accessibilityDa=data.accessibilityData)===null||_data$accessibilityDa===void 0?void 0:_data$accessibilityDa.alt)||"");_classPrivateFieldSet(_signatureUUID,editor,data.uuid);return _context55.a(2,editor);}},_callee54,this);}));function deserialize(_x54,_x55,_x56){return _deserialize6.apply(this,arguments);}return deserialize;}()}]);}(DrawingEditor);_defineProperty(SignatureEditor,"_type","signature");_defineProperty(SignatureEditor,"_editorType",_AnnotationEditorType.SIGNATURE);_defineProperty(SignatureEditor,"_defaultDrawingOptions",null);;// ./src/display/editor/stamp.js
var _bitmap=/*#__PURE__*/new WeakMap();var _bitmapId=/*#__PURE__*/new WeakMap();var _bitmapPromise=/*#__PURE__*/new WeakMap();var _bitmapUrl=/*#__PURE__*/new WeakMap();var _bitmapFile=/*#__PURE__*/new WeakMap();var _bitmapFileName=/*#__PURE__*/new WeakMap();var _canvas=/*#__PURE__*/new WeakMap();var _missingCanvas=/*#__PURE__*/new WeakMap();var _resizeTimeoutId=/*#__PURE__*/new WeakMap();var _isSvg=/*#__PURE__*/new WeakMap();var _hasBeenAddedInUndoStack=/*#__PURE__*/new WeakMap();var _StampEditor_brand=/*#__PURE__*/new WeakSet();var StampEditor=/*#__PURE__*/function(_AnnotationEditor6){function StampEditor(params){var _this101;_classCallCheck(this,StampEditor);_this101=_callSuper(this,StampEditor,[_objectSpread(_objectSpread({},params),{},{name:"stampEditor"})]);_classPrivateMethodInitSpec(_this101,_StampEditor_brand);_classPrivateFieldInitSpec(_this101,_bitmap,null);_classPrivateFieldInitSpec(_this101,_bitmapId,null);_classPrivateFieldInitSpec(_this101,_bitmapPromise,null);_classPrivateFieldInitSpec(_this101,_bitmapUrl,null);_classPrivateFieldInitSpec(_this101,_bitmapFile,null);_classPrivateFieldInitSpec(_this101,_bitmapFileName,"");_classPrivateFieldInitSpec(_this101,_canvas,null);_classPrivateFieldInitSpec(_this101,_missingCanvas,false);_classPrivateFieldInitSpec(_this101,_resizeTimeoutId,null);_classPrivateFieldInitSpec(_this101,_isSvg,false);_classPrivateFieldInitSpec(_this101,_hasBeenAddedInUndoStack,false);_classPrivateFieldSet(_bitmapUrl,_this101,params.bitmapUrl);_classPrivateFieldSet(_bitmapFile,_this101,params.bitmapFile);_this101.defaultL10nId="pdfjs-editor-stamp-editor";return _this101;}_inherits(StampEditor,_AnnotationEditor6);return _createClass(StampEditor,[{key:"altTextFinish",value:function altTextFinish(){if(this._uiManager.useNewAltTextFlow){this.div.hidden=false;}_superPropGet(StampEditor,"altTextFinish",this,3)([]);}},{key:"telemetryFinalData",get:function get(){var _this$altTextData;return{type:"stamp",hasAltText:!!((_this$altTextData=this.altTextData)!==null&&_this$altTextData!==void 0&&_this$altTextData.altText)};}},{key:"mlGuessAltText",value:function(){var _mlGuessAltText=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee55(){var imageData,updateAltTextData,mlManager,_ref127,data,width,height,response,altText,_args56=arguments;return _regenerator().w(function(_context56){while(1)switch(_context56.n){case 0:imageData=_args56.length>0&&_args56[0]!==undefined?_args56[0]:null;updateAltTextData=_args56.length>1&&_args56[1]!==undefined?_args56[1]:true;if(!this.hasAltTextData()){_context56.n=1;break;}return _context56.a(2,null);case 1:mlManager=this._uiManager.mlManager;if(mlManager){_context56.n=2;break;}throw new Error("No ML.");case 2:_context56.n=3;return mlManager.isEnabledFor("altText");case 3:if(_context56.v){_context56.n=4;break;}throw new Error("ML isn't enabled for alt text.");case 4:_ref127=imageData||this.copyCanvas(null,null,true).imageData,data=_ref127.data,width=_ref127.width,height=_ref127.height;_context56.n=5;return mlManager.guess({name:"altText",request:{data:data,width:width,height:height,channels:data.length/(width*height)}});case 5:response=_context56.v;if(response){_context56.n=6;break;}throw new Error("No response from the AI service.");case 6:if(!response.error){_context56.n=7;break;}throw new Error("Error from the AI service.");case 7:if(!response.cancel){_context56.n=8;break;}return _context56.a(2,null);case 8:if(response.output){_context56.n=9;break;}throw new Error("No valid response from the AI service.");case 9:altText=response.output;_context56.n=10;return this.setGuessedAltText(altText);case 10:if(updateAltTextData&&!this.hasAltTextData()){this.altTextData={alt:altText,decorative:false};}return _context56.a(2,altText);}},_callee55,this);}));function mlGuessAltText(){return _mlGuessAltText.apply(this,arguments);}return mlGuessAltText;}()},{key:"remove",value:function remove(){if(_classPrivateFieldGet(_bitmapId,this)){var _classPrivateFieldGet116;_classPrivateFieldSet(_bitmap,this,null);this._uiManager.imageManager.deleteId(_classPrivateFieldGet(_bitmapId,this));(_classPrivateFieldGet116=_classPrivateFieldGet(_canvas,this))===null||_classPrivateFieldGet116===void 0||_classPrivateFieldGet116.remove();_classPrivateFieldSet(_canvas,this,null);if(_classPrivateFieldGet(_resizeTimeoutId,this)){clearTimeout(_classPrivateFieldGet(_resizeTimeoutId,this));_classPrivateFieldSet(_resizeTimeoutId,this,null);}}_superPropGet(StampEditor,"remove",this,3)([]);}},{key:"rebuild",value:function rebuild(){if(!this.parent){if(_classPrivateFieldGet(_bitmapId,this)){_assertClassBrand(_StampEditor_brand,this,_getBitmap).call(this);}return;}_superPropGet(StampEditor,"rebuild",this,3)([]);if(this.div===null){return;}if(_classPrivateFieldGet(_bitmapId,this)&&_classPrivateFieldGet(_canvas,this)===null){_assertClassBrand(_StampEditor_brand,this,_getBitmap).call(this);}if(!this.isAttachedToDOM){this.parent.add(this);}}},{key:"onceAdded",value:function onceAdded(focus){this._isDraggable=true;if(focus){this.div.focus();}}},{key:"isEmpty",value:function isEmpty(){return!(_classPrivateFieldGet(_bitmapPromise,this)||_classPrivateFieldGet(_bitmap,this)||_classPrivateFieldGet(_bitmapUrl,this)||_classPrivateFieldGet(_bitmapFile,this)||_classPrivateFieldGet(_bitmapId,this)||_classPrivateFieldGet(_missingCanvas,this));}},{key:"isResizable",get:function get(){return true;}},{key:"render",value:function render(){if(this.div){return this.div;}var baseX,baseY;if(this._isCopy){baseX=this.x;baseY=this.y;}_superPropGet(StampEditor,"render",this,3)([]);this.div.hidden=true;this.addAltTextButton();if(!_classPrivateFieldGet(_missingCanvas,this)){if(_classPrivateFieldGet(_bitmap,this)){_assertClassBrand(_StampEditor_brand,this,_createCanvas2).call(this);}else{_assertClassBrand(_StampEditor_brand,this,_getBitmap).call(this);}}if(this._isCopy){this._moveAfterPaste(baseX,baseY);}this._uiManager.addShouldRescale(this);return this.div;}},{key:"setCanvas",value:function setCanvas(annotationElementId,canvas){var _this$_uiManager$imag=this._uiManager.imageManager.getFromCanvas(annotationElementId,canvas),bitmapId=_this$_uiManager$imag.id,bitmap=_this$_uiManager$imag.bitmap;canvas.remove();if(bitmapId&&this._uiManager.imageManager.isValidId(bitmapId)){_classPrivateFieldSet(_bitmapId,this,bitmapId);if(bitmap){_classPrivateFieldSet(_bitmap,this,bitmap);}_classPrivateFieldSet(_missingCanvas,this,false);_assertClassBrand(_StampEditor_brand,this,_createCanvas2).call(this);}}},{key:"_onResized",value:function _onResized(){this.onScaleChanging();}},{key:"onScaleChanging",value:function onScaleChanging(){var _this102=this;if(!this.parent){return;}if(_classPrivateFieldGet(_resizeTimeoutId,this)!==null){clearTimeout(_classPrivateFieldGet(_resizeTimeoutId,this));}var TIME_TO_WAIT=200;_classPrivateFieldSet(_resizeTimeoutId,this,setTimeout(function(){_classPrivateFieldSet(_resizeTimeoutId,_this102,null);_assertClassBrand(_StampEditor_brand,_this102,_drawBitmap).call(_this102);},TIME_TO_WAIT));}},{key:"copyCanvas",value:function copyCanvas(maxDataDimension,maxPreviewDimension){var createImageData=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!maxDataDimension){maxDataDimension=224;}var _classPrivateFieldGet117=_classPrivateFieldGet(_bitmap,this),bitmapWidth=_classPrivateFieldGet117.width,bitmapHeight=_classPrivateFieldGet117.height;var outputScale=new _OutputScale();var bitmap=_classPrivateFieldGet(_bitmap,this);var width=bitmapWidth,height=bitmapHeight;var canvas=null;if(maxPreviewDimension){var _window$matchMedia,_window2;if(bitmapWidth>maxPreviewDimension||bitmapHeight>maxPreviewDimension){var ratio=Math.min(maxPreviewDimension/bitmapWidth,maxPreviewDimension/bitmapHeight);width=Math.floor(bitmapWidth*ratio);height=Math.floor(bitmapHeight*ratio);}canvas=document.createElement("canvas");var scaledWidth=canvas.width=Math.ceil(width*outputScale.sx);var scaledHeight=canvas.height=Math.ceil(height*outputScale.sy);if(!_classPrivateFieldGet(_isSvg,this)){bitmap=_assertClassBrand(_StampEditor_brand,this,_scaleBitmap).call(this,scaledWidth,scaledHeight);}var ctx=canvas.getContext("2d");ctx.filter=this._uiManager.hcmFilter;var white="white",black="#cfcfd8";if(this._uiManager.hcmFilter!=="none"){black="black";}else if((_window$matchMedia=(_window2=window).matchMedia)!==null&&_window$matchMedia!==void 0&&_window$matchMedia.call(_window2,"(prefers-color-scheme: dark)").matches){white="#8f8f9d";black="#42414d";}var boxDim=15;var boxDimWidth=boxDim*outputScale.sx;var boxDimHeight=boxDim*outputScale.sy;var pattern=new OffscreenCanvas(boxDimWidth*2,boxDimHeight*2);var patternCtx=pattern.getContext("2d");patternCtx.fillStyle=white;patternCtx.fillRect(0,0,boxDimWidth*2,boxDimHeight*2);patternCtx.fillStyle=black;patternCtx.fillRect(0,0,boxDimWidth,boxDimHeight);patternCtx.fillRect(boxDimWidth,boxDimHeight,boxDimWidth,boxDimHeight);ctx.fillStyle=ctx.createPattern(pattern,"repeat");ctx.fillRect(0,0,scaledWidth,scaledHeight);ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,scaledWidth,scaledHeight);}var imageData=null;if(createImageData){var dataWidth,dataHeight;if(outputScale.symmetric&&bitmap.width<maxDataDimension&&bitmap.height<maxDataDimension){dataWidth=bitmap.width;dataHeight=bitmap.height;}else{bitmap=_classPrivateFieldGet(_bitmap,this);if(bitmapWidth>maxDataDimension||bitmapHeight>maxDataDimension){var _ratio=Math.min(maxDataDimension/bitmapWidth,maxDataDimension/bitmapHeight);dataWidth=Math.floor(bitmapWidth*_ratio);dataHeight=Math.floor(bitmapHeight*_ratio);if(!_classPrivateFieldGet(_isSvg,this)){bitmap=_assertClassBrand(_StampEditor_brand,this,_scaleBitmap).call(this,dataWidth,dataHeight);}}}var offscreen=new OffscreenCanvas(dataWidth,dataHeight);var offscreenCtx=offscreen.getContext("2d",{willReadFrequently:true});offscreenCtx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,dataWidth,dataHeight);imageData={width:dataWidth,height:dataHeight,data:offscreenCtx.getImageData(0,0,dataWidth,dataHeight).data};}return{canvas:canvas,width:width,height:height,imageData:imageData};}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.isEmpty()){return null;}if(this.deleted){return this.serializeDeleted();}var serialized={annotationType:_AnnotationEditorType.STAMP,bitmapId:_classPrivateFieldGet(_bitmapId,this),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:_classPrivateFieldGet(_isSvg,this),structTreeParentId:this._structTreeParentId};if(isForCopying){serialized.bitmapUrl=_assertClassBrand(_StampEditor_brand,this,_serializeBitmap).call(this,true);serialized.accessibilityData=this.serializeAltText(true);serialized.isCopy=true;return serialized;}var _this$serializeAltTex=this.serializeAltText(false),decorative=_this$serializeAltTex.decorative,altText=_this$serializeAltTex.altText;if(!decorative&&altText){serialized.accessibilityData={type:"Figure",alt:altText};}if(this.annotationElementId){var changes=_assertClassBrand(_StampEditor_brand,this,_hasElementChanged4).call(this,serialized);if(changes.isSame){return null;}if(changes.isSameAltText){delete serialized.accessibilityData;}else{var _this$_initialData$st;serialized.accessibilityData.structParent=(_this$_initialData$st=this._initialData.structParent)!==null&&_this$_initialData$st!==void 0?_this$_initialData$st:-1;}}serialized.id=this.annotationElementId;if(context===null){return serialized;}context.stamps||(context.stamps=new Map());var area=_classPrivateFieldGet(_isSvg,this)?(serialized.rect[2]-serialized.rect[0])*(serialized.rect[3]-serialized.rect[1]):null;if(!context.stamps.has(_classPrivateFieldGet(_bitmapId,this))){context.stamps.set(_classPrivateFieldGet(_bitmapId,this),{area:area,serialized:serialized});serialized.bitmap=_assertClassBrand(_StampEditor_brand,this,_serializeBitmap).call(this,false);}else if(_classPrivateFieldGet(_isSvg,this)){var prevData=context.stamps.get(_classPrivateFieldGet(_bitmapId,this));if(area>prevData.area){prevData.area=area;prevData.serialized.bitmap.close();prevData.serialized.bitmap=_assertClassBrand(_StampEditor_brand,this,_serializeBitmap).call(this,false);}}return serialized;}},{key:"renderAnnotationElement",value:function renderAnnotationElement(annotation){annotation.updateEdited({rect:this.getRect(0,0)});return null;}}],[{key:"initialize",value:function initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager);}},{key:"isHandlingMimeForPasting",value:function isHandlingMimeForPasting(mime){return _SupportedImageMimeTypes.includes(mime);}},{key:"paste",value:function paste(item,parent){parent.pasteEditor(_AnnotationEditorType.STAMP,{bitmapFile:item.getAsFile()});}},{key:"computeTelemetryFinalData",value:function computeTelemetryFinalData(data){var _hasAltTextStats$get,_hasAltTextStats$get2;var hasAltTextStats=data.get("hasAltText");return{hasAltText:(_hasAltTextStats$get=hasAltTextStats.get(true))!==null&&_hasAltTextStats$get!==void 0?_hasAltTextStats$get:0,hasNoAltText:(_hasAltTextStats$get2=hasAltTextStats.get(false))!==null&&_hasAltTextStats$get2!==void 0?_hasAltTextStats$get2:0};}},{key:"deserialize",value:function(){var _deserialize7=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee56(data,parent,uiManager){var initialData,missingCanvas,_yield$parent$_struct,_data0,_data0$data,_rect5,rotation,id,structParent,popupRef,container,pageNumber,canvas,_bitmapId2,_bitmap2,_uiManager$imageManag,altText,editor,_data1,rect,bitmap,bitmapUrl,bitmapId,isSvg,accessibilityData,_editor$pageDimension3,parentWidth,parentHeight,_t23,_t24,_t25,_t26;return _regenerator().w(function(_context57){while(1)switch(_context57.n){case 0:initialData=null;missingCanvas=false;if(!(data instanceof StampAnnotationElement)){_context57.n=6;break;}_data0=data,_data0$data=_data0.data,_rect5=_data0$data.rect,rotation=_data0$data.rotation,id=_data0$data.id,structParent=_data0$data.structParent,popupRef=_data0$data.popupRef,container=_data0.container,pageNumber=_data0.parent.page.pageNumber,canvas=_data0.canvas;if(canvas){delete data.canvas;_uiManager$imageManag=uiManager.imageManager.getFromCanvas(container.id,canvas);_bitmapId2=_uiManager$imageManag.id;_bitmap2=_uiManager$imageManag.bitmap;canvas.remove();}else{missingCanvas=true;data._hasNoCanvas=true;}_context57.n=1;return parent._structTree.getAriaAttributes("".concat(AnnotationPrefix).concat(id));case 1:_t25=_yield$parent$_struct=_context57.v;_t24=_t25===null;if(_t24){_context57.n=2;break;}_t24=_yield$parent$_struct===void 0;case 2:if(!_t24){_context57.n=3;break;}_t26=void 0;_context57.n=4;break;case 3:_t26=_yield$parent$_struct.get("aria-label");case 4:_t23=_t26;if(_t23){_context57.n=5;break;}_t23="";case 5:altText=_t23;initialData=data={annotationType:_AnnotationEditorType.STAMP,bitmapId:_bitmapId2,bitmap:_bitmap2,pageIndex:pageNumber-1,rect:_rect5.slice(0),rotation:rotation,id:id,deleted:false,accessibilityData:{decorative:false,altText:altText},isSvg:false,structParent:structParent,popupRef:popupRef};case 6:_context57.n=7;return _superPropGet(StampEditor,"deserialize",this,2)([data,parent,uiManager]);case 7:editor=_context57.v;_data1=data,rect=_data1.rect,bitmap=_data1.bitmap,bitmapUrl=_data1.bitmapUrl,bitmapId=_data1.bitmapId,isSvg=_data1.isSvg,accessibilityData=_data1.accessibilityData;if(missingCanvas){uiManager.addMissingCanvas(data.id,editor);_classPrivateFieldSet(_missingCanvas,editor,true);}else if(bitmapId&&uiManager.imageManager.isValidId(bitmapId)){_classPrivateFieldSet(_bitmapId,editor,bitmapId);if(bitmap){_classPrivateFieldSet(_bitmap,editor,bitmap);}}else{_classPrivateFieldSet(_bitmapUrl,editor,bitmapUrl);}_classPrivateFieldSet(_isSvg,editor,isSvg);_editor$pageDimension3=_slicedToArray(editor.pageDimensions,2),parentWidth=_editor$pageDimension3[0],parentHeight=_editor$pageDimension3[1];editor.width=(rect[2]-rect[0])/parentWidth;editor.height=(rect[3]-rect[1])/parentHeight;editor.annotationElementId=data.id||null;if(accessibilityData){editor.altTextData=accessibilityData;}editor._initialData=initialData;_classPrivateFieldSet(_hasBeenAddedInUndoStack,editor,!!initialData);return _context57.a(2,editor);}},_callee56,this);}));function deserialize(_x57,_x58,_x59){return _deserialize7.apply(this,arguments);}return deserialize;}()}]);}(AnnotationEditor);function _getBitmapFetched(data){var fromId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!data){this.remove();return;}_classPrivateFieldSet(_bitmap,this,data.bitmap);if(!fromId){_classPrivateFieldSet(_bitmapId,this,data.id);_classPrivateFieldSet(_isSvg,this,data.isSvg);}if(data.file){_classPrivateFieldSet(_bitmapFileName,this,data.file.name);}_assertClassBrand(_StampEditor_brand,this,_createCanvas2).call(this);}function _getBitmapDone(){_classPrivateFieldSet(_bitmapPromise,this,null);this._uiManager.enableWaiting(false);if(!_classPrivateFieldGet(_canvas,this)){return;}if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&_classPrivateFieldGet(_bitmap,this)){this._editToolbar.hide();this._uiManager.editAltText(this,true);return;}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&_classPrivateFieldGet(_bitmap,this)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:false,alt_text_type:"empty"}});try{this.mlGuessAltText();}catch(_unused1){}}this.div.focus();}function _getBitmap(){var _this119=this;if(_classPrivateFieldGet(_bitmapId,this)){this._uiManager.enableWaiting(true);this._uiManager.imageManager.getFromId(_classPrivateFieldGet(_bitmapId,this)).then(function(data){return _assertClassBrand(_StampEditor_brand,_this119,_getBitmapFetched).call(_this119,data,true);})["finally"](function(){return _assertClassBrand(_StampEditor_brand,_this119,_getBitmapDone).call(_this119);});return;}if(_classPrivateFieldGet(_bitmapUrl,this)){var url=_classPrivateFieldGet(_bitmapUrl,this);_classPrivateFieldSet(_bitmapUrl,this,null);this._uiManager.enableWaiting(true);_classPrivateFieldSet(_bitmapPromise,this,this._uiManager.imageManager.getFromUrl(url).then(function(data){return _assertClassBrand(_StampEditor_brand,_this119,_getBitmapFetched).call(_this119,data);})["finally"](function(){return _assertClassBrand(_StampEditor_brand,_this119,_getBitmapDone).call(_this119);}));return;}if(_classPrivateFieldGet(_bitmapFile,this)){var file=_classPrivateFieldGet(_bitmapFile,this);_classPrivateFieldSet(_bitmapFile,this,null);this._uiManager.enableWaiting(true);_classPrivateFieldSet(_bitmapPromise,this,this._uiManager.imageManager.getFromFile(file).then(function(data){return _assertClassBrand(_StampEditor_brand,_this119,_getBitmapFetched).call(_this119,data);})["finally"](function(){return _assertClassBrand(_StampEditor_brand,_this119,_getBitmapDone).call(_this119);}));return;}var input=document.createElement("input");input.type="file";input.accept=_SupportedImageMimeTypes.join(",");var signal=this._uiManager._signal;_classPrivateFieldSet(_bitmapPromise,this,new Promise(function(resolve){input.addEventListener("change",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee62(){var data;return _regenerator().w(function(_context63){while(1)switch(_context63.n){case 0:if(!(!input.files||input.files.length===0)){_context63.n=1;break;}_this119.remove();_context63.n=3;break;case 1:_this119._uiManager.enableWaiting(true);_context63.n=2;return _this119._uiManager.imageManager.getFromFile(input.files[0]);case 2:data=_context63.v;_this119._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:_this119._uiManager.useNewAltTextFlow}});_assertClassBrand(_StampEditor_brand,_this119,_getBitmapFetched).call(_this119,data);case 3:resolve();case 4:return _context63.a(2);}},_callee62);})),{signal:signal});input.addEventListener("cancel",function(){_this119.remove();resolve();},{signal:signal});})["finally"](function(){return _assertClassBrand(_StampEditor_brand,_this119,_getBitmapDone).call(_this119);}));input.click();}function _createCanvas2(){var _this$_initialOptions2;var div=this.div;var _classPrivateFieldGet175=_classPrivateFieldGet(_bitmap,this),width=_classPrivateFieldGet175.width,height=_classPrivateFieldGet175.height;var _this$pageDimensions1=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions1[0],pageHeight=_this$pageDimensions1[1];var MAX_RATIO=0.75;if(this.width){width=this.width*pageWidth;height=this.height*pageHeight;}else if(width>MAX_RATIO*pageWidth||height>MAX_RATIO*pageHeight){var factor=Math.min(MAX_RATIO*pageWidth/width,MAX_RATIO*pageHeight/height);width*=factor;height*=factor;}var _this$parentDimension22=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension22[0],parentHeight=_this$parentDimension22[1];this.setDims(width*parentWidth/pageWidth,height*parentHeight/pageHeight);this._uiManager.enableWaiting(false);var canvas=_classPrivateFieldSet(_canvas,this,document.createElement("canvas"));canvas.setAttribute("role","img");this.addContainer(canvas);this.width=width/pageWidth;this.height=height/pageHeight;if((_this$_initialOptions2=this._initialOptions)!==null&&_this$_initialOptions2!==void 0&&_this$_initialOptions2.isCentered){this.center();}else{this.fixAndSetPosition();}this._initialOptions=null;if(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId){div.hidden=false;}_assertClassBrand(_StampEditor_brand,this,_drawBitmap).call(this);if(!_classPrivateFieldGet(_hasBeenAddedInUndoStack,this)){this.parent.addUndoableEditor(this);_classPrivateFieldSet(_hasBeenAddedInUndoStack,this,true);}this._reportTelemetry({action:"inserted_image"});if(_classPrivateFieldGet(_bitmapFileName,this)){this.div.setAttribute("aria-description",_classPrivateFieldGet(_bitmapFileName,this));}}function _scaleBitmap(width,height){var _classPrivateFieldGet176=_classPrivateFieldGet(_bitmap,this),bitmapWidth=_classPrivateFieldGet176.width,bitmapHeight=_classPrivateFieldGet176.height;var newWidth=bitmapWidth;var newHeight=bitmapHeight;var bitmap=_classPrivateFieldGet(_bitmap,this);while(newWidth>2*width||newHeight>2*height){var prevWidth=newWidth;var prevHeight=newHeight;if(newWidth>2*width){newWidth=newWidth>=16384?Math.floor(newWidth/2)-1:Math.ceil(newWidth/2);}if(newHeight>2*height){newHeight=newHeight>=16384?Math.floor(newHeight/2)-1:Math.ceil(newHeight/2);}var offscreen=new OffscreenCanvas(newWidth,newHeight);var ctx=offscreen.getContext("2d");ctx.drawImage(bitmap,0,0,prevWidth,prevHeight,0,0,newWidth,newHeight);bitmap=offscreen.transferToImageBitmap();}return bitmap;}function _drawBitmap(){var _this$parentDimension23=_slicedToArray(this.parentDimensions,2),parentWidth=_this$parentDimension23[0],parentHeight=_this$parentDimension23[1];var width=this.width,height=this.height;var outputScale=new _OutputScale();var scaledWidth=Math.ceil(width*parentWidth*outputScale.sx);var scaledHeight=Math.ceil(height*parentHeight*outputScale.sy);var canvas=_classPrivateFieldGet(_canvas,this);if(!canvas||canvas.width===scaledWidth&&canvas.height===scaledHeight){return;}canvas.width=scaledWidth;canvas.height=scaledHeight;var bitmap=_classPrivateFieldGet(_isSvg,this)?_classPrivateFieldGet(_bitmap,this):_assertClassBrand(_StampEditor_brand,this,_scaleBitmap).call(this,scaledWidth,scaledHeight);var ctx=canvas.getContext("2d");ctx.filter=this._uiManager.hcmFilter;ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,scaledWidth,scaledHeight);}function _serializeBitmap(toUrl){if(toUrl){if(_classPrivateFieldGet(_isSvg,this)){var url=this._uiManager.imageManager.getSvgUrl(_classPrivateFieldGet(_bitmapId,this));if(url){return url;}}var canvas=document.createElement("canvas");var _classPrivateFieldGet177=_classPrivateFieldGet(_bitmap,this);canvas.width=_classPrivateFieldGet177.width;canvas.height=_classPrivateFieldGet177.height;var ctx=canvas.getContext("2d");ctx.drawImage(_classPrivateFieldGet(_bitmap,this),0,0);return canvas.toDataURL();}if(_classPrivateFieldGet(_isSvg,this)){var _this$pageDimensions10=_slicedToArray(this.pageDimensions,2),pageWidth=_this$pageDimensions10[0],pageHeight=_this$pageDimensions10[1];var width=Math.round(this.width*pageWidth*_PixelsPerInch.PDF_TO_CSS_UNITS);var height=Math.round(this.height*pageHeight*_PixelsPerInch.PDF_TO_CSS_UNITS);var offscreen=new OffscreenCanvas(width,height);var _ctx2=offscreen.getContext("2d");_ctx2.drawImage(_classPrivateFieldGet(_bitmap,this),0,0,_classPrivateFieldGet(_bitmap,this).width,_classPrivateFieldGet(_bitmap,this).height,0,0,width,height);return offscreen.transferToImageBitmap();}return structuredClone(_classPrivateFieldGet(_bitmap,this));}function _hasElementChanged4(serialized){var _serialized$accessibi;var _this$_initialData4=this._initialData,pageIndex=_this$_initialData4.pageIndex,altText=_this$_initialData4.accessibilityData.altText;var isSamePageIndex=serialized.pageIndex===pageIndex;var isSameAltText=(((_serialized$accessibi=serialized.accessibilityData)===null||_serialized$accessibi===void 0?void 0:_serialized$accessibi.alt)||"")===altText;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&isSamePageIndex&&isSameAltText,isSameAltText:isSameAltText};}_defineProperty(StampEditor,"_type","stamp");_defineProperty(StampEditor,"_editorType",_AnnotationEditorType.STAMP);;// ./src/display/editor/annotation_editor_layer.js
var _accessibilityManager2=/*#__PURE__*/new WeakMap();var _allowClick=/*#__PURE__*/new WeakMap();var _annotationLayer=/*#__PURE__*/new WeakMap();var _clickAC=/*#__PURE__*/new WeakMap();var _editorFocusTimeoutId=/*#__PURE__*/new WeakMap();var _editors=/*#__PURE__*/new WeakMap();var _hadPointerDown=/*#__PURE__*/new WeakMap();var _isDisabling=/*#__PURE__*/new WeakMap();var _isEnabling=/*#__PURE__*/new WeakMap();var _drawingAC=/*#__PURE__*/new WeakMap();var _focusedElement=/*#__PURE__*/new WeakMap();var _textLayer=/*#__PURE__*/new WeakMap();var _textSelectionAC=/*#__PURE__*/new WeakMap();var _uiManager4=/*#__PURE__*/new WeakMap();var _AnnotationEditorLayer_brand=/*#__PURE__*/new WeakSet();var _AnnotationEditorLayer=/*#__PURE__*/function(){function _AnnotationEditorLayer(_ref128){var uiManager=_ref128.uiManager,pageIndex=_ref128.pageIndex,div=_ref128.div,structTreeLayer=_ref128.structTreeLayer,accessibilityManager=_ref128.accessibilityManager,annotationLayer=_ref128.annotationLayer,drawLayer=_ref128.drawLayer,textLayer=_ref128.textLayer,viewport=_ref128.viewport,l10n=_ref128.l10n;_classCallCheck(this,_AnnotationEditorLayer);_classPrivateMethodInitSpec(this,_AnnotationEditorLayer_brand);_classPrivateFieldInitSpec(this,_accessibilityManager2,void 0);_classPrivateFieldInitSpec(this,_allowClick,false);_classPrivateFieldInitSpec(this,_annotationLayer,null);_classPrivateFieldInitSpec(this,_clickAC,null);_classPrivateFieldInitSpec(this,_editorFocusTimeoutId,null);_classPrivateFieldInitSpec(this,_editors,new Map());_classPrivateFieldInitSpec(this,_hadPointerDown,false);_classPrivateFieldInitSpec(this,_isDisabling,false);_classPrivateFieldInitSpec(this,_isEnabling,false);_classPrivateFieldInitSpec(this,_drawingAC,null);_classPrivateFieldInitSpec(this,_focusedElement,null);_classPrivateFieldInitSpec(this,_textLayer,null);_classPrivateFieldInitSpec(this,_textSelectionAC,null);_classPrivateFieldInitSpec(this,_uiManager4,void 0);var editorTypes=_toConsumableArray(_editorTypes2._.values());if(!_AnnotationEditorLayer._initialized){_AnnotationEditorLayer._initialized=true;var _iterator158=_createForOfIteratorHelper(editorTypes),_step158;try{for(_iterator158.s();!(_step158=_iterator158.n()).done;){var editorType=_step158.value;editorType.initialize(l10n,uiManager);}}catch(err){_iterator158.e(err);}finally{_iterator158.f();}}uiManager.registerEditorTypes(editorTypes);_classPrivateFieldSet(_uiManager4,this,uiManager);this.pageIndex=pageIndex;this.div=div;_classPrivateFieldSet(_accessibilityManager2,this,accessibilityManager);_classPrivateFieldSet(_annotationLayer,this,annotationLayer);this.viewport=viewport;_classPrivateFieldSet(_textLayer,this,textLayer);this.drawLayer=drawLayer;this._structTree=structTreeLayer;_classPrivateFieldGet(_uiManager4,this).addLayer(this);}return _createClass(_AnnotationEditorLayer,[{key:"isEmpty",get:function get(){return _classPrivateFieldGet(_editors,this).size===0;}},{key:"isInvisible",get:function get(){return this.isEmpty&&_classPrivateFieldGet(_uiManager4,this).getMode()===_AnnotationEditorType.NONE;}},{key:"updateToolbar",value:function updateToolbar(mode){_classPrivateFieldGet(_uiManager4,this).updateToolbar(mode);}},{key:"updateMode",value:function updateMode(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_classPrivateFieldGet(_uiManager4,this).getMode();_assertClassBrand(_AnnotationEditorLayer_brand,this,_cleanup2).call(this);switch(mode){case _AnnotationEditorType.NONE:this.disableTextSelection();this.togglePointerEvents(false);this.toggleAnnotationLayerPointerEvents(true);this.disableClick();return;case _AnnotationEditorType.INK:this.disableTextSelection();this.togglePointerEvents(true);this.enableClick();break;case _AnnotationEditorType.HIGHLIGHT:this.enableTextSelection();this.togglePointerEvents(false);this.disableClick();break;default:this.disableTextSelection();this.togglePointerEvents(true);this.enableClick();}this.toggleAnnotationLayerPointerEvents(false);var classList=this.div.classList;var _iterator159=_createForOfIteratorHelper(_editorTypes2._.values()),_step159;try{for(_iterator159.s();!(_step159=_iterator159.n()).done;){var editorType=_step159.value;classList.toggle("".concat(editorType._type,"Editing"),mode===editorType._editorType);}}catch(err){_iterator159.e(err);}finally{_iterator159.f();}this.div.hidden=false;}},{key:"hasTextLayer",value:function hasTextLayer(textLayer){var _classPrivateFieldGet118;return textLayer===((_classPrivateFieldGet118=_classPrivateFieldGet(_textLayer,this))===null||_classPrivateFieldGet118===void 0?void 0:_classPrivateFieldGet118.div);}},{key:"setEditingState",value:function setEditingState(isEditing){_classPrivateFieldGet(_uiManager4,this).setEditingState(isEditing);}},{key:"addCommands",value:function addCommands(params){_classPrivateFieldGet(_uiManager4,this).addCommands(params);}},{key:"cleanUndoStack",value:function cleanUndoStack(type){_classPrivateFieldGet(_uiManager4,this).cleanUndoStack(type);}},{key:"toggleDrawing",value:function toggleDrawing(){var enabled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.div.classList.toggle("drawing",!enabled);}},{key:"togglePointerEvents",value:function togglePointerEvents(){var enabled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.div.classList.toggle("disabled",!enabled);}},{key:"toggleAnnotationLayerPointerEvents",value:function toggleAnnotationLayerPointerEvents(){var _classPrivateFieldGet119;var enabled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;(_classPrivateFieldGet119=_classPrivateFieldGet(_annotationLayer,this))===null||_classPrivateFieldGet119===void 0||_classPrivateFieldGet119.div.classList.toggle("disabled",!enabled);}},{key:"enable",value:function(){var _enable=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee57(){var annotationElementIds,_iterator160,_step160,editor,editables,_iterator161,_step161,editable,_editor4,_t27;return _regenerator().w(function(_context58){while(1)switch(_context58.n){case 0:_classPrivateFieldSet(_isEnabling,this,true);this.div.tabIndex=0;this.togglePointerEvents(true);annotationElementIds=new Set();_iterator160=_createForOfIteratorHelper(_classPrivateFieldGet(_editors,this).values());try{for(_iterator160.s();!(_step160=_iterator160.n()).done;){editor=_step160.value;editor.enableEditing();editor.show(true);if(editor.annotationElementId){_classPrivateFieldGet(_uiManager4,this).removeChangedExistingAnnotation(editor);annotationElementIds.add(editor.annotationElementId);}}}catch(err){_iterator160.e(err);}finally{_iterator160.f();}if(_classPrivateFieldGet(_annotationLayer,this)){_context58.n=1;break;}_classPrivateFieldSet(_isEnabling,this,false);return _context58.a(2);case 1:editables=_classPrivateFieldGet(_annotationLayer,this).getEditableAnnotations();_iterator161=_createForOfIteratorHelper(editables);_context58.p=2;_iterator161.s();case 3:if((_step161=_iterator161.n()).done){_context58.n=9;break;}editable=_step161.value;editable.hide();if(!_classPrivateFieldGet(_uiManager4,this).isDeletedAnnotationElement(editable.data.id)){_context58.n=4;break;}return _context58.a(3,8);case 4:if(!annotationElementIds.has(editable.data.id)){_context58.n=5;break;}return _context58.a(3,8);case 5:_context58.n=6;return this.deserialize(editable);case 6:_editor4=_context58.v;if(_editor4){_context58.n=7;break;}return _context58.a(3,8);case 7:this.addOrRebuild(_editor4);_editor4.enableEditing();case 8:_context58.n=3;break;case 9:_context58.n=11;break;case 10:_context58.p=10;_t27=_context58.v;_iterator161.e(_t27);case 11:_context58.p=11;_iterator161.f();return _context58.f(11);case 12:_classPrivateFieldSet(_isEnabling,this,false);case 13:return _context58.a(2);}},_callee57,this,[[2,10,11,12]]);}));function enable(){return _enable.apply(this,arguments);}return enable;}()},{key:"disable",value:function disable(){_classPrivateFieldSet(_isDisabling,this,true);this.div.tabIndex=-1;this.togglePointerEvents(false);var changedAnnotations=new Map();var resetAnnotations=new Map();var _iterator162=_createForOfIteratorHelper(_classPrivateFieldGet(_editors,this).values()),_step162;try{for(_iterator162.s();!(_step162=_iterator162.n()).done;){var _this$getEditableAnno;var _editor5=_step162.value;_editor5.disableEditing();if(!_editor5.annotationElementId){continue;}if(_editor5.serialize()!==null){changedAnnotations.set(_editor5.annotationElementId,_editor5);continue;}else{resetAnnotations.set(_editor5.annotationElementId,_editor5);}(_this$getEditableAnno=this.getEditableAnnotation(_editor5.annotationElementId))===null||_this$getEditableAnno===void 0||_this$getEditableAnno.show();_editor5.remove();}}catch(err){_iterator162.e(err);}finally{_iterator162.f();}if(_classPrivateFieldGet(_annotationLayer,this)){var editables=_classPrivateFieldGet(_annotationLayer,this).getEditableAnnotations();var _iterator163=_createForOfIteratorHelper(editables),_step163;try{for(_iterator163.s();!(_step163=_iterator163.n()).done;){var editable=_step163.value;var id=editable.data.id;if(_classPrivateFieldGet(_uiManager4,this).isDeletedAnnotationElement(id)){continue;}var editor=resetAnnotations.get(id);if(editor){editor.resetAnnotationElement(editable);editor.show(false);editable.show();continue;}editor=changedAnnotations.get(id);if(editor){_classPrivateFieldGet(_uiManager4,this).addChangedExistingAnnotation(editor);if(editor.renderAnnotationElement(editable)){editor.show(false);}}editable.show();}}catch(err){_iterator163.e(err);}finally{_iterator163.f();}}_assertClassBrand(_AnnotationEditorLayer_brand,this,_cleanup2).call(this);if(this.isEmpty){this.div.hidden=true;}var classList=this.div.classList;var _iterator164=_createForOfIteratorHelper(_editorTypes2._.values()),_step164;try{for(_iterator164.s();!(_step164=_iterator164.n()).done;){var editorType=_step164.value;classList.remove("".concat(editorType._type,"Editing"));}}catch(err){_iterator164.e(err);}finally{_iterator164.f();}this.disableTextSelection();this.toggleAnnotationLayerPointerEvents(true);_classPrivateFieldSet(_isDisabling,this,false);}},{key:"getEditableAnnotation",value:function getEditableAnnotation(id){var _classPrivateFieldGet120;return((_classPrivateFieldGet120=_classPrivateFieldGet(_annotationLayer,this))===null||_classPrivateFieldGet120===void 0?void 0:_classPrivateFieldGet120.getEditableAnnotation(id))||null;}},{key:"setActiveEditor",value:function setActiveEditor(editor){var currentActive=_classPrivateFieldGet(_uiManager4,this).getActive();if(currentActive===editor){return;}_classPrivateFieldGet(_uiManager4,this).setActiveEditor(editor);}},{key:"enableTextSelection",value:function enableTextSelection(){var _classPrivateFieldGet121;this.div.tabIndex=-1;if((_classPrivateFieldGet121=_classPrivateFieldGet(_textLayer,this))!==null&&_classPrivateFieldGet121!==void 0&&_classPrivateFieldGet121.div&&!_classPrivateFieldGet(_textSelectionAC,this)){_classPrivateFieldSet(_textSelectionAC,this,new AbortController());var signal=_classPrivateFieldGet(_uiManager4,this).combinedSignal(_classPrivateFieldGet(_textSelectionAC,this));_classPrivateFieldGet(_textLayer,this).div.addEventListener("pointerdown",_assertClassBrand(_AnnotationEditorLayer_brand,this,_textLayerPointerDown).bind(this),{signal:signal});_classPrivateFieldGet(_textLayer,this).div.classList.add("highlighting");}}},{key:"disableTextSelection",value:function disableTextSelection(){var _classPrivateFieldGet122;this.div.tabIndex=0;if((_classPrivateFieldGet122=_classPrivateFieldGet(_textLayer,this))!==null&&_classPrivateFieldGet122!==void 0&&_classPrivateFieldGet122.div&&_classPrivateFieldGet(_textSelectionAC,this)){_classPrivateFieldGet(_textSelectionAC,this).abort();_classPrivateFieldSet(_textSelectionAC,this,null);_classPrivateFieldGet(_textLayer,this).div.classList.remove("highlighting");}}},{key:"enableClick",value:function enableClick(){if(_classPrivateFieldGet(_clickAC,this)){return;}_classPrivateFieldSet(_clickAC,this,new AbortController());var signal=_classPrivateFieldGet(_uiManager4,this).combinedSignal(_classPrivateFieldGet(_clickAC,this));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:signal});var pointerup=this.pointerup.bind(this);this.div.addEventListener("pointerup",pointerup,{signal:signal});this.div.addEventListener("pointercancel",pointerup,{signal:signal});}},{key:"disableClick",value:function disableClick(){var _classPrivateFieldGet123;(_classPrivateFieldGet123=_classPrivateFieldGet(_clickAC,this))===null||_classPrivateFieldGet123===void 0||_classPrivateFieldGet123.abort();_classPrivateFieldSet(_clickAC,this,null);}},{key:"attach",value:function attach(editor){_classPrivateFieldGet(_editors,this).set(editor.id,editor);var annotationElementId=editor.annotationElementId;if(annotationElementId&&_classPrivateFieldGet(_uiManager4,this).isDeletedAnnotationElement(annotationElementId)){_classPrivateFieldGet(_uiManager4,this).removeDeletedAnnotationElement(editor);}}},{key:"detach",value:function detach(editor){var _classPrivateFieldGet124;_classPrivateFieldGet(_editors,this)["delete"](editor.id);(_classPrivateFieldGet124=_classPrivateFieldGet(_accessibilityManager2,this))===null||_classPrivateFieldGet124===void 0||_classPrivateFieldGet124.removePointerInTextLayer(editor.contentDiv);if(!_classPrivateFieldGet(_isDisabling,this)&&editor.annotationElementId){_classPrivateFieldGet(_uiManager4,this).addDeletedAnnotationElement(editor);}}},{key:"remove",value:function remove(editor){this.detach(editor);_classPrivateFieldGet(_uiManager4,this).removeEditor(editor);editor.div.remove();editor.isAttachedToDOM=false;}},{key:"changeParent",value:function changeParent(editor){var _editor$parent;if(editor.parent===this){return;}if(editor.parent&&editor.annotationElementId){_classPrivateFieldGet(_uiManager4,this).addDeletedAnnotationElement(editor.annotationElementId);AnnotationEditor.deleteAnnotationElement(editor);editor.annotationElementId=null;}this.attach(editor);(_editor$parent=editor.parent)===null||_editor$parent===void 0||_editor$parent.detach(editor);editor.setParent(this);if(editor.div&&editor.isAttachedToDOM){editor.div.remove();this.div.append(editor.div);}}},{key:"add",value:function add(editor){if(editor.parent===this&&editor.isAttachedToDOM){return;}this.changeParent(editor);_classPrivateFieldGet(_uiManager4,this).addEditor(editor);this.attach(editor);if(!editor.isAttachedToDOM){var div=editor.render();this.div.append(div);editor.isAttachedToDOM=true;}editor.fixAndSetPosition();editor.onceAdded(!_classPrivateFieldGet(_isEnabling,this));_classPrivateFieldGet(_uiManager4,this).addToAnnotationStorage(editor);editor._reportTelemetry(editor.telemetryInitialData);}},{key:"moveEditorInDOM",value:function moveEditorInDOM(editor){var _this104=this,_classPrivateFieldGet125;if(!editor.isAttachedToDOM){return;}var _document3=document,activeElement=_document3.activeElement;if(editor.div.contains(activeElement)&&!_classPrivateFieldGet(_editorFocusTimeoutId,this)){editor._focusEventsAllowed=false;_classPrivateFieldSet(_editorFocusTimeoutId,this,setTimeout(function(){_classPrivateFieldSet(_editorFocusTimeoutId,_this104,null);if(!editor.div.contains(document.activeElement)){editor.div.addEventListener("focusin",function(){editor._focusEventsAllowed=true;},{once:true,signal:_classPrivateFieldGet(_uiManager4,_this104)._signal});activeElement.focus();}else{editor._focusEventsAllowed=true;}},0));}editor._structTreeParentId=(_classPrivateFieldGet125=_classPrivateFieldGet(_accessibilityManager2,this))===null||_classPrivateFieldGet125===void 0?void 0:_classPrivateFieldGet125.moveElementInDOM(this.div,editor.div,editor.contentDiv,true);}},{key:"addOrRebuild",value:function addOrRebuild(editor){if(editor.needsToBeRebuilt()){editor.parent||(editor.parent=this);editor.rebuild();editor.show();}else{this.add(editor);}}},{key:"addUndoableEditor",value:function addUndoableEditor(editor){var cmd=function cmd(){return editor._uiManager.rebuild(editor);};var undo=function undo(){editor.remove();};this.addCommands({cmd:cmd,undo:undo,mustExec:false});}},{key:"getNextId",value:function getNextId(){return _classPrivateFieldGet(_uiManager4,this).getId();}},{key:"combinedSignal",value:function combinedSignal(ac){return _classPrivateFieldGet(_uiManager4,this).combinedSignal(ac);}},{key:"canCreateNewEmptyEditor",value:function canCreateNewEmptyEditor(){var _classPrivateGetter2;return(_classPrivateGetter2=_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType))===null||_classPrivateGetter2===void 0?void 0:_classPrivateGetter2.canCreateNewEmptyEditor();}},{key:"pasteEditor",value:function(){var _pasteEditor=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee58(mode,params){var _assertClassBrand$cal29,offsetX,offsetY,id,editor;return _regenerator().w(function(_context59){while(1)switch(_context59.n){case 0:_classPrivateFieldGet(_uiManager4,this).updateToolbar(mode);_context59.n=1;return _classPrivateFieldGet(_uiManager4,this).updateMode(mode);case 1:_assertClassBrand$cal29=_assertClassBrand(_AnnotationEditorLayer_brand,this,_getCenterPoint).call(this),offsetX=_assertClassBrand$cal29.offsetX,offsetY=_assertClassBrand$cal29.offsetY;id=this.getNextId();editor=_assertClassBrand(_AnnotationEditorLayer_brand,this,_createNewEditor).call(this,_objectSpread({parent:this,id:id,x:offsetX,y:offsetY,uiManager:_classPrivateFieldGet(_uiManager4,this),isCentered:true},params));if(editor){this.add(editor);}case 2:return _context59.a(2);}},_callee58,this);}));function pasteEditor(_x60,_x61){return _pasteEditor.apply(this,arguments);}return pasteEditor;}()},{key:"deserialize",value:function(){var _deserialize8=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee59(data){var _editorTypes2$_$get,_data$annotationType;var _t28;return _regenerator().w(function(_context60){while(1)switch(_context60.n){case 0:_context60.n=1;return(_editorTypes2$_$get=_editorTypes2._.get((_data$annotationType=data.annotationType)!==null&&_data$annotationType!==void 0?_data$annotationType:data.annotationEditorType))===null||_editorTypes2$_$get===void 0?void 0:_editorTypes2$_$get.deserialize(data,this,_classPrivateFieldGet(_uiManager4,this));case 1:_t28=_context60.v;if(_t28){_context60.n=2;break;}_t28=null;case 2:return _context60.a(2,_t28);}},_callee59,this);}));function deserialize(_x62){return _deserialize8.apply(this,arguments);}return deserialize;}()},{key:"createAndAddNewEditor",value:function createAndAddNewEditor(event,isCentered){var data=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var id=this.getNextId();var editor=_assertClassBrand(_AnnotationEditorLayer_brand,this,_createNewEditor).call(this,_objectSpread({parent:this,id:id,x:event.offsetX,y:event.offsetY,uiManager:_classPrivateFieldGet(_uiManager4,this),isCentered:isCentered},data));if(editor){this.add(editor);}return editor;}},{key:"addNewEditor",value:function addNewEditor(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.createAndAddNewEditor(_assertClassBrand(_AnnotationEditorLayer_brand,this,_getCenterPoint).call(this),true,data);}},{key:"setSelected",value:function setSelected(editor){_classPrivateFieldGet(_uiManager4,this).setSelected(editor);}},{key:"toggleSelected",value:function toggleSelected(editor){_classPrivateFieldGet(_uiManager4,this).toggleSelected(editor);}},{key:"unselect",value:function unselect(editor){_classPrivateFieldGet(_uiManager4,this).unselect(editor);}},{key:"pointerup",value:function pointerup(event){var _classPrivateGetter3;var isMac=util_FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){return;}if(event.target!==this.div){return;}if(!_classPrivateFieldGet(_hadPointerDown,this)){return;}_classPrivateFieldSet(_hadPointerDown,this,false);if((_classPrivateGetter3=_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType))!==null&&_classPrivateGetter3!==void 0&&_classPrivateGetter3.isDrawer&&_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType).supportMultipleDrawings){return;}if(!_classPrivateFieldGet(_allowClick,this)){_classPrivateFieldSet(_allowClick,this,true);return;}var currentMode=_classPrivateFieldGet(_uiManager4,this).getMode();if(currentMode===_AnnotationEditorType.STAMP||currentMode===_AnnotationEditorType.SIGNATURE){_classPrivateFieldGet(_uiManager4,this).unselectAll();return;}this.createAndAddNewEditor(event,false);}},{key:"pointerdown",value:function pointerdown(event){var _classPrivateGetter4;if(_classPrivateFieldGet(_uiManager4,this).getMode()===_AnnotationEditorType.HIGHLIGHT){this.enableTextSelection();}if(_classPrivateFieldGet(_hadPointerDown,this)){_classPrivateFieldSet(_hadPointerDown,this,false);return;}var isMac=util_FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){return;}if(event.target!==this.div){return;}_classPrivateFieldSet(_hadPointerDown,this,true);if((_classPrivateGetter4=_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType))!==null&&_classPrivateGetter4!==void 0&&_classPrivateGetter4.isDrawer){this.startDrawingSession(event);return;}var editor=_classPrivateFieldGet(_uiManager4,this).getActive();_classPrivateFieldSet(_allowClick,this,!editor||editor.isEmpty());}},{key:"startDrawingSession",value:function startDrawingSession(event){var _this105=this;this.div.focus({preventScroll:true});if(_classPrivateFieldGet(_drawingAC,this)){_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType).startDrawing(this,_classPrivateFieldGet(_uiManager4,this),false,event);return;}_classPrivateFieldGet(_uiManager4,this).setCurrentDrawingSession(this);_classPrivateFieldSet(_drawingAC,this,new AbortController());var signal=_classPrivateFieldGet(_uiManager4,this).combinedSignal(_classPrivateFieldGet(_drawingAC,this));this.div.addEventListener("blur",function(_ref129){var relatedTarget=_ref129.relatedTarget;if(relatedTarget&&!_this105.div.contains(relatedTarget)){_classPrivateFieldSet(_focusedElement,_this105,null);_this105.commitOrRemove();}},{signal:signal});_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType).startDrawing(this,_classPrivateFieldGet(_uiManager4,this),false,event);}},{key:"pause",value:function pause(on){var _this106=this;if(on){var _document4=document,activeElement=_document4.activeElement;if(this.div.contains(activeElement)){_classPrivateFieldSet(_focusedElement,this,activeElement);}return;}if(_classPrivateFieldGet(_focusedElement,this)){setTimeout(function(){var _classPrivateFieldGet126;(_classPrivateFieldGet126=_classPrivateFieldGet(_focusedElement,_this106))===null||_classPrivateFieldGet126===void 0||_classPrivateFieldGet126.focus();_classPrivateFieldSet(_focusedElement,_this106,null);},0);}}},{key:"endDrawingSession",value:function endDrawingSession(){var isAborted=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!_classPrivateFieldGet(_drawingAC,this)){return null;}_classPrivateFieldGet(_uiManager4,this).setCurrentDrawingSession(null);_classPrivateFieldGet(_drawingAC,this).abort();_classPrivateFieldSet(_drawingAC,this,null);_classPrivateFieldSet(_focusedElement,this,null);return _classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType).endDrawing(isAborted);}},{key:"findNewParent",value:function findNewParent(editor,x,y){var layer=_classPrivateFieldGet(_uiManager4,this).findParent(x,y);if(layer===null||layer===this){return false;}layer.changeParent(editor);return true;}},{key:"commitOrRemove",value:function commitOrRemove(){if(_classPrivateFieldGet(_drawingAC,this)){this.endDrawingSession();return true;}return false;}},{key:"onScaleChanging",value:function onScaleChanging(){if(!_classPrivateFieldGet(_drawingAC,this)){return;}_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType).onScaleChangingWhenDrawing(this);}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet127;this.commitOrRemove();if(((_classPrivateFieldGet127=_classPrivateFieldGet(_uiManager4,this).getActive())===null||_classPrivateFieldGet127===void 0?void 0:_classPrivateFieldGet127.parent)===this){_classPrivateFieldGet(_uiManager4,this).commitOrRemove();_classPrivateFieldGet(_uiManager4,this).setActiveEditor(null);}if(_classPrivateFieldGet(_editorFocusTimeoutId,this)){clearTimeout(_classPrivateFieldGet(_editorFocusTimeoutId,this));_classPrivateFieldSet(_editorFocusTimeoutId,this,null);}var _iterator165=_createForOfIteratorHelper(_classPrivateFieldGet(_editors,this).values()),_step165;try{for(_iterator165.s();!(_step165=_iterator165.n()).done;){var _classPrivateFieldGet128;var editor=_step165.value;(_classPrivateFieldGet128=_classPrivateFieldGet(_accessibilityManager2,this))===null||_classPrivateFieldGet128===void 0||_classPrivateFieldGet128.removePointerInTextLayer(editor.contentDiv);editor.setParent(null);editor.isAttachedToDOM=false;editor.div.remove();}}catch(err){_iterator165.e(err);}finally{_iterator165.f();}this.div=null;_classPrivateFieldGet(_editors,this).clear();_classPrivateFieldGet(_uiManager4,this).removeLayer(this);}},{key:"render",value:function render(_ref130){var viewport=_ref130.viewport;this.viewport=viewport;_setLayerDimensions(this.div,viewport);var _iterator166=_createForOfIteratorHelper(_classPrivateFieldGet(_uiManager4,this).getEditors(this.pageIndex)),_step166;try{for(_iterator166.s();!(_step166=_iterator166.n()).done;){var editor=_step166.value;this.add(editor);editor.rebuild();}}catch(err){_iterator166.e(err);}finally{_iterator166.f();}this.updateMode();}},{key:"update",value:function update(_ref131){var viewport=_ref131.viewport;_classPrivateFieldGet(_uiManager4,this).commitOrRemove();_assertClassBrand(_AnnotationEditorLayer_brand,this,_cleanup2).call(this);var oldRotation=this.viewport.rotation;var rotation=viewport.rotation;this.viewport=viewport;_setLayerDimensions(this.div,{rotation:rotation});if(oldRotation!==rotation){var _iterator167=_createForOfIteratorHelper(_classPrivateFieldGet(_editors,this).values()),_step167;try{for(_iterator167.s();!(_step167=_iterator167.n()).done;){var editor=_step167.value;editor.rotate(rotation);}}catch(err){_iterator167.e(err);}finally{_iterator167.f();}}}},{key:"pageDimensions",get:function get(){var _this$viewport$rawDim=this.viewport.rawDims,pageWidth=_this$viewport$rawDim.pageWidth,pageHeight=_this$viewport$rawDim.pageHeight;return[pageWidth,pageHeight];}},{key:"scale",get:function get(){return _classPrivateFieldGet(_uiManager4,this).viewParameters.realScale;}}]);}();function _textLayerPointerDown(event){var _this120=this;_classPrivateFieldGet(_uiManager4,this).unselectAll();var target=event.target;if(target===_classPrivateFieldGet(_textLayer,this).div||(target.getAttribute("role")==="img"||target.classList.contains("endOfContent"))&&_classPrivateFieldGet(_textLayer,this).div.contains(target)){var isMac=util_FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){return;}_classPrivateFieldGet(_uiManager4,this).showAllEditors("highlight",true,true);_classPrivateFieldGet(_textLayer,this).div.classList.add("free");this.toggleDrawing();HighlightEditor.startHighlighting(this,_classPrivateFieldGet(_uiManager4,this).direction==="ltr",{target:_classPrivateFieldGet(_textLayer,this).div,x:event.x,y:event.y});_classPrivateFieldGet(_textLayer,this).div.addEventListener("pointerup",function(){_classPrivateFieldGet(_textLayer,_this120).div.classList.remove("free");_this120.toggleDrawing(true);},{once:true,signal:_classPrivateFieldGet(_uiManager4,this)._signal});event.preventDefault();}}function _get_currentEditorType(_this103){return _editorTypes2._.get(_classPrivateFieldGet(_uiManager4,_this103).getMode());}function _createNewEditor(params){var editorType=_classPrivateGetter(_AnnotationEditorLayer_brand,this,_get_currentEditorType);return editorType?new editorType.prototype.constructor(params):null;}function _getCenterPoint(){var _this$div$getBounding2=this.div.getBoundingClientRect(),x=_this$div$getBounding2.x,y=_this$div$getBounding2.y,width=_this$div$getBounding2.width,height=_this$div$getBounding2.height;var tlX=Math.max(0,x);var tlY=Math.max(0,y);var brX=Math.min(window.innerWidth,x+width);var brY=Math.min(window.innerHeight,y+height);var centerX=(tlX+brX)/2-x;var centerY=(tlY+brY)/2-y;var _ref152=this.viewport.rotation%180===0?[centerX,centerY]:[centerY,centerX],_ref153=_slicedToArray(_ref152,2),offsetX=_ref153[0],offsetY=_ref153[1];return{offsetX:offsetX,offsetY:offsetY};}function _cleanup2(){var _iterator192=_createForOfIteratorHelper(_classPrivateFieldGet(_editors,this).values()),_step192;try{for(_iterator192.s();!(_step192=_iterator192.n()).done;){var editor=_step192.value;if(editor.isEmpty()){editor.remove();}}}catch(err){_iterator192.e(err);}finally{_iterator192.f();}}_defineProperty(_AnnotationEditorLayer,"_initialized",false);var _editorTypes2={_:new Map([FreeTextEditor,InkEditor,StampEditor,HighlightEditor,SignatureEditor].map(function(type){return[type._editorType,type];}))};;// ./src/display/draw_layer.js
var _parent2=/*#__PURE__*/new WeakMap();var _mapping=/*#__PURE__*/new WeakMap();var _toUpdate=/*#__PURE__*/new WeakMap();var _DrawLayer_brand=/*#__PURE__*/new WeakSet();var _DrawLayer=/*#__PURE__*/function(){function _DrawLayer(_ref132){var pageIndex=_ref132.pageIndex;_classCallCheck(this,_DrawLayer);_classPrivateMethodInitSpec(this,_DrawLayer_brand);_classPrivateFieldInitSpec(this,_parent2,null);_classPrivateFieldInitSpec(this,_mapping,new Map());_classPrivateFieldInitSpec(this,_toUpdate,new Map());this.pageIndex=pageIndex;}return _createClass(_DrawLayer,[{key:"setParent",value:function setParent(parent){if(!_classPrivateFieldGet(_parent2,this)){_classPrivateFieldSet(_parent2,this,parent);return;}if(_classPrivateFieldGet(_parent2,this)!==parent){if(_classPrivateFieldGet(_mapping,this).size>0){var _iterator168=_createForOfIteratorHelper(_classPrivateFieldGet(_mapping,this).values()),_step168;try{for(_iterator168.s();!(_step168=_iterator168.n()).done;){var root=_step168.value;root.remove();parent.append(root);}}catch(err){_iterator168.e(err);}finally{_iterator168.f();}}_classPrivateFieldSet(_parent2,this,parent);}}},{key:"draw",value:function draw(properties){var _DrawLayer$id,_DrawLayer$id2;var isPathUpdatable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var hasClip=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var id=(_id10._=(_DrawLayer$id=_id10._,_DrawLayer$id2=_DrawLayer$id++,_DrawLayer$id),_DrawLayer$id2);var root=_assertClassBrand(_DrawLayer_brand,this,_createSVG2).call(this);var defs=_DrawLayer._svgFactory.createElement("defs");root.append(defs);var path=_DrawLayer._svgFactory.createElement("path");defs.append(path);var pathId="path_p".concat(this.pageIndex,"_").concat(id);path.setAttribute("id",pathId);path.setAttribute("vector-effect","non-scaling-stroke");if(isPathUpdatable){_classPrivateFieldGet(_toUpdate,this).set(id,path);}var clipPathId=hasClip?_assertClassBrand(_DrawLayer_brand,this,_createClipPath).call(this,defs,pathId):null;var use=_DrawLayer._svgFactory.createElement("use");root.append(use);use.setAttribute("href","#".concat(pathId));this.updateProperties(root,properties);_classPrivateFieldGet(_mapping,this).set(id,root);return{id:id,clipPathId:"url(#".concat(clipPathId,")")};}},{key:"drawOutline",value:function drawOutline(properties,mustRemoveSelfIntersections){var _DrawLayer$id3,_DrawLayer$id4;var id=(_id10._=(_DrawLayer$id3=_id10._,_DrawLayer$id4=_DrawLayer$id3++,_DrawLayer$id3),_DrawLayer$id4);var root=_assertClassBrand(_DrawLayer_brand,this,_createSVG2).call(this);var defs=_DrawLayer._svgFactory.createElement("defs");root.append(defs);var path=_DrawLayer._svgFactory.createElement("path");defs.append(path);var pathId="path_p".concat(this.pageIndex,"_").concat(id);path.setAttribute("id",pathId);path.setAttribute("vector-effect","non-scaling-stroke");var maskId;if(mustRemoveSelfIntersections){var mask=_DrawLayer._svgFactory.createElement("mask");defs.append(mask);maskId="mask_p".concat(this.pageIndex,"_").concat(id);mask.setAttribute("id",maskId);mask.setAttribute("maskUnits","objectBoundingBox");var rect=_DrawLayer._svgFactory.createElement("rect");mask.append(rect);rect.setAttribute("width","1");rect.setAttribute("height","1");rect.setAttribute("fill","white");var use=_DrawLayer._svgFactory.createElement("use");mask.append(use);use.setAttribute("href","#".concat(pathId));use.setAttribute("stroke","none");use.setAttribute("fill","black");use.setAttribute("fill-rule","nonzero");use.classList.add("mask");}var use1=_DrawLayer._svgFactory.createElement("use");root.append(use1);use1.setAttribute("href","#".concat(pathId));if(maskId){use1.setAttribute("mask","url(#".concat(maskId,")"));}var use2=use1.cloneNode();root.append(use2);use1.classList.add("mainOutline");use2.classList.add("secondaryOutline");this.updateProperties(root,properties);_classPrivateFieldGet(_mapping,this).set(id,root);return id;}},{key:"finalizeDraw",value:function finalizeDraw(id,properties){_classPrivateFieldGet(_toUpdate,this)["delete"](id);this.updateProperties(id,properties);}},{key:"updateProperties",value:function updateProperties(elementOrId,properties){if(!properties){return;}var root=properties.root,bbox=properties.bbox,rootClass=properties.rootClass,path=properties.path;var element=typeof elementOrId==="number"?_classPrivateFieldGet(_mapping,this).get(elementOrId):elementOrId;if(!element){return;}if(root){_assertClassBrand(_DrawLayer_brand,this,_updateProperties).call(this,element,root);}if(bbox){_setBox.call(_DrawLayer,element,bbox);}if(rootClass){var classList=element.classList;for(var _i30=0,_Object$entries8=Object.entries(rootClass);_i30<_Object$entries8.length;_i30++){var _Object$entries8$_i=_slicedToArray(_Object$entries8[_i30],2),className=_Object$entries8$_i[0],value=_Object$entries8$_i[1];classList.toggle(className,value);}}if(path){var defs=element.firstChild;var pathElement=defs.firstChild;_assertClassBrand(_DrawLayer_brand,this,_updateProperties).call(this,pathElement,path);}}},{key:"updateParent",value:function updateParent(id,layer){if(layer===this){return;}var root=_classPrivateFieldGet(_mapping,this).get(id);if(!root){return;}_classPrivateFieldGet(_parent2,layer).append(root);_classPrivateFieldGet(_mapping,this)["delete"](id);_classPrivateFieldGet(_mapping,layer).set(id,root);}},{key:"remove",value:function remove(id){_classPrivateFieldGet(_toUpdate,this)["delete"](id);if(_classPrivateFieldGet(_parent2,this)===null){return;}_classPrivateFieldGet(_mapping,this).get(id).remove();_classPrivateFieldGet(_mapping,this)["delete"](id);}},{key:"destroy",value:function destroy(){_classPrivateFieldSet(_parent2,this,null);var _iterator169=_createForOfIteratorHelper(_classPrivateFieldGet(_mapping,this).values()),_step169;try{for(_iterator169.s();!(_step169=_iterator169.n()).done;){var root=_step169.value;root.remove();}}catch(err){_iterator169.e(err);}finally{_iterator169.f();}_classPrivateFieldGet(_mapping,this).clear();_classPrivateFieldGet(_toUpdate,this).clear();}}],[{key:"_svgFactory",get:function get(){return _shadow(this,"_svgFactory",new _DOMSVGFactory());}}]);}();_DrawLayer2=_DrawLayer;function _setBox(element,_ref154){var _ref155=_slicedToArray(_ref154,4),x=_ref155[0],y=_ref155[1],width=_ref155[2],height=_ref155[3];var style=element.style;style.top="".concat(100*y,"%");style.left="".concat(100*x,"%");style.width="".concat(100*width,"%");style.height="".concat(100*height,"%");}function _createSVG2(){var svg=_DrawLayer2._svgFactory.create(1,1,true);_classPrivateFieldGet(_parent2,this).append(svg);svg.setAttribute("aria-hidden",true);return svg;}function _createClipPath(defs,pathId){var clipPath=_DrawLayer2._svgFactory.createElement("clipPath");defs.append(clipPath);var clipPathId="clip_".concat(pathId);clipPath.setAttribute("id",clipPathId);clipPath.setAttribute("clipPathUnits","objectBoundingBox");var clipPathUse=_DrawLayer2._svgFactory.createElement("use");clipPath.append(clipPathUse);clipPathUse.setAttribute("href","#".concat(pathId));clipPathUse.classList.add("clip");return clipPathId;}function _updateProperties(element,properties){for(var _i42=0,_Object$entries9=Object.entries(properties);_i42<_Object$entries9.length;_i42++){var _Object$entries9$_i=_slicedToArray(_Object$entries9[_i42],2),key=_Object$entries9$_i[0],value=_Object$entries9$_i[1];if(value===null){element.removeAttribute(key);}else{element.setAttribute(key,value);}}}var _id10={_:0};;// ./src/pdf.js
var pdfjsVersion="5.1.91";var pdfjsBuild="45cbe8bb0";{globalThis.pdfjsTestingUtils={HighlightOutliner:HighlightOutliner};}var __webpack_exports__AbortException=exports.AbortException=__webpack_exports__.AbortException;var __webpack_exports__AnnotationEditorLayer=exports.AnnotationEditorLayer=__webpack_exports__.AnnotationEditorLayer;var __webpack_exports__AnnotationEditorParamsType=exports.AnnotationEditorParamsType=__webpack_exports__.AnnotationEditorParamsType;var __webpack_exports__AnnotationEditorType=exports.AnnotationEditorType=__webpack_exports__.AnnotationEditorType;var __webpack_exports__AnnotationEditorUIManager=exports.AnnotationEditorUIManager=__webpack_exports__.AnnotationEditorUIManager;var __webpack_exports__AnnotationLayer=exports.AnnotationLayer=__webpack_exports__.AnnotationLayer;var __webpack_exports__AnnotationMode=exports.AnnotationMode=__webpack_exports__.AnnotationMode;var __webpack_exports__AnnotationType=exports.AnnotationType=__webpack_exports__.AnnotationType;var __webpack_exports__ColorPicker=exports.ColorPicker=__webpack_exports__.ColorPicker;var __webpack_exports__DOMSVGFactory=exports.DOMSVGFactory=__webpack_exports__.DOMSVGFactory;var __webpack_exports__DrawLayer=exports.DrawLayer=__webpack_exports__.DrawLayer;var __webpack_exports__FeatureTest=exports.FeatureTest=__webpack_exports__.FeatureTest;var __webpack_exports__GlobalWorkerOptions=exports.GlobalWorkerOptions=__webpack_exports__.GlobalWorkerOptions;var __webpack_exports__ImageKind=exports.ImageKind=__webpack_exports__.ImageKind;var __webpack_exports__InvalidPDFException=exports.InvalidPDFException=__webpack_exports__.InvalidPDFException;var __webpack_exports__MathClamp=exports.MathClamp=__webpack_exports__.MathClamp;var __webpack_exports__OPS=exports.OPS=__webpack_exports__.OPS;var __webpack_exports__OutputScale=exports.OutputScale=__webpack_exports__.OutputScale;var __webpack_exports__PDFDataRangeTransport=exports.PDFDataRangeTransport=__webpack_exports__.PDFDataRangeTransport;var __webpack_exports__PDFDateString=exports.PDFDateString=__webpack_exports__.PDFDateString;var __webpack_exports__PDFWorker=exports.PDFWorker=__webpack_exports__.PDFWorker;var __webpack_exports__PasswordResponses=exports.PasswordResponses=__webpack_exports__.PasswordResponses;var __webpack_exports__PermissionFlag=exports.PermissionFlag=__webpack_exports__.PermissionFlag;var __webpack_exports__PixelsPerInch=exports.PixelsPerInch=__webpack_exports__.PixelsPerInch;var __webpack_exports__RenderingCancelledException=exports.RenderingCancelledException=__webpack_exports__.RenderingCancelledException;var __webpack_exports__ResponseException=exports.ResponseException=__webpack_exports__.ResponseException;var __webpack_exports__SignatureExtractor=exports.SignatureExtractor=__webpack_exports__.SignatureExtractor;var __webpack_exports__SupportedImageMimeTypes=exports.SupportedImageMimeTypes=__webpack_exports__.SupportedImageMimeTypes;var __webpack_exports__TextLayer=exports.TextLayer=__webpack_exports__.TextLayer;var __webpack_exports__TouchManager=exports.TouchManager=__webpack_exports__.TouchManager;var __webpack_exports__Util=exports.Util=__webpack_exports__.Util;var __webpack_exports__VerbosityLevel=exports.VerbosityLevel=__webpack_exports__.VerbosityLevel;var __webpack_exports__XfaLayer=exports.XfaLayer=__webpack_exports__.XfaLayer;var __webpack_exports__build=exports.build=__webpack_exports__.build;var __webpack_exports__createValidAbsoluteUrl=exports.createValidAbsoluteUrl=__webpack_exports__.createValidAbsoluteUrl;var __webpack_exports__fetchData=exports.fetchData=__webpack_exports__.fetchData;var __webpack_exports__getDocument=exports.getDocument=__webpack_exports__.getDocument;var __webpack_exports__getFilenameFromUrl=exports.getFilenameFromUrl=__webpack_exports__.getFilenameFromUrl;var __webpack_exports__getPdfFilenameFromUrl=exports.getPdfFilenameFromUrl=__webpack_exports__.getPdfFilenameFromUrl;var __webpack_exports__getUuid=exports.getUuid=__webpack_exports__.getUuid;var __webpack_exports__getXfaPageViewport=exports.getXfaPageViewport=__webpack_exports__.getXfaPageViewport;var __webpack_exports__isDataScheme=exports.isDataScheme=__webpack_exports__.isDataScheme;var __webpack_exports__isPdfFile=exports.isPdfFile=__webpack_exports__.isPdfFile;var __webpack_exports__isValidExplicitDest=exports.isValidExplicitDest=__webpack_exports__.isValidExplicitDest;var __webpack_exports__noContextMenu=exports.noContextMenu=__webpack_exports__.noContextMenu;var __webpack_exports__normalizeUnicode=exports.normalizeUnicode=__webpack_exports__.normalizeUnicode;var __webpack_exports__setLayerDimensions=exports.setLayerDimensions=__webpack_exports__.setLayerDimensions;var __webpack_exports__shadow=exports.shadow=__webpack_exports__.shadow;var __webpack_exports__stopEvent=exports.stopEvent=__webpack_exports__.stopEvent;var __webpack_exports__version=exports.version=__webpack_exports__.version;