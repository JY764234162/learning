import{r as p,j as d}from"./index-Cpi3xnDM.js";class x{constructor(t){this.type=t,this.children=[],this.id=E()}}class m extends x{constructor(t="",n={}){super("text"),this.text=t,this.marks=n}}class f extends x{constructor(t="paragraph",n=[]){super(t),this.children=n}}function E(){return Math.random().toString(36).substring(2,9)}class N{constructor(){this.content=[new f("paragraph",[new m("开始编辑文本...")])],this.selection=null,this.domToNode=new WeakMap,this.nodeToDOM=new Map}getContent(){return this.content}setContent(t){this.content=t}toggleBold(){const t=window.getSelection();if(!t||!t.rangeCount)return;let o=t.getRangeAt(0).commonAncestorContainer;for(;o&&!this.domToNode.has(o);)o=o.parentElement;if(!o)return;const c=this.domToNode.get(o);if(!c||!c.children)return;const i=a=>{a.type==="text"?(a.marks=a.marks||{},a.marks.bold=!a.marks.bold):a.children&&a.children.forEach(i)};i(c),this.setContent([...this.content])}createParagraph(){const t=window.getSelection();if(!t||!t.rangeCount)return;let o=t.getRangeAt(0).commonAncestorContainer;for(;o&&!this.domToNode.has(o);)o=o.parentElement;if(!o)return;const c=this.domToNode.get(o);if(!c)return;const i=this.content.findIndex(e=>e===c);if(i===-1)return;const a=new f("paragraph",[new m("")]);this.content.splice(i+1,0,a),this.setContent([...this.content])}}const w=({editor:r,onChange:t})=>{const n=p.useRef(null),o=e=>{var u,h;if(e.type==="text"){let l=e.text,s=document.createTextNode(l);if((u=e.marks)!=null&&u.bold){const g=document.createElement("strong");g.appendChild(s),s=g}if((h=e.marks)!=null&&h.italic){const g=document.createElement("em");g.appendChild(s),s=g}return s}else{const l=c(e.type),s=document.createElement(l);return s.className=e.type,s.dataset.nodeId=e.id,r.nodeToDOM.set(e.id,s),r.domToNode.set(s,e),e.children.forEach(g=>{const C=o(g);s.appendChild(C)}),s}},c=e=>({paragraph:"p","heading-one":"h1","heading-two":"h2","heading-three":"h3","list-item":"li","numbered-list":"ol","bulleted-list":"ul"})[e]||"div",i=()=>{n.current&&(n.current.innerHTML="",r.nodeToDOM=new Map,r.domToNode=new WeakMap,r.getContent().forEach(e=>{var h;const u=o(e);(h=n.current)==null||h.appendChild(u)}))},a=()=>{n.current&&(n.current.addEventListener("input",e=>{console.log("内容已更新，需要同步到模型"),t&&t(r.getContent())}),n.current.addEventListener("keydown",e=>{var u;if(e.key==="Enter"&&!e.shiftKey){if(e.preventDefault(),r.createParagraph(),i(),(u=n.current)!=null&&u.lastChild){const h=document.createRange(),l=window.getSelection();h.setStart(n.current.lastChild,0),h.collapse(!0),l==null||l.removeAllRanges(),l==null||l.addRange(h)}t&&t(r.getContent())}}))};return p.useEffect(()=>{n.current&&(i(),a())},[]),p.useEffect(()=>{i()},[r.getContent()]),d.jsx("div",{ref:n,className:"editor-content",contentEditable:!0,suppressContentEditableWarning:!0,style:{border:"1px solid #ccc",minHeight:"200px",padding:"10px",borderRadius:"4px",lineHeight:"1.5"}})},T=()=>{const[r]=p.useState(()=>new N),[t,n]=p.useState(r.getContent()),o=i=>{n(i)},c=()=>{r.toggleBold(),n([...r.getContent()])};return d.jsxs("div",{className:"editor-page",style:{maxWidth:"800px",margin:"50px auto"},children:[d.jsx("h1",{style:{marginBottom:"20px"},children:"简易富文本编辑器"}),d.jsxs("div",{className:"editor-container",children:[d.jsx("div",{className:"editor-toolbar",style:{marginBottom:"10px"},children:d.jsx("button",{onClick:c,children:"加粗"})}),d.jsx(w,{editor:r,onChange:o})]}),d.jsxs("div",{style:{marginTop:"20px"},children:[d.jsx("h3",{children:"当前编辑器内容模型："}),d.jsx("pre",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"4px",overflow:"auto"},children:JSON.stringify(t,null,2)})]})]})};export{T as default};
